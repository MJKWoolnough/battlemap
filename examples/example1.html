<!doctype html><html lang="en"><head><title>Battlemap</title><link rel="shortcut icon" sizes="any" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 90'%3E%3Cg stroke='%23000' stroke-linejoin='round' stroke-linecap='round'%3E%3Cpath d='M94,84 l-5,5 -5,-5 2,-2 -75,-75 0,-6' fill='%23840' /%3E%3Cpath d='M94,84 l5,-5 -5,-5 -2,2 -75,-75 -6,0' fill='%23c84' /%3E%3Cpath d='M7,20 h-5 q5,30 30,25 l-6,-15 z' fill='%23aad' /%3E%3Cpath d='M20,10 q-10,10 -15,10 10,20 25,20 -2,-8 5,-15 l1,-1' fill='%2388b' /%3E%3Cpath d='M20,10 l5,-5 15,15 -5,5' fill='%23aad' /%3E%3Cpath d='M2,88 a1,1 0,1,1 3,-5 l13,-15 -5,-5 3,-3 7,7' fill='%23f80' /%3E%3Cpath d='M2,88 a1,1 0,1,0 5,-3 l15,-13 5,5 3,-3 -7,-7' fill='%23fa0' /%3E%3Cpath d='M1.75,87.80 l0.4,0.4' /%3E%3Cpath d='M26,70 l55,-50 5,-16' fill='%2388f' /%3E%3Cpath d='M86,4 l-5,16 -55,50 -3,-3' fill='%23bbf' /%3E%3Cpath d='M86,4 l-16,5 -50,55 3,3' fill='%23669' /%3E%3C/g%3E%3C/svg%3E" /><script type="module">const t={admin:"?admin"===window.location.search,currentMap:1,currentUserMap:1,urls:{images:["","data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1NzAgNTIwIj4KCTxwYXRoIGlkPSJidXNoIiBkPSJNMTgwLDQ2MGE2OSw2OSwwLDEsMSwtMTAwLC0yMDBhNjksNjksMCwxLDEsMCwtMTUwYTY5LDY5LDAsMSwxLDE1MCwtNTBhNjksNjksMCwxLDEsMTUwLDUwYTY5LDY5LDAsMSwxLDE1MCwxNTBhNjksNjksMCwxLDEsLTEwMCwxMDBhNjksNjksMCwxLDEsLTEwMCw1MGE2OSw2OSwwLDEsMSwtMTUwLDUweiIgLz4KCTx1c2UgaHJlZj0iI2J1c2giIGZpbGw9IiMyMDU4MGQiIC8+Cgk8dXNlIGhyZWY9IiNidXNoIiBmaWxsPSIjNjM4ZDA1IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg3MCA3MCkgc2NhbGUoMC43NSAwLjc1KSByb3RhdGUoMTg1IDI4NSAyNjApIiAvPgoJPHVzZSBocmVmPSIjYnVzaCIgZmlsbD0iI2IzYmYzNSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTUwIDE1MCkgc2NhbGUoMC41IDAuNSkgcm90YXRlKDI3NSAyODUgMjYwKSIgLz4KPC9zdmc+Cg==","data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHNoYXBlLXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0ZXh0LXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiBpbWFnZS1yZW5kZXJpbmc9Im9wdGltaXplUXVhbGl0eSIgZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIHZpZXdCb3g9IjAgMCAyNDAgMjQwIj4KICAgIDxwYXRoIGZpbGw9IiMwZDBjMGIiIGQ9Ik0xMTcgMTBjMjYgMCAzOCAxNCAzNyA0MSA1IDIgOSA1IDEyIDkgMCA2IDIgMTIgNSAxOCA3IDIgNyA1IDEgOWw4IDEwdjEwbC03IDE3IDIgNGMtMyAzLTQgNi00IDEwbC0xIDEtMTEgMmMtMiAxLTQgMy00IDYgMiA5IDMgMTkgMyAzMC0zIDEtNCA0LTQgN2w1IDEydjZsLTE0IDRjLTYtMy0xMS03LTE1LTExLTEtMiAwLTQgMS01LTQtMy00LTctMS0xMGwtMi00Yy0yIDMtNSA1LTkgNy00LTItNi00LTgtNy0yIDItMiA1IDEgOC0zIDMtNCA3LTQgMTJsLTE0IDEwLTEyLTNjLTItMi0zLTUtMi04IDMtNCA1LTggNi0xMy00LTItNi01LTYtOSAwLTkgMi0xOCA1LTI2bC00LTUtMTMtNGMwLTQtMS04LTMtMTBsMi0zLTktMjRjMS02IDUtMTAgMTAtMTQtNy0zLTctNiAwLTkgMy02IDQtMTEgNC0xNyAzLTQgNy03IDExLTkgMS00IDMtNiA3LTYtMS04IDEtMTYgNC0yMyAzLTQgNi01IDExLTUgMi01IDYtOCAxMi04Wk05MSA5NmwzIDd2NWMtMyA0LTUgOS02IDE0LTEtMS0zLTItNC0xdi0xOGw3LTdabTU3IDEgOSA4Yy0xIDUtMiAxMC0xIDE2LTItMS00IDAtNSAxLTEtNS0zLTEwLTYtMTMtMS01IDAtOSAzLTEyWiIvPgogICAgPHBhdGggZmlsbD0iIzNhM2EzYSIgZD0iTTExMiA4N2MtMTEgMS0xNS00LTExLTEzbDEtMWM1IDUgMTEgOSAxOCAxMWwxMy03YzAgMyAyIDYgNCA4bC0xIDFjLTctMS0xMiAxLTE2IDZsLTgtNVoiLz4KICAgIDxwYXRoIGZpbGw9IiMzYTNhMzgiIGQ9Ik0xNjYgODNoLTVsMi0xLTEwLTdjLTEtMSAwLTIgMS0yIDQtMSA3LTMgOS02bDYgMTMtNSAyIDIgMVpNODAgODFsLTUgMy0zLTEgNS0xLTctMiA2LTEzIDMgNGMzIDAgNSAxIDggM2wtOCA2IDEgMVoiLz4KICAgIDxwYXRoIGZpbGw9IiM3ODY2NTkiIGQ9Ik0xMDAgNTdjMyAzIDUgOCA3IDEzLTUtNC03LTgtNy0xM1oiLz4KICAgIDxwYXRoIGZpbGw9IiMyMjFlMWIiIGQ9Ik0xMzIgNTJoMmMtMiAwLTMgMS0zIDJsNCAzaC0zdjNoLTdjLTEtMi0yLTMtMy0ydi0zbDEwLTNaIi8+CiAgICA8cGF0aCBmaWxsPSIjM2EzYTNhIiBkPSJNMTUxIDc0Yy01IDAtNi0yLTQtNWwyLTMgNC0xMWgzbDcgNnYzbC00IDVjLTQgMC03IDEtOCA1WiIvPgogICAgPHBhdGggZmlsbD0iIzE4MTgxNyIgZD0iTTE0OCA0NHYxbDEgMTMtMyA5IDEgMmMtMiAzLTEgNSA0IDVsMiAxIDEwIDctMiAxYy01LTYtMTEtOC0xNy04IDQgMiA5IDUgMTMgOWgtMmwzIDRhNzQ1MzIgNzQ1MzIgMCAwIDEgNCAxM2gtMmwtOS0xOS01LTJhMzExIDMxMSAwIDAgMC04IDhjMSAxIDIgNCAxIDcgMC01LTMtNy03LTYtNS0xLTkgMS0xMiA1LTYtNS0xMi03LTE4LTVsLTIgNi0xLTJjMC0zIDEtNSAzLTZoMTBsOCA1YzQtNSA5LTcgMTYtNmwxLTFjLTItMi00LTUtNC04bC0xMyA3Yy03LTItMTMtNi0xOC0xMWwtMSAxIDEtNmM0IDYgMTAgMTAgMTggMTMgNy0zIDEzLTcgMTctMTMgMSAzIDAgNy0xIDEwbDEgMmMwLTIgMS0zIDItM2w1LTEyIDQtMjFaIi8+CiAgICA8cGF0aCBmaWxsPSIjNWM1ODUxIiBkPSJtMTQ4IDQ0LTQgMjEtNSAxMiAyLTkgMi00IDMtMjQgMiA0WiIvPgogICAgPHBhdGggZmlsbD0iIzNhM2EzYSIgZD0ibTg2IDU0IDIgMSAyIDEwYzIgMSA0IDQgNSA3bC01IDJjLTMtMy02LTUtMTAtNC0xLTQtMy02LTUtOGwxMS04WiIvPgogICAgPHBhdGggZmlsbD0iIzc0NjM1NiIgZD0iTTEzMiA3MWMwLTMgMS01IDMtN3YtN2wtNC0zYzAtMSAxLTIgMy0yaC0yYzAtMSAxLTIgMy0xIDAtNy00LTExLTEwLTExIDctNCAxMS0xIDEyIDggMyA5IDIgMTYtNSAyM1oiLz4KICAgIDxwYXRoIGZpbGw9IiNjZWIwOWEiIGQ9Im05MyA0NiA0IDJ2MTFjLTMtNC00LTktNC0xM1oiLz4KICAgIDxwYXRoIGZpbGw9IiM0NjQzM2UiIGQ9Im0xNDkgMzMgMiAxNS0yIDEwLTEtMTMgMS0xMloiLz4KICAgIDxwYXRoIGZpbGw9IiNkNmI3YTAiIGQ9Ik0xMjUgNDBjNiAwIDEwIDQgMTAgMTEtMi0xLTMgMC0zIDFsLTEwIDN2M2MxLTEgMiAwIDMgMmg3di0zaDN2N2MtMiAyLTMgNC0zIDdsLTEyIDhjLTYtMi0xMC01LTEzLTktMi01LTQtMTAtNy0xMy0yLTYgMC0xMCA0LTEybDQtOWM1IDUgMTAgNiAxNyA0WiIvPgogICAgPHBhdGggZmlsbD0iIzNmMzYyZiIgZD0iTTExNiA3MGMzLTEgNiAwIDkgMmwtMSAxLTktMiAxLTFaIi8+CiAgICA8cGF0aCBmaWxsPSIjMjcyMjFlIiBkPSJtMTE1IDY0IDUgM2MxLTIgMi0yIDQtMi00IDQtNyA0LTktMVoiLz4KICAgIDxwYXRoIGZpbGw9IiMyNDFmMWMiIGQ9Im0xMDQgNTIgMS0xIDEwIDRjMi0yIDMtMiAyIDJsLTkgM3YtM2wtNC0xIDUtMi01LTJaIi8+CiAgICA8cGF0aCBmaWxsPSIjNGU0YTQ1IiBkPSJNOTYgMzBoMWMtMSAxIDAgMiAxIDR2MTJsLTItNGMtMiAyLTMgMi0zLTJzMS03IDMtMTBaIi8+CiAgICA8cGF0aCBmaWxsPSIjOTc5MDg1IiBkPSJNOTggNDZWMzRjMi0yIDQtMyA4LTMgMCA2LTIgMTEtNyAxNmwtMS0xWiIvPgogICAgPHBhdGggZmlsbD0iIzRmNGM0NiIgZD0iTTEwOSAxN2MtMSA0IDAgNyAyIDExLTEgMS0yIDItMSA0bC0xIDJjLTMtNi0zLTEyIDAtMTdaIi8+CiAgICA8cGF0aCBmaWxsPSIjODg4Mjc4IiBkPSJNOTggMzRjLTEtMi0yLTMtMS00IDEtNCA0LTUgNy00bDEgNGMtNC0xLTYgMC03IDRaIi8+CiAgICA8cGF0aCBmaWxsPSIjNDQ0MTNjIiBkPSJNOTYgMzBjLTEtMyAwLTYgMy04IDItMSA0LTEgNiAxLTUgMC04IDItOSA3WiIvPgogICAgPHBhdGggZmlsbD0iIzI0MjMyMCIgZD0iTTExMSAzMmgtMWMtMS0yIDAtMyAxLTQgMi05IDgtMTMgMTgtMTFsNyA1LTctM2MtMTAtMi0xNiAzLTE4IDEzWiIvPgogICAgPHBhdGggZmlsbD0iIzk1OGU4NCIgZD0ibTE0OSAzMy0xIDEydi0xbC0yLTQtMyAyNC0yIDQtMS0xOGMtMS0xMy04LTE3LTE5LTE1LTEgMi0yIDItMyAyIDEtNCA0LTcgOC04czggMCAxMyAxYy01LTMtOS00LTE0LTMtNSAzLTggNi0xMSAxMS0zLTEtNC0zLTMtNiAyLTEwIDgtMTUgMTgtMTNsNyAzLTctNWMtMTAtMi0xNiAyLTE4IDExLTItNC0zLTctMi0xMSAxMy04IDI1LTUgMzYgNyAyIDIgMyA1IDQgOVoiLz4KICAgIDxwYXRoIGZpbGw9IiNhY2E5NmQiIGQ9Ik0xNjEgODNoNWw3LTFjLTYgNS0xMSA1LTE2IDItNC00LTktNy0xMy05IDYgMCAxMiAyIDE3IDhaIi8+CiAgICA8cGF0aCBmaWxsPSIjMzQzNDM0IiBkPSJNODQgOTNjMy0yIDQtNSA0LThzMS01IDQtNWMxIDEwLTMgMTctMTMgMjAgMS0zIDItNSA1LTdaIi8+CiAgICA8cGF0aCBmaWxsPSIjMzkzOTM5IiBkPSJtMTQ2IDgwIDUgMiA5IDE5Yy0xMC00LTE1LTExLTE0LTIxWiIvPgogICAgPHBhdGggZmlsbD0iIzMzMyIgZD0iTTk5IDg1Yy0zIDctMSAxMyA1IDE4bDYgMWMtMTAgMi0xNS0yLTE2LTExbDItMTEgMyAzWiIvPgogICAgPHBhdGggZmlsbD0iIzMyMzIzMiIgZD0ibTE0NCA4MSAxIDEyYzAgNi0yIDEwLTggMTFoLTdjMyAwIDYtMSA4LTMgMy01IDQtMTEgMy0xNmwzLTRaIi8+CiAgICA8cGF0aCBmaWxsPSIjYWVhYjZlIiBkPSJtNzIgODMgMyAxIDUtM2M1LTQgMTEtNyAxOC04bC02LTljMC02LTEtMTAtNC0xNGg0bDIgMTAgNSAxdjE1Yy04IDEtMTUgNC0yMCAxMC01IDEtOSAwLTEyLTNoNVoiLz4KICAgIDxwYXRoIGZpbGw9IiM2MTYxNjEiIGQ9Ik04OCA4NWMwIDMtMSA2LTQgOCAwLTMgMi02IDQtOFoiLz4KICAgIDxwYXRoIGZpbGw9IiM2ODY4NjgiIGQ9Im05OSA4NSAzIDJjLTIgMS0zIDMtMyA2bDEgMiAyLTZjNi0yIDEyIDAgMTggNSAzLTQgNy02IDEyLTUgNC0xIDcgMSA3IDYgMS0zIDAtNi0xLTggMC0xIDEtMiAzLTIgMSA1IDAgMTEtMyAxNi0yIDItNSAzLTggMy00IDEtNyAzLTEwIDZsLTctNmgtM2wtNi0xYy02LTUtOC0xMS01LTE4WiIvPgogICAgPHBhdGggZmlsbD0iIzVjNWM1YyIgZD0ibTcwIDg4IDE0IDEtOCAxMi04LTExIDItMloiLz4KICAgIDxwYXRoIGZpbGw9IiM1ZDVkNWQiIGQ9Ik0xNTggODhoOWMyIDAgMyAxIDQgM2wtNiA5LTMgMWE3NDUzMiA3NDUzMiAwIDAgMC00LTEzWiIvPgogICAgPHBhdGggZmlsbD0iIzNhM2EzOSIgZD0ibTcwIDEwMi04IDR2LTljMS0yIDItMyA0LTFsNCA2WiIvPgogICAgPHBhdGggZmlsbD0iIzNiM2IzYSIgZD0iTTE3NCA5NWM0IDIgNSA2IDIgMTFsLTYtNCA0LTdaIi8+CiAgICA8cGF0aCBmaWxsPSIjOWI5ODYyIiBkPSJtNzAgMTAyLTMtOSA3IDEwLTEwIDdjLTEtMS0yLTItMS0zbDctM3YtMloiLz4KICAgIDxwYXRoIGZpbGw9IiM1YjVhMzkiIGQ9Ik03NyAxMDRoM3YxOGwtMiAzLTEtM2MyLTYgMi0xMSAwLTE2di0yWiIvPgogICAgPHBhdGggZmlsbD0iIzNhM2EzYSIgZD0iTTc3IDEwNHYybC0xIDEzLTYgNi01LTEzIDEyLThaIi8+CiAgICA8cGF0aCBmaWxsPSIjM2IzYjNiIiBkPSJtMTY0IDEwNiAxMCA3LTUgMTItNi01Yy0xLTUgMC0xMCAxLTE0WiIvPgogICAgPHBhdGggZmlsbD0iI2ExOWY2NiIgZD0ibTE3MiA5MyAxIDFjLTMgMi00IDYtNSA5IDIgMiA1IDQgOSA1bC0yIDJjLTQtMi03LTUtOS04bDYtOVoiLz4KICAgIDxwYXRoIGZpbGw9IiM1YzViM2EiIGQ9Im05OSAxMTQgMSAxLTMgNS00LTIgMy01IDMgMVoiLz4KICAgIDxwYXRoIGZpbGw9IiM1YjVhMzkiIGQ9Ik0xNDIgMTIxYzAtMy0yLTUtNC01bDItMiA0LTEgMyA2LTUgMloiLz4KICAgIDxwYXRoIGZpbGw9IiNiNGIxNzIiIGQ9Im0xMDAgMTE1IDEzIDVjLTEgMi0yIDQtMSA3bC0xNS03IDMtNVoiLz4KICAgIDxwYXRoIGZpbGw9IiNiMmFmNzEiIGQ9Ik0xMzggMTE2YzIgMCA0IDIgNCA1LTYgMS0xMSAzLTE1IDZ2LThsMTEtM1oiLz4KICAgIDxwYXRoIGZpbGw9IiM1YTU5MzgiIGQ9Ik0xNjMgMTIyYy0xIDAtMiAxLTEgM2wtMy0ydi0yMGMyLTEgMyAwIDQgMi0zIDYtMyAxMSAwIDE3WiIvPgogICAgPHBhdGggZmlsbD0iI2JiYjg3NiIgZD0iTTExNCAxMjl2LTloMTFjMiA0IDEgOC0zIDEwLTMgMS02IDAtOC0xWiIvPgogICAgPHBhdGggZmlsbD0iI2FmYWM2ZiIgZD0ibTc3IDEyMiAxIDNjLTMgMi03IDMtMTAgMmw5LTVaIi8+CiAgICA8cGF0aCBmaWxsPSIjNjc2NzY3IiBkPSJNOTUgMTIzYzQgMCA5IDIgMTMgNS0zIDctNSAxMy01IDIxLTggMC0xNC0zLTE4LTggMy0zIDUtNyA1LTEybDUtNloiLz4KICAgIDxwYXRoIGZpbGw9IiM2ZjVmNTMiIGQ9Ik04OCAxMjhjLTUtMS05IDAtMTIgM2wtNSAxYzEtMyAzLTQgNi00bDYtNCA1IDF2M1oiLz4KICAgIDxwYXRoIGZpbGw9IiM2ODY4NjgiIGQ9Im0xNDcgMTQ3LTEwIDEtNi0yMGMzLTMgNy01IDEyLTUgMiAxIDQgMiA1IDVsMyAxMSA0IDItOCA2WiIvPgogICAgPHBhdGggZmlsbD0iI2FjYTk2ZCIgZD0ibTE2MyAxMjIgOCA1Yy00IDEtNyAwLTktMi0xLTIgMC0zIDEtM1oiLz4KICAgIDxwYXRoIGZpbGw9IiMxYzFjMTgiIGQ9Im0xMDMgMTA3LTEgNWMxIDIgMyAzIDYgM2wtMy04aDFsMyAxMGM3IDEgMTQgMSAyMS0xIDItOCAzLTggMiAwbDUtM3YtNmw0LTFjMSAzIDAgNS0yIDdsMSAxLTIgMi0xMSAzdjhjMiAyIDMgNiA0IDEwbC01LTYtNiAzLTctMy0zIDN2LTVoNGMyIDEgNSAyIDggMSA0LTIgNS02IDMtMTBoLTExdjhsLTItMWMtMS0zIDAtNSAxLTdsLTEzLTUtMS0xIDItMmMtMy0xLTQtNC0yLTZsNCAxWiIvPgogICAgPHBhdGggZmlsbD0iIzYzNjM2MyIgZD0iTTEwMyAxMDdoMmwzIDhjLTMgMC01LTEtNi0zbDEtNVoiLz4KICAgIDxwYXRoIGZpbGw9IiM2NjYiIGQ9Ik0xMzcgMTA3djZsLTUgM2MxLTggMC04LTIgMC03IDItMTQgMi0yMSAxbC0zLTEwYzEtMiAzLTIgNi0xbDcgNiA5LTYgOSAxWiIvPgogICAgPHBhdGggZmlsbD0iI2NmYjE5YiIgZD0ibTg4IDEyOC0yIDJjLTMtMi01LTEtNCAzIDEtMSAzLTIgNS0xdjVINzF2LTVsNS0xYzMtMyA3LTQgMTItM1oiLz4KICAgIDxwYXRoIGZpbGw9IiNkMmI0OWQiIGQ9Ik0xNjggMTM2aC0xNWMtMS0yLTItMy0xLTQgMi0xIDQgMCA1IDIgMS01LTEtNy01LTQgMC0yIDEtMiAzLTJsMTMgNHY0WiIvPgogICAgPHBhdGggZmlsbD0iIzcyNjE1NCIgZD0iTTE2OCAxMzZ2LTRsLTEzLTRjLTIgMC0zIDAtMyAyLTItMi0yLTQgMC01bDMtMSA4IDQgNiAyLTEgNloiLz4KICAgIDxwYXRoIGZpbGw9IiMzYTNhM2EiIGQ9Ik0xMzEgMTM3YzEgMyAwIDYtMyA4LTkgNS0xNiAzLTIxLTUgMC0zIDEtNSAzLTZsMy0zIDcgMyA2LTMgNSA2WiIvPgogICAgPHBhdGggZmlsbD0iIzI4MjExYyIgZD0iTTEzNyAxNTRjLTMtMS01LTMtNS01LTQgMy04IDQtMTMgNHMtOS0xLTEyLTRjLTEgMi0zIDQtNSA0bC0xLTJjMi0xIDQtMyA1LTYgOSA4IDE4IDcgMjctMWwyIDYgNCAxLTIgM1oiLz4KICAgIDxwYXRoIGZpbGw9IiMyNzIwMWMiIGQ9Im0xMDMgMTY2LTctMTItOS00IDEtMyAxMSA0IDMgOSAxIDZaIi8+CiAgICA8cGF0aCBmaWxsPSIjMjQxZTFiIiBkPSJNMTQ3IDE0N2MyIDAgMyAxIDUgM2wtOSA0Yy0zIDQtNSA5LTYgMTQtMi0yLTItNC0xLTZsNC0xMSA0LTItNy0xIDEwLTFaIi8+CiAgICA8cGF0aCBmaWxsPSIjNGMzZTM2IiBkPSJNMTM3IDE1NGMtNCA5LTEwIDE4LTE3IDI2LTgtOC0xNC0xNy0xOC0yNyAyIDAgNC0yIDUtNCAzIDMgNyA0IDEyIDRzOS0xIDEzLTRjMCAyIDIgNCA1IDVaTTg3IDE1MGw5IDQgNyAxMmMtMiA1LTIgMTEtMiAxNy0xNCAwLTIwLTctMTctMjBsMy0xM1pNMTUyIDE1MGMzIDggNCAxNiAzIDI2LTUgNS0xMCA3LTE2IDdsLTItMTVjMS01IDMtMTAgNi0xNGw5LTRaIi8+CiAgICA8cGF0aCBmaWxsPSIjMzAzMDMwIiBkPSJtMTA1IDE2NyA0IDRjLTMgNC0zIDktMSAxNC0yIDMtNSAzLTcgMGw0LTE4WiIvPgogICAgPHBhdGggZmlsbD0iIzMxMzEzMSIgZD0ibTEzMyAxNjcgMSAxIDQgMTdjLTMgMy01IDMtNiAwIDEtNSAwLTEwLTEtMTRsMi00WiIvPgogICAgPHBhdGggZmlsbD0iIzY3Njc2NyIgZD0iTTkxIDE4NWM4IDAgMTIgNCAxMCAxM2wtNCAyLTE0IDFjMC03IDMtMTIgOC0xNlpNMTQ0IDE4NWMzLTEgNSAwIDcgMyAzIDMgNSA4IDYgMTNsLTE1LTFjLTYtMy03LTctMy0xMmw1LTNaIi8+Cjwvc3ZnPgo=","data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgOTAiPgoJPHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2E2Yzk1MCIgLz4KCTxwYXRoIGQ9Ik0yOCwyIGwyLDcgTTMzLDEgbDIsOCBNNzAsMTEgbC0xLDcgTTc1LDExIGwtMSw3IE00OCwzMSBsMSw3IE01MiwzMSBsMSw3IE0xNSw0MiBsMyw2IE0xOSw0MiBsMiw2IE0yNCw0MiBsMSw2IE04OCwzOCBsMyw1IE05MiwzNiBsMyw1IE0xMiw3MiBsMiw1IE0xNiw3MCBsMiw2IE00Miw2MSBsMiw2IE04MCw2MiBsLTEsNiBNODQsNjMgbC0yLDYgTTYxLDgzIGwtMSw2IiBzdHJva2U9IiM2ODhhMWIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgLz4KPC9zdmc+Cg==","data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHNoYXBlLXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0ZXh0LXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiBpbWFnZS1yZW5kZXJpbmc9Im9wdGltaXplUXVhbGl0eSIgZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIHZpZXdCb3g9IjAgMCAyNDAgMjQwIj4KICAgIDxwYXRoIGZpbGw9IiMwNTAzMDUiIGQ9Im0xNDUuNSAxMTAuNS0yIDNjLjItMS0uMi0xLjctMS0yLS43LTIuOC0xLjctNS41LTMtOCAzLS45IDQuOC0yLjkgNS41LTZsMS0xN2MuMy44LjggMS41IDEuNSAybDUuNS0xMWMuNy0xLjIgMS4yLTEuMiAxLjUgMC0yLjkgNS40LTQuOSAxMS02IDE3IC40IDQuMi0uMiA4LjItMiAxMmExOCAxOCAwIDAgMSAyIDhjMy45LjMgNy41IDAgMTEtMSAzLjctLjYgNi45LTIuMiA5LjUtNSAxLjQtMi41IDEuOC01LjIgMS04YTY2My4zIDY2My4zIDAgMCAxLTE1LTMxYy0xLTEuMi0yLjItMi4yLTMuNS0zLS42LTEuMS0xLjUtMi4xLTIuNS0zLS44IDMtLjYgNS44LjUgOC41YTcuNSA3LjUgMCAwIDEtMyAzLjVjLjItNC4zLS4xLTguNi0xLTEzIC40LTEzLjMtMi4xLTI2LTcuNS0zOC04LjUtOS0xOC40LTExLTI5LjUtNi02LjIgMy0xMCA4LTExLjUgMTUtMyAxMy42LTQuMiAyNy4zLTMuNSA0MSAwIC43LS4zIDEtMSAxLTEuMy0uOC0yLjMtMi0zLTMuNSAxLjEtMi43IDEuMy01LjYuNS04LjVhMjQuNyAyNC43IDAgMCAxLTQuNSA0IDYuNyA2LjcgMCAwIDAtMS41IDdjMi44IDQuNSA1LjMgOS4yIDcuNSAxNCAuNy0uNSAxLjItMS4yIDEuNS0yIC4xIDYuNy44IDEzLjQgMiAyMGE2LjkgNi45IDAgMCAwIDQuNSAzYy0uNCAxLjYtMSAzLTIgNC41IDEuNiAxLjggMy42IDMgNiAzLjVoMWMuMi42LjcgMSAxLjUgMSAxLS42IDEuOC0xLjIgMi41LTIgNC4yIDIgOC45IDIuNiAxNCAyIC4zIDEuNy01LjMgMi0xNyAxaC0yYy0yLjQtMS4zLTUtMi04LTIgLjIgMS4zLS4xIDIuMy0xIDMgLjItMS4zLS4xLTIuMy0xLTMgMC0yLjUtLjctMi43LTItLjVsLTcgMWE2LjEgNi4xIDAgMCAxIDMgNWMtLjggNS4yLTMuNSA5LTggMTEuNWE0NyA0NyAwIDAgMS0xMi41LTdsLTEtMjBjLS4zLTEuMy0uOC0yLjQtMS41LTMuNUExNjk5IDE2OTkgMCAwIDEgODEgNjIuNWMyLjctMy41IDUuNS02LjggOC41LTEwIDEuNC05LjcgMy4zLTE5LjQgNS41LTI5YTI1LjUgMjUuNSAwIDAgMSAyNC41LTE3YzE1LjggMSAyNC42IDkuMyAyNi41IDI1bDMgMjJhMjkgMjkgMCAwIDEgOSA5bDE1IDMyYy0uMSA5LS40IDE4LTEgMjctNCAyLjctOCA1LTEyLjUgN2ExMSAxMSAwIDAgMS00LjUtM2MtMS42LTMuMS0zLjEtNi4zLTQuNS05LjUgNS4zLTQgNC4zLTUuNi0zLTUtLjgtMS40LTEuNC0xLjUtMi0uNVoiLz4KICAgIDxwYXRoIGZpbGw9IiMzZDM3NWIiIGQ9Ik0xNDUuNSA1Ni41Yy4yIDMuNS0uNiAzLjgtMi41IDEtNS43LTEwLTEyLjUtMTkuMi0yMC41LTI3LjUtMi0uNy00LS43LTYgMC00LjcgNS4zLTkgMTAuOC0xMyAxNi41LS42LS42LTEtMS40LTEtMi41YTQ2OSA0NjkgMCAwIDAgMi41LTE4LjUgMzIgMzIgMCAwIDAgMy41LTEzYzExLjEtNSAyMS0zIDI5LjUgNiA1LjQgMTIgNy45IDI0LjcgNy41IDM4WiIvPgogICAgPHBhdGggZmlsbD0iIzFlMWIyZSIgZD0iTTEwOC41IDEyLjVhMzIgMzIgMCAwIDEtMy41IDEzIDQ2OSA0NjkgMCAwIDEtMi41IDE4LjVjMCAxIC40IDEuOSAxIDIuNWExMTYgMTE2IDAgMCAwLTguNSAxMiAyNC40IDI0LjQgMCAwIDAtMS41IDEwYy0uNy0xMy43LjUtMjcuNCAzLjUtNDEgMS40LTcgNS4zLTEyIDExLjUtMTVaIi8+CiAgICA8cGF0aCBmaWxsPSIjMTAwYTBkIiBkPSJNMTQ1LjUgNTYuNWMuOSA0LjQgMS4yIDguNyAxIDEzLS44IDEuMy0yIDIuMy0zLjUgM2E1IDUgMCAwIDAtLjUgM2MtLjEgNC4zLTEuNiA4LTQuNSAxMSAuNiA4LjYtMS4zIDE2LjYtNS41IDI0IDEuMiAxIDIuNSAxLjMgNCAxLS41LTMuMy41LTYgMy04IDEuMyAyLjUgMi4zIDUuMiAzIDgtMi42LjItNC45LjktNyAyYTExOC42IDExOC42IDAgMCAxLTMwIDBjMTEuNyAxIDE3LjMuNyAxNy0xIDIuNC0xIDUuMS0xLjMgOC0xdi01Yy0yLjcuMi01LS42LTctMi41IDIuOS0uNyA1LjctLjUgOC41LjUgMS0uNCAxLjYtMSAyLTJhNDMgNDMgMCAwIDAgMC0yMmMtOS43IDExLjktMTkuNCAxMS45LTI5IDAtMiA3LjMtMiAxNC42IDAgMjIgMy40LjggNyAxLjMgMTAuNSAxLjVhMzUuNiAzNS42IDAgMCAxLTcgMy41djNjLS43LjgtMS41IDEuNC0yLjUgMi0uOCAwLTEuMy0uNC0xLjUtMSAuOS4xIDEuNS0uMiAyLTFhMzQuNCAzNC40IDAgMCAxLTMtMzIuNWMtLjItLjktLjYtMS43LTEtMi41LTMuNi0xLjUtNy0zLjUtMTAtNiAuNyAwIDEtLjMgMS0xLS4yLTMuMi4zLTYuNSAxLjUtMTBhMTE2IDExNiAwIDAgMSA4LjUtMTJjNC01LjcgOC4zLTExLjIgMTMtMTYuNSAyLS43IDQtLjcgNiAwIDggOC4zIDE0LjggMTcuNSAyMC41IDI3LjUgMiAyLjggMi43IDIuNSAyLjUtMVoiLz4KICAgIDxwYXRoIGZpbGw9IiMyNzI3MjciIGQ9Ik0xMTYuNSAzMi41YzYgNC4xIDExLjEgOS4xIDE1LjUgMTUgLjcuOC41IDEuNS0uNSAyYTcuMyA3LjMgMCAwIDEtNSAxLjVjLTQuNy00LjQtOS05LTEzLTE0YTYuOSA2LjkgMCAwIDAgMy00LjVaIi8+CiAgICA8cGF0aCBmaWxsPSIjNmQ1ZjU4IiBkPSJNMTIxLjUgNTIuNWE5Ni42IDk2LjYgMCAwIDAtOS05IDExIDExIDAgMCAwLTUgNiAzIDMgMCAwIDEtMi0yIDcyIDcyIDAgMCAxIDctOWMzLjggNSA3LjggOS44IDEyIDE0LjUtMSAuNS0yIC4zLTMtLjVaIi8+CiAgICA8cGF0aCBmaWxsPSIjNzk2YTYxIiBkPSJNMTA1LjUgNTUuNWMtLjUgMC0uOS40LTEgMSAuNiAyLjYgMS42IDUgMyA3LS4yLjYtLjcgMS0xLjUgMS0zLjMtMi42LTUtNi01LTEwYTcgNyAwIDAgMSAzLjUtNGM5LjQgMy42IDkgNC43LTEgMy41IDEgLjMgMS42LjggMiAxLjVaIi8+CiAgICA8cGF0aCBmaWxsPSIjMjMyMzIzIiBkPSJNMTMzLjUgNTAuNWE0IDQgMCAwIDEgMy41IDIgMzguMyAzOC4zIDAgMCAxIDIuNSAyNGwtMy41LTEzYy0xLjktMi0zLjQtNC00LjUtNi41YTcgNyAwIDAgMSA0LTNjLTUuMy4xLTYtMS0yLTMuNVoiLz4KICAgIDxwYXRoIGZpbGw9IiNjZmI1YTciIGQ9Ik0xMjEuNSA1Mi41YTYuNSA2LjUgMCAwIDAgMyA1aC0xYTE3LjQgMTcuNCAwIDAgMC0xNiA2Yy0xLjQtMi0yLjQtNC40LTMtNyAuMS0uNi41LTEgMS0xbDQuNSAzIDQuNS0xLjUtMS0xYzUuMy0yLjMgNS4zLTMuMyAwLTMtMi4yLTEtNC4yLTItNi0zLjVhMTEgMTEgMCAwIDEgNS02YzMuMiAyLjggNi4yIDUuOCA5IDlaIi8+CiAgICA8cGF0aCBmaWxsPSIjNWI1MDQ5IiBkPSJNMTIzLjUgNTcuNWgxYTYgNiAwIDAgMSA2IDMuNWwtMSAuNWEzMy4yIDMzLjIgMCAwIDEtNi00WiIvPgogICAgPHBhdGggZmlsbD0iIzFlMWIyZCIgZD0iTTkyLjUgNjkuNWMzIDIuNSA2LjQgNC41IDEwIDYtMTAgLjItMTUuNi00LjQtMTctMTQgMS42LTEuMSAzLjEtMi40IDQuNS00IC44IDMgLjYgNS44LS41IDguNWE3LjUgNy41IDAgMCAwIDMgMy41WiIvPgogICAgPHBhdGggZmlsbD0iIzFjMTkyYiIgZD0iTTk4LjUgNTcuNWMyIDMuNyAyLjQgNy43IDEgMTItMi0xLjMtMy43LTMtNS01bDQtN1oiLz4KICAgIDxwYXRoIGZpbGw9IiNiZDQ0MzgiIGQ9Ik0xMjYuNSA3NS41Yy0uNCAwLS44LjEtMSAuNWwyIDFhMTQgMTQgMCAwIDAtMyA0YzIuNS0uMiA0LjgtMSA3LTIuNS0zLjUgNy4zLTkuMSA5LjgtMTcgNy41LTQuMy0yLjUtNy4zLTYtOS0xMC41bDMgMmE2IDYgMCAwIDAgNiAzLjUgMTQgMTQgMCAwIDAtMy00bDItMS02LTljNy4yLTEwLjYgMTUtMTEgMjMuNS0xLjUuNyAxIC43IDIgMCAzLTIgMi0zLjUgNC40LTQuNSA3WiIvPgogICAgPHBhdGggZmlsbD0iIzNjMzY1YSIgZD0iTTg1LjUgNjEuNWMxLjQgOS42IDcgMTQuMiAxNyAxNCAuNC44LjggMS42IDEgMi41YTM0LjQgMzQuNCAwIDAgMCAzIDMyLjVjLS41LjgtMS4xIDEuMS0yIDFoLTFjLS4zLTMuMy0xLjYtNi00LThhNi45IDYuOSAwIDAgMS00LjUtM2MtMS4yLTYuNi0xLjktMTMuMy0yLTIwLS4zLjgtLjggMS41LTEuNSAyLTIuMi00LjgtNC43LTkuNS03LjUtMTQtLjgtMi43LS4zLTUgMS41LTdaIi8+CiAgICA8cGF0aCBmaWxsPSIjNjEyMjFjIiBkPSJtMTA4LjUgNzcuNS0zLTJjLTItMy0zLTYuMy0yLjUtMTAgMy4zIDMuNiA1LjIgNy42IDUuNSAxMloiLz4KICAgIDxwYXRoIGZpbGw9IiMxZTFiMmUiIGQ9Im0xNTEuNSA2MC41LTIgMTJjLTIgMS44LTQuMyAyLjgtNyAzLS4xLTEgMC0yIC41LTNhNy41IDcuNSAwIDAgMCAzLjUtM2MxLjMtLjggMi4zLTIgMy0zLjVhMTMuMSAxMy4xIDAgMCAxLS41LTguNWMxIC45IDEuOSAxLjkgMi41IDNaIi8+CiAgICA8cGF0aCBmaWxsPSIjM2UzODVjIiBkPSJNOTAuNSA5MC41Yy0yLjIgNS40LTQuNyAxMC43LTcuNSAxNi0xIC44LTIuMiAxLjItMy41IDEtNi0uOC05LjctNC4yLTExLTEwIDQuMi0xMC4xIDguNy0yMC4xIDEzLjUtMzBsOCAxNmMuNSAyLjMuNyA0LjYuNSA3WiIvPgogICAgPHBhdGggZmlsbD0iIzRlMWMxNyIgZD0iTTExNS41IDYyLjVoM2MuMyAxLjggMSAzLjQgMiA1LS40IDEuNy0uOSAzLjQtMS41IDVhMTIuNCAxMi40IDAgMCAxLTMuNS0xMFoiLz4KICAgIDxwYXRoIGZpbGw9IiM1NzFmMWEiIGQ9Ik0xMzEuNSA3OC41YTE1LjIgMTUuMiAwIDAgMS03IDIuNSAxNCAxNCAwIDAgMSAzLTRsLTItMWMuMi0uNC42LS42IDEtLjUgMS4zLTEuNSAyLjItMS4xIDIuNSAxbDUtOGMxLjkgNCAxIDcuMy0yLjUgMTBaIi8+CiAgICA8cGF0aCBmaWxsPSIjM2MzNzViIiBkPSJNMTUxLjUgNjAuNWMxLjMuOCAyLjUgMS44IDMuNSAzIDQuNyAxMC41IDkuNyAyMC44IDE1IDMxIC44IDIuOC40IDUuNS0xIDhhMTUuOSAxNS45IDAgMCAxLTkuNSA1Yy0yIDAtMy42LTEtNC41LTMtMi4zLTUuNC00LjUtMTAuNy02LjUtMTYgMS4xLTYgMy4xLTExLjYgNi0xNy0uMy0xLjItLjgtMS4yLTEuNSAwbC01LjUgMTFhNC41IDQuNSAwIDAgMS0xLjUtMmwtMSAxN2E3LjYgNy42IDAgMCAxLTUuNSA2IDguMSA4LjEgMCAwIDAtMyA4Yy0xLjUuMy0yLjggMC00LTEgNC4yLTcuNCA2LTE1LjQgNS41LTI0IDIuOS0zIDQuNC02LjcgNC41LTExIDIuNy0uMiA1LTEuMiA3LTNsMi0xMloiLz4KICAgIDxwYXRoIGZpbGw9IiMzZDM3NWIiIGQ9Ik0xMjIuNSAxMTIuNWMtNS4xLjYtOS44IDAtMTQtMnYtM2MyLjQtLjkgNC43LTIgNy0zLjVhNjIgNjIgMCAwIDEtMTAuNS0xLjVjLTItNy40LTItMTQuNyAwLTIyIDkuNiAxMS45IDE5LjMgMTEuOSAyOSAwYTQzIDQzIDAgMCAxIDAgMjJjLS40IDEtMSAxLjYtMiAyLTIuOC0xLTUuNi0xLjItOC41LS41IDIgMS45IDQuMyAyLjcgNyAyLjV2NWMtMi45LS4zLTUuNiAwLTggMVoiLz4KICAgIDxwYXRoIGZpbGw9IiMxZjFjMmYiIGQ9Ik0xNDguNSA4OC41YzIgNS4zIDQuMiAxMC42IDYuNSAxNiAxIDIgMi40IDMgNC41IDMtMy41IDEtNy4xIDEuMy0xMSAxYTE4IDE4IDAgMCAwLTItOGMxLjgtMy44IDIuNC03LjggMi0xMloiLz4KICAgIDxwYXRoIGZpbGw9IiMxZjFjMzAiIGQ9Ik05MC41IDkwLjVjMSA2IDEgMTIgMCAxOC0zLjkuMy03LjUgMC0xMS0xIDEuMy4yIDIuNS0uMiAzLjUtMSAyLjgtNS4zIDUuMy0xMC42IDcuNS0xNloiLz4KICAgIDxwYXRoIGZpbGw9IiMxZjFjMmUiIGQ9Ik05OS41IDEwMy41YzIuNCAyIDMuNyA0LjcgNCA4LTIuNC0uNS00LjQtMS43LTYtMy41IDEtMS40IDEuNi0zIDItNC41WiIvPgogICAgPHBhdGggZmlsbD0iIzU1M2UyOSIgZD0iTTc0LjUgMTEzLjVjLTEtMi0yLjctMy40LTUtNC0uMi0xLjQgMC0yLjcuNS00YTIxIDIxIDAgMCAwIDguNSA0LjVjMS4zLjcgMS4zIDEuMyAwIDItMS4yLjgtMi42IDEuMy00IDEuNVoiLz4KICAgIDxwYXRoIGZpbGw9IiM1ODQwMmEiIGQ9Ik0xNjkuNSAxMDguNWMtMiAxLjQtMy43IDMtNSA1LTEuOC0uNS0zLjUtMS40LTUtMi41IDMuNC0xLjQgNi41LTMuMyA5LjUtNS41LjUgMSAuNiAyIC41IDNaIi8+CiAgICA8cGF0aCBmaWxsPSIjYWM3ZTU0IiBkPSJNNjkuNSAxMDkuNWMyLjMuNiA0IDIgNSA0IC40IDEgMS43IDEuNCA0IDFhMyAzIDAgMCAxIDIgMmwtMiAzIDQgMWExNSAxNSAwIDAgMS0zLjUgNCAyOS43IDI5LjcgMCAwIDEtOS01Yy0uNS0zLjMtLjctNi43LS41LTEwWiIvPgogICAgPHBhdGggZmlsbD0iI2FkN2Y1NSIgZD0iTTE2OS41IDEwOC41Yy4zIDQgMCA3LjgtMSAxMS41bC04LjUgNC41Yy0xLjgtLjctMy0yLTMuNS00IC45LTEgMS45LTEgMyAwIDEtMSAxLTIgMC0zIDEuNC0xLjQgMy0yLjQgNS0zIDEuMy0uMyAxLjMtLjcgMC0xIDEuMy0yIDMtMy42IDUtNVoiLz4KICAgIDxwYXRoIGZpbGw9IiMwOTA1MDUiIGQ9Ik0xNDUuNSAxMTAuNWM0IDExIDguOCAyMS42IDE0LjUgMzJhNTIgNTIgMCAwIDEgNCAyOGMtLjQgMS0xIDEuNi0yIDItMi40LTIuNS00LTUuNS01LTktMS40LTEuOC0yLjktMi41LTQuNS0yYTgwLjggODAuOCAwIDAgMCA1LjUgMTVjMS40IDMuNi4yIDUuOC0zLjUgNi41LTcgLjgtMTMuMy0uOS0xOS01LTItMi0yLjQtNC4xLTEtNi41LS42LTQuNi0yLjUtOC42LTUuNS0xMiAwLTYuNC0zLTkuNy05LjUtMTAtMy4xLjktNiAyLjItOC41IDRhMTAgMTAgMCAwIDEtNCA5IDk0IDk0IDAgMCAwLTMuNSAxNS41IDI2IDI2IDAgMCAxLTIzIDQuNWMtLjItMiAwLTQgLjUtNiAyLjQtNSA0LjMtMTAuMiA1LjUtMTUuNS0xLjktLjItMy40LjctNC41IDIuNS0xIDMuNS0yLjYgNi41LTUgOS0xLS40LTEuNi0xLTItMmE1OC4yIDU4LjIgMCAwIDEgNS0zMWM1LjQtOSA5LjktMTguNCAxMy41LTI4IC45LjcgMS4yIDEuNyAxIDMtLjMgMy43IDEuNCA2IDUgN2EyOSAyOSAwIDAgMCAyMCA1IDI4IDI4IDAgMCAwIDIxLTZjMy45LTEuMSA0LjktMy40IDMtN2wyLTNaIi8+CiAgICA8cGF0aCBmaWxsPSIjNTAzYjI2IiBkPSJNODAuNSAxMTYuNWEzIDMgMCAwIDAtMi0yYy41LTEuNiAxLjUtMiAzLTEuNSA0LjMgNC41IDQgNS42LTEgMy41WiIvPgogICAgPHBhdGggZmlsbD0iIzVjNDMyZCIgZD0iTTE2NC41IDExNC41Yy0yIC42LTMuNiAxLjYtNSAzLTEuOC0xLjQtMy4zLTEtNC41IDEtLjctMS45LS4yLTMuNCAxLjUtNC41IDIuNy0uMiA1LjMgMCA4IC41WiIvPgogICAgPHBhdGggZmlsbD0iIzVhMjAxYSIgZD0iTTEwMy41IDExMy41Yy0uOC4zLTEuMiAxLTEgMi0xLjItMS0yLjYtMS00LS41YTEyIDEyIDAgMCAxIDQgMi41Yy0uNyAwLTEgLjMtMSAxLTcuNS0yLjctNy45LTItMSAyLS43IDAtMSAuMy0xIDEtMy42LTEtNS4zLTMuMy01LTcgLjktLjcgMS4yLTEuNyAxLTMgMyAwIDUuNi43IDggMloiLz4KICAgIDxwYXRoIGZpbGw9IiNjMTQ1MzkiIGQ9Ik0xMDMuNSAxMTMuNWgyYzkuOSAxLjMgMTkuOSAxLjMgMzAgMCAxLS4yIDEuNy4yIDIgMS01LjkgMi4yLTEyIDMuOS0xOC41IDUtNS42LS45LTExLjEtMi4yLTE2LjUtNC0uMi0xIC4yLTEuNyAxLTJaIi8+CiAgICA8cGF0aCBmaWxsPSIjNTkxZjFhIiBkPSJNMTQyLjUgMTExLjVjLjguMyAxLjIgMSAxIDIgMS45IDMuNi45IDUuOS0zIDd2LTFsMy0yLjVjLTEuOC0uMS0zLjQuNC01IDEuNXYtMmM0LjItMi43IDMuOS0zLjQtMS0yLS4zLS44LTEtMS4yLTItMSAyLjEtMS4xIDQuNC0xLjggNy0yWiIvPgogICAgPHBhdGggZmlsbD0iIzJjMTEwZSIgZD0iTTEzOC41IDExNi41Yy00LjUgMS4yLTguOCAyLjUtMTMgNGEyNSAyNSAwIDAgMS0xNCAwYy43LjEgMS40IDAgMi0uNWExMzIgMTMyIDAgMCAxLTExLTIuNSAxMiAxMiAwIDAgMC00LTIuNWMxLjQtLjYgMi44LS40IDQgLjUgNS40IDEuOCAxMC45IDMuMSAxNi41IDQgNi40LTEuMSAxMi42LTIuOCAxOC41LTUgNC45LTEuNCA1LjItLjcgMSAyWiIvPgogICAgPHBhdGggZmlsbD0iIzFmMWMyZiIgZD0iTTE1OC41IDE1MC41YTE5MC4yIDE5MC4yIDAgMCAwLTE4LTI3YzEuNC0xLjIgMy4xLTIuMiA1LTMgNS41IDkuNiA5LjggMTkuNiAxMyAzMFoiLz4KICAgIDxwYXRoIGZpbGw9IiMxZjFjMzAiIGQ9Ik05OS41IDEyNC41YTQgNCAwIDAgMC0zLjUgMiA0NjAuNSA0NjAuNSAwIDAgMC0xNS41IDIyYzMuOC05LjYgOC4xLTE4LjkgMTMtMjhsNiA0WiIvPgogICAgPHBhdGggZmlsbD0iIzFkMGMwOCIgZD0iTTEwMS41IDExOC41YTIwIDIwIDAgMCAwIDEwIDIgMjUgMjUgMCAwIDAgMTQgMGM0LjUgMCA4LjgtLjYgMTMtMmE3LjUgNy41IDAgMCAxIDUtMS41bC0zIDIuNWE2MS40IDYxLjQgMCAwIDEtNDAgMWMtNi45LTQtNi41LTQuNyAxLTJaIi8+CiAgICA8cGF0aCBmaWxsPSIjYWQzZTMzIiBkPSJNMTM4LjUgMTE2LjV2MmMtNC4yIDEuNC04LjUgMi0xMyAyIDQuMi0xLjUgOC41LTIuOCAxMy00WiIvPgogICAgPHBhdGggZmlsbD0iI2FiM2QzMiIgZD0iTTEwMi41IDExNy41YzMuNiAxIDcuMyAxLjggMTEgMi41LS42LjUtMS4zLjYtMiAuNS0zLjYuMi03LS41LTEwLTIgMC0uNy4zLTEgMS0xWiIvPgogICAgPHBhdGggZmlsbD0iI2JiNDMzNyIgZD0iTTE0MC41IDExOS41djFhMjggMjggMCAwIDEtMjEgNmMtNy40LjgtMTQtMS0yMC01IDAtLjcuMy0xIDEtMWE2MS40IDYxLjQgMCAwIDAgNDAtMVoiLz4KICAgIDxwYXRoIGZpbGw9IiMzYjM1NTkiIGQ9Ik05OS41IDEyNC41YzIuNCAxIDQuNyAyLjIgNyAzLjVMODQgMTUyLjVjLTIuOCA0LTQuOCA4LjMtNiAxM2E0MCA0MCAwIDAgMSAyLjUtMTdjNS03LjQgMTAtMTQuOCAxNS41LTIyYTQgNCAwIDAgMSAzLjUtMloiLz4KICAgIDxwYXRoIGZpbGw9IiMzYjM1NTgiIGQ9Ik0xNDAuNSAxMjMuNWM2LjcgOC40IDEyLjcgMTcuNCAxOCAyNyAyLjQgNSAzLjIgMTAuMyAyLjUgMTYtMS01LjItMy05LjgtNi0xNGwtMjEtMjItMS41LTMgOC00WiIvPgogICAgPHBhdGggZmlsbD0iIzJmMWQxYyIgZD0iTTEyNC41IDEyOS41YzQtMS44IDYuNS0uNSA3LjUgNCA0LjIgNC41IDguNyA4LjcgMTMuNSAxMi41LTEuMiAxLTIuNSAyLTQgMi41LTUtNS43LTkuNy0xMS43LTE0LTE4YTMgMyAwIDAgMC0zLTFaIi8+CiAgICA8cGF0aCBmaWxsPSIjNWIzODM3IiBkPSJNMTA5LjUgMTI4LjVjNSAuOCAxMCAxLjIgMTUgMWEzIDMgMCAwIDEgMyAxYzQuMyA2LjMgOSAxMi4zIDE0IDE4YTI1IDI1IDAgMCAxLTggMWMtOS40LTE4LjYtMTguOC0xOC42LTI4IDAtMi44LjItNS40LS4xLTgtMWExODIgMTgyIDAgMCAxIDEwLjUtMTRjLjgtMiAxLjMtNCAxLjUtNloiLz4KICAgIDxwYXRoIGZpbGw9IiMzMDFkMWMiIGQ9Ik0xMDkuNSAxMjguNWMtLjIgMi0uNyA0LTEuNSA2YTE4MiAxODIgMCAwIDAtMTAuNSAxNGMtMS41LS42LTIuOC0xLjQtNC0yLjVhNTcgNTcgMCAwIDAgMTYtMTcuNVpNMTMzLjUgMTQ5LjVjLTEuNC4yLTIuNyAwLTQtLjUtNi4zLTE1LTEzLTE1LjMtMjAtLjVhNC45IDQuOSAwIDAgMS00IDFjOS4yLTE4LjYgMTguNi0xOC42IDI4IDBaIi8+CiAgICA8cGF0aCBmaWxsPSIjMWMxYTJiIiBkPSJNMTE3LjUgMTM5LjVjMS42LS4yIDMuMS4xIDQuNSAxIDEuNSAyLjggMi45IDUuNCA0IDhhMTEuOSAxMS45IDAgMCAwLTEzIDBjMS0zLjIgMi40LTYuMiA0LjUtOVoiLz4KICAgIDxwYXRoIGZpbGw9IiM1MTNiMjciIGQ9Ik05NS41IDE1MC41YTQuNyA0LjcgMCAwIDAtNCAzYy0yLjYtMi0yLjUtNCAuNS02IDEuMSAxLjEgMi4zIDIuMSAzLjUgM1oiLz4KICAgIDxwYXRoIGZpbGw9IiM1ODQwMmEiIGQ9Ik0xNDcuNSAxNTMuNWE0LjcgNC43IDAgMCAwLTQtM2M0LjQtNCA1LjctMyA0IDNaIi8+CiAgICA8cGF0aCBmaWxsPSIjYjE4MjU3IiBkPSJNOTUuNSAxNTAuNWMyLjggMS40IDUuOCAyIDkgMnY1aC02YTcuOCA3LjggMCAwIDEtNy00IDQuNyA0LjcgMCAwIDEgNC0zWiIvPgogICAgPHBhdGggZmlsbD0iI2IyODI1NyIgZD0iTTE0My41IDE1MC41YzEuOS4yIDMuMiAxLjIgNCAzYTguMSA4LjEgMCAwIDEtOCA0aC01di01YzEuMy4yIDIuMy0uMSAzLTEgMiAwIDQtLjMgNi0xWiIvPgogICAgPHBhdGggZmlsbD0iIzU3NDAyYSIgZD0iTTEzNy41IDE1MS41Yy0uNy45LTEuNyAxLjItMyAxdjVoNWMtMi40IDEtNS4xIDEuMy04IDF2LTdoNloiLz4KICAgIDxwYXRoIGZpbGw9IiM1YjQyMmMiIGQ9Ik0xMDQuNSAxNTIuNWgzYTkgOSAwIDAgMS0xIDUuNWMtMi45LjgtNS41LjYtOC0uNWg2di01WiIvPgogICAgPHBhdGggZmlsbD0iI2FiN2Q1NCIgZD0iTTE0MS41IDE2Ny41Yy0yLjEtMi40LTIuNS01LTEtOCAyLjgtLjMgNS41LS44IDgtMS41IDEgMiAxLjMgNC4yIDEgNi41YTEwIDEwIDAgMCAwLTggM1oiLz4KICAgIDxwYXRoIGZpbGw9IiNhYzdlNTQiIGQ9Ik04OS41IDE2MC41YzMuMiAxLjMgNi41IDIgMTAgMmwtMSA2Yy0yLjQtMi43LTUuNC00LTktNHYtNFoiLz4KICAgIDxwYXRoIGZpbGw9IiM1YjQzMmMiIGQ9Ik05Ny41IDE3Ni41di02YzIuMiAwIDIuNS0uNiAxLTJsMS02Yy0zLjUgMC02LjgtLjctMTAtMiAuNC0xLjEgMS0yLjEgMi0zIDQuMyAxLjQgOC42IDIuOCAxMyA0LTIuNiA0LjMtMy42IDktMyAxNGE3IDcgMCAwIDAtNCAxWiIvPgogICAgPHBhdGggZmlsbD0iIzVlNDUyZSIgZD0iTTE0MC41IDE1OS41Yy0xLjUgMy0xLjEgNS42IDEgOGE3IDcgMCAwIDEtMiAyLjVjLjIuNC42LjYgMSAuNXY2bC0yLTFjLS40LTUtMS43LTkuNi00LTE0IDEuOC0xLjMgMy44LTIgNi0yWiIvPgogICAgPHBhdGggZmlsbD0iI2IwODE1NiIgZD0iTTk3LjUgMTcwLjV2NmExMy4xIDEzLjEgMCAwIDEtMTQgMi41YzEuOC0zLjggMy41LTcuNiA1LTExLjUgMy42LTEgNi42IDAgOSAzWiIvPgogICAgPHBhdGggZmlsbD0iI2IxODI1NyIgZD0iTTE0MC41IDE3Ni41di02YzIuOC0yLjggNi00IDEwLTQgMSA0LjQgMi42IDguNiA1IDEyLjUtNS40IDEuOC0xMC40IDEtMTUtMi41WiIvPgo8L3N2Zz4KCg==","data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA5MjAgODM1Ij4KCTxkZWZzPgoJCTxwYXRoIGlkPSJhIiBkPSJNNTAgMjUwYTY5IDY5IDAgMSAxIDUwLTE1MCA2OSA2OSAwIDEgMSAxNTAgMCA2OSA2OSAwIDEgMSAyMDAgMTAwIDY5IDY5IDAgMSAxIDUwIDEwMCA2OSA2OSAwIDEgMS01MCAxMDAgNjkgNjkgMCAxIDEtMjAwLTUwQTY5IDY5IDAgMSAxIDUwIDI1MHoiIHRyYW5zZm9ybT0icm90YXRlKDEyMCAxODggMjI4LjYpIHNjYWxlKC42IC40KSIvPgoJCTxwYXRoIGlkPSJiIiBkPSJNMjUwIDM1MGE2OSA2OSAwIDEgMSA1MC0xNTAgNjkgNjkgMCAxIDEgMTUwIDAgNjkgNjkgMCAxIDEgMTAwIDEwMCA2OSA2OSAwIDEgMS0xNTAgMTAwIDY5IDY5IDAgMSAxLTE1MC01MHoiLz4KCQk8ZyBpZD0iYyI+CgkJCTx1c2UgaHJlZj0iI2EiLz4KCQkJPHVzZSBocmVmPSIjYSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjYwIDIwMCkiLz4KCQkJPHVzZSBocmVmPSIjYSIgdHJhbnNmb3JtPSJyb3RhdGUoOTAgMjM1IDM4NSkiLz4KCQkJPHVzZSBocmVmPSIjYSIgdHJhbnNmb3JtPSJyb3RhdGUoOTAgNDMwIDM4MCkiLz4KCQk8L2c+CgkJPGcgaWQ9ImQiPgoJCQk8dXNlIGhyZWY9IiNiIiBmaWxsPSIjNTY4YjE5IiB0cmFuc2Zvcm09InNjYWxlKC41KSIvPgoJCQk8dXNlIGhyZWY9IiNiIiBmaWxsPSIjNmZhMTI4IiB0cmFuc2Zvcm09Im1hdHJpeCguNCAwIDAgLjQgNDAgMzApIi8+CgkJCTx1c2UgaHJlZj0iI2IiIGZpbGw9IiM4ZWJhNDEiIHRyYW5zZm9ybT0ibWF0cml4KC4zIDAgMCAuMyA4MCA2MCkiLz4KCQk8L2c+Cgk8L2RlZnM+Cgk8dXNlIGhyZWY9IiNjIiBmaWxsPSIjMWMzODA4Ii8+Cgk8dXNlIGhyZWY9IiNjIiBmaWxsPSIjMjU0MTEwIiB0cmFuc2Zvcm09InJvdGF0ZSgxODAgNTcwIDQ4MCkgc2NhbGUoMS41KSIvPgoJPGcgZmlsbD0iIzNiNjIxMSI+CgkJPHVzZSBocmVmPSIjYSIgdHJhbnNmb3JtPSJtYXRyaXgoMS41IDAgMCAxLjUgLTIyMCAtMTkwKSIvPgoJCTx1c2UgaHJlZj0iI2EiIHRyYW5zZm9ybT0ibWF0cml4KDAgMS41IC0xLjUgMCA2NjAgMTAwKSIvPgoJCTx1c2UgaHJlZj0iI2EiIHRyYW5zZm9ybT0icm90YXRlKDQ1IDE5NC42IDY0MC42KSBzY2FsZSgxLjUpIi8+CgkJPHVzZSBocmVmPSIjYSIgdHJhbnNmb3JtPSJyb3RhdGUoMTcwIDU5Ny4yIDQzMC4xKSBzY2FsZSgxLjUpIi8+CgkJPHVzZSBocmVmPSIjYSIgdHJhbnNmb3JtPSJyb3RhdGUoLTEwMCA0MjMuNyAyNDEpIHNjYWxlKDEuNSkiLz4KCTwvZz4KCTxnIGZpbGw9IiM0YjczMWMiPgoJCTx1c2UgaHJlZj0iI2EiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xNDApIi8+CgkJPHVzZSBocmVmPSIjYSIgdHJhbnNmb3JtPSJyb3RhdGUoLTQ1IDQ3My42IDU2My44KSIvPgoJCTx1c2UgaHJlZj0iI2EiIHRyYW5zZm9ybT0icm90YXRlKC05MCA1MzAgNDcwKSIvPgoJCTx1c2UgaHJlZj0iI2EiIHRyYW5zZm9ybT0icm90YXRlKC0xMzUgNTA3LjggNDM0KSIvPgoJCTx1c2UgaHJlZj0iI2EiIHRyYW5zZm9ybT0icm90YXRlKDE4MCA1MzAgNDAwKSIvPgoJCTx1c2UgaHJlZj0iI2EiIHRyYW5zZm9ybT0icm90YXRlKDE4MCA1MzAgNDAwKSIvPgoJCTx1c2UgaHJlZj0iI2EiIHRyYW5zZm9ybT0icm90YXRlKDEyNSA1MjUuMyA0MDcpIi8+CgkJPHVzZSBocmVmPSIjYSIgdHJhbnNmb3JtPSJyb3RhdGUoOTAgNTA1IDM1NSkiLz4KCQk8dXNlIGhyZWY9IiNhIiB0cmFuc2Zvcm09InJvdGF0ZSg0NSA1NDIuMSAyODQuNikiLz4KCTwvZz4KCTxnIGZpbGw9IiM2MTg1MmIiPgoJCTx1c2UgaHJlZj0iI2EiIHRyYW5zZm9ybT0ibWF0cml4KC42IDAgMCAuNiA1MCA0MCkiLz4KCQk8dXNlIGhyZWY9IiNhIiB0cmFuc2Zvcm09InJvdGF0ZSg2MCAzOTQuMyA1MjMpIHNjYWxlKC42KSIvPgoJCTx1c2UgaHJlZj0iI2EiIHRyYW5zZm9ybT0icm90YXRlKDEyMCA0MTkuMiA0MjguNykgc2NhbGUoLjYpIi8+CgkJPHVzZSBocmVmPSIjYSIgdHJhbnNmb3JtPSJtYXRyaXgoLS42IDAgMCAtLjYgODAwIDgwMCkiLz4KCQk8dXNlIGhyZWY9IiNhIiB0cmFuc2Zvcm09InJvdGF0ZSgtMTIwIDQ1OS44IDMzNC41KSBzY2FsZSguNikiLz4KCQk8dXNlIGhyZWY9IiNhIiB0cmFuc2Zvcm09InJvdGF0ZSgtNjAgMzkzIDMxOS4zKSBzY2FsZSguNikiLz4KCTwvZz4KCTxwYXRoIGZpbGw9IiM1NTNkMGUiIGQ9Ik02MDYgMTIxYzIgMyAyIDcgMSAxMWwtMSAyMC0yIDIzYzAgNS0yIDEwLTEgMTUgMy00IDktNCAxMi05IDEwLTEgMTgtMTAgMjctMTMgMy0xIDYtMyA4LTZsNC00YzItMSA0IDAgNSAxIDIgMiAxIDMgMCA1YTQ3IDQ3IDAgMCAxLTIxIDE2IDgzIDgzIDAgMCAwLTE4IDEwbC0xOSAxMWMtMSAxLTMgMS0zIDMgMSA0LTIgNy00IDEyIDkgMiAxNyAzIDI1IDBsMjEtNGMxMC0xIDIxLTIgMzEtNiAyLTEgMyAwIDQgMiAyIDIgMSA0LTEgNS02IDQtMTIgNS0xOSA1LTEwIDAtMjAgMy0zMCA0LTExIDEtMjEgNC0zMiA2LTMgMC01IDItNyA1LTQgOC03IDE3LTE2IDIybC0xNCAxMi0xNyA5YzEgMiAyIDMgNCAzIDggMCAxNyAxIDI2LTEgMTEtMiAyMi0zIDMyLTEwbDE1LTdjNy0zIDEzLTggMjAtMTJsNi00YzQtMyA2IDAgOCAyIDMgMyAwIDUtMiA3LTkgNi0xNiAxMy0yNyAxNy04IDMtMTUgOC0yMyAxMi04IDMtMTcgNy0yNyA1aC03bC0xMyAxYy04IDEtMTYgMC0yNC0yLTctMi0xMyAxLTE3IDZhMTA2IDEwNiAwIDAgMC0xOCAyMWMtNSA5LTkgMTgtMTAgMjggMCA3IDggMTcgMTQgMThsMjYgNSAyNCAzIDIxIDQgMTMgNGMxOCA1IDM2IDEyIDU2IDdhODMgODMgMCAwIDEgMTYtM2M1IDAgMTEtMiAxNS02IDgtNSAxNy03IDI2LTExIDYtMyAxMy00IDIwLTZhOCA4IDAgMCAwIDQtM2MxMC0xMyAyNC0yMCAzOS0yNWwyIDFjLTEwIDctMjEgMTEtMjkgMjEgMTEtMSAyMi02IDM0LTYgMCAyLTEgNC0zIDRhNTk5IDU5OSAwIDAgMC01MyAxN2MtOCAzLTE2IDUtMjQgMTEgOS0xIDE3IDEgMjUgMmw0MCA1IDI1IDQgNiAxdjdsLTE1LTFjLTgtMi0xNS0xLTIyLTNoLTRjMSA2IDUgMTAgOSAxM2E2NSA2NSAwIDAgMCAxNyAxNWMyIDEgNCAyIDMgNWgtNmE4MyA4MyAwIDAgMS0yOS0yN2MtNC02LTgtMTAtMTYtOS02IDEtMTEgMC0xNy0xaC04Yy0xNCAxLTI4IDMtNDEgNy01IDEtOSAzLTE1IDMgMiA0IDcgNiAxMCA4YTczIDczIDAgMCAwIDI4IDEyYzIgMCA1IDAgNSAzcy0zIDMtNSAzYy0xMiAxLTIzLTMtMzMtOS02LTQtMTMtNi0xOC0xMi0yLTMtNi0yLTktMS04IDEtMTYtMi0yMy00LTktMS0xNi02LTI0LThsLTE1LTQtNDItN2EyMjQgMjI0IDAgMCAxLTE0LTJjLTUtMS0xMSAwLTEzIDQtMyA0LTEgOCAyIDEybDI1IDM1IDQgN2EzOSAzOSAwIDAgMCAyNCAyMWM5IDIgMTggMCAyNi0yIDEyLTMgMjQtOCAzNi05bDIwLTJjMTEgMCAyMy0yIDM0IDJsNSAxYzIgMSA2IDAgNCA0IDAgMi0zIDQtNiAzYTk5IDk5IDAgMCAwLTMyLTJsLTIyIDEtMjIgNmMtMTEgMy0yMSA2LTMzIDctMyAwLTUgMi05LTFsMyA1YzcgNCAxMSAxMSAxNiAxN2wxNCAxOCA5IDExYzQgNSA4IDcgMTQgNWE2NyA2NyAwIDAgMSAyMC0ybDE0LTFjMTAgMCAxOSAzIDI2IDEyYTEyMSAxMjEgMCAwIDAgMjkgMjZsNSAxYzIgMCAzIDEgMyAzIDEgMiAwIDQtMiA1LTQgMS03IDEtMTAtMS04LTYtMTgtMTEtMjUtMTlsLTgtMTBjLTQtNS05LTctMTYtN2gtMjJjLTMgMS01IDMtOCAzIDAgMyAxIDYgNCA3IDIgMCAyIDEgMiAyIDkgMTIgMTggMjYgMzEgMzIgMTAgNSAxNiAxMyAyNSAxOSAyIDIgNCA1IDIgOHMtNiAyLTggMGExNDQgMTQ0IDAgMCAxLTE0LTEyYy00LTUtMTEtNi0xNi0xMWExMjkgMTI5IDAgMCAxLTI3LTI3Yy0zLTUtOC04LTEzLTEyIDMgNyAyIDE0IDggMTktMiAxMyA2IDIyIDcgMzVsNSAzNiA0IDI3YzEgMy0xIDYtNCA2LTMgMS00LTItNC01bC04LTM2LTItMTYtNC0xNWMtMi01LTEtMTAtMi0xNWwtOS0yN2MtMS01LTYtOS05LTEzLTQtNy0xMS0xMS0xNC0yMC0yIDExLTggMjEtMTAgMzEtMyAxMCAyIDE1IDYgMjEgNSA2IDkgMTIgMTEgMTkgMCA0IDMgNyA1IDExdjRsLTEgM2MtMiAxLTMgMC0zLTJsLTYtMTRhOTAgOTAgMCAwIDAtMTMtMTljLTIgNyAxIDE0IDIgMjBhNzYgNzYgMCAwIDAgMyAxMmwyIDZjMSAzIDEgNy0zIDktNC0yLTQtNS01LTlhNzk5IDc5OSAwIDAgMS04LTM2di0xMWMzLTE1IDYtMzAgMTEtNDUgMy0xMi0zLTIxLTEyLTI4YTYyIDYyIDAgMCAxLTEyLTEybC0xMS0xMWMtOC02LTEyLTE2LTE2LTI1YTI0MCAyNDAgMCAwIDAtMjAtMjhjLTItMi0zLTUtNi02bC0yIDNjLTEgMTAtNSAxOS03IDI4LTMgMTAtNyAxOS00IDMwIDEgNi0xIDEzIDEgMTlsNyAyMiA0IDE0IDMgMjV2MzBsLTQgMjZjLTEgMTIgMyAyMiA3IDMzbDkgMjdjMSAzIDEgNi0yIDEwLTUtMTUtMTAtMzAtMjAtNDItMyAyLTMgNy01IDExLTUgMTItMTIgMjMtMTUgMzUtMyA4LTcgMTUtNyAyNGgtNXYtNmE2MiA2MiAwIDAgMSA2LTI4bDgtMjBjMy01IDctMTAgOC0xNSAyLTkgOC0xNyA4LTI3YTI5IDI5IDAgMCAwLTItN2MtMS0zLTItNiAxLTlsMS00LTEtNDFhNTcgNTcgMCAwIDAtNi0yNWMtNyAzLTkgOS0xMyAxNGwtMSAyYy01IDUtNyAxMi0xMiAxN2ExOSAxOSAwIDAgMC01IDEwYy0zIDE3LTcgMzQtMTcgNDgtNiA5LTEzIDE4LTI1IDIxaC03Yy0yIDAtMy0xLTMtM2wyLTRjMTQgMCAxOS0xMSAyNS0yMCA4LTEyIDEyLTI2IDE1LTQwIDItMTIgNy0yMiAxNi0zMSA2LTcgMTMtMTMgMTgtMjEgMy01IDAtOC0xLTExbC0zLTE0Yy0xLTItMi0zLTQtMS02IDQtMTMgNi0xOSA5bC0yMiAxMS0xIDFjLTMgNy04IDE0LTYgMjIgMSA0IDEgOC0xIDEyLTYtOS03LTE4LTMtMjctMTcgNS0zMiAxMi00OSAxOC03IDItMTMgNy0yMCAxMGEyODkgMjg5IDAgMCAwLTI1IDEybC0xNyAxMS0xNCAxMGMtMSAyLTMgNC01IDEtMS0yIDEtMyAzLTRsMzQtMjZhNTggNTggMCAwIDEgMTgtOGM4LTMgMTQtOSAyMC0xM2ExMDIgMTAyIDAgMCAxIDMzLTEzIDg1IDg1IDAgMCAwIDMyLTE2bDE0LTdjMTAtNSAyMC0xMSAyOS0xOGwzLTRjLTEtMTAgNC0xOCA2LTI2bDItOGMtMS04IDEtMTUgMi0yM2EzMyAzMyAwIDAgMC01LTI1Yy0yLTMtNS00LTEwLTRsLTE0LTFhMjYgMjYgMCAwIDAtMjAgNmMtMSAxLTIgMi0xIDQgNCA0IDMgOSA0IDE0YTExMSAxMTEgMCAwIDEgMCAzOWMtMSA2LTIgMTMtOSAxNmExMCAxMCAwIDAgMS0xLTlsMy0xMnYtOGMtMi0xMC0zLTIwLTctMzAtMS0zIDAtNi0yLTgtOSAzLTE3IDgtMjYgMTJsLTMgMWMtNiAwLTExIDMtMTUgNS0xMyA4LTI0IDE5LTMzIDMxYTk0IDk0IDAgMCAxLTQxIDMybC0zNyAxM2E3NCA3NCAwIDAgMS0zMiA1Yy0yLTEtNC0xLTQtM3MxLTMgMy00bDUtMWM4IDAgMTYtMyAyNC00bDEtMWMxNS03IDMyLTEwIDQ3LTE4YTcxIDcxIDAgMCAwIDI4LTIzbDE0LTE3IDE3LTE0aC0yMWMtMTUgMi0yOC0zLTQyLTZsLTIzLTItMTItNWMtOS01LTE5LTYtMjktNS0zIDAtNCAxLTUgNC00IDEwLTcgMjEtMTMgMzEtNCA4LTEwIDE1LTIwIDE4di00YzEyLTggMjMtMjkgMjAtMzctNCAyLTYgNi05IDlsLTUgNWMtMSAxLTIgMi0zIDEtMi0yLTEtMyAwLTRhMzMgMzMgMCAwIDEgMy02YzgtOSAxNi0xOCAyNi0yNSAxMC02IDIwLTkgMzItNmw1IDFhMTczIDE3MyAwIDAgMC0xNC0zOSA3NSA3NSAwIDAgMC0yOS0yN2MyLTMgNC0zIDYtMmE3MSA3MSAwIDAgMSAzMiAyNmM1IDcgOSAxNCAxMiAyMiAyIDQgMiA5IDUgMTIgNyA1IDkgMTUgMTggMTkgMyAyIDYgMiA5IDIgOSAyIDE5IDYgMjggNmE0NTYgNDU2IDAgMCAwIDI2LTJjLTYtNC0xMC0xMC0xNC0xNi0zLTUtNS0xMC05LTE0LTItMS0yLTMgMC00IDItMiAzLTEgNSAwbDIxIDI0IDggN2M2IDUgMTMgMSAxOS0xbDE0LTZjNi0yIDEwLTcgMTYtMTAgNy0zIDE1LTUgMjItNmwxNS0yYzYtMSA4LTQgNC05LTYtOS0xNC0xNi0yMy0yMWwtOC0zYy0xMC00LTE3LTEwLTIyLTIwYTc0IDc0IDAgMCAwLTMwLTMxYy0xMS03LTIwLTE2LTI5LTI2bC0zLTJjLTEyLTQtMjEtMTMtMzMtMTgtNS0yLTktNS0xNC02LTctMS0xMi02LTE3LTExbC0xNC0xMmMtMS0yLTItNCAwLTZzNC0xIDUgMGMxMiAxMSAyNiAxOCA0MCAyNCA3IDMgMTQgNyAyMiA5bDEtMTQgNC0yNGMxLTYgMC0xMiAyLTE4YTgyIDgyIDAgMCAxIDgtMjFjMS0zIDQtNCA3LTMgMiAyIDIgNSAxIDdsLTcgMTVjLTQgOS0yIDIwLTQgMzBsLTEgOWMwIDgtMSAxNiAxIDI0bDIgM2M0IDEgNiA0IDEwIDZsMTggMTYgMTEgN2M2IDMgMTMgNyAxNiAxMmwxMiAxOGM1IDggMTIgMTUgMjEgMTkgMiAxIDQgMSA0LTIgMy0xMCAxMC0xOSAxMy0yOSAxLTUgNC0xMCAyLTE1LTItMi0xLTUtMS04YTY2IDY2IDAgMCAwLTktMzIgMjQgMjQgMCAwIDAtOS04Yy01LTQtMTItNi0xOC04bC0xOC04LTMtM2MtMS0xLTMtMy0yLTUgMi0zIDQtMiA3LTEgNyA0IDE1IDYgMjQgOCAxNCAzIDI1IDkgMzIgMjNhOTIgOTIgMCAwIDEgOCAzM2MxIDEyLTMgMjItOCAzMmwtNiAxNS0xIDEyIDUgNGM3IDAgMTEgNSAxNiA4IDkgNyAxOSA1IDI2LTUgOC0xMSAxNS0yMyAyNC0zNGE4OSA4OSAwIDAgMSAzMS0yMyAxOTEgMTkxIDAgMCAwIDIwLTEyYzMtMiA0LTYgNS0xMCAxLTEwLTItMjAtNy0yOS02LTEwLTgtMjEtMTAtMzJhOCA4IDAgMCAxIDAtNWMzLTUgMy0xMSA1LTE2IDEtMiAyLTUgNS00IDIgMCAyIDQgMSA1YTUyIDUyIDAgMCAwIDEgMzQgNjIgNjIgMCAwIDAgMTEgMTlsMiA4YzAgNiAyIDExIDEgMTYgNS0xIDYtNSA4LTggNS05IDEwLTE3IDEzLTI2IDQtOSA4LTE5IDEwLTI5bDUtMjUgMS0xM2E1NCA1NCAwIDAgMSAzLTE5bDUtMSIvPgoJPHVzZSBocmVmPSIjZCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMzUwIDMwMCkiLz4KCTx1c2UgaHJlZj0iI2QiIHRyYW5zZm9ybT0icm90YXRlKC00NSA5NTkuNiAtOTcuNSkiLz4KCTx1c2UgaHJlZj0iI2QiIHRyYW5zZm9ybT0icm90YXRlKC0xMDAgMzIyLjcgMjgzKSIvPgoJPHVzZSBocmVmPSIjZCIgdHJhbnNmb3JtPSJyb3RhdGUoLTE1MCAzMDkuOSAzNTYuNCkiLz4KCTx1c2UgaHJlZj0iI2QiIHRyYW5zZm9ybT0icm90YXRlKDE4MCA0MDAgMTYwKSIvPgoJPHVzZSBocmVmPSIjZCIgdHJhbnNmb3JtPSJyb3RhdGUoMTIwIDIzNi41IDI4My4yKSIvPgoJPHVzZSBocmVmPSIjZCIgdHJhbnNmb3JtPSJyb3RhdGUoOTAgMTkwIDIxMCkiLz4KPC9zdmc+Cg==","data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiB2aWV3Qm94PSIwIDAgMTI4IDE0MiI+Cgk8cGF0aCBmaWxsPSIjMDkwODA5IiBkPSJNNjQuNS0uNWg3YTI3OCAyNzggMCAwIDAgMTYgOC41IDM5IDM5IDAgMCAxIDEwIDI4LjUgMzYgMzYgMCAwIDEgMTQuNSA0YzIuNyA4LjYgNSAxNy4zIDcgMjYgMi42LjkgNC40IDIuNSA1LjUgNWwtLjUgOGExOCAxOCAwIDAgMC0zLjUgNi41IDkwIDkwIDAgMCAxIDcgMjEuNXY4Yy0uOCAzLjMtMiA2LjctMy41IDEwbC0xLTFjLTEuMiAxLTIuNSAxLjYtNCAyLTE4LjEtOS0zNi04LjUtNTMuNSAxLjUtNCA2LjItOS40IDEwLjctMTYgMTMuNWgtMmMtMS4yLS45LTIuNC0xLjktMy41LTMtMS40LTQuNC0yLjktOC43LTQuNS0xMy0zLjktMS4yLTcuNy0yLjUtMTEuNS00LTQuNS41LTguNyAyLTEyLjUgNC41LTMuNyAyLjctNyA1LjctMTAgOS0xIC43LTIgLjctMyAwLS45LTEtMS45LTEuOS0zLTIuNXYtMjFjMS42LTYuMiA0LjMtMTIgOC0xNy41LTIuNi0zLTMuNC02LjYtMi41LTEwLjUgNC0xMC41IDcuMy0yMS4yIDEwLTMyIDQuNi0zLjQgOS40LTYuNCAxNC41LTkgMi0uNiAyLjQtMS42IDEtM0E0Mi41IDQyLjUgMCAwIDEgNDguNSAzYzUuNC0xLjMgMTAuOC0yLjUgMTYtMy41WiIvPgoJPHBhdGggZmlsbD0iIzI4MjgyOCIgZD0iTTU0LjUgMy41YzEuNC0uMiAyLjcgMCA0IC41QTQzIDQzIDAgMCAwIDU1IDI5LjVjLTkuMy00LjMtMTIuMy0xMS4zLTktMjFhMTYgMTYgMCAwIDEgOC41LTVaIi8+Cgk8cGF0aCBmaWxsPSIjMjcyNzI3IiBkPSJNNjYuNSA0MS41Yy0xLjMgMS4zLTIuNyAxLjMtNCAwIDEuMy0xLjIgMi0yLjkgMi01LTEuNi04LTEtMTUuOSAyLTIzLjVsLS41LTEuNWEyMC41IDIwLjUgMCAwIDAtMyA4Yy0uNSA2LS41IDEyIDAgMThhMzYuMyAzNi4zIDAgMCAxLTItMjBjLTEuNyA1LjYtMiAxMS4zLTEgMTdhMzIuNCAzMi40IDAgMCAxLTEtMjdBMTQuNCAxNC40IDAgMCAxIDc1LjUgNWMxLjIgMS40IDIuNSAyLjUgNCAzLjUtMS4xIDktNCAxNy4zLTguNSAyNWwtNSA1Yy0uNyAxLjItLjYgMi4yLjUgM1oiLz4KCTxwYXRoIGZpbGw9IiMyODI4MjgiIGQ9Ik04Mi41IDkuNWMxLS4xIDIgMCAzIC41IDEuNCAyLjIgMy4xIDQuMiA1IDZhMzAgMzAgMCAwIDAtNyA5LjVjLTIuMy44LTQuNCAxLjgtNi41IDNhNTggNTggMCAwIDAgMi41LTE4YzEuMy4yIDIuMy0uMSAzLTFaIi8+Cgk8cGF0aCBmaWxsPSIjZGVkNWNjIiBkPSJNNjIuNSA0MS41YzEuMyAxLjMgMi43IDEuMyA0IDAgNC00LjUgOC4zLTguNiAxMy0xMi41IDIuNS0xIDQuNS0uNCA2IDEuNSAxLjQgNy42IDIgMTUuMyAyIDIzbC00IDZhMjkuNCAyOS40IDAgMCAwLTYgMTFjLTEuNyA2LTUuNyA5LTEyIDktNi43LS43LTExLjMtNC0xNC0xMGE2MCA2MCAwIDAgMC03LTExIDE4IDE4IDAgMCAxLTYtMTNjMS44LTQuNCAyLjgtOSAzLTE0IDIuNy0zLjUgNi00IDEwLTEuNWE2MCA2MCAwIDAgMCAxMSAxMS41WiIvPgoJPHBhdGggZmlsbD0iIzcyNmQ2OCIgZD0iTTQxLjUgMzEuNWMtLjIgNS0xLjIgOS42LTMgMTQtMi01LjQtMS0xMCAzLTE0WiIvPgoJPHBhdGggZmlsbD0iIzdhNzU3MCIgZD0iTTg1LjUgMzAuNWMxLjggMS45IDMgNC4yIDMuNSA3IC43IDQuMy43IDguNyAwIDEzYTUuNSA1LjUgMCAwIDEtMS41IDNjMC03LjctLjYtMTUuNC0yLTIzWiIvPgoJPHBhdGggZmlsbD0iI2I0YWVhNyIgZD0iTTMwLjUgMzkuNWMxLjQgMS40IDEgMi40LTEgMyAuNi0uOSAxLTEuOSAxLTNaIi8+Cgk8cGF0aCBmaWxsPSIjMzUzNDU2IiBkPSJNMTAwLjUgNDAuNWMyLjMuNiA0LjYgMSA3IDEuNS41LjQuOCAxIDEgMS41bC0zIDEwYy0yLjIuMy00LjUuMy03IDBhMTc4IDE3OCAwIDAgMCAyLTEzWiIvPgoJPHBhdGggZmlsbD0iIzY4NjM1ZiIgZD0iTTkyLjUgNDIuNWMxLjMgMSAyIDIuNSAyIDQuNS0uMiAyLjUtMSA0LjYtMi41IDYuNS0uOC0zLjgtLjYtNy40LjUtMTFaIi8+Cgk8cGF0aCBmaWxsPSIjNmU2OTY0IiBkPSJNMzMuNSA0My41YTcgNyAwIDAgMSAyLjUgMmMuMyAyLjkuOCA1LjcgMS41IDguNWwtMSAxLjVhMTUuOCAxNS44IDAgMCAxLTMtMTJaIi8+Cgk8cGF0aCBmaWxsPSIjN2Q3ODcyIiBkPSJNNTYuNSA0My41YzIuMiAyIDQuNSAzLjggNyA1LjUtMy42IDAtNi0xLjktNy01LjVaIi8+Cgk8cGF0aCBmaWxsPSIjMTIxMTExIiBkPSJNODQuNSA1MS41Yy0yLjQuMy00LjcuOC03IDEuNS0xLjEuOC0xLjEgMS42IDAgMi41LjUgMi40LS4zIDQuMS0yLjUgNS0xLjktLjYtMi45LTItMy00LTIuMSAxLjQtMy4zLjctMy41LTJsLjUtMmMxIDEgMi4yIDEuMiAzLjUuNWw2LTRjLTEuNS0xLjItMS4zLTIgLjUtMi41IDEuOS43IDMuNyAxLjUgNS41IDIuNSAxLjMgMSAxLjMgMS44IDAgMi41WiIvPgoJPHBhdGggZmlsbD0iIzM1MzQ1NyIgZD0iTTI3LjUgNDcuNWMxLjEgMy43IDIuOCA3LjIgNSAxMC41YTg4LjYgODguNiAwIDAgMS03IDMuNWMtMS40LTItMy0zLjctNS01LTEuOC0xLjQtMi4yLTMuMS0xLTUgMi41LTEuOCA1LjEtMy4xIDgtNFpNMTEwLjUgNDYuNWE2Ny40IDY3LjQgMCAwIDEgNS41IDI3IDEzIDEzIDAgMCAxLTExLjUgNGMtLjMtMy4yLTEtNi40LTItOS41IDMuNC03IDYtMTQuMSA4LTIxLjVaIi8+Cgk8cGF0aCBmaWxsPSIjN2M3NzcxIiBkPSJNNDUuNSA1MC41YzIuNC4zIDQuOCAxIDcgMiAxLjMuOCAxLjMgMS40IDAgMmE3LjggNy44IDAgMCAxLTctNFoiLz4KCTxwYXRoIGZpbGw9IiM3NjcxNmMiIGQ9Ik04NC41IDUxLjVjLTEuOCAyLTQuMiAzLjQtNyA0LTEuMS0uOS0xLjEtMS43IDAtMi41IDIuMy0uNyA0LjYtMS4yIDctMS41WiIvPgoJPHBhdGggZmlsbD0iIzFiMWIyZCIgZD0iTTk2LjUgNTQuNWE5NzEuNyA5NzEuNyAwIDAgMC0zLjUgMzVjLS4yIDIuNS0xLjQgNC4xLTMuNSA1LS40LTMgLjUtNS43IDIuNS04IDEtMTAuNiAxLjUtMjEuMyAxLjUtMzJoM1oiLz4KCTxwYXRoIGZpbGw9IiMzNTM0NTciIGQ9Ik0xOS41IDU2LjVjMy40IDUuNCA2LjQgMTEuMSA5IDE3LTYuNC0uMS0xMC4yIDIuOS0xMS41IDkgMi4xLTIuOCA0LjgtNC44IDgtNiAxLjYuMyAyLjggMS4xIDMuNSAyLjVhMTguNyAxOC43IDAgMCAwLTExIDEyLjUgMjIuMyAyMi4zIDAgMCAxLTgtMTBjMi43LTguNyA1LjYtMTcuMyA4LjUtMjYgLjQuNi45LjkgMS41IDFaIi8+Cgk8cGF0aCBmaWxsPSIjNzM2ZTY5IiBkPSJNNDQuNSA1OC41YzIuNyAzLjQgNSA3IDcgMTEtNC43LTIuNC04LTYtMTAtMTFoM1oiLz4KCTxwYXRoIGZpbGw9IiM1OTUzMTUiIGQ9Ik05MC41IDY0LjVjLjEtLjcgMC0xLjQtLjUtMmE0LjIgNC4yIDAgMCAxLTIuNSAzYy45LTMuNCAyLTYuNyAzLjUtMTAgLjggMy4yLjYgNi4yLS41IDlaIi8+Cgk8cGF0aCBmaWxsPSIjNzU3MTZiIiBkPSJNNzcuNSA3MC41YzEuMi00LjIgMy4yLTcuOCA2LTExIC44LjggMS43LjUgMi41LTEgLjMgMS40IDAgMi43LTEgNGE4My4yIDgzLjIgMCAwIDAtNy41IDhaIi8+Cgk8cGF0aCBmaWxsPSIjYjFhNDI5IiBkPSJNOTAuNSA2NC41Yy4yIDYuNyAwIDEzLjMtLjUgMjBhOS4yIDkuMiAwIDAgMC0xLjUgMTB2MWE2LjYgNi42IDAgMCAxLTQtNmwyLjUtNWMuNS01LjcuNy0xMS4zLjUtMTd2LTJhNC4yIDQuMiAwIDAgMCAyLjUtM2MuNS42LjYgMS4zLjUgMloiLz4KCTxwYXRoIGZpbGw9IiMxNTE1MjIiIGQ9Ik0zNy41IDc4LjVjLTEuNC4yLTIuNyAwLTQtLjVhMzUgMzUgMCAwIDEtNS00LjVjLTIuNi01LjktNS42LTExLjYtOS0xN2gxYzIgMS4zIDMuNiAzIDUgNSAyLjQtMSA0LjctMi4yIDctMy41YTQxLjIgNDEuMiAwIDAgMS01LTEwLjUgNyA3IDAgMCAxIDMtMmMuNCA0LjQgMiA4LjMgNSAxMS41bC0yIDJjMS43LjcgMy40LjUgNS0uNWE5MC41IDkwLjUgMCAwIDEgMi41IDIzIDcuNSA3LjUgMCAwIDEtMy41LTNaIi8+Cgk8cGF0aCBmaWxsPSIjMzUzNDU3IiBkPSJNMzcuNSA3OC41YTY4LjkgNjguOSAwIDAgMC03LjUtNiA0MS40IDQxLjQgMCAwIDAtNC41LTkuNWMzLjEtMS43IDYuMy0yLjIgOS41LTEuNSAzIDQuMyA0LjUgOS4xIDQuNSAxNC41LS4yIDEuNC0uOSAyLjItMiAyLjVaIi8+Cgk8cGF0aCBmaWxsPSIjNTc1MTEzIiBkPSJNNDQuNSA2OC41djJoLTFhMTAuMSAxMC4xIDAgMCAxLTEuNS02YzEuNSAxIDIuMyAyLjMgMi41IDRaIi8+Cgk8cGF0aCBmaWxsPSIjMWYxZTFkIiBkPSJNNzAuNSA2My41YzEgNi0xLjcgOC4yLTggNi41LS45LTEtMS45LTEuOS0zLTIuNSAwLTEuMi0uNy0yLTItMi41YTMyIDMyIDAgMCAxIDQtMi41Yy0uNy0yLS43LTQgMC02LTIuNS4zLTQuNiAxLjMtNi41IDMtMi4yLS45LTMtMi42LTIuNS01IDEuMy0uNiAxLjMtMS4yIDAtMmEyMSAyMSAwIDAgMC03LTJjLTEuMy0uNi0xLjMtMS4yIDAtMiAyLjQtMiA1LjEtMi40IDgtMS0uMi42LS41IDEtMSAxLjVsNy41IDUuNWMxLjgtMi43IDMtMi40IDMuNSAxYTguNSA4LjUgMCAwIDAgMCA4bC0uNSAyYy0uNy0xLjItMS4yLTEuMi0xLjUgMCAxLjYgMyA0IDMuNyA3IDJsMi00WiIvPgoJPHBhdGggZmlsbD0iIzIzMjIzNiIgZD0iTTQ0LjUgNjguNWM1LjcgMi41IDcuNSA2LjggNS41IDEzLS41IDIuMS0xLjQgNC4xLTIuNSA2LS42LS4xLTEtLjUtMS0xLS4yLTUuNS0uOC0xMC45LTItMTZ2LTJaIi8+Cgk8cGF0aCBmaWxsPSIjNzc3MjZkIiBkPSJNNzIuNSA2OS41Yy0yLjMgMS41LTUgMi4xLTggMi0xLjkgMC0zLjUtLjMtNS0xIC42LS43LjYtMS43IDAtMyAxLjEuNiAyLjEgMS41IDMgMi41IDYuMyAxLjcgOS0uNSA4LTYuNSAxLjYtMSAyLjktLjYgNCAxLjVhNC4zIDQuMyAwIDAgMC0yIDQuNVoiLz4vCgk8cGF0aCBmaWxsPSIjMTYxNTE0IiBkPSJNNTkuNSA3MC41YzEuNS43IDMuMSAxIDUgMSAzIC4xIDUuNy0uNSA4LTJhMyAzIDAgMCAxIDMgMWMtMi4xIDUuNS01LjYgNi41LTEwLjUgM2E4NiA4NiAwIDAgMS03LjUgMS41Yy0uOS0yLTIuMi0zLjctNC01IDIuMS0uNyA0LjEtLjUgNiAuNVoiLz4KCTxwYXRoIGZpbGw9IiMzNzM2NTgiIGQ9Ik04Ny41IDY3LjVjLjIgNS43IDAgMTEuMy0uNSAxN2wtMi41IDVjLTMuNS04LTIuNS0xNS40IDMtMjJaIi8+Cgk8cGF0aCBmaWxsPSIjNDAxOTBkIiBkPSJNNzguNSA3NC41YzEuNCA0LjEgMS45IDguNSAxLjUgMTNhNDMuNCA0My40IDAgMCAwLTQuNS05LjVjMS4yLTEgMi4yLTIuMiAzLTMuNVoiLz4KCTxwYXRoIGZpbGw9IiNhYjllMmIiIGQ9Ik00My41IDcwLjVoMWE4My42IDgzLjYgMCAwIDEgMiAxNmwtMi41LTNhODUgODUgMCAwIDEtLjUtMTNaIi8+Cgk8cGF0aCBmaWxsPSIjNzg3ODc4IiBkPSJNNTUuNSA4My41Yy4yLTEuNy0uNS0yLjctMi0zIC42LTMuMyAxLjgtMy42IDMuNS0xIC4zIDEuNi0uMiAzLTEuNSA0WiIvPgoJPHBhdGggZmlsbD0iIzc0NzQ3NCIgZD0iTTc1LjUgODIuNWMtMS42LjgtMi4zIDIuMS0yIDRsLTMtNS41YzIuNS0yLjMgNC4yLTEuOCA1IDEuNVoiLz4KCTxwYXRoIGZpbGw9IiM1NjUwMTYiIGQ9Ik0xMDUuNSA3OS41djJjLTMuNi42LTYuMi0uNi04LTMuNWwuNS0xLjVjMi4xIDEuOSA0LjYgMi45IDcuNSAzWiIvPgoJPHBhdGggZmlsbD0iI2M4YzhjOCIgZD0iTTUzLjUgODAuNWMxLjUuMyAyLjIgMS4zIDIgMyAuMiA0LjYtMS4zIDUuNi00LjUgMyAwLTIuMy44LTQuMyAyLjUtNloiLz4KCTxwYXRoIGZpbGw9IiM2ZDZkNmQiIGQ9Ik03MC41IDg0LjVoLTd2LTNjMy4xLS41IDUuNS41IDcgM1oiLz4KCTxwYXRoIGZpbGw9IiMzZDNiNTYiIGQ9Ik0xMTAuNSA4My41aC01di0yYzUgMCA5LjgtMS4zIDE0LTRsMSAuNWMtMi44IDIuOS02IDQuNy0xMCA1LjVaIi8+Cgk8cGF0aCBmaWxsPSIjOTk4ZTJjIiBkPSJNMTA2LjUgODYuNWE3IDcgMCAwIDEgNC0zYzQtLjggNy4zLTIuNiAxMC01LjVsLTEtLjVjLTQuMiAyLjctOSA0LTE0IDR2LTJjNy4zLjkgMTIuMS0yLjEgMTQuNS05IDMuNSA3LjIgMS4zIDEyLTYuNSAxNC41LTIuMiAxLTQuNiAxLjUtNyAxLjVaIi8+Cgk8cGF0aCBmaWxsPSIjMWIxYjJkIiBkPSJNOS41IDgxLjVjMS43IDQuMiA0LjQgNy41IDggMTAtLjcgMi4yLTEuMiA0LjYtMS41IDdhMTkuMiAxOS4yIDAgMCAxLTYuNS0xN1oiLz4KCTxwYXRoIGZpbGw9IiMzYjM5NTciIGQ9Ik0zNC41IDgxLjVjMS41LjUgMi44IDEuMiA0IDItOS4xIDQtMTIuOCAxMS0xMSAyMWwtNi01di0yYy43LTguNCA1LTEzLjcgMTMtMTZaIi8+Cgk8cGF0aCBmaWxsPSIjZTFlMWUxIiBkPSJNNTguNSA4My41YTYuNiA2LjYgMCAwIDEgMCA3Yy0xLjMgMC0yLjMtLjUtMy0xLjUgMS4xLTEuOCAyLjEtMy42IDMtNS41WiIvPgoJPHBhdGggZmlsbD0iI2Q2ZDZkNiIgZD0iTTc1LjUgODIuNWMxLjIgMS44IDEuOSAzLjggMiA2LTIgLjMtMy4zLS4zLTQtMi0uMy0xLjkuNC0zLjIgMi00WiIvPmEKCTxwYXRoIGZpbGw9IiM1OTUyMWUiIGQ9Ik0xMDUuNSA4My41aDVhNyA3IDAgMCAwLTQgMyAxMCAxMCAwIDAgMS04LTNjMi4yLS42IDQuNi0uNiA3IDBaIi8+YQoJPHBhdGggZmlsbD0iIzliOWI5YiIgZD0iTTU4LjUgOTAuNWE2LjYgNi42IDAgMCAwIDAtN2MuNy0yLjkgMi0zLjQgNC0xLjUtMS4zIDMtMi4zIDYuMi0zIDkuNS0uNi0uMS0xLS41LTEtMVoiLz5hCgk8cGF0aCBmaWxsPSIjZDhkOGQ4IiBkPSJNNjMuNSA4NC41aDdjMi4zIDYuNiAwIDkuMy03IDh2LThaIi8+YQoJPHBhdGggZmlsbD0iIzZiNmI2YiIgZD0iTTExNi41IDkwLjVjMC0uNS0uNC0uOS0xLTFsLTkgMmMtMS0yLjItMi41LTIuMi00LjUgMGE1IDUgMCAwIDEtLjUtM2M1LjIuNCAxMC4yLS4zIDE1LTIgMS4zIDEuNSAxLjMgMi44IDAgNFoiLz4KCTxwYXRoIGZpbGw9IiNlNGU0ZTQiIGQ9Ik00Ni41IDEwNC41Yy00LjktLjgtOS41LTIuMS0xNC00LS4zLTkuNSA0LTEzLjMgMTMtMTEuNS01LjUgMy42LTQuOCA1LjggMiA2LjUuMi0xLjMtLjItMi41LTEtMy41IDEtMS42IDIuMi0xLjggMy41LS41IDEuMyA1LjEuMiA5LjUtMy41IDEzWiIvPgoJPHBhdGggZmlsbD0iI2IyYTUyYyIgZD0iTTM0LjUgODEuNWMtOCAyLjMtMTIuMyA3LjYtMTMgMTYtMS4yLS44LTIuMi0xLjgtMy0zIDEuMi05LjUgNi41LTEzLjggMTYtMTNaIi8+Cgk8cGF0aCBmaWxsPSIjNTgyMzEyIiBkPSJNNzkuNSA4OC41YzIgMSAyLjQgMi42IDEgNC41LTQuNyAyLjYtOS43IDQtMTUgNC41di0zYTE1IDE1IDAgMCAwIDE0LTZaIi8+Cgk8cGF0aCBmaWxsPSIjMzIzMTUzIiBkPSJNOTYuNSA1NC41YzIuNyAwIDUuNC40IDggMWEyNTYgMjU2IDAgMCAxLTguNSAyMGMtNS42IDEzLjEtMS40IDE5LjggMTIuNSAyMCA1IDEgOC40LS42IDEwLjUtNSA1IDkuNSA2LjQgMTkuNSA0IDMwYTEzNi40IDEzNi40IDAgMCAwLTM0LjUtMjV2LTFoMWMyLjEtLjkgMy4zLTIuNSAzLjUtNSAxLTExLjcgMi4xLTIzLjQgMy41LTM1WiIvPgoJPHBhdGggZmlsbD0iI2Q1ZDVkNSIgZD0iTTExNi41IDkwLjVjLS4xLjYtLjQgMS4xLTEgMS41LTMuOC44LTYuOC42LTktLjVsOS0yYy42LjEgMSAuNSAxIDFaIi8+Cgk8cGF0aCBmaWxsPSIjNTYyMjEyIiBkPSJNNTIuNSA5MS41YzAtLjUuNC0uOSAxLTEgMyAzLjMgNi42IDQuNiAxMSA0djNjLTUuNy44LTkuNy0xLjItMTItNloiLz4KCTxwYXRoIGZpbGw9IiMxYjFiMmQiIGQ9Im0xNC41IDExMi41LTUuNS0xMWMtLjctLjgtMS41LTEtMi41LTEgLjctMS44IDEuNy0zLjUgMy01YTI1IDI1IDAgMCAwIDcuNSA3Yy44IDIuNCAyIDQuNiAzLjUgNi41LTIuMiAxLTQuMiAyLTYgMy41WiIvPgoJPHBhdGggZmlsbD0iI2I0YTgyYiIgZD0iTTM4LjUgODMuNWMxLjQuMiAyLjguNyA0IDEuNS01LjYgMS05LjUgNC4xLTExLjUgOS41YTYxIDYxIDAgMCAwLS41IDExYy0xLjEgMC0yLjEtLjQtMy0xLTEuOC0xMCAxLjktMTcgMTEtMjFaIi8+Cgk8cGF0aCBmaWxsPSIjNDYxYzBlIiBkPSJNODUuNSAxMDUuNWExMSAxMSAwIDAgMC02LTVsNS00YzYgMi4yIDYuMiA1LjIgMSA5WiIvPgoJPHBhdGggZmlsbD0iIzcyMmUxNyIgZD0iTTczLjUgOTcuNWMxLjQtLjIgMi43IDAgNCAuNWExOSAxOSAwIDAgMS0yMiAxLjVjNC44IDAgOS44LS4xIDE1LS41IDEuMi0uMiAyLjItLjcgMy0xLjVaIi8+Cgk8cGF0aCBmaWxsPSIjMzUzNDU3IiBkPSJNNi41IDEwMC41YzEgMCAxLjguMiAyLjUgMWw1LjUgMTFhNDMgNDMgMCAwIDAtMTEuNSAxM2MtMS4yLTguNyAwLTE3IDMuNS0yNVoiLz4KCTxwYXRoIGZpbGw9IiM3MTcxNzEiIGQ9Ik0zMi41IDEwMC41YzQuNSAxLjkgOS4xIDMuMiAxNCA0LTEuMSAyLjYtMy4xIDMuNS02IDIuNS0yLjMtLjgtNC42LTEuNS03LTJhNi41IDYuNSAwIDAgMS0xLTQuNVoiLz4KCTxwYXRoIGZpbGw9IiM4NTM1MWIiIGQ9Ik03OS41IDEwMC41YTExIDExIDAgMCAxIDYgNWMtMy44IDUtOC44IDctMTUgNi0xLTIuNC0yLjMtNC42LTQtNi41IDQuNC0xLjQgOC44LTIuOSAxMy00LjVaIi8+Cgk8cGF0aCBmaWxsPSIjNTY1MDE2IiBkPSJNMTguNSA5NC41Yy44IDEuMiAxLjggMi4yIDMgM3YyYy41IDIuNy43IDUuMy41IDgtMi45LTMuOC00LTguMS0zLjUtMTNaIi8+Cgk8cGF0aCBmaWxsPSIjNDIxYTBkIiBkPSJtNTQuNSAxMDIuNS02IDljLTEuNi0uNS0yLTEuNS0xLjUtMyAxLjctMS44IDMuMi0zLjggNC41LTYgMS4xLTEuMyAyLjEtMS4zIDMgMFoiLz4KCTxwYXRoIGZpbGw9IiM4MTM0MWEiIGQ9Im01NC41IDEwMi41IDguNSAyYy0uOCAyLjktMS40IDUuOS0yIDlhMTcgMTcgMCAwIDEtMTIuNS0ybDYtOVoiLz4KCTxwYXRoIGZpbGw9IiM1ZTU3MTYiIGQ9Ik0yNy41IDEwNC41Yy45LjYgMS45IDEgMyAxYTE3IDE3IDAgMCAwIDQgNmMtNC40LjMtNi43LTItNy03WiIvPgoJPHBhdGggZmlsbD0iIzI4MjgyOCIgZD0iTTQ5LjUgMTE5LjVjMyAuOCA2IDEuMSA5IDEtMS4yIDYuNi00LjYgMTItMTAgMTYtLjUtNC0uNS04IDAtMTIgMi4xLjcgNC4xLjcgNiAwLTEuMi0uOS0yLjYtMS41LTQtMmEzIDMgMCAwIDEtMS0zWiIvPgo8L3N2Zz4K","data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHNoYXBlLXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0ZXh0LXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiBpbWFnZS1yZW5kZXJpbmc9Im9wdGltaXplUXVhbGl0eSIgZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIHZpZXdCb3g9IjAgMCAyNDAgMjQwIj4KICAgIDxwYXRoIGZpbGw9IiMwNzA1MDMiIGQ9Ik02OSAxN2gyMGM0IDEgOCAyIDExIDUgMS0yIDItMiA0LTIgNCAxIDggMyAxMiA3bDMtMWM1IDUgMTAgMTEgMTQgMTggMiA2IDMgMTIgMiAxOSA4IDMgMTYgNyAyMyAxNGwyMC0zYzMtMSA1IDAgOCAzbC00IDFjNyAyIDEzIDUgMTggMTFsMTEgMjIgMSAxYzItMiA0LTMgNy0zIDExIDExIDE1IDI0IDEyIDQwbC0xNCAyM2MtMSA4IDAgMTYgMyAyNC0xIDExLTcgMTctMTcgMjBsLTktNiAzLTNjLTMgMC00LTItNC00IDEtMiAyLTIgMyAwbDEtNCA3LTdjLTEtNC00LTctNy04bC0xIDJjMCAyIDEgNSAzIDdsLTIgM2MtMi0yLTMtMi00IDAgMSA0LTEgNi02IDQtMSA2LTQgNy04IDMtMiAwLTQgMC01IDItNi01LTktMTAtOS0xN2wtNy0xNi0xNC0xMi01IDIyYy00IDEtOCAyLTExIDVsLTE1LTYtNS0yMmMtNC0yLTctMi05IDBsLTUgOGMtNCAwLTYgMi04IDUtMi0yLTMtMy0yLTVsLTggM2MwLTYtMS03LTUtNGwtMi0xLTEtNmMtMyAwLTMgMi0xIDV2MTRsLTMgMy0yLTZjLTQtMS02LTItOC01LTQtMS03IDAtOCA0LTMgNS0zIDEwIDAgMTZsLTUgNyAxIDRjLTQtMS02LTMtOC01LTMgMS0zIDQgMCA3aC00Yy00LTQtNy05LTktMTQtMSAzLTMgNS02IDctMiAyLTIgNS0yIDctMyAxLTUgMC02LTItMi0xMiAxLTIxIDExLTI3bDUtMTQtMi05LTktMjBjLTItMTQgMS0yNiAxMC0zNiA2IDEgMTIgMCAxOS0zIDItOSA2LTE2IDEzLTIyIDExLTUgMjQtNiAzNi0xbDExLTZ2LTJMODIgMzZsMi0yYy01LTUtOS0xMC0xNS0xNHYtM1pNNDggMTI0aDIzbDQgNGMtNyA1LTggMTEtMyAxOGwtNCA0LTQgOC0yLTItMTEtMWMtNS0yLTgtNS03LTEwbDQtMjFabTEzMCA4IDE1IDQtMSA5IDEgMjUtNyA0Yy0zLTItNC01LTQtNyAzLTcgNC0xMyAzLTIwLTItNi00LTExLTctMTVaIiBvcGFjaXR5PSIxIi8+CiAgICA8cGF0aCBmaWxsPSIjMTYxMDBhIiBkPSJtNzUgMjIgMS0xIDE3IDljMS0yIDAtMy0xLTQgNiAxIDEyIDMgMTcgN2wxMSA0IDggMTIgMSAxNC02IDEtNi0yLTExIDItMTItMTd2LTJoMmMtNi0xMC0xMy0xNy0yMS0yM1oiLz4KICAgIDxwYXRoIGZpbGw9IiMxMDBiMDciIGQ9Ik0yMDcgMTEwYy04IDItMTQgNi0xOSAxMWwtMiAxLTEtMWMzLTMgNi02IDExLThsLTE0LTEtOS0xMWMtNS0yLTEwLTMtMTQtMmwtMS05LTItMmMtNyAxLTEzIDQtMTggOC0zIDItNCA0LTQgN2wzLTJjLTUgNi04IDE0LTkgMjNsLTMgMWMtMi05LTYtMTYtMTMtMjItMS01LTQtOS04LTEwbC0zIDE3Yy0xIDMgMCA2IDIgOWwtMSAxLTQtNS0yIDJjLTIgNS0yIDExIDAgMTgtMiAwLTMgMC0zIDItMSAyLTEgNCAxIDYgNSAzIDkgNyAxMyAxMi05LTMtMTUtOC0yMS0xNGwtMTAtMTcgMTMgMTJjLTEtMy0yLTYtMS05aC00di0zYzMtMSA2LTMgOC02LTMtNC00LTctNC0xMGw0IDctMi0xNC00IDItOC0yLTcgNGMtMiAxLTMgMy0yIDVsLTQtMi0xIDJjLTQtNC03LTUtMTEtNWwtOC05YzItNiA2LTEyIDExLTE2bC0zLTFjOS0zIDgtNC0xLTMgMC0xIDEtMiAzLTIgOS0zIDE5LTIgMjggNGwxNS05djNjNS00IDExLTYgMTctN2wtNSA0IDEzLTJjMi0xIDMgMCA1IDJsNC0xYzE1IDUgMjggMTMgMzkgMjRsLTEtNWMxMC0zIDE5LTEgMjggNWwtNCAxIDkgNy00IDFjMyAyIDYgNSA4IDlaIi8+CiAgICA8cGF0aCBmaWxsPSIjMjgxZjE2IiBkPSJNMTM3IDEwMWMwLTIgMS0zIDMtNGw3LTNjMiA4IDIgMTYgMCAyNCA1IDAgOCAzIDggMTBsLTIgMSAxIDQgMS0zLTMgMTJjLTQgMi03IDUtOSA5bDEtOGMyLTUgNC05IDQtMTRsLTEtMWMtNCAyLTYgNS04IDgtNSAyLTkgMi0xMyAyLTEgMi0yIDItMyAwbC0xLTNoLTJjLTQtNi05LTktMTUtOWw4IDVjLTEgMS0yIDMtMSA1IDEtNCAyLTQgNC0xLTIgMC0zIDItMSAzLTQgMi02IDQtNiA5djZsLTEzLTE4Yy0yLTctMi0xMyAwLTE4bDItMiA0IDUgMS0xYy0yLTMtMy02LTItOWwzLTE3YzQgMSA3IDUgOCAxMCA3IDYgMTEgMTMgMTMgMjJsMy0xYzEtOSA0LTE3IDktMjNaIi8+CiAgICA8cGF0aCBmaWxsPSIjMjkyMDE3IiBkPSJNNDUgOTZhNDIxNyA0MjE3IDAgMCAxIDExIDExYy05LTItMTUgMC0yMCA3IDMgMiA2IDMgMTEgM2gxM2wyLTItMy02IDEyIDEyYy05IDEtMTcgMC0yNS0xLTUtMS02IDEtNiA1IDEtMiAzLTMgNS0ybC00IDIwYzAgMTIgNyAxOCAyMCAxNmwzIDhjLTMgMC01IDEtNSA0LTYtNy0xMS03LTE2IDEtMyA0LTMgMTAtMSAxNWwtMiA3Yy0xLTQtMy02LTYtNC0zLTUtMy05IDAtMTJ2LThjLTMgMS0zIDMtMSA1LTQgNS00IDEwLTEgMTZsLTEgMmMtNS0xLTctNC03LThsNC0xMWMtMi0yLTItMyAwLTVoLTNsLTEgOC03IDE0LTMgMmMtNC00LTQtOC0xLTExbDctNmMxLTYgMy0xMSA2LTE1di0xMGwtNi0yMGMyLTMgMi02IDEtOCAxLTggMy0xNiA2LTIzbDE0LTUgMyAyIDEtMVoiLz4KICAgIDxwYXRoIGZpbGw9IiMyYTIxMTgiIGQ9Ik0xNTkgOTljNC0xIDkgMCAxNCAybDkgMTEgMTQgMWMtNSAyLTggNS0xMSA4LTIgMC00IDEtNSAzbC0yMiAyNC01IDIgNi01IDEtMTAgNCAxYzAtNi0yLTEyLTUtMTZsOS0xMy0xLTEtMTAgMTItMS0yIDMtMTdaIi8+CiAgICA8cGF0aCBmaWxsPSIjMjkxZjE1IiBkPSJtODQgMTI0LTE3LTExLTMtMyAxLTIgNCAyYy0xLTIgMC00IDItNWw3LTQgOCAyIDQtMiAyIDE0LTQtN2MwIDMgMSA2IDQgMTAtMiAzLTUgNS04IDZaIi8+CiAgICA8cGF0aCBmaWxsPSIjNDUzZDM0IiBkPSJtNTYgMTA3IDMgMiAzIDYtMiAySDQ3Yy01IDAtOC0xLTExLTMgNS03IDExLTkgMjAtN1oiLz4KICAgIDxwYXRoIGZpbGw9IiMyOTFmMTUiIGQ9Ik0yMDcgMTEwYzEgNSA0IDkgOSAxM2w2IDE0Yy0yIDEyLTUgMjMtOSAzNGwyIDIzYy0xLTItMi0yLTIgMSAwIDIgMSA1IDMgNy0yIDUtNSA3LTkgNyAyLTcgMi0xNCAwLTIxLTgtOS0xNS05LTIxIDJsLTMgMS0yLTggMi00YzQtMyA4LTUgMTMtNmwzLThhNDg1IDQ4NSAwIDAgMSA2LTMyYzEtMiAwLTMtMi0yLTItNS01LTgtOS0xMGgtNmM1LTUgMTEtOSAxOS0xMVoiLz4KICAgIDxwYXRoIGZpbGw9IiM0MzNiMzIiIGQ9Im02NyAxMTMgMTcgMTF2M2g0Yy0xIDMgMCA2IDEgOWwtMTMtMTItOS0xMVoiLz4KICAgIDxwYXRoIGZpbGw9IiM0NDNjMzMiIGQ9Ik0xODggMTIxaDZjNCAyIDcgNSA5IDEwLTggMC0xNC0yLTE5LTYgMC0yIDEtMyAyLTNsMi0xWiIvPgogICAgPHBhdGggZmlsbD0iIzI5MjAxNyIgZD0iTTc2IDEzMmM2IDggMTQgMTYgMjQgMjMtMTAgMy0xNyAwLTI0LTZhNjY3OCA2Njc4IDAgMCAwLTItMTRsMi0zWiIvPgogICAgPHBhdGggZmlsbD0iIzJlYjkwMCIgZD0iTTExNSAxMzNjMy0xIDMgMCAxIDJsLTEtMlpNMTM3IDEzM2MzLTEgMyAwIDEgMmwtMS0yWiIvPgogICAgPHBhdGggZmlsbD0iIzQ0M2MzNCIgZD0iTTE0NCAxNDNjLTQtNS05LTYtMTMtMS0xIDEtMiAzLTEgNSAxLTUgNC03IDktNiAzIDIgMyA1IDEgOC0yLTEtNC0yLTUtMS0zIDItNSA1LTYgOWgybDQtN2MxLTEgMy0xIDQgMSAxIDYgMCAxMi0yIDE4LTMtMS01IDAtOCAybC0yLTFjMS0zIDMtNSA2LTZsMS0zLTE0LTFjLTIgMS0zIDItMiA1IDYgMyA1IDUgMCA0LTIgMi00IDItNSAwLTItNi0yLTEyIDAtMTggMS0yIDItMiA0LTFsNCA3aDNsLTctOWMtMi0xLTQgMC01IDEtMi02IDAtOCA2LTggMiAyIDQgNCA1IDggMC00LTItOC00LTEwIDEtMSAyLTIgNC0xIDEgMiAyIDIgMyAwIDQgMCA4IDAgMTMtMiAyLTMgNC02IDgtOGwxIDFjMCA1LTIgOS00IDE0WiIvPgogICAgPHBhdGggZmlsbD0iIzJhMjExNyIgZD0ibTE3NiAxMzcgNiA5LTIgMnYxNWwtNCA1LTUtMS0zIDJjLTgtMi0xNS02LTIxLTExbDktNSAyIDRjOC01IDE0LTEyIDE4LTIwWiIvPgogICAgPHBhdGggZmlsbD0iIzQzM2IzMiIgZD0ibTIwNSAxMzMgMSAyYTQ4NSA0ODUgMCAwIDAtMTAgMzhsMS0yM2MxLTcgNC0xMiA4LTE3WiIvPgogICAgPHBhdGggZmlsbD0iI2NhYjY5ZCIgZD0ibTExOCAxNzIgMSA0Yy0xLTItMi0zLTEtNFoiLz4KICAgIDxwYXRoIGZpbGw9IiM5ZjhmN2IiIGQ9Ik0xMjIgMTczaDdjLTYgMS02IDEgMCAybC03IDF2LTNaIi8+CiAgICA8cGF0aCBmaWxsPSIjOGQ4MDZlIiBkPSJNMTM0IDE3MmgzYzEgMiAwIDUtMSA4bC0xLTVoLTNjMC0yIDEtMyAyLTNaIi8+CiAgICA8cGF0aCBmaWxsPSIjZTBjYmFlIiBkPSJNMTE0IDE3M2MxIDEgMiAzIDEgNmwtMS02WiIvPgogICAgPHBhdGggZmlsbD0iIzI4MWUxNSIgZD0ibTE4MSAxNzQgMSAxYy00IDYtNiAxMy03IDIwbC0yLTMtNS0xNSAxMS0yIDItMVoiLz4KPC9zdmc+Cgo=","data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHNoYXBlLXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0ZXh0LXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiBpbWFnZS1yZW5kZXJpbmc9Im9wdGltaXplUXVhbGl0eSIgZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIHZpZXdCb3g9IjAgMCAyNDAgMjQwIj4KICAgIDxwYXRoIGZpbGw9IiMwNTA0MDciIGQ9Im0xMzggNTQtMTAtNi0zLTEydi05bC0xLTFjLTEtMi0zLTMtNC0ybC0xMiA4LTIgNi04IDkgMiA1Yy00IDctNiAxNS01IDI0LTEgNSAwIDExIDIgMTZsNCAzLTcgMS00LTYtMi0xOS0xOCAxN2EzOTYgMzk2IDAgMCAwIDQgMjNsLTItMS0xLTFjLTEgMS0yIDItMSA0IDAgNCAyIDggNCAxM2w1IDcgMSAxLTkgMi0xIDFjLTMgMC0zIDItMiA0LTItMS0zIDAtNCAxdjNhMTA0OSAxMDQ5IDAgMCAxIDI4IDE5bDEtNCAxIDhoLTNsLTItMWMtMiAyLTIgNC0xIDdsMTAgMTctNi0yYy0yIDEtMiAzIDAgNWwtMiAxYy0yIDAtMyAwLTQgMmwtMSAxLTMgNGMtMi0yLTMtMy0yLTVsOC0xMS02LTljLTE0LTQtMjAtMTItMTktMjYtMy0yLTQtNS01LTh2LTJsOS0xMC0zLTE5YzAtMyAxLTYgMy04bC0zLTE1YzYtMTIgMTQtMjEgMjUtMjcgNC02IDUtMTIgMy0xOCAyLTQgNS02IDgtNy0xLTYgMS05IDYtMTJsMTUtNWM1IDAgOCAzIDEwIDhsMSAxNCA2IDEyWiIvPgogICAgPHBhdGggZmlsbD0iIzVmNWFhNiIgZD0iTTEwOCAzMmMxLTEgMiAwIDMgMS00IDEwLTcgMjAtNyAzMSA1IDQgOSA4IDEyIDE0bC0xIDFjNCAyIDUgNCA1IDlsNCA5LTctNXY0Yy03LTMtMTQtNS0yMC00LTItNS0zLTExLTItMTYtMS05IDEtMTcgNS0yNGwtMi01IDgtOSAyLTZaIi8+CiAgICA8cGF0aCBmaWxsPSIjMGYwZDBmIiBkPSJNMTEwIDQ1YzUtMSA3IDEgNSA3bC0zIDFjLTMtMy00LTUtMi04WiIvPgogICAgPHBhdGggZmlsbD0iI2FiYTM0YiIgZD0iTTExMSA0N2gzYy0xIDMtMiAzLTMgMFoiLz4KICAgIDxwYXRoIGZpbGw9IiM0ODNkNzYiIGQ9Im0xMjQgMjYgMSAxdjlsMyAxMmMzIDEwIDkgMjAgMTcgMzB2MTBsLTYgOC0zIDJ2LTRsLTktM2M1IDAgNi0zIDQtN2gtM2w0LTJjLTEtMi0yLTQtMS01LTQtMi03LTQtOS03bC00LTFjNiAwIDctMiAzLTctMiAwLTQgMC00IDJsLTItOC0zLTMgMy0xYzItNiAwLTgtNS03bDYtMiA5LTE0LTEtM1oiLz4KICAgIDxwYXRoIGZpbGw9IiMwYTA4MGQiIGQ9Ik0xMjggNDhhNTA4MyA1MDgzIDAgMCAxIDEzIDEwYzEzIDYgMjIgMTYgMjYgMzFsLTEgNyAzIDExLTIgMjAgMTQgMTYtNyA5YzEgMTQtNSAyMi0xOSAyNWwtNSA5IDggMTQtNCAzYzAtMy0xLTQtMi01bC0zLTMtNyA0aC00bDktOC0yLTJjLTIgMC0zIDItNCAzaC0ybDktMTdjMi04IDAtOS02LTRsLTIgMTB2LTloLTNsLTEgNy05IDE2djRsLTIgMWMwLTggMy0xNSA4LTIwbDItNmgtMTBsLTQgNC0yIDEtNS0yLTItMy05LTEgMS0yLTYtNGMxLTIgMi0yIDMgMCAzLTIgMy0zIDEtM2wtNiAyIDEtOSAyLTFoNHY0aC01bDQgMmEzNjE5IDM2MTkgMCAwIDAgMTEtM2wtNyA3IDExIDhjMiAxIDQgMCA1LTJsMi02aDN2M2w1LTQtNy01Yy0xLTEtMS0yIDEtMiAzIDMgOCA0IDE0IDRsLTEtMTBjLTEtNSAxLTggNy05IDMgNSA0IDQgMy0zIDMtNSA1LTExIDMtMTctMS0yLTItMy0xLTRoLTNsLTMgMi00LTF2M2wtNCAyIDcgMi04IDVjMiAyIDIgNCAwIDZsLTUgMS0yLTFjLTItMy0zLTUtMy04bC05LTEtMS0yIDEwLTJhMTA5IDEwOSAwIDAgMCAyOC0xNWM0LTYgNi0xMiA2LTIwbC0yLTE0LTE0LTktMSAxIDYgMTRjMCA3LTIgMTMtNyAxOXYtM2wtMTIgNmgtMTFjLTUtMi01LTMgMC0zIDUgMSAxMSAwIDE3LTNsMy0yIDYtOFY3OGMtOC0xMC0xNC0yMC0xNy0zMFoiLz4KICAgIDxwYXRoIGZpbGw9IiM1NjRmOTQiIGQ9Im0xMjQgMjYgMSAzLTkgMTQtNiAyYy0yIDMtMSA1IDIgOGwzIDMgMiA4Yy0xIDEgMCAzIDEgNWw0IDFjMiAzIDUgNSA5IDctMSAxIDAgMyAxIDVsLTQgMmMtMyAwLTQgMS0zIDMtMSAyIDAgMyAyIDRsOSAzdjRjLTYgMy0xMiA0LTE3IDNsNS0xdi0zbC00LTljMC01LTEtNy01LTlsMS0xYy0zLTYtNy0xMC0xMi0xNCAwLTExIDMtMjEgNy0zMS0xLTEtMi0yLTMtMWwxMi04YzEtMSAzIDAgNCAyWiIvPgogICAgPHBhdGggZmlsbD0iIzE4MTUxNyIgZD0iTTExOCA2OWMtMS0yLTItNC0xLTUgMC0yIDItMiA0LTIgNCA1IDMgNy0zIDdaIi8+CiAgICA8cGF0aCBmaWxsPSIjMTYxMzE4IiBkPSJNMTI5IDcyaDR2NGMtMyAwLTUtMS00LTRaIi8+CiAgICA8cGF0aCBmaWxsPSIjMTcxNTFkIiBkPSJNMTA4IDc2YzcgNSA2IDctMiA3LTEtMyAwLTYgMi03WiIvPgogICAgPHBhdGggZmlsbD0iIzkzOGYzYyIgZD0iTTEwOCA3OWMxLTEgMiAwIDMgMi0yIDEtMyAwLTMtMloiLz4KICAgIDxwYXRoIGZpbGw9IiMxMjEwMTMiIGQ9Ik0xMjggODRoM2MyIDQgMSA3LTQgNy0yLTEtMy0yLTItNC0xLTIgMC0zIDMtM1oiLz4KICAgIDxwYXRoIGZpbGw9IiM5Yzk1NDYiIGQ9Ik0xMjcgODZoNHYzaC00di0zWiIvPgogICAgPHBhdGggZmlsbD0iIzQ1M2I3MSIgZD0iTTE0NCAxMTdjMC0xMC01LTE1LTE0LTEzbDEyLTZ2M2M1LTYgNy0xMiA3LTE5bC02LTE0IDEtMSAxNCA5IDIgMTRjMCA4LTIgMTQtNiAyMGwtMTAgN1oiLz4KICAgIDxwYXRoIGZpbGw9IiMyMDFjMjkiIGQ9Ik0xNTMgODVjNC0xIDYgMiA0IDZoLTR2LTZaIi8+CiAgICA8cGF0aCBmaWxsPSIjNmU2NzNlIiBkPSJNMTU0IDg2YzMgMCAzIDEgMSA0LTEtMi0yLTMtMS00WiIvPgogICAgPHBhdGggZmlsbD0iIzY0NjBhOSIgZD0ibTk0IDk2IDEwIDQtMi0yaDRhNzE1IDcxNSAwIDAgMS05LTZjNi0xIDEzIDEgMjAgNHYtNGw3IDV2M2wtNSAxYy01IDAtNSAxIDAgM2gxMWM5LTIgMTQgMyAxNCAxM2wtMTggOGgtMTFjLTEtMyAwLTYgMS04LTEgMyAwIDUgNCA0IDItMiAyLTQgMC02bDItMWMtOC0xMS0xNy0xNC0yOS05bC0zIDQtMS0zYy0yLTEtNC0yLTUtMS0xIDIgMCA0IDMgNWwtMyA1IDIgMmMtNi0xLTktNC0xMS04bC01LTIxIDE4LTE3IDIgMTkgNCA2WiIvPgogICAgPHBhdGggZmlsbD0iIzJiMmE0OCIgZD0ibTEwMSA5NSA1IDNoLTRsMiAyLTEwLTQgNy0xWiIvPgogICAgPHBhdGggZmlsbD0iIzFiMTkyMSIgZD0iTTgyIDg4YzEtMiAyLTIgMyAwIDIgNSAwIDYtNSA1LTEtMyAwLTQgMi01WiIvPgogICAgPHBhdGggZmlsbD0iIzk4OTUzZSIgZD0iTTgyIDg4YzIgMCAzIDEgMyA0aC0zdi00WiIvPgogICAgPHBhdGggZmlsbD0iIzZkNmNiMiIgZD0iTTEyMCAxMTVjLTIgMC0yIDAtMiAyaC0yYy0xIDItMiA1LTEgOC0xMS0yLTIwLTQtMjktOGwtMi0yIDMtNSAzLTEgMy00YzEyLTUgMjEtMiAyOSA5bC0yIDFaIi8+CiAgICA8cGF0aCBmaWxsPSIjMWYxYjFkIiBkPSJNMTQ1IDEwMmg1YzAgMy0yIDUtNSA0di00WiIvPgogICAgPHBhdGggZmlsbD0iIzMwMmUzMiIgZD0ibTg5IDEwNiAxIDMtMyAxYy0zLTEtNC0zLTMtNSAxLTEgMyAwIDUgMVoiLz4KICAgIDxwYXRoIGZpbGw9IiNhZmFkNTMiIGQ9Ik04OSAxMDZjLTEgMS0xIDItMiAxIDAtMSAxLTIgMi0xWiIvPgogICAgPHBhdGggZmlsbD0iI2UxZGY2ZiIgZD0iTTEwNCAxMDZjMS0xIDIgMCAzIDF2M2gtM3YtNFoiLz4KICAgIDxwYXRoIGZpbGw9IiMyNDIzMmUiIGQ9Ik0xMDQgMTA2djRoM3YtM2MyIDEgMiAyIDAgNC00IDEtNiAwLTYtMyAwLTIgMS0zIDMtMloiLz4KICAgIDxwYXRoIGZpbGw9IiMxODE3MTciIGQ9Ik0xMjggMTEwaDRjLTIgNi00IDYtNCAwWiIvPgogICAgPHBhdGggZmlsbD0iIzRkM2Q1MSIgZD0ibTcyIDExMCAxIDUtMSAxLTItM2MtMS0yIDAtMyAxLTRsMSAxWiIvPgogICAgPHBhdGggZmlsbD0iIzUzNDU1NiIgZD0ibTc5IDEzMy01LTdjLTEtNCAwLTcgMy04bDEgMXY3Yy0xIDIgMCA0IDIgNmwtMSAxWiIvPgogICAgPHBhdGggZmlsbD0iIzEyMTIxNSIgZD0iTTEyMCAxMTVjMiAyIDIgNCAwIDYtNCAxLTUtMS00LTRoMmMwLTIgMC0yIDItMloiLz4KICAgIDxwYXRoIGZpbGw9IiNkZWRjNjciIGQ9Ik0xMTggMTE3YzEgMCAyIDEgMSAzLTMtMS0zLTItMS0zWiIvPgogICAgPHBhdGggZmlsbD0iIzRhM2I0ZSIgZD0iTTE2MCAxMDhjMyAwIDQgMiA0IDVsLTMgMTRjLTQgNC01IDMtMi0xIDItNiAyLTEwLTEtMTVsMi0zWiIvPgogICAgPHBhdGggZmlsbD0iIzg1NzY3OCIgZD0iTTEzNCAxNDhjMC0yIDEtMyAyLTNsMS01LTYtMSA1LTFjMi0yIDItNCAwLTZsOC01YzEtMiAyLTIgMyAwbC02IDExYzAgNS0yIDgtNyAxMFoiLz4KICAgIDxwYXRoIGZpbGw9IiM1MTQwNTUiIGQ9Ik0xNDggMTE5aDNjLTEgMSAwIDIgMSA0IDIgNiAwIDEyLTMgMTcgMSA3IDAgOC0zIDNsLTItM2M3LTYgOC0xMyA0LTIxWiIvPgogICAgPHBhdGggZmlsbD0iI2RmZDhjMiIgZD0ibTk2IDEyOSA3IDNjLTMgMi0zIDQtMSA2aDdsMS0zYTI1NSAyNTUgMCAwIDEgMTcgM2wtMyA2Yy0zIDItNiAyLTkgMS0xLTEtMi0yLTMtMXMwIDMgMSA1bC00IDFjLTUtMS05LTQtMTItN2wxLTRjLTItMy00LTYtNC05IDAtMSAxLTIgMi0xWiIvPgogICAgPHBhdGggZmlsbD0iIzg1Nzg3YiIgZD0ibTExNyAxMjkgOSAxYzAgMyAxIDUgMyA4LTItMS00LTItNS0xbC0xNC0yLTEgM3YtNGM0IDAgNS0yIDItNWg2WiIvPgogICAgPHBhdGggZmlsbD0iIzhhN2U3ZiIgZD0iTTk2IDEyOWMtMS0xLTIgMC0yIDEgMCAzIDIgNiA0IDlsLTEgNC0yLTEtMS02Yy0zLTMtNC03LTItMTBsNCAzWiIvPgogICAgPHBhdGggZmlsbD0iIzQ5Mzg2ZCIgZD0ibTE2MSAxMzIgMTAgOC0xOSAxNS0xLTFjMy01IDMtOSAxLTE0IDItNCA1LTcgOS04WiIvPgogICAgPHBhdGggZmlsbD0iIzQ3Mzg2OCIgZD0ibTcwIDEzNyAxLTFjMy0xIDYgMCA5IDEtMiAyLTMgNS0yIDgtMi0zLTMtNS0yLTdsLTYtMVoiLz4KICAgIDxwYXRoIGZpbGw9IiM2NDU2OWIiIGQ9Im03MCAxMzcgNiAxYy0xIDIgMCA0IDIgNyAxIDIgMyA0IDcgNWw0IDF2M2gtM2wtMTgtMTNjLTEtMi0xLTQgMi00WiIvPgogICAgPHBhdGggZmlsbD0iI2FiOWY5NyIgZD0iTTEyNCAxMzdjMS0xIDMgMCA1IDFsMiAxIDYgMS0xIDVjLTEgMC0yIDEtMiAzLTkgNS0xNyA2LTI1IDJsNC0xYy0xLTItMi00LTEtNXMyIDAgMyAxYy0zIDAtMyAxLTEgM2g5YzMtMSAzLTMgMS00bDMtNi0zLTFaIi8+CiAgICA8cGF0aCBmaWxsPSIjZDFjYjUyIiBkPSJtNjQgMTQyIDIzIDE1djNjLTktNC0xNi05LTIzLTE1di0zWiIvPgogICAgPHBhdGggZmlsbD0iIzFmMWIxZSIgZD0iTTE0OCAxMTljNCA4IDMgMTUtNCAyMWwyIDNjLTYgMS04IDQtNyA5LTUgMC02IDEtMiAzIDEgMyAwIDQtMyAzLTEtMS0yLTItMS0zLTEyIDItMjMgMS0zNC0zIDAtMiAwLTMgMi0zbC02LTcgMiAxYzMgMyA3IDYgMTIgNyA4IDQgMTYgMyAyNS0yIDUtMiA3LTUgNy0xMGw2LTExYy0xLTItMi0yLTMgMGwtNy0yIDQtMnYtM2w0IDEgMy0yWiIvPgogICAgPHBhdGggZmlsbD0iIzI0MjIyMSIgZD0iTTEyNCAxNDRjMiAxIDIgMy0xIDRoLTljLTItMi0yLTMgMS0zIDMgMSA2IDEgOS0xWiIvPgogICAgPHBhdGggZmlsbD0iIzdlNzM0MyIgZD0iTTE3MyAxNDJjMSAwIDIgMSAxIDNsLTI5IDE5Yy0xLTIgMC00IDEtNSAxMC00IDE5LTEwIDI3LTE3WiIvPgogICAgPHBhdGggZmlsbD0iIzYyNTg2MCIgZD0iTTE2NyAxNTVjMCAzIDAgNi0yIDlsLTkgN2MtMi0zLTItNi0yLThsMTMtOFoiLz4KICAgIDxwYXRoIGZpbGw9IiM4Mjc3NDciIGQ9Im04NyAxNTcgNiAzLTEgNC01LTR2LTNaIi8+CiAgICA8cGF0aCBmaWxsPSIjNDEzNzY3IiBkPSJNOTkgMTUyYzExIDQgMjIgNSAzNCAzLTEgMSAwIDIgMSAzIDMgMSA0IDAgMy0zLTQtMi0zLTMgMi0zbDEgMTBjLTYgMC0xMS0xLTE0LTQtMiAwLTIgMS0xIDJsNyA1LTUgNHYtM2gtM2wtMy00LTEtNGMtMS0yLTItMi0yIDAtMi0yLTQtMS01IDFsLTItMS05IDQtNC0yaDV2LTRoLTR2LTRaIi8+CiAgICA8cGF0aCBmaWxsPSIjMWIxODIwIiBkPSJNMTIxIDE2MmMtNCAwLTUtMi0zLTQgMC0yIDEtMiAyIDBsMSA0WiIvPgogICAgPHBhdGggZmlsbD0iIzZkNjU2NyIgZD0ibTcwIDE1NSAxMyA4LTEgOGMtOC0zLTEyLTktMTItMTZaIi8+CiAgICA8cGF0aCBmaWxsPSIjNTg1Mzk5IiBkPSJNMTE4IDE1OGMtMiAyLTEgNCAzIDRsMyA0LTIgNmMtMSAyLTMgMy01IDJsLTExLTggNy03YzEtMiAzLTMgNS0xWiIvPgogICAgPHBhdGggZmlsbD0iIzE4MTcyMSIgZD0iTTExNCAxNjJjMyAwIDQgMiAzIDVsLTUgMWMtMS0zIDAtNSAyLTZaIi8+CiAgICA8cGF0aCBmaWxsPSIjOTQ4ZjY1IiBkPSJNMTE0IDE2NGMxIDAgMiAwIDEgMmwtMS0yWiIvPgogICAgPHBhdGggZmlsbD0iIzQ2MzY2OSIgZD0ibTEzOCAxOTktNyAxdi00bDktMTUgMi0xMGM2LTUgOC00IDYgNGwtOSAxN2gyYzEtMSAyLTMgNC0zbDIgMi05IDhaIi8+CiAgICA8cGF0aCBmaWxsPSIjNWY0Zjk2IiBkPSJtOTEgMTY4IDMgMmMyIDkgNiAxOCAxMiAyNmwxIDQtNi0xLTktNWMtMi0yLTItNCAwLTVsNiAyLTEwLTE3Yy0xLTMtMS01IDEtN2wyIDFaIi8+CiAgICA8cGF0aCBmaWxsPSIjNDUzNjY5IiBkPSJtMTAzIDE3MyA5IDEgMiAzaC0xMGMtMS0yLTItMy0xLTRaIi8+CiAgICA8cGF0aCBmaWxsPSIjNTY0NTg0IiBkPSJNMTI1IDIwMGgtMTN2LTRsMSAzIDUtMWMzLTcgNi0xMyA3LTIwaC00bDQtNGgxMGwtMiA2Yy01IDUtOCAxMi04IDIwWiIvPgogICAgPHBhdGggZmlsbD0iIzEwMGUxMCIgZD0iTTc1IDEwOWMyIDQgNSA3IDExIDggOSA0IDE4IDYgMjkgOGgxMWwtMTAgMiAxIDJoLTZjMyAzIDIgNS0yIDV2NGgtN2MtMi0yLTItNCAxLTZsLTctMy00LTNjLTIgMy0xIDcgMiAxMGwxIDYgNiA3Yy0yIDAtMiAxLTIgM3Y0bC0yIDEtMSA5IDYtMmMyIDAgMiAxLTEgMy0xLTItMi0yLTMgMGw2IDQtMSAyYy0xIDEgMCAyIDEgNGExMDQ4MDYgMTA0ODA2IDAgMCAwIDggMTl2NGgxM2wyLTEgMSAxIDItOCAxMC0xNnY1bC05IDE1djRsNy0xaDRjLTIgMC00IDEtNSAzbDIgMiA4LTEgMS0zIDQgMXYtM2MxIDEgMiAyIDIgNWwtMyAzYy00IDAtOCAxLTExIDNsLTctNGgtMzBsLTcgNGMtNi0xLTExLTMtMTQtN2wzLTRjMCAyIDEgMyA0IDJsMSA0YzMtMiA2LTIgOSAwdi0zbC05LTYgMi0xIDkgNSA2IDEtMS00Yy02LTgtMTAtMTctMTItMjZsLTMtMmgzbC0xLTgtNi0zLTIzLTE1YzEtMSAyLTIgNC0xbDE4IDEzYzcgNiAxMCA0IDktNmwtNS00LTIgMXY1aC0zYy00LTEtNi0zLTctNS0xLTMgMC02IDItOC0zLTEtNi0yLTktMWw5LTItMS0xIDEtMWMtMi0yLTMtNC0yLTZ2LTdsLTEtMWMtMyAxLTQgNC0zIDgtMi01LTQtOS00LTEzbDIgMyAxLTEtMS01IDIgMSAxLTJaIi8+CiAgICA8cGF0aCBmaWxsPSIjNjc1NmExIiBkPSJNMTA0IDE3N2gxMGw1IDIgMi0xaDRjLTEgNy00IDEzLTcgMjBsLTUgMS0xLTMtMS00LTctMTVaIi8+CiAgICA8cGF0aCBmaWxsPSIjNzg2ZTNkIiBkPSJNMTAxIDE3NmMtMi0yLTMtMi0yIDEtMS0yLTItNC0xLTVoM3Y0WiIvPgogICAgPHBhdGggZmlsbD0iIzRiM2I2ZSIgZD0iTTg2IDE1NGgzdi0zbC00LTFoM3YtNWwyLTEgNSA0YzEgMTAtMiAxMi05IDZaIi8+CiAgICA8cGF0aCBmaWxsPSIjNmM1ZDZkIiBkPSJNODMgMTIyYzIgMCA0IDAgNiAyLTQgNS0zIDEwIDMgMTQtNCAxLTcgMy05IDctMi0xLTItMi0yLTNsNS03LTQtMTAgMS0zWiIvPgogICAgPHBhdGggZmlsbD0iIzZkNjQzYSIgZD0ibTE0MCAxNzYtMTAgMTYtMiA4LTEtMXYtNGw5LTE2IDEtN2gzdjRaIi8+CiAgICA8cGF0aCBmaWxsPSIjYjhiNDQ2IiBkPSJNMTAxIDE3NmMxIDYgNCAxMSA4IDE3djdsLTMtOWMtMy01LTYtOS03LTE0LTEtMyAwLTMgMi0xWiIvPgogICAgPHBhdGggZmlsbD0iIzg1Nzc3OCIgZD0ibTkwIDE5NSA5IDZ2M2wtNC00LTktM2MxLTIgMi0yIDQtMloiLz4KICAgIDxwYXRoIGZpbGw9IiM4MjcyNzUiIGQ9Ik0xNTIgMTk4djNsLTQtMS0xIDMtOCAxLTItMmMxLTIgMy0zIDUtM2w3LTQgMyAzWiIvPgogICAgPHBhdGggZmlsbD0iI2JiYjFhMSIgZD0ibTg2IDE5NyA5IDMgNCA0Yy0zLTItNi0yLTkgMGwtMS00Yy0zIDEtNCAwLTQtMmwxLTFaIi8+Cjwvc3ZnPgo=","data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHNoYXBlLXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0ZXh0LXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiBpbWFnZS1yZW5kZXJpbmc9Im9wdGltaXplUXVhbGl0eSIgZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIHZpZXdCb3g9IjAgMCAyMTIgMjI2Ij4KICAgIDxwYXRoIGZpbGw9IiMwMzAzMDMiIGQ9Im0xMTUgMjktMSAxLTUgNC0xMSAyLTctMy03IDYtMjcgMTAtNy00LTEyIDIxLTkgNS0xNi05Yy00LTEwLTItMTggNy0yNSA0LTMgOS02IDE1LTdsNiAyYzAtNiAxLTExIDMtMTYgMy00IDctNyAxMi04IDYtMSAxMy0zIDIwLTNsOSAyIDUgOGMyLTMgNC00IDctNSA1LTEgMTAtMSAxNiAxIDMgNSAzIDExIDIgMThaIi8+CiAgICA8cGF0aCBmaWxsPSIjNzQ3NDc0IiBkPSJNODQgMTZjLTQtMy03LTQtMTEtNC04IDAtMTUgMi0yMSA4LTIgNC0zIDktMyAxNGwtMS0xYy0xLTYgMC0xMSAxLTE1IDUtNSAxMC03IDE3LThoMTVsMyA2WiIvPgogICAgPHBhdGggZmlsbD0iIzc2NzY3NiIgZD0ibTEwOSAxNi02IDItMyAzYy0yLTItNC0zLTYtMiAxLTUgNC02IDktNSAyIDAgNCAwIDYgMloiLz4KICAgIDxwYXRoIGZpbGw9IiMwNjA1MDUiIGQ9Im0xNTYgNjMtMS0xLTgtNi0zLTYtMSAxLTE1LTNjLTUtMi05LTUtMTAtMTBsLTQtOCAxLTEgMTEtMTBjNi01IDEyLTUgMTkgMGwxMCAxMSAxIDVjNC0yIDgtMiAxMy0yIDEgNSA0IDkgOCAxMmwxIDVjLTUgNi0xMCAxMS0xNyAxNGwtNS0xWiIvPgogICAgPHBhdGggZmlsbD0iIzUxNTE1MSIgZD0ibTg0IDE2IDQgOC01IDExLTItMTNjLTQgMy03IDMtMTEgMWwtNiA1YzIgMSAyIDIgMCA0bC00LTJjLTEtMTItMy0xMi01IDBsNiA3Yy0yIDUtNCA2LTcgMnYxbC02LTcgMSAxYzAtNSAxLTEwIDMtMTQgNi02IDEzLTggMjEtOCA0IDAgNyAxIDExIDRaIi8+CiAgICA8cGF0aCBmaWxsPSIjNTQ1NDU0IiBkPSJNMTA5IDE2YzQgMTAgMCAxNS0xMSAxNi01LTQtNi04LTQtMTMgMi0xIDQgMCA2IDJsMy0zIDYtMloiLz4KICAgIDxwYXRoIGZpbGw9IiM5NDk0OTQiIGQ9Im0xNDQgMjctMSAxLTQtM2MtMy0yLTUtMi03LTFsLTkgNmgtMmMzLTUgOC04IDE0LTkgNCAwIDcgMiA5IDZaIi8+CiAgICA8cGF0aCBmaWxsPSIjNmM2YzZjIiBkPSJNMTM5IDI1YTQ5NSA0OTUgMCAwIDEgNSAyYzUgMyA2IDcgNCAxMi0yLTItNC0zLTYtMmwtMSA4LTMtMWMtMS03IDAtMTMgMS0xOVoiLz4KICAgIDxwYXRoIGZpbGw9IiM1NDU0NTQiIGQ9Ik0xMzkgMjVjLTEgNi0yIDEyLTEgMTktNSAwLTktMS0xMy0zbC01LTEwIDEtMWgybDktNmMyLTEgNC0xIDcgMVoiLz4KICAgIDxwYXRoIGZpbGw9IiM1YzVjNWMiIGQ9Im04MyAzNS0yNSA5LTQtNHYtMWMzIDQgNSAzIDctMmwtNi03YzItMTIgNC0xMiA1IDBsNCAyYzItMiAyLTMgMC00bDYtNWM0IDIgNyAyIDExLTFsMiAxM1oiLz4KICAgIDxwYXRoIGZpbGw9IiM4ZThlOGUiIGQ9Ik0xNDggMzljMCA0LTMgNi03IDZsMS04YzItMSA0IDAgNiAyWiIvPgogICAgPHBhdGggZmlsbD0iIzg2ODY4NiIgZD0iTTE3MiA1MGMtMy01LTctNy0xMS04bC01IDFjLTItMS0zLTItMi0zIDMtMyA3LTMgMTItMSAxIDMgNCA2IDcgOSAxIDEgMCAxLTEgMloiLz4KICAgIDxwYXRoIGZpbGw9IiM2NDY0NjQiIGQ9Im00MiAzOSAyIDRjLTIgOC01IDE0LTkgMjAtNyAyLTEyIDEtMTYtM2w5LTZjLTItMS00IDAtNSAyLTItNS0xLTkgMS0xM2w5LTUgOSAxWiIvPgogICAgPHBhdGggZmlsbD0iIzYyNjI2MiIgZD0iTTE1NCA0MGMtMSAxIDAgMiAyIDNsNS0xYzQgMSA4IDMgMTEgOGwtMTEgMTBjLTExLTQtMTQtMTAtNy0yMFoiLz4KICAgIDxwYXRoIGZpbGw9IiM3NTc1NzUiIGQ9Im00MiAzOS05LTEtOSA1Yy0yIDQtMyA4LTEgMTMgMS0yIDMtMyA1LTJsLTkgNmMtMy04LTEtMTUgNS0yMCA0LTMgOC01IDE0LTVsNCA0WiIvPgogICAgPHBhdGggZmlsbD0iIzA1MDQwNCIgZD0iTTE3NiAxMTNjLTMtMy0zLTUtMS03bC0yLTljLTEtMiAwLTQgMS01bDEtM2MtMS0xLTItMi0zLTEtNS00LTgtOS03LTE1bC0xLTFjMS05IDYtMTQgMTUtMTRsNCAxIDEyIDE3LTMgNyAzIDMgNSAxNWMtNSAxMC0xMyAxNC0yNCAxMloiLz4KICAgIDxwYXRoIGZpbGw9IiNkNjg1NGEiIGQ9Ik0xMTYgNzF2MWwtMiAyYy0xLTQtMy03LTUtOS0xLTUgMS04IDUtMTEgMy0xIDYgMCA3IDRsLTYgMTEgMSAyWiIvPgogICAgPHBhdGggZmlsbD0iIzZhM2MyOCIgZD0ibTk3IDY1LTIgMi02LTZoLTRjLTIgNC0zIDktMyAxNGwtNCAzLTUtM3YtMWwyLTZjNSAwIDUtMSAyLTNsLTEtM2MyLTMgNS01IDktNiA1IDEgOSA0IDEyIDlaIi8+CiAgICA8cGF0aCBmaWxsPSIjOTc2MDNhIiBkPSJtOTcgNjUgMSAyLTE2IDExaC00bDQtM2MwLTUgMS0xMCAzLTE0aDRsNiA2IDItMloiLz4KICAgIDxwYXRoIGZpbGw9IiMzMzFiMTMiIGQ9Ik0xMjkgNjNjMiAwIDQgMiA1IDV2MWwtOC0xLTItNC0zIDVjLTEtMS0yLTItMS0zIDAtMyAxLTUgMy01bDYgMloiLz4KICAgIDxwYXRoIGZpbGw9IiMzNTFjMTMiIGQ9Im03NiA2MiAxIDNjMyAyIDMgMy0yIDNsLTIgNmMtMy0yLTQtNC00LTdsMy0zIDQtMloiLz4KICAgIDxwYXRoIGZpbGw9IiM1YzM3MjYiIGQ9Im0xMzQgNjktMSAzYy00LTItNy0xLTkgMmwtNi0yLTEtMWMwLTIgMS00IDMtNS0xIDEgMCAyIDEgM2wzLTUgMiA0IDggMVoiLz4KICAgIDxwYXRoIGZpbGw9IiM5MTkxOTEiIGQ9Im0xODkgNzktNC02Yy0yLTEtNC0yLTUtMWwxIDdoLTR2LThsMi01aC03YzItMyA0LTQgOC00IDQgNCA3IDEwIDkgMTdaIi8+CiAgICA8cGF0aCBmaWxsPSIjY2M2NTQwIiBkPSJtMTQzIDcyLTIgMi00IDQtNC02IDEtM3YtMWwzLTFjMiAwIDQgMiA2IDVaIi8+CiAgICA8cGF0aCBmaWxsPSIjMDQwMzAzIiBkPSJtMzMgNzQgMiAyIDEgMSA1IDEzYy0zIDUtNSAxMS02IDE3IDcgMTAgNiAyMS0zIDMwbDQgOGMwIDEgMCAyIDIgMiAyLTEgNCAwIDYgMWw1IDExIDEgMSAyIDFjNSAwIDEwIDIgMTYgNGw2IDcgMSA3IDItMWM0IDEgNyAzIDkgOGwzLTVjOC01IDE0LTMgMTggNyAxLTQgMi02IDUtOGwxNS0yYzItMSAzIDAgNSAyIDEtMyAyLTUgNS03IDYtMyAxMi01IDE5LTUgNS0xIDctMyA1LTctMi03IDAtMTMgNi0xNmE5NjQ2MSA5NjQ2MSAwIDAgMCA5LTI5YzYtMSAxMyAwIDIwIDEgNyA3IDggMTUgNCAyNWwtMTAgMTAtMyAxNWMtMiAzLTUgMy04IDJsLTcgMmM0IDUgNSAxMCAwIDE2bC0xNiAxNGMtNiAxLTExIDAtMTYtMmwtNyA3Yy05IDItMTcgMC0yMy02LTMgMTAtMTAgMTUtMjAgMTYtNS0zLTktNy0xMi0xMS03IDItMTIgMC0xNS01LTQgMS03IDAtMTAtMi03LTUtMTItMTItMTUtMTlsLTE1LTljLTYtNi03LTEyLTMtMTktMy01LTQtOS00LTE0TDYgMTI2di0xNGw3LTdjLTMtMS00LTQtNC02bDQtMjJjNi00IDEzLTUgMjAtM1ptMTM2IDY0YzIgMiAyIDUtMiA3bDItN1ptLTEzMyA3IDIgMmMtMiAwLTItMS0yLTJabTEyNSAxNmMyIDQgMCA2LTUgN2w1LTdaIi8+CiAgICA8cGF0aCBmaWxsPSIjYTM2YjQ4IiBkPSJNMTE2IDcxaDFsMSAxIDYgMmMyLTMgNS00IDktMmwtNSAxMC02LTctNi0zdi0xWiIvPgogICAgPHBhdGggZmlsbD0iIzhlOGU4ZSIgZD0iTTMyIDgzYy0xIDEtMiAwLTItMS01LTEtMTAgMC0xMyAzLTEtNCAxLTcgNS03aDhsMiA1WiIvPgogICAgPHBhdGggZmlsbD0iI2U1YmQ4NiIgZD0ibTExMCA5MSAyIDItMSAyYzIgMiAzIDUgMyA4LTQgNC00IDggMCAxMi0yIDMtMyA2LTEgOWwtNSA1LTQtNGMtOSAxLTE0LTMtMTctMTAtMi03LTMtMTQtMi0yMSAxLTIgMy0zIDUtM2wyLTdjMyAwIDUtMSA3LTQgMy0xIDYtMiAxMC0xbDEgMi0zIDUgMyA1WiIvPgogICAgPHBhdGggZmlsbD0iI2JlN2Y1MiIgZD0iTTEwOSA2NWMyIDIgNCA1IDUgOWwyLTIgNiAzIDYgNyA1LTEwIDQgNmMtMSAxIDAgMiAxIDQgMiAwIDQgMiA2IDUtMiAwLTMgMi0zIDRsLTMgMWMtMS04LTUtMTEtMTItOWgtM2wtNC01LTEzLTMtMiAxYy03LTMtMTMtMy0xOCAxLTEgMC0yIDEtMSAzLTItMS00IDAtNSAybDEgOWMtMy0xLTYgMC04IDJsLTIgOWMxIDUgMyA5IDYgMTMtMiAyLTMgNC0zIDctMS03LTMtMTMtNi0xOWwyLTEwYzItMyA0LTQgNy00di02bC0xMS0yaC0xYzEtNCAzLTYgOC02bDUgM2g0bDE2LTExIDIgMWMyLTIgNS0zIDktM1oiLz4KICAgIDxwYXRoIGZpbGw9IiM4YTRkMzIiIGQ9Im0xNDEgNzQgMiA3aDN2OWwtMSAxaC00YzAtMiAxLTQgMy00LTItMy00LTUtNi01LTEtMi0yLTMtMS00bDQtNFoiLz4KICAgIDxwYXRoIGZpbGw9IiM2ZDZkNmQiIGQ9Ik0xODkgNzljLTIgMS0zIDItMyA0aC0xMWwtNC0zLTItMTJjMC0yIDEtMyAzLTJoN2wtMiA1djhoNGwtMS03YzEtMSAzIDAgNSAxbDQgNloiLz4KICAgIDxwYXRoIGZpbGw9IiM0NjI1MWEiIGQ9Ik0xNTIgNzZjMiAzIDMgNiAzIDEwLTIgMy02IDQtOSA0di05aC0zbC0yLTcgMi0yYzQtMyA3LTIgOSA0WiIvPgogICAgPHBhdGggZmlsbD0iIzNjMWYxNSIgZD0iTTYwIDgxaDRsLTIgMy04IDF2N2g2bC0zIDUgNSAxdjNjLTItMS0zIDAtNCAxdjNsMiAyLTEgMy00LTF2LThjLTEtMS0yLTItMy0xIDEtNCAxLTYtMi04LTMtOSAwLTEzIDEwLTExWiIvPgogICAgPHBhdGggZmlsbD0iI2Q5YTQ2NiIgZD0ibTEyNiA4My0yIDggMSAyaC0xM2wtMi0yLTMtNSAzLTUtMS0yYy00LTEtNyAwLTEwIDEtMiAzLTQgNC03IDRsLTIgN2MtMiAwLTQgMS01IDMtMSA3IDAgMTQgMiAyMSAzIDcgOCAxMSAxNyAxMGw0IDQgMSAxLTIgNmMyIDMgMiA1LTMgNmwtNS0yLTYtNyAzLTUtOC01Yy0zLTEtNSAwLTcgMmwtMS05Yy0xLTIgMC00IDItNi0yLTEtNC0yLTYtMWwtMS01YzItMSAyLTMgMi01IDEtNCA0LTcgNy05LTItMS0zLTItMS0zbDYtMyA0LTUgMTEtMyAyLTEgMTMgMyA0IDVoM1oiLz4KICAgIDxwYXRoIGZpbGw9IiM1MjUyNTIiIGQ9Ik0zMiA4M2MwIDIgMSA1IDMgN2wtNiAxMkgxOXYtNGwtMy02IDEtN2MzLTMgOC00IDEzLTMgMCAxIDEgMiAyIDFaIi8+CiAgICA8cGF0aCBmaWxsPSIjOGI0YjMxIiBkPSJNNjUgODFoMWMtMSA0IDAgNyAzIDExLTMgMi00IDYtNCA5IDIgMyAyIDYgMSAxMGwtMS00aC01Yy0xLTMgMC00IDItNWwyLTEwLTMtMWMzLTMgNC02IDQtMTBaIi8+CiAgICA8cGF0aCBmaWxsPSIjNjUzNTI2IiBkPSJNNjQgODFoMWMwIDQtMSA3LTQgMTBsMyAxLTIgMTBjLTIgMS0zIDItMiA1bC0yLTJ2LTNjMS0xIDItMiA0LTF2LTNsLTUtMSAzLTVoLTZ2LTdsOC0xIDItM1oiLz4KICAgIDxwYXRoIGZpbGw9IiM1YTVhNWEiIGQ9Ik0xODggODhjMiA2IDIgMTIgMSAxOWwtMSAxLTkgMVY5MWMzLTIgNS0zIDktM1oiLz4KICAgIDxwYXRoIGZpbGw9IiM5NDk0OTQiIGQ9Ik0xODggODhjMSAwIDIgMCAzIDIgMiA0IDMgOSAyIDE0bC00IDNjMS03IDEtMTMtMS0xOVoiLz4KICAgIDxwYXRoIGZpbGw9IiM4ZThlOGUiIGQ9Im0xNiA5MiAzIDZ2NGwtNC0xIDEtOVoiLz4KICAgIDxwYXRoIGZpbGw9IiMwOTAzMDIiIGQ9Ik01MiAxMDBjMS0xIDIgMCAzIDF2OGwtMy0xdi04WiIvPgogICAgPHBhdGggZmlsbD0iIzE1MDgwNCIgZD0iTTE1MCAxMDFjMSAzIDEgNi0yIDgtMS0zLTItNi0xLThoM1oiLz4KICAgIDxwYXRoIGZpbGw9IiM2OTM3MjUiIGQ9Ik0xNDcgOTZjMiAwIDMgMSAzIDR2MWgtM2MtMSAyIDAgNSAxIDhsLTIgMmgtNmMtMS0yIDAtMyAxLTRsMy0zdi04aDNaIi8+CiAgICA8cGF0aCBmaWxsPSIjNTQ1NDU0IiBkPSJtMjAgMTA5IDkgMmMtMS0xLTIgMC0yIDFsLTQgOGMtMyAwLTUgMS02IDQtMS00LTItOC0xLTExbDQtNFoiLz4KICAgIDxwYXRoIGZpbGw9IiNjMDVhMzciIGQ9Ik0xNDAgMTExaDZsLTEgNi0zLTEtMi0yYy0zLTItMy0zIDAtM1oiLz4KICAgIDxwYXRoIGZpbGw9IiM2YTZhNmEiIGQ9Ik0yOSAxMTFjNyA1IDggMTIgMiAyMGwtOCA2YTE4MzQgMTgzNCAwIDAgMS0zLThsLTMtNWMxLTMgMy00IDYtNGw0LThjMC0xIDEtMiAyLTFaIi8+CiAgICA8cGF0aCBmaWxsPSIjMDkwNDAzIiBkPSJtMTQ5IDEyMSA1IDJjMSA3IDAgMTQtMyAyMmwtNSA0LTItMXYtNGwxLTFoM2wzLTE0LTEtNC0yLTMgMS0xWiIvPgogICAgPHBhdGggZmlsbD0iIzhhOGE4YSIgZD0ibTIwIDEwOS00IDRjLTEgMyAwIDcgMSAxMWwzIDUtMiAyYy02LTYtOC0xMi02LTE5IDItMyA0LTQgOC0zWiIvPgogICAgPHBhdGggZmlsbD0iIzBlMDQwMyIgZD0iTTU0IDExNnY4YzYtMyA2LTIgMSAyIDIgMiAyIDQgMCA3bC0zLTItNC0xMWMxLTMgMy00IDYtNFoiLz4KICAgIDxwYXRoIGZpbGw9IiNiMzcyNGQiIGQ9Ik0xNDcgOTV2MWgtM3Y4bC0zIDNjLTEgMS0yIDItMSA0LTMgMC0zIDEgMCAzbC05IDIxYy00IDAtNyAxLTggNWwtMSAxLTggMWMyLTYgNS0xMCAxMS0xMiAxLTYgNC0xMSA4LTE1bDQtMThjMy0yIDYtMiAxMC0yWiIvPgogICAgPHBhdGggZmlsbD0iIzNiMjAxOSIgZD0iTTU2IDExNHY3aDRjLTEgMiAwIDQgMyA2LTIgMC00IDEtNCAzbDQgNi0yIDItNi00di0xYzItMyAyLTUgMC03IDUtNCA1LTUtMS0ydi04bDItMloiLz4KICAgIDxwYXRoIGZpbGw9IiM1ODU4NTgiIGQ9Ik0xOTAgMTIxaC0xYzMgMSA0IDQgNSA3bC01IDE2Yy0yIDAtMyAxLTMgMy05LTItMTItNy0xMS0xNWw0LTExYzMtMiA3LTIgMTEgMFoiLz4KICAgIDxwYXRoIGZpbGw9IiNjODc0NGMiIGQ9Im03NSAxMzUtNCA0aC0xYy0xLTItMi00LTQtNGwzLTQgNi01YzAgMiAxIDUgMyA3LTIgMC0zIDEtMyAyWiIvPgogICAgPHBhdGggZmlsbD0iI2EwNTUzOSIgZD0ibTE0MCAxMTQgMiAyYy0xIDgtNCAxNi05IDIzLTMgMC01IDItNyA0bC0zLTNjMS00IDQtNSA4LTVsOS0yMVoiLz4KICAgIDxwYXRoIGZpbGw9IiM4NzU0M2EiIGQ9Ik02NSAxMTJ2MTBoNGMtMiAzLTIgNiAwIDlsLTMgNGgtMWMtMS01LTItMTAtNC0xM2wxLTJjLTMgMC00LTEtNS0yIDItMyA0LTUgOC02WiIvPgogICAgPHBhdGggZmlsbD0iI2FlNmY0YiIgZD0ibTY2IDgxIDExIDJ2NmMtMyAwLTUgMS03IDRsLTIgMTBjMyA2IDUgMTIgNiAxOWwzIDMgNCAxYzAgNCAxIDkgNCAxM2gtNWwtNS00YzAtMSAxLTIgMy0yLTItMi0zLTUtMy03bC02IDVjLTItMy0yLTYgMC05aC00di0xMGwxLTFjMS00IDEtNy0xLTEwIDAtMyAxLTcgNC05LTMtNC00LTctMy0xMVoiLz4KICAgIDxwYXRoIGZpbGw9IiNjZTkzNWEiIGQ9Im0xMDQgNzYtMTEgMy00IDUtNiAzYy0yIDEtMSAyIDEgMy0zIDItNiA1LTcgOSAwIDIgMCA0LTIgNWwxIDVjMi0xIDQgMCA2IDEtMiAyLTMgNC0yIDZsMSA5YzItMiA0LTMgNy0ybDggNS0zIDUgNiA3IDUgMmM1LTEgNS0zIDMtNmwyLTZjNCAwIDgtMiAxMi01IDItOSA1LTE3IDktMjVsLTItNmMtMS0xLTItMi0zLTFsLTEtMiAyLThjNy0yIDExIDEgMTIgOWwzLTFoNGwyIDRjLTQgMC03IDAtMTAgMmwtNCAxOGMtNCA0LTcgOS04IDE1LTYgMi05IDYtMTEgMTJsLTE1IDJjLTUtMy0xMC00LTE0LTUtMy00LTQtOS00LTEzbC00LTEtMy0zYzAtMyAxLTUgMy03LTMtNC01LTgtNi0xM2wyLTljMi0yIDUtMyA4LTJsLTEtOWMxLTIgMy0zIDUtMi0xLTIgMC0zIDEtMyA1LTQgMTEtNCAxOC0xWiIvPgogICAgPHBhdGggZmlsbD0iI2RmYjM4MCIgZD0iTTEyNSA5M2MxLTEgMiAwIDMgMWwyIDZjLTQgOC03IDE2LTkgMjUtNCAzLTggNS0xMiA1bC0xLTEgNS01Yy0yLTMtMS02IDEtOS00LTQtNC04IDAtMTIgMC0zLTEtNi0zLThsMS0yaDEzWiIvPgogICAgPHBhdGggZmlsbD0iI2U5Yzg5NyIgZD0iTTExMCA5MWMyIDkgMSAxOS01IDI4LTUgMS04IDAtOC01bDUtMTZjLTItNyAwLTEwIDgtN1oiLz4KICAgIDxwYXRoIGZpbGw9IiM4OTg5ODkiIGQ9Ik0xOTAgMTIxYzQgMSA2IDUgNyAxMC0xIDgtNCAxMy0xMSAxNiAwLTIgMS0zIDMtM2w1LTE2Yy0xLTMtMi02LTUtN2gxWiIvPgogICAgPHBhdGggZmlsbD0iIzVjMzIyMiIgZD0iTTYwIDEwN2g1bDEgNC0xIDFjLTQgMS02IDMtOCA2IDEgMSAyIDIgNSAybC0xIDJjMiAzIDMgOCA0IDEzbC0yIDEtNC02YzAtMiAyLTMgNC0zLTMtMi00LTQtMy02aC00di03bDQtNGgtMWwxLTNaIi8+CiAgICA8cGF0aCBmaWxsPSIjNTUyYzIxIiBkPSJtMTQ1IDExOCA0IDMtMSAxIDIgM2MtMyA1LTQgMTEtNiAxN2wtNy02IDYtN2MtMS00LTItOC0xLTExaDNaIi8+CiAgICA8cGF0aCBmaWxsPSIjM2EyMDE4IiBkPSJtMTUwIDEyNSAxIDQtMyAxNGgtM2wtMSAxdjRsMiAxLTMgNS05LTR2LTNsOSAyYy0xLTUtMy04LTctMTAtMS0yLTEtMyAxLTNsNyA2YzItNiAzLTEyIDYtMTdaIi8+CiAgICA8cGF0aCBmaWxsPSIjNjczNDI0IiBkPSJtMTQyIDExNiAzIDF2MWgtM2MtMSAzIDAgNyAxIDExbC02IDdjLTIgMC0yIDEtMSAzIDQgMiA2IDUgNyAxMGwtOS0ydjNjLTQtMi02LTUtOC03IDItMiA0LTQgNy00IDUtNyA4LTE1IDktMjNaIi8+CiAgICA8cGF0aCBmaWxsPSIjNmM2YzZjIiBkPSJNMjcgMTM5YzMgMiA0IDQgMyA4LTcgMS05LTEtNy03bDQtMVoiLz4KICAgIDxwYXRoIGZpbGw9IiM0MzIyMTciIGQ9Ik03MCAxMzloMWMxLTEgMiAwIDMgMS03IDUtNyA2IDIgMmwxIDFjLTMgMS01IDMtNiA2bC0yLTNjLTEtMS0yLTEtMiAxbC0xLTJjMC0zIDItNSA0LTZaIi8+CiAgICA8cGF0aCBmaWxsPSIjYjQ2MDNkIiBkPSJNODAgMTM5aDVjNCAxIDkgMiAxNCA1bDE1LTIgOC0xdjFjLTItMS00IDAtNCAybC01IDEtMiA0LTcgMmMtMS0yLTItMy0xLTRoLTR2NGwtMTMtNS0yIDJ2LTdoLTNsLTEgNHYtNloiLz4KICAgIDxwYXRoIGZpbGw9IiMxZjEwMGEiIGQ9Im03MSAxNDkgMiAxYzEtMiAzLTMgNS0zbDEgMi02IDQtNi02YzAtMiAxLTIgMi0xbDIgM1oiLz4KICAgIDxwYXRoIGZpbGw9IiNiYjRmMmUiIGQ9Im0xMjMgMTQwIDMgM2MyIDIgNCA1IDggN2w5IDQtNCAxMmMtMi0xLTQgMC01IDFsLTktNmMtMi0yLTMtNS0yLTd2LThsLTEtNHYtMWwxLTFaIi8+CiAgICA8cGF0aCBmaWxsPSIjODg0NDJkIiBkPSJtMTIyIDE0MiAxIDRjLTItMS0zLTItNC0xbC0xIDdjLTEtMy0zLTMtNS0xLTIgMS0zIDMtNCA2IDAtMi0xLTMtMi0zLTEgMS0yIDMtMSA1bC0yLTggNy0yIDItNCA1LTFjMC0yIDItMyA0LTJaIi8+CiAgICA8cGF0aCBmaWxsPSIjNzUzYzI5IiBkPSJtNzUgMTM1IDUgNHY2bDEtNGgzdjdsMi0yIDEzIDUtMSAxNGMtMi0zLTQtMi01IDBoLTNsLTItNi04LTJ2NWMtMS0yLTItNC0xLTZ2LTdsLTEtMmMtMiAwLTQgMS01IDNsLTItMWMxLTMgMy01IDYtNmwtMS0xYy05IDQtOSAzLTItMi0xLTEtMi0yLTMtMWw0LTRaIi8+CiAgICA8cGF0aCBmaWxsPSIjNGU0ZTRlIiBkPSJtMTgyIDE1MS0xMSA1LTIgOGMtNi04LTQtMTUgNC0xOWw5IDZaIi8+CiAgICA8cGF0aCBmaWxsPSIjNjU2NTY1IiBkPSJtNDEgMTcxLTEyLTYtMy0xMyA5LTFjOSA0IDExIDExIDYgMjBaIi8+CiAgICA8cGF0aCBmaWxsPSIjNTIyOTFkIiBkPSJNMTIzIDE0NnY4bC0yIDRjLTMtMi01LTEtNiAxbC03IDF2M2wtMi0xdi0zYy0xLTIgMC00IDEtNSAxIDAgMiAxIDIgMyAxLTMgMi01IDQtNiAyLTIgNC0yIDUgMWwxLTdjMS0xIDIgMCA0IDFaIi8+CiAgICA8cGF0aCBmaWxsPSIjNjk2OTY5IiBkPSJtMTgyIDE1MS0yIDExLTUgMiAzIDEtNSAxLTQtMiAyLTggMTEtNVoiLz4KICAgIDxwYXRoIGZpbGw9IiMxNDA5MDUiIGQ9Ik0xMjEgMTU4Yy00IDQtOCA2LTEzIDV2LTNsNy0xYzEtMiAzLTMgNi0xWiIvPgogICAgPHBhdGggZmlsbD0iI2JiNTEyZiIgZD0ibTEwNCAxNTEgMiA4djNsLTQgN2gtNHYtNGwxLTE0di00aDRjLTEgMSAwIDIgMSA0WiIvPgogICAgPHBhdGggZmlsbD0iIzgyODI4MiIgZD0iTTE4MiAxNTFjMSAwIDIgMCAyIDIgMSA0IDAgNy0xIDExbC01IDEtMy0xIDUtMiAyLTExWiIvPgogICAgPHBhdGggZmlsbD0iIzQxMjIxNyIgZD0iTTk4IDE2NXY0bC05IDItNi0yLTMtN3YtNWw4IDIgMiA2aDNjMS0yIDMtMyA1IDBaIi8+CiAgICA8cGF0aCBmaWxsPSIjOTA5MDkwIiBkPSJtMjYgMTUyIDMgMTMgMTIgNnYzbC0xNi04Yy0yLTUtMi0xMCAxLTE0WiIvPgogICAgPHBhdGggZmlsbD0iIzVkNWQ1ZCIgZD0iTTE2NCAxNzNoLTFjMiAzIDMgNiAyIDEwbC01IDdjLTEtMi0yLTMtMS00bC00LTEtMy03Yy0zIDAtNiAxLTggM2E0MzAgNDMwIDAgMCAxLTQgMTJjLTItNS0yLTEwLTEtMTVsMy0zIDE4LTRjMSAwIDMgMCA0IDJaIi8+CiAgICA8cGF0aCBmaWxsPSIjNzI3MjcyIiBkPSJNMTY0IDE3M2MyIDAgNCAyIDYgNi0zIDYtNyAxMS0xMyAxNWwtMSA0LTEyLTMtNC0yYTQzMCA0MzAgMCAwIDAgNC0xMmMyLTIgNS0zIDgtM2wzIDcgNCAxYy0xIDEgMCAyIDEgNGw1LTdjMS00IDAtNy0yLTEwaDFaIi8+CiAgICA8cGF0aCBmaWxsPSIjNTQ1NDU0IiBkPSJtNjUgMTkzLTEtMWMtMyAyLTQgMi00LTEtNCAwLTctMS05LTQtMy00LTUtOS01LTEzIDAtNSAyLTggNi05bDE1IDYgMyAxMS01IDExWiIvPgogICAgPHBhdGggZmlsbD0iIzRkNGQ0ZCIgZD0iTTEzMiAyMDBjLTYgMC0xMS0xLTE1LTR2MmwtMi0yLTEtMTEgMTItM2MyIDAgMyAxIDUgM2w1IDExLTQgNFoiLz4KICAgIDxwYXRoIGZpbGw9IiM1ZjVmNWYiIGQ9Im03OSAxOTgtNyAxdi01aC0zYzEtNSA0LTkgOC0xMSA2IDQgNyA5IDIgMTVaIi8+CiAgICA8cGF0aCBmaWxsPSIjNTQ1NDU0IiBkPSJtMTAyIDIwNS0xLTFjLTYgNC05IDMtOC00LTMgMC01IDEtNyAzLTEtMi0yLTItMi0xbC0xLTJjMy02IDctMTIgMTItMTcgNCAxIDYgNCA3IDkgMiA0IDIgOCAwIDEzWiIvPgogICAgPHBhdGggZmlsbD0iIzdjN2M3YyIgZD0iTTQ2IDE3NGMwIDQgMiA5IDUgMTMgMiAzIDUgNCA5IDQgMCAzIDEgMyA0IDFsMSAxLTYgM2MtNy00LTEyLTktMTUtMTYtMS0zIDAtNSAyLTZaIi8+CiAgICA8cGF0aCBmaWxsPSIjODU4NTg1IiBkPSJNNjkgMTk0aDN2NWw3LTEtNyA0Yy0zLTItNC01LTMtOFoiLz4KICAgIDxwYXRoIGZpbGw9IiM4MTgxODEiIGQ9Im0xMzIgMjAwLTEgMWgtMTJsLTItM3YtMmM0IDMgOSA0IDE1IDRaIi8+CiAgICA8cGF0aCBmaWxsPSJncmF5IiBkPSJNMTAyIDIwNWMtNSA3LTEwIDctMTUgMWwtMy00YzAtMSAxLTEgMiAxIDItMiA0LTMgNy0zLTEgNyAyIDggOCA0bDEgMVoiLz4KPC9zdmc+Cg=="],audio:[""]},mapData:{1:{name:"Vampire Attack",width:3e3,height:3e3,gridType:0,gridSize:100,gridColour:{r:0,g:0,b:0,a:255},gridStroke:1,startX:2101,startY:1441,gridDistance:5,gridDiagonal:!1,lightColour:{r:0,g:0,b:0,a:228},baseOpaque:!1,masks:[],data:{},hidden:!1,locked:!1,tokens:[],walls:[],children:[{name:"Background",hidden:!1,locked:!0,tokens:[{x:1576,y:376,lightColours:[],lightStages:[],lightTimings:[],id:12,rotation:0,flip:!1,flop:!1,width:148,height:148,snap:!0,tokenData:{},tokenType:0,src:1,patternWidth:0,patternHeight:0},{x:0,y:0,lightColours:[],lightStages:[],lightTimings:[],id:1,rotation:0,flip:!1,flop:!1,width:3e3,height:3e3,snap:!0,tokenData:{},tokenType:0,src:3,patternWidth:100,patternHeight:88},{x:2676,y:876,lightColours:[],lightStages:[],lightTimings:[],id:10,rotation:0,flip:!1,flop:!1,width:148,height:148,snap:!0,tokenData:{},tokenType:0,src:1,patternWidth:0,patternHeight:0},{x:2352,y:1041,lightColours:[],lightStages:[],lightTimings:[],id:21,rotation:0,flip:!1,flop:!1,width:148,height:148,snap:!0,tokenData:{},tokenType:0,src:1,patternWidth:0,patternHeight:0},{x:2184,y:1060,lightColours:[],lightStages:[],lightTimings:[],id:7,rotation:0,flip:!1,flop:!1,width:148,height:148,snap:!0,tokenData:{},tokenType:0,src:1,patternWidth:0,patternHeight:0},{x:2476,y:1276,lightColours:[],lightStages:[],lightTimings:[],id:19,rotation:0,flip:!1,flop:!1,width:148,height:148,snap:!0,tokenData:{},tokenType:0,src:1,patternWidth:0,patternHeight:0},{x:2492,y:1528,lightColours:[],lightStages:[],lightTimings:[],id:20,rotation:0,flip:!1,flop:!1,width:148,height:148,snap:!0,tokenData:{},tokenType:0,src:1,patternWidth:0,patternHeight:0},{x:2376,y:1676,lightColours:[],lightStages:[],lightTimings:[],id:9,rotation:0,flip:!1,flop:!1,width:148,height:148,snap:!0,tokenData:{},tokenType:0,src:1,patternWidth:0,patternHeight:0},{x:2272,y:1832,lightColours:[],lightStages:[],lightTimings:[],id:23,rotation:0,flip:!1,flop:!1,width:148,height:148,snap:!0,tokenData:{},tokenType:0,src:1,patternWidth:0,patternHeight:0},{x:2040,y:1836,lightColours:[],lightStages:[],lightTimings:[],id:22,rotation:0,flip:!1,flop:!1,width:148,height:148,snap:!0,tokenData:{},tokenType:0,src:1,patternWidth:0,patternHeight:0},{x:876,y:2476,lightColours:[],lightStages:[],lightTimings:[],id:11,rotation:0,flip:!1,flop:!1,width:148,height:148,snap:!0,tokenData:{},tokenType:0,src:1,patternWidth:0,patternHeight:0},{x:576,y:1676,lightColours:[],lightStages:[],lightTimings:[],id:8,rotation:0,flip:!1,flop:!1,width:148,height:148,snap:!0,tokenData:{},tokenType:0,src:1,patternWidth:0,patternHeight:0},{x:776,y:476,lightColours:[],lightStages:[],lightTimings:[],id:2,rotation:0,flip:!1,flop:!1,width:148,height:148,snap:!0,tokenData:{},tokenType:0,src:1,patternWidth:0,patternHeight:0},{x:2200,y:1400,lightColours:[[{r:255,g:219,b:195,a:255}],[{r:255,g:219,b:195,a:255}],[{r:255,g:219,b:195,a:117}],[{r:255,g:219,b:195,a:117}]],lightStages:[15,1,15,1],lightTimings:[0],id:18,rotation:0,flip:!1,flop:!1,width:100,height:100,snap:!0,tokenData:{},tokenType:0,src:9,patternWidth:0,patternHeight:0}],walls:[]},{name:"Grid",hidden:!1,locked:!1,tokens:[],walls:[]},{name:"Chars",hidden:!1,locked:!1,tokens:[{x:1600,y:1100,lightColours:[],lightStages:[],lightTimings:[],id:14,rotation:224,flip:!1,flop:!1,width:200,height:200,snap:!0,tokenData:{"store-character-id":{user:!0,data:2}},tokenType:0,src:7,patternWidth:0,patternHeight:0},{x:1300,y:1200,lightColours:[],lightStages:[],lightTimings:[],id:13,rotation:224,flip:!1,flop:!1,width:100,height:100,snap:!0,tokenData:{"store-character-id":{user:!0,data:1}},tokenType:0,src:6,patternWidth:0,patternHeight:0},{x:2187,y:1587,lightColours:[],lightStages:[],lightTimings:[],id:15,rotation:64,flip:!1,flop:!1,width:125,height:125,snap:!0,tokenData:{"store-character-id":{user:!0,data:4}},tokenType:0,src:2,patternWidth:0,patternHeight:0},{x:2300,y:1500,lightColours:[],lightStages:[],lightTimings:[],id:16,rotation:64,flip:!1,flop:!1,width:100,height:100,snap:!0,tokenData:{"store-character-id":{user:!0,data:3}},tokenType:0,src:8,patternWidth:0,patternHeight:0},{x:2084,y:1184,lightColours:[],lightStages:[],lightTimings:[],id:17,rotation:64,flip:!1,flop:!1,width:131,height:131,snap:!0,tokenData:{"store-character-id":{user:!0,data:5}},tokenType:0,src:4,patternWidth:0,patternHeight:0}],walls:[]},{name:"Trees",hidden:!1,locked:!1,tokens:[{x:2e3,y:200,lightColours:[],lightStages:[],lightTimings:[],id:4,rotation:192,flip:!1,flop:!1,width:700,height:700,snap:!0,tokenData:{},tokenType:0,src:5,patternWidth:0,patternHeight:0},{x:1900,y:2e3,lightColours:[],lightStages:[],lightTimings:[],id:5,rotation:0,flip:!1,flop:!1,width:700,height:700,snap:!0,tokenData:{},tokenType:0,src:5,patternWidth:0,patternHeight:0},{x:200,y:800,lightColours:[],lightStages:[],lightTimings:[],id:3,rotation:128,flip:!1,flop:!1,width:700,height:700,snap:!0,tokenData:{},tokenType:0,src:5,patternWidth:0,patternHeight:0},{x:100,y:2e3,lightColours:[],lightStages:[],lightTimings:[],id:6,rotation:64,flip:!1,flop:!1,width:700,height:700,snap:!0,tokenData:{},tokenType:0,src:5,patternWidth:0,patternHeight:0}],walls:[{id:1,x1:2300,y1:550,x2:2323,y2:539,colour:{r:0,g:0,b:0,a:255},scattering:0},{id:2,x1:2323,y1:539,x2:2302,y2:529,colour:{r:0,g:0,b:0,a:255},scattering:0},{id:3,x1:2302,y1:529,x2:2288,y2:546,colour:{r:0,g:0,b:0,a:255},scattering:0},{id:4,x1:2288,y1:546,x2:2300,y2:550,colour:{r:0,g:0,b:0,a:255},scattering:0},{id:5,x1:2250,y1:2300,x2:2270,y2:2310,colour:{r:0,g:0,b:0,a:255},scattering:0},{id:6,x1:2270,y1:2310,x2:2251,y2:2324,colour:{r:0,g:0,b:0,a:255},scattering:0},{id:7,x1:2251,y1:2324,x2:2239,y2:2308,colour:{r:0,g:0,b:0,a:255},scattering:0},{id:8,x1:2239,y1:2308,x2:2250,y2:2300,colour:{r:0,g:0,b:0,a:255},scattering:0},{id:9,x1:500,y1:2350,x2:484,y2:2342,colour:{r:0,g:0,b:0,a:255},scattering:0},{id:10,x1:484,y1:2342,x2:489,y2:2365,colour:{r:0,g:0,b:0,a:255},scattering:0},{id:11,x1:489,y1:2365,x2:500,y2:2350,colour:{r:0,g:0,b:0,a:255},scattering:0},{id:12,x1:551,y1:1206,x2:551,y2:1177,colour:{r:0,g:0,b:0,a:255},scattering:0},{id:13,x1:551,y1:1177,x2:527,y2:1195,colour:{r:0,g:0,b:0,a:255},scattering:0},{id:14,x1:527,y1:1195,x2:550,y2:1200,colour:{r:0,g:0,b:0,a:255},scattering:0}]},{name:"Light",hidden:!1,locked:!1,tokens:[],walls:[]}]}},characterData:{1:{name:{user:!0,data:"Vampire"},"store-image-icon":{user:!1,data:6},"5e-initiative-mod":{user:!1,data:4},"5e-ac":{user:!1,data:16},"5e-hp-current":{user:!1,data:144},"5e-hp-max":{user:!1,data:144},"5e-darkvision":{user:!0,data:120},"5e-notes":{user:!1,data:"Shapechanger\nLegendary Resistance 3/day.\nMM: 297"},"store-image-data":{user:!1,data:[{src:6,width:100,height:100,patternWidth:0,patternHeight:0,rotation:0,flip:!1,flop:!1,snap:!0,lightColours:[],lightStages:[],lightTimings:[],tokenData:{"store-character-id":{user:!0,data:1}}}]}},2:{name:{user:!0,data:"Werewolf"},"store-image-icon":{user:!1,data:7},"5e-initiative-mod":{user:!1,data:1},"5e-ac":{user:!1,data:12},"5e-hp-current":{user:!1,data:58},"5e-hp-max":{user:!1,data:58},"5e-notes":{user:!1,data:"Shapechanger\nMM: 211"},"store-image-data":{user:!1,data:[{src:7,width:200,height:200,patternWidth:0,patternHeight:0,rotation:0,flip:!1,flop:!1,snap:!0,lightColours:[],lightStages:[],lightTimings:[],tokenData:{"store-character-id":{user:!0,data:2}}}]}},3:{name:{user:!0,data:"Svevdor"},"store-image-icon":{user:!1,data:8},"5e-player":{user:!0,data:!0},"store-image-data":{user:!1,data:[{src:8,width:100,height:100,patternWidth:0,patternHeight:0,rotation:0,flip:!1,flop:!1,snap:!0,lightColours:[],lightStages:[],lightTimings:[],tokenData:{"store-character-id":{user:!0,data:3}}}]}},4:{name:{user:!0,data:"Opal"},"store-image-icon":{user:!1,data:2},"5e-player":{user:!0,data:!0},"store-image-data":{user:!1,data:[{src:2,width:125,height:125,patternWidth:0,patternHeight:0,rotation:0,flip:!1,flop:!1,snap:!0,lightColours:[],lightStages:[],lightTimings:[],tokenData:{"store-character-id":{user:!0,data:4}}}]}},5:{name:{user:!0,data:"Vax"},"store-image-icon":{user:!1,data:4},"5e-player":{user:!0,data:!0},"5e-darkvision":{user:!0,data:60},"store-image-data":{user:!1,data:[{src:4,width:131,height:131,patternWidth:0,patternHeight:0,rotation:0,flip:!1,flop:!1,snap:!0,lightColours:[],lightStages:[],lightTimings:[],tokenData:{"store-character-id":{user:!0,data:5}}}]}}},images:{folders:{Terrain:{folders:{},items:{Tree:5,Grass:3,Bush:1}},Characters:{folders:{},items:{Wizard:8,Rogue:4,Fighter:2}},Monsters:{folders:{},items:{Werewolf:7,Vampire:6}}},items:{Campfire:9}},audio:{folders:{},items:{}},maps:{folders:{},items:{"Vampire Attack":1}},characters:{folders:{Players:{folders:{},items:{Vax:5,Opal:4,Svevdor:3}}},items:{Vampire:1,Werewolf:2}},music:{},plugins:{"5e.js":{enabled:!0,data:{}},"notes.js":{enabled:!0,data:{}},"spells.js":{enabled:!0,data:{}}},localStorage:{panelWidth:"485",lastTab:"Settings",tabIcons:"",panelOnTop:"",menuHide:"",zoomSlider:"",miniTools:"",musicSort:"",hiddenLayerOpacity:"0",measureTokenMove:"",autosnap:"","5e-show-selected-hp":"","5e-show-selected-ac":"","5e-show-selected-names":"","5e-desaturate-token-conditions":"",windowData:'{"Tools":{"out":true,"data":[0,0,48,412]},"Layers":{"out":true,"data":[48,0,153,227]}}',selectedMap:"1",keys:'{"centreMap":"c","helpKey":"F1","togglePanel":"F9","5e-health-key":"h","5e-initiative-key":"i","5e-CONDITION_BANE":"","5e-CONDITION_BLESSED":"","5e-CONDITION_BLINDED":"","5e-CONDITION_BLINK":"","5e-CONDITION_BLUR":"","5e-CONDITION_BURNING":"","5e-CONDITION_CHARMED":"","5e-CONDITION_CONCENTRATING":"Shift+C","5e-CONDITION_CONFUSED":"","5e-CONDITION_DEAD":"Shift+D","5e-CONDITION_DEAFENED":"","5e-CONDITION_DYING":"d","5e-CONDITION_EXHAUSTED":"","5e-CONDITION_FLYING":"","5e-CONDITION_FRIGHTENED":"","5e-CONDITION_GRAPPLED":"","5e-CONDITION_GUIDANCE":"","5e-CONDITION_HASTE":"","5e-CONDITION_HEXED":"","5e-CONDITION_HIDEOUS_LAUGHTER":"","5e-CONDITION_HUNTERS_MARK":"","5e-CONDITION_INCAPACITATED":"","5e-CONDITION_INSPIRED":"","5e-CONDITION_INVISIBLE":"Shift+I","5e-CONDITION_LEVITATE":"","5e-CONDITION_MIRROR_IMAGE":"","5e-CONDITION_PARALYZED":"","5e-CONDITION_PETRIFIED":"","5e-CONDITION_POISONED":"","5e-CONDITION_PRONE":"p","5e-CONDITION_RAGE":"","5e-CONDITION_RECKLESS":"","5e-CONDITION_RESTRAINED":"","5e-CONDITION_SANCTUARY":"","5e-CONDITION_SLOW":"","5e-CONDITION_STUNNED":"","5e-CONDITION_UNCONSCIOUS":"","spells-create":"Enter","tool_default":"1","tool_draw":"2","tool_mask":"3","tool_measure":"4","tool_move":"5","tool_multiplace":"6","tool_spells":"7","tool_wall":"8","toolPrev":"Shift+(","toolNext":"Shift+)","tokenEdit":"e","tokenLight":"","nextToken":"Tab","prevToken":"Shift+Tab","layerPrev":"[","layerNext":"]"}',"5e-show-token-hp":"","5e-show-token-ac":"","5e-show-token-names":"",panelShow:""}};{const e=Symbol("lastTokenID"),i=Symbol("tokenList"),o=Symbol("lastWallID"),s=Symbol("wallList"),a=Symbol("lastMapID"),n=Symbol("lastCharacterID"),r=Symbol("lastMusicPackID"),l=(t,e)=>{if(e(t))return t;for(let i=0;;i++){const o=t+"."+i;if(e(o))return o}},M=(t,e,i)=>l(e,(e=>!t[e]&&(t[e]=i,!0))),g=(t,e,i)=>l(e,(e=>!t[e]&&(t[e]=i,!0))),c=(t,e)=>{let i=t;for(const t of e.split("/")){if(!t)continue;const e=i.folders[t];if(!e)return null;i=e}return i},d=t=>{const e=t.lastIndexOf("/");return e>=0?[t.slice(0,e),t.slice(e+1)]:["",t]},I=(t,e)=>{for(;t.charAt(0)===e;)t=t.slice(1);return t},h=(t,e)=>{for(;t.charAt(t.length-1)===e;)t=t.slice(0,-1);return t},T=t=>{for(;t.includes("//");)t=t.replaceAll("//","/");return t},u=(t,e)=>{let i;const[o,s]=d(T(h(e,"/")));if(o){if(i=c(t,o),!i)return[null,"",null]}else i=t;return[i,s,i.folders[s]]},A=(t,e)=>{const[i,o]=d(e),s=c(t,T(i));return s?[s,o,s.items[o]]:[null,"",0]},L=(t,e)=>{const[i,o]=u(t,e);return i&&o?e.slice(0,e.length-o.length)+g(i.folders,o,{folders:{},items:{}}):""},m=(t,e,i)=>{const[o,s,a]=A(t,e);if(!o||!a)return"";let n,r;if(i.endsWith("/"))n=c(t,h(i,"/")),r=s;else{const[e,o]=d(i);r=o,i=h(e,"/"),n=c(t,i)}return delete o.items[s],i+"/"+M(n.items,r,a)},y=(t,e,i)=>{const[o,s,a]=u(t,e);if(!o||!a)return"";let n,r;if(i.endsWith("/"))n=c(t,h(i,"/")),r=s;else{const[e,o]=d(i);r=o,i=h(e,"/"),n=c(t,i)}return i.endsWith(e)?"":(delete o.folders[s],i+"/"+g(n.folders,r,a))},N=(t,e)=>{const[i,o,s]=A(t,e);return i&&s?(delete i.items[o],null):null},D=(t,e)=>{const[i,o,s]=u(t,e);return i&&s?(delete i.folders[o],null):null},p=(t,e,i)=>{let[o,s]=A(t,i);return o?(s||(s=e+""),{id:e,path:i.slice(0,s.length)+M(o.items,s,e)}):""},E=()=>t.mapData[t.currentMap],w=(t=E(),e={})=>{for(const i of t.children??[])e[i.name]=i,w(i,e);return e},f=t=>{const e=w();return l(t,(t=>!(t in e)))},x=t=>{let e=E();t:for(const i of h(I(t,"/"),"/").split("/"))if(i){for(const t of e.children??[])if(t.name===i){e=t;continue t}return null}return e},S=t=>{const[e,i]=d(h(t,"/")),o=x(e);if(o)for(const t of o.children??[])if(t.name===i)return[o,t];return[null,null]},C=t=>{const{token:e}=E()[i][t.id];if(t.tokenData&&(Object.assign(e.tokenData,t.tokenData),delete t.tokenData),t.removeTokenData){for(const i of t.removeTokenData)delete e.tokenData[i];delete t.removeTokenData}for(const i of Object.keys(t))e[i]=t[i]},k=(t,a)=>{for(const o of a.tokens??[])t[i][o.id]={layer:a,token:o},o.id>t[e]&&(t[e]=o.id);for(const e of a.walls??[])t[s][e.id]={layer:a,wall:e},e.id>t[o]&&(t[o]=e.id);for(const e of a.children??[])k(t,e)};t[n]=0,t[a]=0,t[r]=0;for(const e in t.characterData){const i=parseInt(e);i<t[n]&&(t[n]=i)}for(const n in t.mapData){const r=parseInt(n),l=t.mapData[r];r<t[a]&&(t[a]=r),l[e]=l[o]=0,l[i]={},l[s]={},k(l,l)}for(const e in t.music){const i=parseInt(e);i<t[r]&&(t[r]=i)}Object.defineProperties(window,{WebSocket:{value:class extends EventTarget{constructor(){super(),setTimeout((()=>this.dispatchEvent(new Event("open")))),setTimeout((()=>this.#t(-1,t.admin?2:1)))}send(t){const e=JSON.parse(t);this.#t(e.id,this.#e(e.method,e.params))}#e(g,c){switch(g){case"conn.ready":t.admin?this.#t(-2,t.currentMap):t.currentUserMap>0&&this.#t(-3,t.mapData[t.currentUserMap]);break;case"conn.currentTime":return Math.floor(Date.now()/1e3);case"maps.setCurrentMap":return t.currentMap=JSON.parse(c),null;case"maps.getUserMap":return t.currentUserMap;case"maps.setUserMap":return t.currentUserMap=JSON.parse(c),null;case"maps.getMapData":return t.mapData[c];case"maps.new":{const a=++t[r];return t.mapData[a]=Object.assign(c,{startX:0,startY:0,gridDistance:0,gridDiagonal:!1,lightColour:{r:0,g:0,b:0,a:0},baseOpaque:!1,masks:[],data:{},hidden:!1,locked:!1,tokens:[],walls:[],children:[{name:"Layer",hidden:!1,locked:!1,tokens:[],walls:[]},{name:"Light",hidden:!1,locked:!1,tokens:[],walls:[]},{name:"Grid",hidden:!1,locked:!1,tokens:[],walls:[]}],[e]:0,[o]:0,[i]:{},[s]:{}}),{id:a,name:M(t.maps.items,c.name,a)}}case"maps.setMapDetails":return Object.assign(E(),c),null;case"maps.setMapStart":{const t=c,e=E();return e.startX=t[0],e.startY=t[1],null}case"maps.setGridDistance":return E().gridDistance=c,null;case"maps.setGridDiagonal":return E().gridDiagonal=c,null;case"maps.setLightColour":return E().lightColour=c,null;case"maps.setData":return E().data[c.key]=c.data,null;case"maps.removeData":return delete E().data[c],null;case"maps.addLayer":{const t=f(c);return E().children?.push({name:t,hidden:!1,locked:!1,tokens:[],walls:[]}),t}case"maps.addLayerFolder":{const[t,e]=d(c),i=f(e);return x(t)?.children?.push({name:i,hidden:!1,locked:!1,children:[]}),t+"/"+i}case"maps.renameLayer":{const t=c;return t.name=(x(t.path)??{name:""}).name=f(t.name),t}case"maps.moveLayer":{const t=c,[e,i]=S(t.from),o=x(t.to);return e?.children&&i&&o?.children&&(e.children.splice(e.children.indexOf(i),1),o.children.splice(t.position,0,i)),null}case"maps.showLayer":{const t=x(c);return t&&(t.hidden=!1),null}case"maps.hideLayer":{const t=x(c);return t&&(t.hidden=!0),null}case"maps.lockLayer":{const t=x(c);return t&&(t.locked=!0),null}case"maps.unlockLayer":{const t=x(c);return t&&(t.locked=!1),null}case"maps.addToMask":return E().masks.push(c),null;case"maps.removeFromMask":return E().masks.splice(c,1),null;case"maps.setMask":{const t=E();return t.masks=c.masks,t.baseOpaque=c.baseOpaque,null}case"maps.removeLayer":{const[t,e]=S(c);return t&&e&&t.children?.splice(t.children.indexOf(e),1),null}case"maps.addToken":{const t=c,o=E(),s=x(t.path);return s&&(t.token.id&&!(t.token.id in o[i])||(t.token.id=++o[e]),s.tokens?.push(t.token),o[i][t.token.id]={layer:s,token:t.token}),t.token.id}case"maps.removeToken":{const t=E(),{layer:e,token:o}=t[i][c];return e.tokens?.splice(e.tokens.indexOf(o),1),delete t[i][c],null}case"maps.setToken":return C(c),null;case"maps.setTokenMulti":for(const t of c)C(t);return null;case"maps.setTokenLayerPos":{const t=E()[i][c.id],e=x(c.to);return e?.tokens&&t.layer.tokens&&(t.layer.tokens?.splice(t.layer.tokens.indexOf(t.token),1),e.tokens?.splice(c.newPos,0,t.token),t.layer=e),null}case"maps.shiftLayer":{const t=x(c.path),{dx:e,dy:i}=c;if(t){for(const o of t.tokens??[])o.x+=e,o.y+=i;for(const o of t.walls??[])o.x1+=e,o.y1+=i,o.x2+=e,o.y2+=i}return null}case"maps.addWall":{const t=c,e=E(),i=x(t.path);return i&&((t.wall.id in e.walls||!t.wall.id||t.wall.id>e[o])&&(t.wall.id=++e[o]),i.walls?.push(t.wall),e[s][t.wall.id]={layer:i,wall:t.wall}),t.wall.id}case"maps.removeWall":{const t=E(),{layer:e,wall:i}=t[s][c];return e.walls?.splice(e.walls.indexOf(i)),delete t[s][i.id],null}case"maps.modifyWall":{const t=c,{wall:e}=E()[s][t.id];return Object.assign(e,t),null}case"maps.moveWall":{const t=E()[s][c.id],e=x(c.path);return e?.walls&&t.layer.walls&&(t.layer.walls.splice(t.layer.walls.indexOf(t.wall),1),e.walls.push(t.wall),t.layer=e),null}case"music.list":return Object.values(t.music);case"music.new":{const e=l(c,(e=>!Object.values(t.music).some((t=>t.name===e)))),i=++t[r];return t.music[i]={name:e,tracks:[],volume:0,playTime:0},{id:i,name:e}}case"music.rename":return t.music[c.id].name=l(c.name,(e=>{for(const i in t.music)if(t.music[i].name===e)return!1;return!0}));case"music.remove":return delete t.music[c],null;case"music.copy":{const e=l(c.name,(e=>!Object.values(t.music).some((t=>t.name===e)))),i=++t[r],o=t.music[c.id];return t.music[i]={name:e,tracks:JSON.parse(JSON.stringify(o.tracks)),volume:o.volume,playTime:0},{id:i,name:e}}case"music.setVolume":return t.music[c.id].volume=c.volume,null;case"music.playPack":return t.music[c.id].playTime=c.playTime||Math.floor(Date.now()/1e3);case"music.stopPack":return t.music[c].playTime=0,null;case"music.stopAllPacks":for(const e in t.music)t.music[e].playTime=0;return null;case"music.addTracks":{const e=t.music[c.id];for(const t of c.tracks)e.tracks.push({id:t,volume:255,repeat:0});return null}case"music.removeTrack":return t.music[c.id].tracks.splice(c.track,1),null;case"music.setTrackVolume":return t.music[c.id].tracks[c.track].volume=c.volume,null;case"music.setTrackRepeat":return t.music[c.id].tracks[c.track].repeat=c.repeat,null;case"characters.create":{const e=c,i=++t[n];return t.characterData[i]=e.data,{id:i,path:M(t.characters.items,e.path,i)}}case"characters.modify":{const e=c,i=t.characterData[e.id];for(const[t,o]of Object.entries(e.setting))i[t]=o;for(const t of e.removing)delete i[t];return null}case"characters.get":{const e=t.characterData[c];if(!e)return null;if(t.admin)return e;const i={};for(const[t,o]of Object.entries(e))i[t]=o;return i}case"plugins.list":return t.plugins;case"plugins.enable":case"plugins.disable":break;case"plugins.set":{const e=c,i=t.plugins[e.id];for(const[t,o]of Object.entries(e.setting))i.data[t]=o;for(const t of e.removing)delete i.data[t];return null}case"imageAssets.list":return t.images;case"imageAssets.createFolder":return L(t.images,c);case"imageAssets.move":return m(t.images,c.from,c.to);case"imageAssets.moveFolder":return y(t.images,c.from,c.to);case"imageAssets.remove":return N(t.images,c);case"imageAssets.removeFolder":return D(t.images,c);case"imageAssets.copy":return p(t.images,c.id,c.path);case"audioAssets.list":return t.audio;case"audioAssets.createFolder":return L(t.audio,c);case"audioAssets.move":return m(t.audio,c.from,c.to);case"audioAssets.moveFolder":return y(t.audio,c.from,c.to);case"audioAssets.remove":return N(t.audio,c);case"imageAssets.removeFolder":return D(t.audio,c);case"imageAssets.copy":return p(t.audio,c.id,c.path);case"characters.list":return t.characters;case"characters.createFolder":return L(t.characters,c);case"characters.move":return m(t.characters,c.from,c.to);case"characters.moveFolder":return y(t.characters,c.from,c.to);case"characters.remove":return N(t.characters,c);case"characters.removeFolder":return D(t.characters,c);case"characters.copy":{const[e,i]=A(t.characters,c.path),o=t.characterData[c.id],s=++t[n];return e&&o?(t.characterData[s]=JSON.parse(JSON.stringify(o)),{id:s,path:c.path.slice(0,i.length)+M(e.items,i,s)}):null}case"maps.list":return t.maps;case"maps.createFolder":return L(t.maps,c);case"maps.move":return m(t.maps,c.from,c.to);case"maps.moveFolder":return y(t.maps,c.from,c.to);case"maps.remove":return N(t.maps,c);case"maps.removeFolder":return D(t.maps,c);case"maps.copy":{const[e,i]=A(t.maps,c.path),o=t.mapData[c.id],s=++t[a];return e&&o?(t.mapData[s]=JSON.parse(JSON.stringify(o)),{id:s,path:c.path.slice(0,i.length)+M(e.items,i,s)}):null}}return null}#t(t,e){setTimeout((()=>this.dispatchEvent(new MessageEvent("message",{data:JSON.stringify({id:t,result:e})}))))}close(){}}},XMLHttpRequest:{value:class extends EventTarget{#i={addEventListener:(t,e)=>{}};#o="";#s=-1;response;responseType="";readyState=4;responseText="Bad Upload";status=200;get upload(){return this.#i}abort(){this.#s>=0&&(clearTimeout(this.#s),this.#s=-1)}open(t,e){this.#o=e}setRequestHeader(t,e){}overrideMimeType(t){}send(e){this.#s=setTimeout((()=>{this.#s=-1;const i=new URL(this.#o,"file:///"),o=I(h(i.pathname,"/"),"/"),s=Array.from(i.searchParams).find((([t])=>"path"===t))?.[1]??"";if(("images"===o||"audio"===o)&&e instanceof FormData){const i=[],a=this.response=[];for(const n of e.getAll("asset"))if(n instanceof File){let e;const r=new FileReader;i.push(new Promise((t=>e=t))),r.addEventListener("load",(()=>{const i=t.urls[o].push(r.result)-1;a.push({id:i,name:M(c(t[o],s).items,n.name,i)}),e()})),r.readAsDataURL(n)}Promise.all(i).then((()=>this.dispatchEvent(new Event("readystatechange"))))}else this.status=400,this.dispatchEvent(new Event("readystatechange"))}))}}},localStorage:{value:new class{getItem(e){return t.localStorage[e]??null}setItem(e,i){t.localStorage[e]=i}removeItem(e){delete t.localStorage[e]}}},saveData:{value:()=>console.log(t)}})}Object.defineProperty(globalThis,"include",{value:(()=>{const t=new Map([["/adminMap.js",["default",()=>Vh],["dragLighting",()=>Fh],["mapLoadReceive",()=>Hh],["mapLoadSend",()=>Bh],["selectToken",()=>$h]],["/assets.js",["audioAssetName",()=>td],["audioIDtoURL",()=>Md],["dragAudio",()=>nd],["dragAudioFiles",()=>ad],["dragImage",()=>rd],["dragImageFiles",()=>sd],["imageAssetName",()=>ed],["imageIDtoURL",()=>ld],["uploadAudio",()=>od],["uploadImages",()=>id]],["/characterList.js",["Character",()=>Kh],["getCharacterName",()=>iT]],["/characters.js",["characterIcon",()=>Eh],["dragCharacter",()=>ph],["edit",()=>wh]],["/colours.js",["Colour",()=>zn],["ColourSetting",()=>Yn],["colourPicker",()=>Gn],["dragColour",()=>Un],["hex2Colour",()=>_n],["makeColourPicker",()=>Rn],["noColour",()=>Pn]],["/folders.js",["DragFolder",()=>Hg],["DraggableItem",()=>Zg],["Folder",()=>Bg],["Item",()=>Qg],["Root",()=>Fg]],["/help.js",["default",()=>CM]],["/ids.js",["adminHideLight",()=>bs],["cursors",()=>qs],["dragOver",()=>Ps],["folderDragging",()=>_s],["folders",()=>Gs],["foldersItem",()=>Rs],["gridPattern",()=>Xs],["hiddenLayer",()=>Bs],["hideZoomSlider",()=>Fs],["imageIcon",()=>Ws],["invertID",()=>vs],["itemControl",()=>Us],["layerGrid",()=>Zs],["layerLight",()=>Qs],["lighting",()=>Ks],["mapID",()=>Hs],["mapMask",()=>Js],["psuedoLink",()=>Ys],["selectedLayerID",()=>js],["settingsTicker",()=>Os],["tokenSelector",()=>zs],["zoomSliderID",()=>$s],["zooming",()=>Vs]],["/keys.js",["getKey",()=>jM],["getKeyIDs",()=>YM],["getKeyName",()=>zM],["registerKeyEvent",()=>vM],["setKey",()=>bM]],["/language.js",["default",()=>oa],["language",()=>ta],["languages",()=>ia],["makeLangPack",()=>ea]],["/layerList.js"],["/lib/bbcode.js",["default",()=>qg],["isCloseTag",()=>Kg],["isOpenTag",()=>Vg],["isString",()=>Jg],["process",()=>Xg],["text",()=>$g]],["/lib/bbcode_tags.js",["all",()=>vc],["audio",()=>wc],["b",()=>ic],["center",()=>lc],["centre",()=>rc],["code",()=>xc],["color",()=>hc],["colour",()=>Ic],["font",()=>uc],["full",()=>cc],["h1",()=>Ac],["h2",()=>Lc],["h3",()=>mc],["h4",()=>yc],["h5",()=>Nc],["h6",()=>Dc],["highlight",()=>dc],["hr",()=>pc],["i",()=>oc],["img",()=>fc],["justify",()=>gc],["left",()=>nc],["list",()=>kc],["none",()=>bc],["quote",()=>Cc],["right",()=>Mc],["s",()=>ac],["size",()=>Tc],["table",()=>Sc],["text",()=>Oc],["u",()=>sc],["url",()=>Ec]],["/lib/bind.js",["Binding",()=>w],["Bound",()=>x],["default",()=>S]],["/lib/conn.js",["HTTPRequest",()=>Ss],["WS",()=>Cs],["WSConn",()=>ks]],["/lib/css.js",["add",()=>Y],["at",()=>_],["default",()=>C],["id",()=>P],["ids",()=>G],["mixin",()=>U],["render",()=>R]],["/lib/dom.js",["amendNode",()=>I],["attr",()=>g],["bindElement",()=>h],["child",()=>M],["clearNode",()=>N],["createDocumentFragment",()=>y],["event",()=>m],["eventCapture",()=>u],["eventOnce",()=>T],["eventPassive",()=>A],["eventRemove",()=>L],["isChildren",()=>d],["value",()=>c]],["/lib/drag.js",["DragFiles",()=>Oi],["DragTransfer",()=>ki],["setDragEffect",()=>vi]],["/lib/events.js",["hasKeyEvent",()=>Mt],["keyEvent",()=>nt],["mouseDragEvent",()=>lt],["mouseMoveEvent",()=>rt],["mouseX",()=>st],["mouseY",()=>at]],["/lib/fraction.js",["default",()=>dd]],["/lib/html.js",["a",()=>ct],["abbr",()=>dt],["address",()=>It],["area",()=>ht],["article",()=>Tt],["aside",()=>ut],["audio",()=>At],["b",()=>Lt],["base",()=>mt],["bdi",()=>yt],["bdo",()=>Nt],["blockquote",()=>Dt],["body",()=>pt],["br",()=>Et],["button",()=>wt],["canvas",()=>ft],["caption",()=>xt],["cite",()=>St],["code",()=>Ct],["col",()=>kt],["colgroup",()=>Ot],["data",()=>vt],["datalist",()=>bt],["dd",()=>jt],["del",()=>zt],["details",()=>Yt],["dfn",()=>_t],["dialog",()=>Pt],["div",()=>Gt],["dl",()=>Rt],["dt",()=>Ut],["em",()=>Wt],["embed",()=>Qt],["fieldset",()=>Zt],["figcaption",()=>Bt],["figure",()=>Ht],["footer",()=>Ft],["form",()=>$t],["h1",()=>Vt],["h2",()=>Kt],["h3",()=>Jt],["h4",()=>Xt],["h5",()=>qt],["h6",()=>te],["head",()=>ee],["header",()=>ie],["hgroup",()=>oe],["hr",()=>se],["html",()=>ae],["i",()=>ne],["iframe",()=>re],["img",()=>le],["input",()=>Me],["ins",()=>ge],["kbd",()=>ce],["label",()=>de],["legend",()=>Ie],["li",()=>he],["link",()=>Te],["main",()=>ue],["map",()=>Ae],["mark",()=>Le],["menu",()=>me],["meta",()=>ye],["meter",()=>Ne],["nav",()=>De],["noscript",()=>pe],["ns",()=>gt],["object",()=>Ee],["ol",()=>we],["optgroup",()=>fe],["option",()=>xe],["output",()=>Se],["p",()=>Ce],["picture",()=>ke],["pre",()=>Oe],["progress",()=>ve],["q",()=>be],["rp",()=>je],["rt",()=>ze],["ruby",()=>Ye],["s",()=>_e],["samp",()=>Pe],["script",()=>Ge],["section",()=>Re],["select",()=>Ue],["slot",()=>We],["small",()=>Qe],["source",()=>Ze],["span",()=>Be],["strong",()=>He],["style",()=>Fe],["sub",()=>$e],["summary",()=>Ve],["sup",()=>Ke],["table",()=>Je],["tbody",()=>Xe],["td",()=>qe],["template",()=>ti],["textarea",()=>ei],["tfoot",()=>ii],["th",()=>oi],["thead",()=>si],["time",()=>ai],["title",()=>ni],["tr",()=>ri],["track",()=>li],["u",()=>Mi],["ul",()=>gi],["vare",()=>ci],["video",()=>di],["wbr",()=>Ii]],["/lib/inter.js",["Pickup",()=>_i],["Pipe",()=>bi],["Requester",()=>ji],["Subscription",()=>zi],["WaitGroup",()=>Yi]],["/lib/load.js",["default",()=>sa]],["/lib/menu.js",["ItemElement",()=>Bi],["MenuElement",()=>Zi],["SubMenuElement",()=>Hi],["item",()=>$i],["menu",()=>Fi],["submenu",()=>Vi]],["/lib/misc.js",["addAndReturn",()=>mi],["autoFocus",()=>Ni],["checkInt",()=>Ti],["isInt",()=>hi],["mod",()=>ui],["pushAndReturn",()=>Li],["queue",()=>yi],["setAndReturn",()=>Ai],["text2DOM",()=>Di]],["/lib/nodes.js",["NodeArray",()=>Io],["NodeMap",()=>ho],["addNodeRef",()=>qi],["noSort",()=>Ji],["node",()=>Ki],["stringSort",()=>Xi]],["/lib/rpc.js",["RPC",()=>Ma],["RPCError",()=>la]],["/lib/settings.js",["BoolSetting",()=>wi],["IntSetting",()=>fi],["JSONSetting",()=>Ci],["NumberSetting",()=>xi],["StringSetting",()=>Si]],["/lib/svg.js",["a",()=>Ao],["animate",()=>Lo],["animateMotion",()=>mo],["animateTransform",()=>yo],["circle",()=>No],["clipPath",()=>Do],["defs",()=>po],["desc",()=>Eo],["ellipse",()=>wo],["feBlend",()=>fo],["feColorMatrix",()=>xo],["feComponentTransfer",()=>So],["feComposite",()=>Co],["feConvolveMatrix",()=>ko],["feDiffuseLighting",()=>Oo],["feDisplacementMap",()=>vo],["feDistantLight",()=>bo],["feDropShadow",()=>jo],["feFlood",()=>zo],["feFuncA",()=>Yo],["feFuncB",()=>_o],["feFuncG",()=>Po],["feFuncR",()=>Go],["feGaussianBlur",()=>Ro],["feImage",()=>Uo],["feMerge",()=>Wo],["feMergeNode",()=>Qo],["feMorphology",()=>Zo],["feOffset",()=>Bo],["fePointLight",()=>Ho],["feSpecularLighting",()=>Fo],["feSpotLight",()=>$o],["feTile",()=>Vo],["feTurbulence",()=>Ko],["filter",()=>Jo],["foreignObject",()=>Xo],["g",()=>qo],["image",()=>ts],["line",()=>es],["linearGradient",()=>is],["marker",()=>os],["mask",()=>ss],["metadata",()=>as],["mpath",()=>ns],["ns",()=>To],["path",()=>rs],["pattern",()=>ls],["polygon",()=>Ms],["polyline",()=>gs],["radialGradient",()=>cs],["rect",()=>ds],["script",()=>Is],["set",()=>hs],["stop",()=>Ts],["style",()=>us],["svg",()=>As],["svgData",()=>uo],["switche",()=>Ls],["symbol",()=>ms],["text",()=>ys],["textPath",()=>Ns],["title",()=>Ds],["tspan",()=>ps],["use",()=>Es],["view",()=>ws]],["/lib/windows.js",["DesktopElement",()=>In],["ShellElement",()=>dn],["WindowElement",()=>hn],["defaultIcon",()=>yn],["desktop",()=>un],["setDefaultIcon",()=>Ln],["setLanguage",()=>mn],["shell",()=>Tn],["windows",()=>An]],["/lib/windows_taskmanager.js",["DesktopElement",()=>In],["ShellElement",()=>En],["WindowElement",()=>hn],["defaultIcon",()=>yn],["desktop",()=>un],["setDefaultIcon",()=>Ln],["setLanguage",()=>mn],["shell",()=>wn],["windows",()=>An]],["/map.js",["addLayer",()=>gI],["addLayerFolder",()=>rI],["centreOnGrid",()=>DI],["default",()=>EI],["getLayer",()=>sI],["getParentLayer",()=>aI],["isSVGFolder",()=>iI],["isSVGLayer",()=>oI],["isTokenDrawing",()=>TI],["isTokenImage",()=>hI],["layerList",()=>Qd],["mapData",()=>Zd],["mapView",()=>pI],["moveLayer",()=>cI],["normaliseWall",()=>uI],["panZoom",()=>mI],["removeLayer",()=>MI],["renameLayer",()=>lI],["root",()=>Bd],["screen2Grid",()=>yI],["setLayerVisibility",()=>nI],["setLightColour",()=>II],["setMapDetails",()=>dI],["showSignal",()=>LI],["splitAfterLastSlash",()=>tI],["updateLight",()=>AI],["walkLayers",()=>eI],["wallList",()=>Hd],["zoom",()=>NI]],["/mapList.js",["dragMap",()=>hT]],["/map_fns.js",["checkSelectedLayer",()=>YI],["doLayerAdd",()=>th],["doLayerFolderAdd",()=>eh],["doLayerMove",()=>ih],["doLayerRename",()=>oh],["doLayerShift",()=>Mh],["doLockUnlockLayer",()=>qI],["doMapChange",()=>KI],["doMapDataRemove",()=>Th],["doMapDataSet",()=>hh],["doMaskAdd",()=>uh],["doMaskRemove",()=>Ah],["doMaskSet",()=>Lh],["doSetLightColour",()=>JI],["doShowHideLayer",()=>XI],["doTokenAdd",()=>sh],["doTokenMoveLayerPos",()=>ah],["doTokenRemove",()=>lh],["doTokenSet",()=>nh],["doTokenSetMulti",()=>rh],["doWallAdd",()=>gh],["doWallModify",()=>dh],["doWallMove",()=>Ih],["doWallRemove",()=>ch],["getToken",()=>zI],["layersRPC",()=>yh],["setLayer",()=>_I],["snapTokenToGrid",()=>mh],["tokenMousePos",()=>PI],["waitAdded",()=>GI],["waitFolderAdded",()=>UI],["waitFolderRemoved",()=>WI],["waitLayerHide",()=>ZI],["waitLayerLock",()=>BI],["waitLayerPositionChange",()=>FI],["waitLayerRename",()=>$I],["waitLayerSelect",()=>VI],["waitLayerShow",()=>QI],["waitLayerUnlock",()=>HI],["waitRemoved",()=>RI]],["/map_lighting.js",["intersection",()=>wd],["makeLight",()=>fd]],["/map_tokens.js",["Lighting",()=>_M],["SQRT3",()=>JM],["SVGDrawing",()=>UM],["SVGShape",()=>RM],["SVGToken",()=>GM],["definitions",()=>XM],["deselectToken",()=>VM],["masks",()=>KM],["outline",()=>FM],["outlineRotationClass",()=>$M],["selected",()=>HM],["tokenSelected",()=>QM],["tokenSelectedReceive",()=>ZM],["tokens",()=>BM]],["/messaging.js",["bbcodeDrag",()=>Gc],["parseBBCode",()=>Pc],["register",()=>Yc],["registerTag",()=>_c]],["/musicPacks.js",["dragMusicPack",()=>xT],["open",()=>ST]],["/plugins.js",["addLights",()=>dg],["addPlugin",()=>ag],["addWalls",()=>cg],["askReload",()=>rg],["characterEdit",()=>sg],["default",()=>Ag],["drawingClass",()=>ug],["getSettings",()=>ng],["handleWalls",()=>Ig],["menuItems",()=>gg],["pluginName",()=>ig],["settings",()=>og],["shapeClass",()=>Tg],["tokenClass",()=>hg],["tokenContext",()=>lg],["tokenDataFilter",()=>Mg]],["/rpc.js",["addCharacterDataChecker",()=>qn],["addMapDataChecker",()=>Xn],["addTokenDataChecker",()=>tr],["combined",()=>Kn],["handleError",()=>er],["inited",()=>ir],["internal",()=>Vn],["isAdmin",()=>Hn],["isUser",()=>Fn],["rpc",()=>Jn],["timeShift",()=>$n]],["/script.js"],["/settings.js",["autosnap",()=>Lg],["enableAnimation",()=>fg],["hiddenLayerOpacity",()=>kg],["hiddenLayerSelectedOpacity",()=>Og],["hideMenu",()=>mg],["invert",()=>yg],["measureTokenMove",()=>wg],["miniTools",()=>Ng],["musicSort",()=>xg],["panelOnTop",()=>Eg],["scrollAmount",()=>Sg],["tabIcons",()=>Dg],["undoLimit",()=>Cg],["zoomSlider",()=>pg]],["/shared.js",["characterData",()=>Xa],["cloneObject",()=>Ja],["enterKey",()=>Fa],["getCharacterToken",()=>qa],["labels",()=>Ka],["loading",()=>on],["mapLoadedReceive",()=>Va],["mapLoadedSend",()=>$a],["menuItems",()=>sn],["resetCharacterTokens",()=>tn],["walls",()=>en]],["/symbols.js",["addSymbol",()=>da],["clearRight",()=>Ba],["clearRightStr",()=>Ha],["copy",()=>Ia],["copyStr",()=>ha],["folder",()=>Ta],["folderStr",()=>ua],["lightGrid",()=>Ga],["lightGridStr",()=>Ra],["lightOnOff",()=>_a],["lightOnOffStr",()=>Pa],["lock",()=>Qa],["lockStr",()=>Za],["newFolder",()=>Aa],["newFolderStr",()=>La],["playStatus",()=>ma],["playStatusStr",()=>ya],["popout",()=>Na],["popoutStr",()=>Da],["remove",()=>pa],["removeStr",()=>Ea],["rename",()=>wa],["renameStr",()=>fa],["share",()=>Ua],["shareStr",()=>Wa],["spinner",()=>xa],["spinnerStr",()=>Sa],["stop",()=>Ca],["stopStr",()=>ka],["symbols",()=>ca],["userSelected",()=>Oa],["userSelectedStr",()=>va],["userVisible",()=>ba],["userVisibleStr",()=>ja],["visibility",()=>za],["visibilityStr",()=>Ya]],["/tools.js",["addTool",()=>kd],["defaultTool",()=>Cd],["disable",()=>vd],["ignore",()=>Od],["isDefaultTool",()=>Ud],["marker",()=>bd],["optionsWindow",()=>Rd],["toolMapMouseDown",()=>_d],["toolMapMouseOver",()=>Gd],["toolMapWheel",()=>Pd],["toolTokenMouseDown",()=>jd],["toolTokenMouseOver",()=>Yd],["toolTokenWheel",()=>zd]],["/tools_draw.js"],["/tools_mask.js"],["/tools_measure.js",["measureDistance",()=>Qh],["startMeasurement",()=>Wh],["stopMeasurement",()=>Zh]],["/tools_move.js"],["/tools_multiplace.js"],["/tools_wall.js"],["/undo.js",["default",()=>SI]],["/windows.js",["checkWindowData",()=>jn],["desktop",()=>On],["getWindowData",()=>bn],["loadingWindow",()=>Cn],["shell",()=>vn],["windows",()=>kn]]].map((([t,...e])=>[t,Object.freeze(Object.defineProperties({},Object.fromEntries(e.map((([t,e])=>[t,{enumerable:!0,get:e}])))))]))),e=new Map([["/plugins/5e.js",async()=>{const[t,e,i,o,s,a,n,r,l,M,g,c,d,I,h,T,u,A,L,m,y,N,D,p,E]=await Promise.all(["/lib/bind.js","/lib/css.js","/lib/dom.js","/lib/html.js","/lib/menu.js","/lib/misc.js","/lib/nodes.js","/lib/settings.js","/lib/svg.js","/adminMap.js","/assets.js","/colours.js","/ids.js","/keys.js","/language.js","/map.js","/map_fns.js","/map_lighting.js","/map_tokens.js","/plugins.js","/rpc.js","/settings.js","/shared.js","/symbols.js","/windows.js"].map(include));class w extends L.Lighting{wallInteraction(t,e,i,o,s,a,n=!1){if(n&&a<=this.lightStages[0]){const{r:a,g:n,b:r,a:l}=s,M=255-Math.round((255-l)/255*(a+n+r)/765*(255-this.lightColours[0][0].r)),g=new c.Colour(M,M,M);return new w(t,e,i,o,[[g],[g]],this.lightStages,this.lightTimings)}return null}createLightPolygon(t){return l.polygon({points:t,fill:this.lightColours[0][0].toHexString()})}}let f;const x=Symbol("select"),S=Symbol("unselect"),C=Symbol("updateData"),k=h.makeLangPack({ARMOUR_CLASS:"Armour Class",CONDITION_BANE:"Bane",CONDITION_BLESSED:"Blessed",CONDITION_BLINDED:"Blinded",CONDITION_BLINK:"Blink",CONDITION_BLUR:"Blur",CONDITION_BURNING:"Burning",CONDITION_CHARMED:"Charmed",CONDITION_CONCENTRATING:"Concentrating",CONDITION_CONFUSED:"Confused",CONDITION_DEAD:"Dead",CONDITION_DEAFENED:"Deafened",CONDITION_DYING:"Dying",CONDITION_EXHAUSTED:"Exhausted",CONDITION_FLYING:"Flying",CONDITION_FRIGHTENED:"Frightened",CONDITION_GRAPPLED:"Grappled",CONDITION_GUIDANCE:"Guidance",CONDITION_HASTE:"Haste",CONDITION_HEXED:"Hex",CONDITION_HIDEOUS_LAUGHTER:"Hideous Laughter",CONDITION_HUNTERS_MARK:"Hunters' Mark",CONDITION_INCAPACITATED:"Incapacitated",CONDITION_INSPIRED:"Inspired",CONDITION_INVISIBLE:"Invisible",CONDITION_LEVITATE:"Levitating",CONDITION_MIRROR_IMAGE:"Mirror Image",CONDITION_PARALYZED:"Paralyzed",CONDITION_PETRIFIED:"Petrified",CONDITION_POISONED:"Poisoned",CONDITION_PRONE:"Prone",CONDITION_RAGE:"Rage",CONDITION_RECKLESS:"Reckless",CONDITION_RESTRAINED:"Restrained",CONDITION_SANCTUARY:"Sanctuary",CONDITION_SLOW:"Slow",CONDITION_STUNNED:"Stunned",CONDITION_UNCONSCIOUS:"Unconscious",CONDITIONS:"Conditions",DARKVISION:"Darkvision",DESATURATE_CONDITIONS:"Greyscale Conditions",HIDE_CONDITIONS:"Hide Token Conditions",HIGHLIGHT_COLOUR:"Token Highlight Colour",HP_CURRENT:"Current Hit Points",HP_CURRENT_ENTER:"Please enter current Hit Points",HP_MAX:"Maximum Hit Points",INITIATIVE:"Initiative",INITIATIVE_ADD:"Add Initiative",INITIATIVE_ADV:"Advantage",INITIATIVE_ASC:"Sort Initiative Ascending",INITIATIVE_CHANGE:"Change Initiative",INITIATIVE_DESC:"Sort Initiative Descending",INITIATIVE_ENTER:"Enter initiative",INITIATIVE_ENTER_LONG:"Please enter the initiative value for this token",INITIATIVE_MOD:"Initiative Mod",INITIATIVE_NEXT:"Next",INITIATIVE_PREV:"Previous",INITIATIVE_REMOVE:"Remove Initiative",IS_PLAYER:"Is Player",KEY_HEALTH:"Health Modification Key (5E)",KEY_INITIATIVE:"Initiative Key (5E)",NOTES:"Notes",SHAPECHANGE:"Shapechange",SHAPECHANGE_5E:"Shapechange (5E)",SHAPECHANGE_CHANGE:"Change to Selected Token",SHAPECHANGE_INITIAL_RESTORE:"Restore Initial Token",SHAPECHANGE_TITLE:"Shapechange Settings",SHAPECHANGE_TOKEN_ADD:"Add Token",SHAPECHANGE_TOKEN_CATEGORY:"Add Category",SHAPECHANGE_TOKEN_CATEGORY_LONG:"Please enter a name for this category of Shapechanges.",SHAPECHANGE_TOKEN_CATEGORY_REMOVE:"Remove Shapechange Category",SHAPECHANGE_TOKEN_CATEGORY_REMOVE_LONG:"Are you sure you wish to Remove this Shapechange Category?",SHAPECHANGE_TOKEN_CATEGORY_RENAME:"Rename Shapechange Category",SHAPECHANGE_TOKEN_CATEGORY_RENAME_LONG:"Please enter a new name for this Shapechange category.",SHAPECHANGE_TOKEN_NAME:"Enter Name",SHAPECHANGE_TOKEN_NAME_LONG:"Please enter a name for the selected token.",SHAPECHANGE_TOKEN_REMOVE:"Remove Shapechange Token",SHAPECHANGE_TOKEN_REMOVE_LONG:"Are you sure you wish to Remove this Shapechange Token?",SHAPECHANGE_TOKEN_RENAME:"Rename Shapechange Token",SHAPECHANGE_TOKEN_RENAME_LONG:"Please enter a new name for this token.",SHOW_AC:"Show Token Armour Class",SHOW_HP:"Show Token Hit Points",SHOW_NAMES:"Show Token Names",TOGGLE_CONDITION:"Toggle Condition",TOKEN_SELECTED:"Selected",TOKENS_UNSELECTED:"Unselected"},{"en-US":{ARMOUR_CLASS:"Armor Class",DESATURATE_CONDITIONS:"Grayscale Conditions",HIGHLIGHT_COLOUR:"Token Highlight Color",SHOW_AC:"Show Token Armor Class"}}),O=m.pluginName({url:"/plugins/5e.js"}),[v,b,j,z,Y,_,P,G,R,U,W,Q,Z,B,H,F,$,V,K,J,X,q,tt,et,it,ot,st,at,nt,rt,lt,Mt,gt,ct,dt,It,ht,Tt,ut,At,Lt,mt,yt,Nt,Dt,pt,Et,wt]=e.ids(48),ft=e.ids(37),xt=l.svg({viewBox:"0 0 2 2"},l.polygon({points:"2,2 0,2 1,0",fill:"currentColor"})),St=l.svg({viewBox:"0 0 2 2"},l.polygon({points:"0,0 2,0 1,2",fill:"currentColor"})),Ct=l.svg({viewBox:"0 0 2 2"},l.polygon({points:"0,0 2,1 0,2",fill:"currentColor"})),kt=l.svg({viewBox:"0 0 2 2"},l.polygon({points:"2,0 0,1 2,2",fill:"currentColor"})),Ot=Object.keys(k).filter((t=>t.startsWith("CONDITION_"))),vt=(t,e)=>t.initiative-e.initiative,bt=(t,e)=>e.initiative-t.initiative,jt=t=>t instanceof f&&!t.isPattern&&L.tokens.has(t.id),zt=new n.NodeArray(o.ul({id:b})),Yt=()=>{0===zt.length?u.doMapDataRemove("5e-initiative"):u.doMapDataSet("5e-initiative",zt.map((t=>({id:t.token.id,initiative:t.initiative}))))},_t=E.windows({"window-icon":`data:image/svg+xml,%3Csvg xmlns="${l.ns}" viewBox="0 0 100 100"%3E%3Cpath d="M92.5,7 l-30,30 h30 z" fill="%23000" stroke="%23fff" stroke-linejoin="round" /%3E%3Ccircle cx="50" cy="50" r="40" fill="none" stroke="%23fff" stroke-width="12" stroke-dasharray="191 1000" stroke-dashoffset="-29" /%3E%3Ccircle cx="50" cy="50" r="40" fill="none" stroke="%23000" stroke-width="10" stroke-dasharray="191 1000" stroke-dashoffset="-30" /%3E%3C/svg%3E`,"window-title":k.INITIATIVE,style:"--window-left: 0px; --window-top: calc(100% - 400px); --window-width: 200px; --window-height: 400px","window-data":"5e-window-data","hide-close":!0,"hide-maximise":!0,resizable:!0},o.div({id:v},[y.isAdmin?o.div([o.button({title:k.INITIATIVE_ASC,onclick:()=>{zt.sort(vt),zt.sort(n.noSort),Yt()}},xt),o.button({title:k.INITIATIVE_DESC,onclick:()=>{zt.sort(bt),zt.sort(n.noSort),Yt()}},St),o.br(),o.button({title:k.INITIATIVE_PREV,onclick:()=>{const t=zt.pop();t&&(zt.unshift(t),Yt())}},kt),o.button({title:k.INITIATIVE_NEXT,onclick:()=>{const t=zt.shift();t&&(zt.push(t),Yt())}},Ct)]):[],zt[n.node]])),Pt=new Set,Gt=(t,e,s)=>(Pt.add(t.id),zt.push({token:t,hidden:s,initiative:e,[n.node]:o.li({style:s&&!y.isAdmin?"display: none":void 0,onmouseover:()=>{t[n.node].parentNode&&(i.amendNode(Wt,{width:t.width,height:t.height,transform:t.transformString()}),t[n.node].parentNode.insertBefore(Wt,t[n.node]))},onmouseleave:()=>Wt.remove()},[o.img({src:g.imageIDtoURL(t.src),onclick:e=>{T.centreOnGrid(t.x+(t.width>>1),t.y+(t.height>>1)),y.isAdmin&&e.ctrlKey&&M.selectToken(t)}}),o.span(t.getData("name")??""),o.span(y.isAdmin?{class:q,onclick:()=>{Rt([t.id,null]),Yt(),Wt.remove()}}:{},e+"")])})),Rt=t=>{const{"5e-initiative":e}=T.mapData.data,o=new Set;if(zt.splice(0,zt.length),Pt.clear(),T.walkLayers(((t,e)=>{e&&o.add(t.path)})),e)for(const i of e){const e=L.tokens.get(i.id);if(e){const{layer:s,token:a}=e;if(a instanceof f){let e=i.initiative;const n=o.has(s.path);if(t&&t[0]===i.id){const i=t[1];if(t=void 0,null===i)continue;e=i}n&&!y.isAdmin||Gt(a,e,n)}}}if(t&&null!==t[1]){const{token:e,layer:i}=L.tokens.get(t[0]);e instanceof f&&Gt(e,t[1],o.has(i.path))}0===zt.length?_t.remove():_t.parentNode||i.amendNode(E.shell,_t),Zt()},Ut={SHOW_HP:[new r.BoolSetting("5e-show-token-hp").wait((t=>i.amendNode(document.body,{class:{[Y]:!t}}))),new r.BoolSetting("5e-show-selected-hp").wait((t=>i.amendNode(document.body,{class:{[B]:!t}})))],SHOW_AC:[new r.BoolSetting("5e-show-token-ac").wait((t=>i.amendNode(document.body,{class:{[G]:!t}}))),new r.BoolSetting("5e-show-selected-ac").wait((t=>i.amendNode(document.body,{class:{[H]:!t}})))],SHOW_NAMES:[new r.BoolSetting("5e-show-token-names").wait((t=>i.amendNode(document.body,{class:{[U]:!t}}))),new r.BoolSetting("5e-show-selected-names").wait((t=>i.amendNode(document.body,{class:{[F]:!t}})))],HIDE_CONDITIONS:[new r.BoolSetting("5e-hide-token-conditions").wait((t=>i.amendNode(document.body,{class:{[Q]:t}}))),new r.BoolSetting("5e-hide-selected-conditions").wait((t=>i.amendNode(document.body,{class:{[$]:t}})))],DESATURATE_CONDITIONS:[new r.BoolSetting("5e-desaturate-token-conditions").wait((t=>i.amendNode(document.body,{class:{[V]:t}}))),new r.BoolSetting("5e-desaturate-selected-conditions").wait((t=>i.amendNode(document.body,{class:{[K]:t}})))]},Wt=l.rect({"stroke-width":20}),Qt=new c.ColourSetting("5e-hightlight-colour",new c.Colour(255,255,0,127)).wait((t=>{const e=t.toHexString();i.amendNode(Wt,{fill:e,stroke:e,opacity:t.a/255})})),Zt=(()=>{const t=l.g({id:et,fill:"#000"}),e=[[new c.Colour(0,0,0)]],o=[0],s=l.filter({id:pt},l.feColorMatrix({type:"matrix",values:"0 0 0 0 0,0 0 0 0 0,0 0 0 0 0,-0.2125 -0.7154 -0.0721 1 0"})),a=l.filter({id:Et},l.feColorMatrix({type:"matrix",values:"0.5 0 0 0 0.5,0 0.5 0 0 0.5,0 0 0.5 0 0.5,0 0 0 1 0"})),r=l.g(),M=l.clipPath({id:wt}),g=[];L.masks[n.node].firstChild?.after(t),i.amendNode(L.definitions[n.node],[r,M,s,a]);let d=0,I=0,h=[],u=null;return()=>{if(u!==T.mapData)return void(u=T.mapData);d=0,i.clearNode(t),i.clearNode(r),i.clearNode(M);const s=[];zt[0]?.token.getData("5e-player")?s.push(zt[0].token):T.walkLayers(((t,e)=>{if(!e)for(const e of t.tokens)e.getData("5e-player")&&s.push(e)}));let a=T.wallList!==h||s.length!==g.length;if(h=T.wallList,s.length){const{gridSize:c,gridDistance:h,width:u,height:L}=T.mapData,m=c/(h||1),y=[Math.max(u,L)/m,0];a||=m!==I,I=m,i.amendNode(t,[l.rect({width:"100%",height:"100%",fill:"#fff"}),s.map(((t,s)=>{const[n,c]=t.getCentre();if(!a){const[t,e,o,a,l]=g[s];if(n===t&&c===e)return i.amendNode(r,a),i.amendNode(M,l),o}const I=A.makeLight(new w(n,c,n,c,e,y,o),T.wallList,m),h=(t.getData("5e-darkvision")??0)*m,u=[n,c,I,[],[]];if(g.splice(s,1,u),h){const e="DVC-5E_"+d++,[o,s]=t.getCentre();i.amendNode(r,u[3]=l.clipPath({id:e},l.circle({r:h,cx:o,cy:s}))),i.amendNode(M,u[4]=I.map((t=>i.amendNode(t.cloneNode(),{"clip-path":`url(#${e})`,fill:void 0}))))}return I})).flat().sort(((t,e)=>n.stringSort(e.getAttribute("fill")??"",t.getAttribute("fill")??"")))])}}})(),Bt={settings:{fn:o.div([D.labels([k.HIGHLIGHT_COLOUR,": "],c.makeColourPicker(null,k.HIGHLIGHT_COLOUR,(()=>Qt.value),(t=>Qt.set(t)))),o.table({id:tt},[o.thead(o.tr([o.td(),o.th(k.TOKENS_UNSELECTED),o.th(k.TOKEN_SELECTED)])),o.tbody(Object.entries(Ut).map((([t,e])=>o.tr([o.td([k[t],": "]),e.map((t=>o.td(D.labels(o.input({type:"checkbox",class:d.settingsTicker,checked:t.value,onchange:function(){t.set(this.checked)}}),""))))]))))])])},tokenClass:{fn:t=>f=class extends t{#a;#n;#r;#l;#M;#g;#c;#d;#I;#h;#T;constructor(t,e){super(t,e);const i=this.getData("5e-hp-max"),o=this.getData("5e-hp-current"),s=this.getData("5e-ac"),a=Math.min(this.width,this.height)/4;this[n.node]=l.g([this.#a=this[n.node],this.#n=l.g({class:_,transform:`translate(${this.x}, ${this.y})`,style:"color: #000"},[this.#r=l.g({class:P,style:null===o||null===i?"display: none":void 0},[this.#g=l.use({href:`#${at}`,width:a,height:a}),this.#M=l.use({href:`#${st}`,width:a,height:a,"stroke-dasharray":19*Math.PI*.75*Math.min(o||0,i||0)/(i||1)+" 60",style:`color: rgba(${Math.round(255*Math.min(o||0,i||0)/(i||1))}, 0, 0, 1)`}),this.#l=l.text({x:this.width/8,y:"1.2em","text-anchor":"middle",fill:`rgba(${Math.round(255*Math.min(o||0,i||0)/(i||1))}, 0, 0, 1)`},o?.toString()??"")]),this.#c=l.text({class:W,style:"user-select: none",stroke:"#fff","stroke-width":1,fill:"#000",x:this.width/2,y:"1em","text-anchor":"middle"},this.getData("name")??""),this.#d=l.g({class:R,style:null===s?"display: none":void 0},[this.#h=l.use({href:`#${ot}`,width:a,height:a,x:3*this.width/4}),this.#I=l.text({x:7*this.width/8,y:"1.2em","text-anchor":"middle"},s?.toString()??"")]),this.#T=l.g({class:Z})])]),setTimeout((()=>this.#u()),0),this.#A()}#u(){const t=this.width/2,e=this.#c.getComputedTextLength(),o=Math.min(this.width,this.height)/8,s=Math.min(t/e*16,this.height/8);i.amendNode(this.#c,{style:{"font-size":s+"px"},"stroke-width":s/100}),i.amendNode(this.#I,{style:{"font-size":`${o}px`}}),i.amendNode(this.#l,{style:{"font-size":`${o}px`}})}#L(t){const e=this[n.node];this[n.node]=this.#a;const i=t();return this.#a=this[n.node],this[n.node]=e,i}cleanup(){this.#L((()=>super.cleanup()))}uncleanup(){this.#L((()=>super.uncleanup()))}hasLight(){return super.hasLight()||this.getData("5e-player")}at(t,e){return this.#L((()=>super.at(t,e)))}[x](){L.outline.insertAdjacentElement("beforebegin",this.#n)}[S](){this.isPattern||i.amendNode(this[n.node],this.#n)}updateSource(t){this.#L((()=>super.updateSource(t)))}updateNode(){const t=this.#a instanceof SVGRectElement;this.#L((()=>super.updateNode())),this.isPattern?t||this.#n.remove():t&&(L.selected.token===this&&L.outline.insertAdjacentElement("beforebegin",this.#n),this[n.node].replaceWith(this[n.node]=l.g([this.#a,this.#n]))),i.amendNode(this.#a,{width:this.width,height:this.height,transform:this.transformString()}),i.amendNode(this.#n,{transform:`translate(${this.x}, ${this.y})`}),i.amendNode(this.#h,{x:3*this.width/4,width:this.width/4,height:Math.min(this.height,this.width)/4}),i.amendNode(this.#g,{width:this.width/4,height:Math.min(this.width,this.height)/4}),i.amendNode(this.#M,{width:this.width/4,height:Math.min(this.width,this.height)/4}),i.amendNode(this.#c,{x:this.width/2,style:{"font-size":void 0}}),i.amendNode(this.#l,{x:this.width/8}),i.amendNode(this.#I,{x:7*this.width/8}),this.#u(),this.#A()}[C](){const t=this.getData("5e-hp-max"),e=this.getData("5e-hp-current"),o=this.getData("5e-ac"),s=this.getData("name")||"";null===o?i.amendNode(this.#d,{style:"display: none"}):(i.amendNode(this.#d,{style:void 0}),i.clearNode(this.#I,o+"")),null===e||null===t?i.amendNode(this.#r,{style:"display: none"}):(i.amendNode(this.#r,{style:void 0}),i.clearNode(this.#l,{fill:`rgba(${Math.round(255*Math.min(e||0,t||0)/(t||1))}, 0, 0, 1)`},e+""),i.amendNode(this.#M,{"stroke-dasharray":19*Math.PI*.75*Math.min(e||0,t||0)/(t||1)+" 60"})),this.#c.innerHTML!==s&&(i.clearNode(this.#c,{style:{"font-size":void 0}},s),this.#u()),this.#A()}#A(){i.clearNode(this.#T);const t=this.getData("5e-conditions")??[],e=Math.min(this.width,this.height)/4,o=Math.floor(this.width/e);let s=-1,a=0;for(let n=0;n<t.length;n++)t[n]&&(i.amendNode(this.#T,l.use({href:`#${ft[n]}`,x:a*e,y:s*e,width:e,height:e})),a++,a===o&&(a=0,s--));i.amendNode(this.#T,{transform:`translate(0, ${this.height})`})}}},handleWalls:{fn:Zt}},Ht=l.animate({attributeName:"stroke-dashoffset",values:"251.26;0",dur:"1s"}),Ft=l.animateMotion({dur:"1s",begin:-.6},l.mpath({href:"#5e-dying"})),$t=l.circle({r:3,fill:"#fff",stroke:"#000"},Ft);if(e.add({[`#${v}`]:{" svg":{width:"1.5em"}," button":{height:"2em"}},[`#${b}`]:{"list-style":"none",padding:0," li":{display:"grid","grid-template-columns":"4.5em auto 3em","align-items":"center"," span":{"text-align":"center"}}," img":{height:"4em",width:"4em",cursor:"pointer"}},[`.${j}`]:{"padding-left":"1em","box-styling":"padding-box",">menu-item":{display:"list-item","list-style":"none"}},[`.${z}`]:{"list-style":"square !important"},[`.${Y} g .${_} .${P},.${G} g .${_} .${R},.${U} g .${_} .${W},.${Q} g .${_} .${Z},.${B} svg>.${_} .${P},.${H} svg>.${_} .${R},.${F} svg>.${_} .${W},.${$} svg>.${_} .${Z}`]:{visibility:"hidden"},[`.${V} g .${_} .${Z},.${K} svg>.${_} .${Z}`]:{filter:`url(#${it})`},[`.${J},.${J}>button,.${J}>img`]:{width:"100px",height:"100px"},[`#${X}`]:{"border-collapse":"collapse"," td":{"text-align":"center",label:{"font-size":"2em"}}," th, td:not(:first-child)":{border:"1px solid currentColor"}},[`.${q}:hover`]:{"background-color":"#800",cursor:"pointer"}}),N.enableAnimation.wait((t=>{const e={repeatCount:t?"indefinite":1};i.amendNode(Ht,e),i.amendNode(Ft,e),i.amendNode($t,t?{cx:0,cy:0}:{cx:46,cy:38})})),i.amendNode(p.symbols,[l.filter({id:it},l.feColorMatrix({type:"saturate",values:0})),l.symbol({id:ot,viewBox:"0 0 8 9"},l.path({d:"M0,1 q2,0 4,-1 q2,1 4,1 q0,5 -4,8 q-4,-3 -4,-8 z",fill:"#aaa"})),l.symbol({id:at,viewBox:"0 0 20 20"},l.circle({r:9.5,fill:"#eee",stroke:"#888","stroke-width":1,"stroke-linecap":"round","stroke-dasharray":`${19*Math.PI*.75} ${19*Math.PI*.25}`,transform:"translate(10, 10) rotate(135)"})),l.symbol({id:st,viewBox:"0 0 20 20"},l.circle({r:9.5,fill:"transparent",stroke:"#f00","stroke-width":1,"stroke-linecap":"round",transform:"translate(10, 10) rotate(135)"})),[l.symbol({viewBox:"0 0 80 85"},l.g({stroke:"#000","stroke-width":3,"stroke-linecap":"round","stroke-linejoin":"round"},[l.path({d:"M5,37 a1,1 0,0,1 70,0 q4,-1 3,5 q-1,18 -6,10 q0,28 -15,30 q-17,3 -34,0 q-15,-2 -15,-30 q-5,8 -6,-10 q-1,-6 3,-5 z M40,2 v25 m-5,0 h10 m0,-6 h-10 m0,-6 h10 m0,-6 h-10",fill:"#444"}),l.path({d:"M57,82 q-17,3 -34,0 l10,-20 l-20,-18 l5,-20 l5,10 l17,5 l17,-5 l5,-10 l5,20 l-20,18 z",fill:"#fff"}),l.path({d:"M20,38 l15,5 a5,5 0,0,1 -15,-5 z M60,38 l-15,5 a5,5 0,0,0 15,-5 z",fill:"#f00"})])),l.symbol({viewBox:"0 0 11 10.5"},[l.ellipse({cx:5.5,cy:2,rx:5,ry:1.5,fill:"transparent",stroke:"#ff0","stroke-width":1}),l.circle({cx:5.5,cy:5.5,r:5,fill:"#fc8",stroke:"#000","stroke-width":.2}),l.ellipse({cx:5.5,cy:2,rx:5,ry:1.5,fill:"transparent",stroke:"#ff0","stroke-width":1,"stroke-dasharray":10}),l.path({d:"M2,5.5 q1,-1 2,0 m3,0 q1,-1 2,0 M3.5,8.5 q2,1 4,0",fill:"transparent",stroke:"#000","stroke-width":.1,"stroke-linecap":"round"})]),l.symbol({viewBox:"0 0 100 70"},[l.defs(l.mask({id:nt},[l.rect({width:100,height:70,fill:"#fff"}),l.line({x1:10,y1:67,x2:90,y2:3,stroke:"#000","stroke-width":9})])),l.g({mask:`url(#${nt})`},p.visibility()),l.line({x1:10,y1:67,x2:90,y2:3,stroke:"#000","stroke-width":5})]),l.symbol({viewBox:"0 0 100 80"},l.g({stroke:"#000","stroke-width":2},[l.ellipse({cx:50,cy:35,rx:49,ry:34,fill:"#fc8"}),l.path({d:"M10,55 l-8,9 M20,62 l-5,9 M30,66 l-3,10 M40,69 l-1,10 M50,70 v10 M60,69 l1,10 M70,66 l3,10 M80,62 l5,9 M90,55 l8,9","stroke-linecap":"round"})])),l.symbol({viewBox:"0 0 150 90"},[l.defs(l.g({id:rt},[l.circle({cx:50,cy:50,r:48,fill:"#fc8",stroke:"#000"}),l.path({d:"M30,30 v10 a5,5 0,0,0 10,0 v-10 a5,5, 0,0,0 -10,0 M60,30 v10 a5,5 0,0,0 10,0 v-10 a5,5, 0,0,0 -10,0 M20,60 q30,20 60,0 q-30,40 -60,0 Z",fill:"#321"})])),l.use({href:`#${rt}`,style:"opacity: 0.6"}),l.use({href:`#${rt}`,style:"opacity: 0.6",transform:"translate(50, 0)"}),l.use({href:`#${rt}`,style:"opacity: 0.8",transform:"translate(25, 0)"})]),l.symbol({viewBox:"0 0 100 100"},[l.defs(l.radialGradient({id:At,cy:.55,fy:1},[l.stop({offset:"0%","stop-color":"#fff"}),l.stop({offset:"20%","stop-color":"#ff0"}),l.stop({offset:"100%","stop-color":"#f00"})])),l.path({d:"M43,99 c-20,0 -60,-30 -30,-70 q0,20 10,30 c0,-20 25,-40 20,-58 q20,30 20,58 q10,-10 5,-30 q10,15 15,35 q5,-10 0,-25 c40,50 -10,62 -40,60 z M25,20 c-15,30 5,30 0,0 z M60,20 c0,20 10,20 0,0 z",stroke:"#000",fill:`url(#${At})`,"stroke-linejoin":"round"})]),l.symbol({viewBox:"0 0 8.2 8.23"},l.path({d:"M0.1,2.1 a2,2 0,0,1 4,0 a2,2 0,0,1 4,0 q0,3 -4,6 q-4,-3 -4,-6 Z",fill:"#f00",stroke:"#000","stroke-width":.2})),l.symbol({viewBox:"0 0 80 90"},[l.defs([l.path({id:lt,d:"M1,7 v2 a1,1 0,0,1 -2,0 v-2 z",fill:"#000"}),l.g({id:Mt},[l.circle({r:5.5,fill:"none",stroke:"#000","stroke-width":4.5}),Array.from({length:12},((t,e)=>30*e)).map((t=>l.use({href:`#${lt}`,transform:`rotate(${t})`})))])]),l.path({d:"M64,88 c-15,-30 20,-30 15,-60 c-5,-35 -70,-40 -70,10 c-10,10 -10,10 -2,12 c-2,4 -2,4 2,5 c-4,4 -2,4 0,5 c-2,8 -1,10 20,12 q5,0 5,15 z",fill:"#fc8",stroke:"#000","stroke-linejoin":"round"}),l.use({href:`#${Mt}`,transform:"translate(55, 15)"}),l.use({href:`#${Mt}`,transform:"translate(30, 20) scale(1.2)"}),l.use({href:`#${Mt}`,transform:"translate(50, 42) scale(1.8)"})]),l.symbol({viewBox:"0 0 58 100"},l.path({d:"M37,90 a8,8 0,1,0 0,0.1 z M25,70 h8 l1,-20 a11,8 -10,0,0 -30,-45 v15 h5 l2,-8 a9,6 -10,0,1 13,32 Z",stroke:"#000","stroke-width":2,fill:"#fff"})),l.symbol({viewBox:"0 0 84 110"},[l.rect({x:18,y:50,width:47,height:30,fill:"#ffe"}),l.path({d:"M12,52 q-9,-1 -10,-10 a35,35 0,1,1 80,0 q-1,9 -10,10 M32,83 c-10,-20 -27,0 -20,-30 c3,-4.5 -5,-13.5 0,-18 M72,35 c5,4.5 -3,13.5 0,18 c7,30 -10,10 -20,30 M17,72.2 c3,10 0,28 5,30 a40,40 0,0,0 40,0 c5,-2 2,-20 5,-30",fill:"#ffe",stroke:"#000","stroke-width":2,"stroke-linecap":"round"}),l.path({d:"M23,74 c3,5 0,15 5,20 a30,30 0,0,0 28,0 c5,-5 2,-15 5,-20 M32,96 v-13 a25,30 0,0,0 20,0 v13 M37,85 v12 M42,86 v12 M47,85 v12 M32,89.5 a27,30 0,0,0 20,0",fill:"none",stroke:"#000","stroke-width":1}),l.path({d:"M19,50 c0,20 18,10 18,5 c2,-15 -20,-10 -18,-5 M 65,50 c0,20 -18,10 -18,5 c-2,-15 20,-10 18,-5 M41,60 c-10,5 -5,25 0,15 Z M43,60 c10,5 5,25 0,15 Z",fill:"#000"})]),l.symbol({viewBox:"0 0 65 70"},[l.path({d:"M15,25 a20,20 0,1,1 40,10 c0,5 -10,5 -10,10 c-3,15 -10,30 -20,20 M20,25 a10,10 0,1,1 30,10",fill:"#fff",stroke:"#000","stroke-width":3,"stroke-linecap":"round"}),l.path({d:"M5,60 l20,-20 M50,15 l10,-10",stroke:"#000","stroke-width":8})]),l.symbol({viewBox:"0 0 100 54"},[l.defs(l.path({id:gt,d:"M0,32 h20 l3,-10 l6,30 l10,-50 l8,40 l4,-10 l4,15 l6,-25 l3,10 h36",fill:"none","stroke-linejoin":"round","stroke-dasharray":"150 102"},Ht)),l.use({href:`#${gt}`,stroke:"#000","stroke-width":4}),l.use({href:`#${gt}`,stroke:"#f00","stroke-width":2}),$t]),l.symbol({viewBox:"0 0 82 107"},l.g({stroke:"#000",fill:"#fff","stroke-width":1},[l.circle({cx:41,cy:41,r:40,fill:"#fa6"}),l.circle({cx:41,cy:60,r:6,fill:"#000"}),l.path({d:"M11,30 a2,1 0,0,0 20,0 m20,0 a2,1 0,0,0 20,0",fill:"none"}),l.path({d:"M38,70 l-6,18 l1,11 h16 l1,-11 l-6,-18"}),l.path({d:"M36,90 a8,8 0,1,0 -3,10 M46,90 a8,8 0,1,1 3,10 M33,98 a8,8 0,1,0 16,0"})])),l.symbol({viewBox:"0 0 200 100"},[l.defs(l.path({id:ct,d:"M100,99 c40,-20 30,-50 60,-40 q10,5 20,-10 h-40 c40,-10 45,-5 50,-20 l-45,5 c45,-20 50,-10 54,-33 c-120,20 -45,60 -99,98 z",fill:"#fff",stroke:"#000","stroke-width":2,"stroke-linejoin":"round"})),l.use({href:`#${ct}`,transform:"translate(200, 0) scale(-1, 1)"}),l.use({href:`#${ct}`})]),l.symbol({viewBox:"0 0 62 80"},[l.path({d:"M11,43 a25,26 0,1,1 40,0 a15,22 0,1,1 -40,0 z M11,79 q5,-5 5,-10 q0,-3.5 -1,-7 q-6,-9 -5,-18 q-4,-5 -5,-15 a1,1 0,0,0 -4,-1 q0,5 3,17 q-2,10 3,20 q-1,7 -5,14 z M51,79 q-5,-5 -5,-10 q0,-3.5 1,-7 q6,-9 5,-18 q4,-5 5,-15 a1,1 0,0,1 4,-1 q0,5 -3,17 q2,10 -3,20 q1,7 5,14 z",fill:"#fc8",stroke:"#000"}),l.ellipse({cx:31,cy:56,rx:5,ry:10,fill:"#000"}),l.g({fill:"#f80",stroke:"#fff","stroke-width":3},[l.circle({cx:21,cy:29,r:3}),l.circle({cx:41,cy:29,r:3})]),l.path({d:"M29,29 q-5,11 3,10",stroke:"#000","stroke-width":.5,fill:"none"})]),l.symbol({viewBox:"0 0 75 70"},l.g({fill:"#fc8",stroke:"#000","stroke-linejoin":"round","stroke-linecap":"round"},[l.path({d:"M11,44 l2,10 l5,5 l15,-5 l5,-3 q2,-12 9,-16 l21,-12 l-24,-11 l-26,-5 l-5,10 l-8,5 q0,5 -4,10"}),l.path({d:"M11,44 q1,5 -1,10 q3,10 6,15 q10,-6 20,-10 q-4,-12 -18,-3 M6,44 q10,-1 20,0 q1,-5 0,-10 q-12,-2 -25,-2 q2,6 5,12 M11,24 q7,2 15,5 q3,-5 4,-10 q-10,-4 -20,-7 q-2,5 -5,10 q0,5 -4,10 M26,9 q15,10 20,0 q-8,-5 -15,-8 q-6,1.5 -12,2 l-4,10 M56,24 q-5,2 -10,5 q1,6 2,10 q5,2 25,-5 q-2,-7 -5,-15 q-10,0 -24,-7"})])),l.symbol({viewBox:"0 0 100 100"},[l.defs(l.polygon({id:dt,points:"16,16 50,30 84,16 70,50 84,84 50,70 16,84 30,50"})),l.g({stroke:"#000","stroke-width":1},[l.use({href:`#${dt}`,fill:"#888"}),l.use({href:`#${dt}`,fill:"#ccc",transform:"rotate(45, 50, 50)"}),l.circle({cx:50,cy:50,r:20,fill:"#fff"})])]),l.symbol({viewBox:"0 0 100 80"},[l.defs(l.pattern({id:Lt,width:100,height:80,patternUnits:"userSpaceOnUse"},[l.rect({width:100,height:80,fill:"#f84"}),l.path({d:"M11,58 a3,2 0,0,0 0,-10 M55,0 q23,10 17,20 M70,40 l21,5 v-6 l-14,-4 c-10,-5 0,-10 -10,-20 h-10 v5 c5,5 -5,20 13,20 M92,32 a1,1 0,0,1 0,-5",fill:"#ffc"})])),l.path({d:"M30,45 q3,5 -2,10 q-4,1 -8,5 c-8,5 0,20 -10,15 q-1,-1.5 0,-3 l1,-8 c2,-5 10,-10 5,-9 a4,2 0,1,1 1,-5 a4,1 330,0,1 55,-30 q0,-8 -10,-15 a2,5 320,0,1 3,0 q20,10 17,15 q8,0 10,10 q-5,5 -15,5 q6,3 12,5 a1,1 0,0,1 -1,3 q-10,-2 -20,-3 q-18,0 -37,11",fill:`url(#${Lt})`,stroke:"#000","stroke-linecap":"round","stroke-linejoin":"round"}),l.circle({cx:82,cy:25,r:1.5,fill:"#000"})]),l.symbol({viewBox:"0 0 100 100"},[l.circle({cx:50,cy:50,r:49.5,fill:"#808",stroke:"#000","stroke-width":1}),l.path({d:"M3,35 L79,90 L50,1 L21,90 L97,35 Z",stroke:"#000",fill:"#fff","stroke-linejoin":"bevel","fill-rule":"evenodd"})]),l.symbol({viewBox:"0 0 100 100"},[l.defs(l.radialGradient({id:mt,cx:"50%",cy:"50%",fx:"15%",fy:"15%"},[l.stop({offset:"0%","stop-color":"#fff"}),l.stop({offset:"50%","stop-color":"#f00"}),l.stop({offset:"100%","stop-color":"#600"})])),l.g({stroke:"#000","stroke-linejoin":"round"},[l.path({d:"M1,10 q0,50 49,50 q49,0 49,-50 c-10,5 -30,-9 -49,-9 c-19,0 -39,14 -49,9 z",fill:"#a00"}),l.path({d:"M20,69 a1,1 0,0,0 60,0 v-30 q0,-20 -20,-20 c0,15 -20,15 -20,0 q-20,0 -20,20 z",fill:"#ffd"}),l.path({d:"M35,30 v20 c0,20 -15,10 -5,20 M65,30 v20 c0,20 15,10 5,20",stroke:"#a00","stroke-width":2,"stroke-linecap":"round",fill:"none"}),l.path({d:"M30,70 a10,9 0,0,0 40,0 z a2,1 0,0,0 40,0 M35,70 v12 M40,70 v15.5 M45,70 v17 M50,70 v18 M55,70 v17 M60,70 v15.5 M65,70 v12",fill:"#fff"}),l.circle({cx:50,cy:62,r:10,fill:`url(#${mt})`}),l.path({d:"M27,40 l20,10 a1,1 0,0,1 -20,-10 z M73,40 l-20,10 a1,1 0,0,0 20,-10 z",fill:"#ff0"}),l.circle({cx:35,cy:50,r:2,fill:"#000"}),l.circle({cx:65,cy:50,r:2,fill:"#000"})])]),l.symbol({viewBox:"0 0 100 100"},[l.defs(l.mask({id:It},[l.rect({width:100,height:100,fill:"#fff"}),l.path({d:"M0,50 h100 M50,0 v100","stroke-width":10,stroke:"#000"})])),l.circle({cx:50,cy:50,r:47.5,fill:"#fff"}),l.g({mask:`url(#${It})`},[l.circle({cx:50,cy:50,r:30,stroke:"#f00","stroke-width":2,fill:"none"}),l.circle({cx:50,cy:50,r:45,stroke:"#000","stroke-width":5,fill:"none"})]),l.path({d:"M0,50 h35 m30,0 h35 M50,0 v35 m0,30 v35",stroke:"#000","stroke-width":3}),l.path({d:"M35,50 h10 m10,0 h15 M50,35 v10 m0,10 v10",stroke:"#000","stroke-width":1}),l.circle({cx:50,cy:50,r:2,fill:"#f00"})]),l.symbol({viewBox:"0 0 100 100"},[l.circle({cx:50,cy:50,r:49.5,stroke:"#000",fill:"#fc8"}),l.path({d:"M20,30 l20,20 m-20,0 l20,-20 m20,0 l20,20 m-20,0 l20,-20 M30,75 h40 v5 a1,1 0,0,1 -15,0 v-5",stroke:"#000","stroke-width":2,fill:"#f00","stroke-linecap":"round"})]),l.symbol({viewBox:"0 0 24 100"},l.path({d:"M20,90 a8,8 0,1,0 0,0.1 z M8,70 h8 l4,-65 h-16 z",stroke:"#000","stroke-width":2,fill:"#fff"})),l.symbol({viewBox:"0 0 82 92"},l.g({stroke:"#000","stroke-width":1,fill:"rgba(255, 255, 255, 0.75)"},[l.path({d:"M81,91 v-50 a30,30 0,0,0 -80,0 v50 l10,-10 l10,10 l10,-10 l10,10 l10,-10 l10,10 l10,-10 z"}),l.circle({cx:20,cy:30,r:10}),l.circle({cx:60,cy:30,r:10})])),l.symbol({viewBox:"0 0 100 100"},[l.defs(l.g({id:ht,transform:"rotate(10)",stroke:"#000","stroke-width":1},[l.path({d:"M30,65 q-0.5,-5, 0,-10 h16 q15,6 30,6 h18 q1,3 0,6 h-18 q-15,0 -30,-6 v4 z",fill:"#420"}),l.path({d:"M30,55 h16 q15,6 30,6 h18 q0.5,-10 -10,-10 q-30,-4 -28,-10 q1,-15 -0,-30 q-12,-1 -26,0 q-1,22 0,44",fill:"#840"})])),l.path({d:"M0,100 v-30 l20,-5 h60 l20,5 v30 z",fill:"#0a0"}),l.use({href:`#${ht}`,transform:"translate(10,0) scale(0.9)"}),l.use({href:`#${ht}`}),l.path({d:"M15,90 q-2,-2.5 5,-5 q-2,-2.5 5,-5 c3,0 40,2 58,5 q5,2.5 -5,5 q5,2.5 -5,5 c-15,2 -55,-5 -58,-5",fill:"#040"})]),l.symbol({viewBox:"0 0 70 90"},[l.rect({x:5,y:5,width:60,height:80,fill:"#4df",stroke:"#640","stroke-width":10,rx:1}),l.path({d:"M10,50 v10 L60,15 v-5 h-5 z",fill:"#8ff"})]),l.symbol({viewBox:"0 0 73 81"},l.path({d:"M10,32 a1,1 0,0,0 40,40 a1,1 0,0,0 -3,-3 a1,1 0,0,1 -34,-34 a1,1 0,0,0 -3,-3 z M60,77 l-20,-30 h-20 l-10,-35 a8,8 90,1,1 8,5 l7,24.5 h18 l18.5,28 l7,-4 l3,4 z",fill:"#00a",stroke:"#000","stroke-width":1})),l.symbol({viewBox:"0 0 100 90"},[l.path({d:"M5,90 a60,60 0,0,1 90,0 z",fill:"red",stroke:"#000"}),l.path({d:"M50,20 c20,0 20,10 20,30 c-2,15 -5,20 -18,30 q-2,1 -4,0 c-13,-10 -16,-15 -18,-30 c0,-20 0,-30 20,-30",fill:"#fc8",stroke:"#000"}),l.path({d:"M35,45 a10,10 0,0,1 10,0 a10,10 0,0,1 -10,0 M55,45 a10,10 0,0,1 10,0 a10,10 0,0,1 -10,0",fill:"red",stroke:"#000","stroke-width":.3}),l.path({d:"M40,65 c5,0 5,-5 10,-3 c5,-2 5,3 10,3 q-10,-0.5 -20,0 M41,65 q10,0.5 18,0 c-4,4 -14,4 -18,0",fill:"#080"}),l.g({"stroke-width":8,"stroke-linecap":"round",fill:"none"},[l.path({d:"M30,40 c-15,-5 -10,20 -25,10 M70,40 c15,-5 10,20 25,10",stroke:"#040"}),l.path({d:"M33,32 c-15,-10 -10,5 -25,-10 M67,32 c15,-10 10,5, 25,-10",stroke:"#060"}),l.path({d:"M38,25 c-5,-10 -10,5 -15,-20 M 62,25 c5,-10 10,5, 15,-20",stroke:"#080"}),l.path({d:"M50,22 v-18",stroke:"#0a0"})])]),l.symbol({viewBox:"0 0 6.2 9.3"},[l.defs(l.linearGradient({id:yt},[l.stop({offset:"0%","stop-color":"#040"}),l.stop({offset:"100%","stop-color":"#0e0"})])),l.path({d:"M3.1,0.2 q-6,8 0,9 q6,-1 0,-9 Z",stroke:"#000","stroke-width":.2,fill:`url(#${yt})`})]),l.symbol({viewBox:"0 0 100 60"},[l.defs(l.pattern({id:Nt,width:100,height:60,patternUnits:"userSpaceOnUse"},[l.rect({width:100,height:60,fill:"#cca"}),l.path({d:"M100,60 h-53 l25,-60 h20 z",fill:"#888"}),l.circle({cx:15,cy:20,r:13,fill:"#840"}),l.path({d:"M85,59 h15 v-20 h-15 z M0,59 h50 v-15 h-50 z M0,25 l28,-10 l-5,20 h-10 z",fill:"#fc8"})])),l.g({stroke:"#000","stroke-linejoin":"round",fill:`url(#${Nt})`},[l.path({d:"M40,33.5 l-3,14.5 h-3.5 l-2,8 h9 q4,0 5,-4 l5,-20.5 z M90,59 a1,1 0,0,0 0,-12 h-20 l10,-23 c10,-8 0,-20 -5,-18 l-40,5 q-5,0 -6,5 l-8,33 h-15 a1,1 0,0,0 0,10 h20 q5,0 6,-5 l5,-20 l27,-5 l-10,25 q0,5 5,5 z M64,29 l-4,1 l-8,20 q-1,4 2,4 z"}),l.circle({cx:15,cy:20,r:12})])]),l.symbol({viewBox:"0 0 100 100"},l.g({stroke:"#000","stroke-width":1,fill:"#fff"},[l.circle({cx:50,cy:50,r:49,fill:"#a00"}),l.circle({cx:30,cy:40,r:8}),l.circle({cx:70,cy:40,r:8}),l.path({d:"M22,25 l17,8 M61,33 l17,-8 M20,80 a3,2 0,0,1 60,0 z M30,80 v-15 M40,80 v-20 M50,80 v-20 M60,80 v-20 M70,80 v-15","stroke-width":3})])),l.symbol({viewBox:"0 0 100 90"},l.g({stroke:"#000","stroke-linejoin":"round","stroke-linecap":"round"},[l.path({d:"M94,84 l-5,5 l-5,-5 l2,-2 l-75,-75 l0,-6",fill:"#840"}),l.path({d:"M94,84 l5,-5 l-5,-5 l-2,2 l-75,-75 l-6,0",fill:"#c84"}),l.path({d:"M7,20 h-5 q5,30 30,25 l-6,-15 z",fill:"#aad"}),l.path({d:"M20,10 q-10,10 -15,10 q10,20 25,20 q-2,-8 5,-15 l1,-1",fill:"#88b"}),l.path({d:"M20,10 l5,-5 l15,15 l-5,5",fill:"#aad"}),l.path({d:"M2,88 a1,1 0,1,1 3,-5 l13,-15 l-5,-5 l3,-3 l7,7",fill:"#f80"}),l.path({d:"M2,88 a1,1 0,1,0 5,-3 l15,-13 l5,5 l3,-3 l-7,-7",fill:"#fa0"}),l.path({d:"M1.75,87.80 l0.4,0.4"}),l.path({d:"M26,70 l55,-50 l5,-16",fill:"#88f"}),l.path({d:"M86,4 l-5,16 l-55,50 l-3,-3",fill:"#bbf"}),l.path({d:"M86,4 l-16,5 l-50,55 l3,3",fill:"#669"})])),l.symbol({viewBox:"0 0 37 37"},l.g({stroke:"#000","stroke-width":.5,fill:"#ccc","stroke-linecap":"round","fill-rule":"evenodd"},[l.path({d:"M2,28 a1,1 0,0,0 5,5 l4,-4 a1,1 0,0,0 -5,-5 z m1,1 a1,1 0,0,0 3,3 l4,-4 a1,1 0,0,0 -3,-3 z m10,-12 a1,1 0,0,0 5,5 l4,-4 a1,1 0,0,0 -5,-5 z m1,1 a1,1 0,0,0 3,3 l4,-4 a1,1 0,0,0 -3,-3 z m10,-12 a1,1 0,0,0 5,5 l4,-4 a1,1 0,0,0 -5,-5 z m1,1 a1,1 0,0,0 3,3 l4,-4 a1,1 0,0,0 -3,-3 z"}),l.path({d:"M7.5,26.5 l8,-8 a1,1 0,0,1 1,1 l-8,8 a1,1 0,0,1 -1,-1 z m11,-11 l8,-8 a1,1 0,0,1 1,1 l-8,8 a1,1 0,0,1 -1,-1 z"})])),l.symbol({viewBox:"0 0 47 72"},[l.g({stroke:"#000",fill:"none"},[l.path({d:"M2.5,41.5 l21,-21 l21,21","stroke-width":6.5}),l.path({d:"M23.5,0.25 v21 M14.5,7 h18","stroke-width":3}),l.path({d:"M23.5,21 l20,20 v30 h-40 v-30 z",fill:"#efa"}),l.path({d:"M23.5,1 v20 M15.5,7 h16",stroke:"#fc4","stroke-width":1}),l.path({d:"M3.5,41 l20,-20 l20,20",stroke:"#e42","stroke-width":5}),l.circle({cx:23.5,cy:40,r:8,fill:"#88f","stroke-width":.5})]),l.path({d:"M13.5,70.5 v-10 a10,10 0,0,1 20,0 v10 z",fill:"#642"})]),l.symbol({viewBox:"0 0 100 65"},[l.defs(l.pattern({id:Dt,x:15,y:12.5,width:22,height:12,patternUnits:"userSpaceOnUse"},[l.rect({width:22,height:12,fill:"#420"}),l.path({d:"M0,0 l3,6 h8 l3,-6 h8 l1,2 m0,8 l-1,2 h-8 l-3,-6 m-8,0 l-3,6",fill:"transparent",stroke:"#210","stroke-linecap":"square"})])),l.path({d:"M26,43 q-3,-10 -10,-20 q-30,0 0,-20 c30,-10 0,15 20,35 M30,43 q-5,20 0,20 q2.5,0.5 5,0 q5,0 5,-20 M80,43 q5,20 0,20 q-2.5,0.5 -5,0 q-5,0 -5,-20 M80,43 c40,-35 0,-10 -2,-3",fill:"#080",stroke:"#000","stroke-linejoin":"round"}),l.path({d:"M25,43 c20,-30 40,-30 60,0 c-20,5 -40,5 -60,0 Z",fill:`url(#${Dt})`,stroke:"#210","stroke-linejoin":"round"}),l.circle({cx:20,cy:10,r:2.5,fill:"#000"})]),l.symbol({viewBox:"0 0 100 100"},l.g({stroke:"#000"},[l.circle({cx:50,cy:50,r:49,fill:"#fc8"}),l.path({id:Tt,d:"M30,40 l3,8.5 h9 l-7,5.5 l2.5,8 l-7.5,-5 l-7.5,5 l2.5,-8.5 l-7,-5.5 h9 z",fill:"#ff0"}),l.use({href:`#${Tt}`,transform:"translate(40, 0) scale(0.5)","stroke-width":1.5}),l.path({d:"M50,80 l-1,-8 l16,2 l-2,-16 l16,2 l-1,-8",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"})])),l.symbol({viewBox:"0 0 100 100"},[l.defs(l.path({id:ut,d:"M3,2 h20 v3 l-15,20 h15 l1,-3 h1 l-1,5 h-20 v-3 l15,-20 h-15 l-1,3 h-1 z","stroke-width":1,stroke:"#000",fill:"#fff"})),l.use({href:`#${ut}`,transform:"scale(1.2) translate(55, 0)"}),l.use({href:`#${ut}`,transform:"translate(45, 30)"}),l.use({href:`#${ut}`,transform:"scale(0.8) translate(35, 70)"}),l.use({href:`#${ut}`,transform:"scale(0.6) translate(25, 130)"})])].map(((t,e)=>i.amendNode(t,{id:ft[e]})))]),y.isAdmin){const r=t=>{if(!t["shapechange-categories"]||!t["store-image-shapechanges"])return null;if(!(t["shapechange-categories"].data instanceof Array))return console.log("shapechange-categories must be an Array"),null;if(!(t["store-image-shapechanges"].data instanceof Array))return console.log("store-image-shapechanges must be an Array"),null;const e=t["store-image-shapechanges"].data.length;for(const i of t["shapechange-categories"].data){if("object"!=typeof i)return console.log("entry of shapechange-categories is not an object"),null;if("string"!=typeof i.name)return console.log("shapechange-categories.name must be a string"),null;if(!(i.images instanceof Array))return console.log("shapechange-categories.images must be an array"),null;i.images.length>e&&i.images.splice(e);for(const t of i.images)if("boolean"!=typeof t)return console.log("entry of shapechange-categories.images must be boolean"),null;for(;i.images.length<e;)i.images.push(!1)}for(const e of t["store-image-shapechanges"].data){if("object"!=typeof e)return console.log("entry of store-image-shapechanges must be an object"),null;if(!a.isInt(e.src,0))return console.log("store-image-shapechanges.src must be a Uint"),null;if("string"!=typeof e["5e-shapechange-name"])return console.log("store-image-shapechanges.5e-shapechange-name must be a string"),null;if(!a.isInt(e.width,0)||!a.isInt(e.height,0))return console.log("store-image-shapechanges.width/height must be a Uint"),null;if("boolean"!=typeof e.flip||"boolean"!=typeof e.flop)return console.log("store-image-shapechanges.flip/flop must be a boolean"),null}return t},M=r(m.getSettings(O))??{"shapechange-categories":{user:!1,data:[]},"store-image-shapechanges":{user:!1,data:[]}},c=t=>{E.shell.prompt(k.INITIATIVE_ENTER,k.INITIATIVE_ENTER_LONG,"0").then((e=>{if(jt(t)&&null!==e){const i=parseInt(e);a.isInt(i,-20,40)&&(Rt([t.id,i]),Yt())}}))},A=t=>{jt(t)&&(Rt([t.id,null]),Yt())},N=(t,e,i)=>(null!==e?Promise.resolve(Math.floor(20*(i?Math.max(Math.random(),Math.random()):Math.random()))+1+e):E.shell.prompt(k.INITIATIVE_ENTER,k.INITIATIVE_ENTER_LONG,"0").then((t=>{if(!t)throw new Error("invalid initiative");return parseInt(t)}))).then((e=>{jt(t)&&a.isInt(e,-20,40)&&(Rt([t.id,e]),Yt())})).catch((()=>{})),w=M["shapechange-categories"].data.map((t=>({name:t.name,images:t.images.slice()}))),v=M["store-image-shapechanges"].data.map(D.cloneObject),b=t=>{const e={name:null,"5e-ac":null,"5e-hp-max":null,"5e-hp-current":null},{name:i,"5e-ac":o,"5e-hp-max":s,"5e-hp-current":a}=t.tokenData;return i&&(e.name=D.cloneObject(i)),o&&(e["5e-ac"]=D.cloneObject(o)),s&&(e["5e-hp-max"]=D.cloneObject(s)),a&&(e["5e-hp-max"]=D.cloneObject(a)),{src:t.src,width:t.width,height:t.height,flip:t.flip,flop:t.flop,tokenData:e}},Y=(t,e)=>{const i={id:t.id,tokenData:{},removeTokenData:[]};if(e)t.tokenData["store-image-5e-initial-token"]||(i.tokenData["store-image-5e-initial-token"]={user:!1,data:b(t)});else{if(!t.tokenData["store-image-5e-initial-token"])return;e=t.tokenData["store-image-5e-initial-token"].data,i.removeTokenData.push("store-image-5e-initial-token")}i.src=e.src,i.width=e.width,i.height=e.height,i.flip=e.flip,i.flop=e.flop;for(const t in i.tokenData){const e=i.tokenData[t];e?i.tokenData[t]=D.cloneObject(e):i.removeTokenData.push(t)}u.doTokenSet(i),t.updateNode(),Pt.has(i.id)&&Rt()},_=(t,e=w.length-1)=>{const s=o.span(t.name),a=o.th([s,p.rename({title:k.SHAPECHANGE_TOKEN_CATEGORY_RENAME,class:d.itemControl,onclick:()=>E.shell.prompt(k.SHAPECHANGE_TOKEN_CATEGORY_RENAME,k.SHAPECHANGE_TOKEN_CATEGORY_RENAME_LONG,t.name).then((e=>{e&&t.name!==e&&i.clearNode(s,t.name=e)}))}),p.remove({title:k.SHAPECHANGE_TOKEN_CATEGORY_REMOVE,class:d.itemControl,onclick:()=>E.shell.confirm(k.SHAPECHANGE_TOKEN_CATEGORY_REMOVE,k.SHAPECHANGE_TOKEN_CATEGORY_REMOVE_LONG,"").then((t=>{if(t){w[e].name="";for(const t of W)t[e].remove();a.remove()}}))})]);return a},P=(t,e,i=!1)=>{const s=o.td([D.labels(o.input({class:d.settingsTicker,type:"checkbox",checked:i,onchange:function(){w[e].images[t]=this.checked}}),"")]);return W[t].push(s),s},G=(t,e)=>{W.push([]);const s=o.span(t["5e-shapechange-name"]),a=o.img({src:g.imageIDtoURL(t.src)}),n=o.tr([o.th([o.div({class:[d.tokenSelector,J],style:"width: 100px; height: 100px"},[o.button({title:k.SHAPECHANGE_CHANGE,onclick:()=>{const e=u.getToken();if(e){const o=b(e);E.shell.confirm(h.default.TOKEN_REPLACE,h.default.TOKEN_REPLACE_CONFIRM).then((e=>{e&&(Object.assign(t,o),i.amendNode(a,{src:g.imageIDtoURL(t.src)}))}))}else E.shell.alert(h.default.TOKEN_SELECT,h.default.TOKEN_NONE_SELECTED)}}),a]),o.br(),s,p.rename({title:k.SHAPECHANGE_TOKEN_RENAME,class:d.itemControl,onclick:()=>E.shell.prompt(k.SHAPECHANGE_TOKEN_RENAME,k.SHAPECHANGE_TOKEN_RENAME_LONG,t["5e-shapechange-name"]).then((e=>{e&&t["5e-shapechange-name"]!==e&&i.clearNode(s,t["5e-shapechange-name"]=e)}))}),p.remove({title:k.SHAPECHANGE_TOKEN_REMOVE,class:d.itemControl,onclick:()=>E.shell.confirm(k.SHAPECHANGE_TOKEN_REMOVE,k.SHAPECHANGE_TOKEN_REMOVE_LONG).then((t=>{t&&(U[e].remove(),v[e]["5e-shapechange-name"]="")}))})]),w.map(((t,i)=>P(e,i,t.images[e])))]);return U.push(n),n},R=o.tr([o.td(),w.map(_)]),U=[],W=[],Q=o.tbody(v.map(G)),Z=E.windows({"window-icon":`data:image/svg+xml,%3Csvg xmlns="${l.ns}" viewBox="0 0 2 2"%3E%3Crect width="2" height="2" fill="%23f00"%3E%3Canimate attributeName="rx" values="0;0;1;1;0" dur="16s" repeatCount="indefinite" keyTimes="0;0.375;0.5;0.875;1" /%3E%3Canimate attributeName="fill" values="%23f00;%23f00;%2300f;%2300f;%23f00" dur="16s" repeatCount="indefinite" keyTimes="0;0.375;0.5;0.875;1" /%3E%3C/rect%3E%3C/svg%3E`,"window-title":k.SHAPECHANGE_TITLE,"window-data":"shapechange-5e",resizable:!0},o.div([o.h1(k.SHAPECHANGE_TITLE),o.button({onclick:()=>E.shell.prompt(k.SHAPECHANGE_TOKEN_CATEGORY,k.SHAPECHANGE_TOKEN_CATEGORY_LONG).then((t=>{if(t){const e={name:t,images:Array.from({length:v.length},(()=>!1))},o=w.push(e)-1;i.amendNode(R,_(e));for(let t=0;t<U.length;t++)i.amendNode(U[t],P(t,o))}}))},k.SHAPECHANGE_TOKEN_CATEGORY),o.button({onclick:()=>{const t=u.getToken();if(t){const e=b(t);E.shell.prompt(k.SHAPECHANGE_TOKEN_NAME,k.SHAPECHANGE_TOKEN_NAME_LONG).then((t=>{if(t){const o=Object.assign(e,{"5e-shapechange-name":t});i.amendNode(Q,G(o,v.length)),v.push(o);for(const t of w)t.images.push(!1)}}))}else E.shell.alert(h.default.TOKEN_SELECT,h.default.TOKEN_NONE_SELECTED)}},k.SHAPECHANGE_TOKEN_ADD),o.table({id:X},[o.thead(R),Q]),o.button({onclick:()=>{const t=[],e=[],i=[];for(const t of v)t["5e-shapechange-name"]?(i.push(!0),e.push(D.cloneObject(t))):i.push(!1);for(const e of w)if(e.name){const o=[];for(let t=0;t<i.length;t++)i[t]&&o.push(e.images[t]);t.push({name:e.name,images:o})}M["shapechange-categories"]={user:!1,data:t},M["store-image-shapechanges"]={user:!1,data:e},y.rpc.pluginSetting(O,M,[])}},h.default.SAVE)])),[B,H]=I.registerKeyEvent("5e-health-key",k.KEY_HEALTH,"h",void 0,(()=>{const{token:t}=L.selected;if(t instanceof f){const e=t.getData("5e-hp-current");null!==e&&E.shell.prompt(k.HP_CURRENT,k.HP_CURRENT_ENTER,e).then((i=>{if(null!==i&&jt(t)){const o=Math.max(0,parseInt(i)+(i.startsWith("+")||i.startsWith("-")?e:0));isNaN(o)||u.doTokenSet({id:t.id,tokenData:{"5e-hp-current":{user:!1,data:Math.max(0,(parseInt(i)||0)+(i.startsWith("+")||i.startsWith("-")?e:0))}}})}}))}})),[F,$]=I.registerKeyEvent("5e-initiative-key",k.KEY_INITIATIVE,"i",void 0,(()=>{const{token:t}=L.selected;t instanceof f&&(T.mapData.data["5e-initiative"]&&T.mapData.data["5e-initiative"].some((e=>e.id===t.id))?c(t):N(t,t.getData("5e-initiative-mod"),t.getData("5e-initiative-adv")??!1))})),V=(t,e)=>{if(jt(t)){const i=t.getData("5e-conditions")?.slice()??Array.from({length:Ot.length},(t=>!1));i[e]=!i[e],u.doTokenSet({id:t.id,tokenData:{"5e-conditions":{user:!0,data:i}}})}},K=Ot.map(((e,i)=>I.registerKeyEvent("5e-"+e,t.default`${k.TOGGLE_CONDITION}: ${k[e]}`,"",void 0,(()=>V(L.selected.token,i)))));e.add(`.${d.adminHideLight} #${et}`,{display:"none"}),i.amendNode(Bt.settings.fn,o.button({onclick:()=>i.amendNode(E.shell,Z)},k.SHAPECHANGE_5E)),Bt.characterEdit={fn:(t,e,s,n,r,l)=>{const M=!n&&s["store-character-id"]&&D.characterData.has(s["store-character-id"].data)?(()=>{const t=D.characterData.get(s["store-character-id"].data);return e=>s[e]??t[e]??{}})():t=>s[t]??{};return i.amendNode(t,[D.labels([k.INITIATIVE_MOD,": "],o.input({type:"number",min:-20,max:20,step:1,value:M("5e-initiative-mod").data??"",onchange:function(){""===this.value?l.add("5e-initiative-mod"):(l.delete("5e-initiative-mod"),r["5e-initiative-mod"]={user:!1,data:a.checkInt(parseInt(this.value),-20,20,0)})}})),D.labels([k.INITIATIVE_ADV,": "],o.input({type:"checkbox",checked:M("5e-initiative-adv").data??!1,onchange:function(){r["5e-initiative-adv"]={user:!1,data:this.checked}}})),o.br(),D.labels([k.ARMOUR_CLASS,": "],o.input({type:"number",min:0,max:50,step:1,value:M("5e-ac").data??10,onchange:function(){r["5e-ac"]={user:!1,data:a.checkInt(parseInt(this.value),0,50,0)}}})),o.br(),D.labels([k.HP_CURRENT,": "],o.input({type:"number",min:0,step:1,value:M("5e-hp-current").data??10,onchange:function(){r["5e-hp-current"]={user:!1,data:a.checkInt(parseInt(this.value),0,1/0,0)}}})),o.br(),D.labels([k.HP_MAX,": "],o.input({type:"number",min:0,step:1,value:M("5e-hp-max").data??10,onchange:function(){r["5e-hp-max"]={user:!1,data:a.checkInt(parseInt(this.value),0,1/0,0)}}})),o.br(),D.labels(o.input({type:"checkbox",class:d.settingsTicker,checked:M("5e-player").data,onchange:function(){r["5e-player"]={user:!0,data:this.checked}}}),[k.IS_PLAYER,": "]),o.br(),D.labels([k.DARKVISION,": "],o.input({type:"number",min:0,step:1,value:M("5e-darkvision").data??0,onchange:function(){r["5e-darkvision"]={user:!0,data:a.checkInt(parseInt(this.value),0,1/0,0)}}})),o.br(),D.labels([k.NOTES,": "],o.textarea({rows:10,cols:30,style:"resize: none",onchange:function(){r["5e-notes"]={user:!1,data:this.value}}},M("5e-notes").data??""))]),()=>{let t=!1,i=!1;if(n)for(const[,{token:o}]of L.tokens)o instanceof f&&o.tokenData["store-character-id"]?.data===e&&(o[C](),Pt.has(o.id)&&(t=!0),(r["5e-player"]||r["5e-darkvision"])&&(i=!0));else L.tokens.get(e).token[C](),t=!!r.name&&Pt.has(e),i=!!r["5e-player"];t?Rt():i&&Zt()}}},Bt.tokenContext={fn:()=>{const{token:t}=L.selected;if(!(t instanceof f))return[];const e=t.getData("5e-initiative-mod"),i=t.getData("5e-conditions")??[],{"shapechange-categories":{data:o},"store-image-shapechanges":{data:a}}=M,r=[];return T.mapData.data["5e-initiative"]&&T.mapData.data["5e-initiative"].some((e=>e.id===t.id))?r.push(s.item({onselect:()=>jt(t)&&c(t)},k.INITIATIVE_CHANGE),s.item({onselect:()=>jt(t)&&A(t)},k.INITIATIVE_REMOVE)):r.push(s.item({onselect:()=>jt(t)&&N(t,e,t.getData("5e-initiative-adv")??!1)},k.INITIATIVE_ADD)),r.push(s.submenu([s.item(k.CONDITIONS),s.menu({class:j},Ot.map(((t,e)=>[t,e])).sort((([t],[e])=>n.stringSort(k[t]+"",k[e]+""))).map((([e,o])=>s.item({onselect:()=>V(t,o),class:{[z]:!!i[o]}},k[e]))))])),o&&o.length&&r.push(s.submenu([s.item(k.SHAPECHANGE),s.menu([t.tokenData["store-image-5e-initial-token"]?s.item({onselect:()=>{jt(t)&&Y(t)}},k.SHAPECHANGE_INITIAL_RESTORE):[],o.map((e=>s.submenu([s.item(e.name),s.menu(e.images.map(((e,i)=>{if(e){const e=a[i];return s.item({onselect:()=>{jt(t)&&Y(t,e)}},e["5e-shapechange-name"])}return[]})))])))])])),r}},y.rpc.waitPluginSetting().when((t=>{t.id===O&&r(t.setting)&&(M["shapechange-categories"]=t.setting["shapechange-categories"].data,M["store-image-shapechanges"]=t.setting["store-image-shapechanges"].data)})),L.tokenSelectedReceive((()=>{let t=null;return()=>{t?.[S]();const{token:e}=L.selected;if(e instanceof f&&!e.isPattern){B(),F();for(const[t]of K)t();t=e,e[x]()}else{H(),$();for(const[,t]of K)t()}}})())}else e.add(`#${tt}`,{" thead, td:last-child":{display:"none"}});m.addPlugin("5e",Bt),D.mapLoadedReceive((()=>{_t.remove(),a.queue((async()=>{for(const[,t]of L.tokens)t instanceof f&&t[C]();i.clearNode(T.getLayer("/Light").l,[l.use({href:`#${d.lighting}`,style:"mix-blend-mode: saturation",filter:`url(#${pt})`,"clip-path":`url(#${wt})`}),l.g({style:"mix-blend-mode: multiply"},[l.use({href:`#${d.lighting}`}),l.use({href:`#${d.lighting}`,filter:`url(#${Et})`,"clip-path":`url(#${wt})`})])]),Rt()}))})),y.combined.waitTokenSet().when((t=>{const{tokenData:e,removeTokenData:i}=t;if(e&&(e["5e-initiative"]||void 0!==e.name)||i&&(i.includes("5e-initiative")||i.includes("name")))setTimeout((()=>{Pt.has(t.id)&&Rt(),L.tokens.get(t.id).token[C]()}),0);else{if(e)for(const i in e)switch(i){case"5e-ac":case"5e-hp-max":case"5e-hp-current":case"5e-conditions":return void setTimeout((()=>L.tokens.get(t.id).token[C]()),0)}if(i)for(const e of i)switch(e){case"5e-ac":case"5e-hp-max":case"5e-hp-current":case"5e-conditions":return void setTimeout((()=>L.tokens.get(t.id).token[C]()),0)}}})),y.combined.waitMapDataSet().when((t=>{"5e-initiative"===t.key&&setTimeout(Rt,0)})),y.combined.waitMapDataRemove().when((t=>{"5e-initiative"===t&&_t.remove()})),y.combined.waitTokenRemove().when((t=>setTimeout(Pt.has(t)?Rt:Zt))),y.combined.waitTokenAdd().when((({token:{id:t}})=>setTimeout(Pt.has(t)?Rt:Zt))),y.combined.waitTokenMoveLayerPos().when((({id:t})=>setTimeout(Pt.has(t)?Rt:Zt))),y.combined.waitTokenSet().when((({id:t})=>setTimeout(Pt.has(t)?Rt:Zt))),y.combined.waitTokenSetMulti().when((t=>{for(const{id:e}of t)if(Pt.has(e))return void setTimeout(Rt);setTimeout(Zt)}));for(const t of["waitLayerShow","waitLayerHide","waitLayerRemove"])y.combined[t]().when((()=>setTimeout(Rt)));for(const t of["waitLayerShift","waitLayerMove","waitWallAdded","waitWallRemoved","waitWallModified","waitWallMoved"])y.combined[t]().when((()=>setTimeout(Zt)));return y.rpc.waitCharacterDataChange().when((({id:t})=>setTimeout((()=>{let e=!1;for(const[,{token:i}]of L.tokens)i instanceof f&&i.tokenData["store-character-id"]?.data===t&&(i[C](),!e&&Pt.has(i.id)&&(setTimeout(Rt),e=!0))})))),y.addMapDataChecker((t=>{for(const e in t){let i="";if("5e-initiative"===e){const o=t[e];if(o instanceof Array)for(const t of o){if(!(t instanceof Object)){i="Map Data value of 5e-initiative needs to be an array of Objects";break}if(!a.isInt(t.id,0)){i="Map Data value of IDInitiative.id needs to be a Uint";break}if(!a.isInt(t.initiative)){i="Map Data value of 5e-initiative needs to be an Int";break}}else i="Map Data value of 5e-initiative needs to be an array"}i&&(delete t[e],console.log(new TypeError(i)))}})),y.addCharacterDataChecker((t=>{for(const e in t){const i=t[e].data;let o="";switch(e){case"name":"string"!=typeof i&&(o="Character Data 'name' must be a string");break;case"5e-ac":a.isInt(i,0,50)||(o="Character Data '5e-ac' must be a Uint <= 50");break;case"5e-hp-max":a.isInt(i,0)||(o="Character Data '5e-hp-max' must be a Uint");break;case"5e-hp-current":a.isInt(i,0)||(o="Character Data '5e-hp-current' must be a Uint");break;case"5e-initiative-adv":"boolean"!=typeof i&&(o="Token Data '5e-initiative-adv' must be a boolean");break;case"5e-initiative-mod":a.isInt(i,-20,20)||(o="Character Data '5e-initiative-mod' must be an Int between -20 and 20");break;case"5e-notes":"string"!=typeof i&&(o="Character Data '5e-notes' must be a string");break;case"5e-player":"boolean"!=typeof i&&(o="Token Data '5e-player' must be a boolean");break;case"5e-darkvision":a.isInt(i,0)||(o="Token Data '5e-darkvision' must be a Uint")}o&&(delete t[e],console.log(new TypeError(o)))}})),y.addTokenDataChecker((t=>{for(const e in t){const i=t[e].data;let o="";switch(e){case"name":"string"!=typeof i&&(o="Token Data 'name' must be a string");break;case"5e-ac":a.isInt(i,0,50)||(o="Token Data '5e-ac' must be a Uint <= 50");break;case"5e-hp-max":a.isInt(i,0)||(o="Token Data '5e-hp-max' must be a Uint");break;case"5e-hp-current":a.isInt(i,0)||(o="Token Data '5e-hp-current' must be a Uint");break;case"5e-initiative-adv":"boolean"!=typeof i&&(o="Token Data '5e-initiative-adv' must be a boolean");break;case"5e-initiative-mod":a.isInt(i,-20,20)||(o="Token Data '5e-initiative-mod' must be an Int between -20 and 20");break;case"5e-conditions":i instanceof Array&&i.length===Ot.length&&i.every((t=>"boolean"==typeof t))||(o="Token Data '5e-conditions' must be a boolean array of correct length");break;case"5e-player":"boolean"!=typeof i&&(o="Token Data '5e-player' must be a boolean");break;case"5e-darkvision":a.isInt(i,0)||(o="Token Data '5e-darkvision' must be a Uint");break;case"store-image-5e-initial-token":"object"!=typeof i?o="Token Data 'store-image-5e-initial-token' must be an object":a.isInt(i.src,0)?a.isInt(i.width,0)&&a.isInt(i.height,0)?"boolean"==typeof i.flip&&"boolean"==typeof i.flop||(o="Token Data 'store-image-5e-initial-token' flip & flop must be boolean"):o="Token Data 'store-image-5e-initial-token' width & height must be Uints":o="Token Data 'store-image-5e-initial-token' src must be a Uint";break;case"5e-notes":"string"!=typeof i&&(o="Token Data '5e-notes' must be a string")}o&&(delete t[e],console.log(new TypeError(o)))}})),{}}],["/plugins/notes.js",async()=>{const[t,e,i,o,s,a,n,r,l,M,g,c,d,I,h,T,u,A,L,m]=await Promise.all(["/lib/bbcode.js","/lib/bbcode_tags.js","/lib/bind.js","/lib/css.js","/lib/dom.js","/lib/drag.js","/lib/html.js","/lib/inter.js","/lib/misc.js","/lib/nodes.js","/lib/svg.js","/folders.js","/ids.js","/language.js","/messaging.js","/plugins.js","/rpc.js","/shared.js","/symbols.js","/windows.js"].map(include)),y=I.makeLangPack({ERROR_FOLDER_NOT_EMPTY:"Cannot remove a non-empty folder",ERROR_INVALID_FOLDER:"Invalid Folder",ERROR_INVALID_ITEM:"Invalid Item",ERROR_INVALID_PATH:"Invalid Path",MENU_TITLE:"Notes",NAME_EXISTS:"Note Exists",NAME_EXISTS_LONG:"A note with that name already exists",NAME_INVALID:"Invalid Name",NAME_INVALID_LONG:"Note names cannot contains the '/' (slash) character",NOTE:"Note",NOTE_EDIT:"Edit Note",NOTE_POPOUT:"Open in New Window",NOTE_SAVE:"Save Note",NOTE_SHARE:"Allow Note Sharing",NOTES_NEW:"New Note",NOTES_NEW_LONG:"Enter new note name",SHARE:"Share"}),N=`data:image/svg+xml,%3Csvg xmlns="${g.ns}" viewBox="0 0 84 96" width="84" height="96" %3E%3Crect x="60" y="6" width="24" height="90" fill="%23888" rx="10" /%3E%3Crect x="1" y="6" width="80" height="90" stroke="%23000" fill="%23fff" rx="10" /%3E%3Cg id="h"%3E%3Ccircle cx="16" cy="11" r="2" fill="%23333" /%3E%3Cellipse cx="15" cy="6" rx="3" ry="5" stroke="%23aaa" stroke-width="2" fill="none" stroke-dasharray="0 5 15" /%3E%3C/g%3E%3Cuse href="%23h" x="10" /%3E%3Cuse href="%23h" x="20" /%3E%3Cuse href="%23h" x="30" /%3E%3Cuse href="%23h" x="40" /%3E%3Cuse href="%23h" x="50" /%3E%3Cpath d="M11,25 h60 M11,40 h60 M11,55 h60 M11,70 h30" stroke="%23000" stroke-width="4" stroke-linecap="round" /%3E%3C/svg%3E`;if(h.register("plugin-notes",[N,y.NOTE]),u.isAdmin){class e extends c.DraggableItem{static#m=new Set;#y=null;#N=null;#D=null;#p;#E=!1;constructor(t,e,i){super(t,e,i,E),s.amendNode(this.image,{src:N}),k.set(e,this),this.#p=h.bbcodeDrag.register((()=>t=>`[note=${e}]${t||this.name}[/note]`)),s.amendNode(this.nameElem,{onauxclick:t=>{1===t.button&&(this.#N?this.#N.focus():this.#w())}})}static checkEditors(){for(const t of e.#m)if(t.#E)return!0;return!1}#f(t){this.#E&&(t.preventDefault(),this.#y?.confirm(I.default.ARE_YOU_SURE,I.default.UNSAVED_CHANGES,N).then((t=>{t&&(this.#E=!1,this.#y?.remove())})))}#w(){(this.#E?this.#y?.confirm(I.default.ARE_YOU_SURE,I.default.UNSAVED_CHANGES,N)??Promise.resolve(!0):Promise.resolve(!0)).then((t=>{if(t){this.#E=!1;const t=window.open("","","");t&&((this.#N=t).addEventListener("unload",(()=>this.#N=null)),t.document.head.append(n.title(this.name),o.render(),n.link({rel:"shortcut icon",sizes:"any",href:N})),t.document.body.classList.add($),t.document.body.append(h.parseBBCode(C.get(this.id)?.data.contents||"")),this.#y?.remove())}}))}show(){if(this.#y)this.#y.focus();else if(this.#N)this.#N.focus();else{const t=n.div({class:$},h.parseBBCode(C.get(this.id)?.data.contents||""));s.amendNode(m.shell,this.#y=m.windows({"window-title":this.name,"window-icon":N,"hide-minimise":!1,resizable:!0,style:"--window-width: 50%; --window-height: 50%",onclose:t=>this.#f(t),onremove:()=>{this.#y=null,this.#D=null,e.#m.delete(this)}},t)),this.#y.addControlButton(S,(()=>this.#w()),y.NOTE_POPOUT),this.#y.addControlButton(x,(()=>{if(e.#m.has(this))this.#E?this.#y?.confirm(I.default.ARE_YOU_SURE,I.default.UNSAVED_CHANGES,N).then((i=>{i&&(this.#E=!1,s.clearNode(this.#y,{"window-title":this.name,class:void 0},t),e.#m.delete(this))})):(s.clearNode(this.#y,{"window-title":this.name,class:void 0},t),e.#m.delete(this));else{e.#m.add(this);const o=C.get(this.id)||{user:!1,data:{contents:"",share:!1}},r=i.default(""),l=()=>r.value=(this.#E=M.value!==o.data.contents||g.checked!==o.data.share)?"*":"",M=n.textarea({ondragover:a.setDragEffect({link:[h.bbcodeDrag]}),oninput:l,ondrop:t=>{if(h.bbcodeDrag.is(t)){const{selectionStart:e,selectionEnd:i}=M,o=h.bbcodeDrag.get(t);o&&M.setRangeText(o(M.value.slice(Math.min(e,i),Math.max(e,i))))}}},o.data.contents),g=n.input({type:"checkbox",class:d.settingsTicker,checked:o.data.share,onchange:l});s.clearNode(this.#y,{"window-title":i.default`${y.NOTE_EDIT}${r}: ${this.name}`,class:V},[A.labels([y.NOTE,": "],M),n.br(),A.labels(g,[y.NOTE_SHARE,": "]),n.br(),n.button({onclick:()=>{o.data={contents:M.value,share:g.checked},C.set(this.id,o),u.rpc.pluginSetting(f,{[this.id+""]:o},[]),s.clearNode(t,h.parseBBCode(M.value)),l(),this.#x()}},y.NOTE_SAVE)])}}),y.NOTE_EDIT),this.#x()}}ondragstart(t){super.ondragstart(t),t.defaultPrevented||h.bbcodeDrag.set(t,this.#p)}delete(){this.#y?.remove(),this.#N?.close(),h.bbcodeDrag.deregister(this.#p)}#x(){C.has(this.id)&&C.get(this.id).data.share?this.#D??=this.#y.addControlButton(L.shareStr,(()=>{const t=C.get(this.id);t&&u.rpc.broadcastWindow("plugin-notes",this.id,t.data.contents)}),y.SHARE):(this.#D?.(),this.#D=null)}filter(t){const e=C.get(this.id)?.data.contents.toLowerCase()||"";return super.filter(t.every((t=>e.includes(t)))?[]:t)}}s.amendNode(window,{onbeforeunload:t=>{e.checkEditors()&&t.preventDefault()}});class D extends c.DragFolder{constructor(t,e,i,o){super(t,e,i,o,E,w)}removeItem(t){const e=super.removeItem(t);return k.delete(e),e}}let p=0;const E=new a.DragTransfer("pluginnote"),w=new a.DragTransfer("pluginnotefolder"),f=T.pluginName({url:"/plugins/notes.js"}),x=`data:image/svg+xml,%3Csvg xmlns="${g.ns}" viewBox="0 0 70 70" fill="none" stroke="%23000"%3E%3Cpolyline points="51,7 58,0 69,11 62,18 51,7 7,52 18,63 62,18" stroke-width="2" /%3E%3Cpath d="M7,52 L1,68 L18,63 M53,12 L14,51 M57,16 L18,55" /%3E%3C/svg%3E`,S=`data:image/svg+xml,%3Csvg xmlns="${g.ns}" viewBox="0 0 15 15"%3E%3Cpath d="M7,1 H1 V14 H14 V8 M9,1 h5 v5 m0,-5 l-6,6" stroke-linejoin="round" fill="none" stroke="currentColor" /%3E%3C/svg%3E`,C=new Map,k=new Map,O={user:!1,data:{folders:{},items:{}}},v=t=>{if(!(t instanceof Object&&t.folders instanceof Object&&t.items instanceof Object))return!1;for(const e in t.items)if(!l.isInt(t.items[e],0))return!1;for(const e in t.folders)if(!v(t.folders[e]))return!1;return!0},b=t=>t instanceof Object&&"string"==typeof t.contents,j=t=>{if(!(t instanceof Object&&t[""]instanceof Object&&!1===t[""].user&&v(t[""].data)))return O;for(const e in t)if(""!==e){const i=parseInt(e);!isNaN(i)&&t[e]instanceof Object&&!t[e].user&&b(t[e].data)&&(C.set(i,t[e]),i>p&&(p=i))}return t[""]},z=r.Subscription.bind(1),Y=r.Subscription.bind(1),_=r.Subscription.bind(1),P=r.Subscription.bind(1),G=r.Subscription.bind(1),R=r.Subscription.bind(1),U=new r.Subscription((()=>{})),W=j(T.getSettings(f)),Q=(t,e=W.data)=>{const i=t.split("/"),o=i.pop()??"";for(const t of i)if(t&&!(e=e.folders[t]))return[null,o];return[e,o]},Z=t=>{const e=t.split("/");t="";for(const i of e)i&&(t+=`/${i}`);return t},B=new c.Root(W.data,y.MENU_TITLE,{list:()=>Promise.resolve(W.data),createFolder:t=>{const[e,i]=Q(t);return e?e.folders[i]?(u.handleError(y.NAME_EXISTS_LONG),Promise.reject(y.NAME_EXISTS_LONG)):(e.folders[i]={folders:{},items:{}},u.rpc.pluginSetting(f,{"":W},[]),Promise.resolve(t)):(u.handleError(y.ERROR_INVALID_PATH),Promise.reject(y.ERROR_INVALID_PATH))},move:(t,e)=>{const[i,o]=Q(t),[s,a]=Q(e);if(!i||!s)return u.handleError(y.ERROR_INVALID_PATH),Promise.reject(y.ERROR_INVALID_PATH);const n=i.items[o];return void 0===n?(u.handleError(y.ERROR_INVALID_ITEM),Promise.reject(y.ERROR_INVALID_ITEM)):s.items[a]?(u.handleError(y.NAME_EXISTS_LONG),Promise.reject(y.NAME_EXISTS_LONG)):(delete i.items[o],s.items[a]=n,u.rpc.pluginSetting(f,{"":W},[]),Promise.resolve(e))},moveFolder:(t,e)=>{if(t=Z(t),(e=Z(e)).startsWith(t))return u.handleError(y.ERROR_INVALID_PATH),Promise.reject(y.ERROR_INVALID_PATH);const[i,o]=Q(t),[s,a]=Q(e);return i&&s?i.folders[o]?s.folders[a]?(u.handleError(y.NAME_EXISTS_LONG),Promise.reject(y.NAME_EXISTS_LONG)):(s.folders[a]=i.folders[o],delete i.folders[o],u.rpc.pluginSetting(f,{"":W},[]),Promise.resolve(e)):(u.handleError(y.ERROR_INVALID_FOLDER),Promise.reject(y.ERROR_INVALID_FOLDER)):(u.handleError(y.ERROR_INVALID_PATH),Promise.reject(y.ERROR_INVALID_PATH))},remove:t=>{const[e,i]=Q(t);if(!e)return u.handleError(y.ERROR_INVALID_PATH),Promise.reject(y.ERROR_INVALID_PATH);const o=e.items[i];return void 0===o?(u.handleError(y.ERROR_INVALID_ITEM),Promise.reject(y.ERROR_INVALID_ITEM)):(C.delete(o),delete e.items[i],u.rpc.pluginSetting(f,{"":W},[o+""]),Promise.resolve())},removeFolder:t=>{const[e,i]=Q(Z(t));if(!e)return u.handleError(y.ERROR_INVALID_PATH),Promise.reject(y.ERROR_INVALID_PATH);const o=e.folders[i];return o?0!==Object.keys(o.folders).length||0!==Object.keys(o.items).length?(u.handleError(y.ERROR_FOLDER_NOT_EMPTY),Promise.reject(y.ERROR_FOLDER_NOT_EMPTY)):(delete e.folders[i],u.rpc.pluginSetting(f,{"":W},[]),Promise.resolve()):(u.handleError(y.ERROR_INVALID_FOLDER),Promise.reject(y.ERROR_INVALID_FOLDER))},copy:(t,e)=>{const[i,o]=Q(e);if(!i)return u.handleError(y.ERROR_INVALID_PATH),Promise.reject(y.ERROR_INVALID_PATH);if(i.items[o])return u.handleError(y.NAME_EXISTS_LONG),Promise.reject(y.NAME_EXISTS_LONG);const s=++p,a=A.cloneObject(C.get(t));return i.items[o]=s,C.set(s,a),u.rpc.pluginSetting(f,{"":W,[s+""]:a},[]),Promise.resolve({id:s,path:e})},waitAdded:()=>z[0],waitMoved:()=>Y[0],waitRemoved:()=>_[0],waitCopied:()=>U,waitFolderAdded:()=>P[0],waitFolderMoved:()=>G[0],waitFolderRemoved:()=>R[0]},e,D),H=(t,e,i,o)=>{for(const s in t.folders){const a=i+s+"/";e.folders[s]?H(t.folders[s],e.folders[s],a,o):o[a]=-1}for(const s in e.folders)t.folders[s]||(o[i+s+"/"]=0);for(const s in t.items)e.items[s]?t.items[s]!==e.items[s]&&(o[""]=1):o[i+s]=-t.items[s];for(const s in e.items)t.items[s]?t.items[s]!==e.items[s]&&(o[""]=1):o[i+s]=e.items[s]},F=o.id(),$=o.id(),V=o.id();o.add({[`#${F}`]:{" ul":{"padding-left":"1em","list-style":"none"},">div>ul":{padding:0}},[`.${V} textarea`]:{width:"calc(100% - 10em)",height:"calc(100% - 5em)"},[`.${$}`]:{"user-select":"text","white-space":"pre-wrap","font-family":"'Andale Mono',monospace"}}),B.windowIcon=N,T.addPlugin("notes",{menuItem:{fn:[y.MENU_TITLE,n.div({id:F},[n.button({onclick:()=>m.shell.prompt(y.NOTES_NEW,[y.NOTES_NEW_LONG,": "],"").then((t=>{if(t)if(t.includes("/"))m.shell.alert(y.NAME_INVALID,y.NAME_INVALID_LONG);else if(B.getItem(`/${t}`))m.shell.alert(y.NAME_EXISTS,y.NAME_EXISTS_LONG);else{const e={user:!1,data:{contents:"",share:!1}};B.addItem(++p,t),C.set(W.data.items[t]=p,e),u.rpc.pluginSetting(f,{"":W,[p]:e},[])}}))},y.NOTES_NEW),B[M.node]]),!0,N]}}),u.rpc.waitPluginSetting().when((({id:t,setting:e,removing:i})=>{if(t===f){for(const t of i){const e=parseInt(t);isNaN(e)||C.delete(e)}for(const t in e)if(""===t){if(!v(e[""].data))continue;const t={};H(W.data,e[""].data,"/",t);const i=Object.keys(t);let o=!1;if(t[""]||i.length>2)o=!0;else if(1===i.length)t[i[0]]<0?i[0].endsWith("/")?R[1](i[0]):_[1](i[0]):i[0].endsWith("/")?P[1](i[0]):z[1]([{id:t[i[0]],name:i[0]}]);else if(2===i.length)if(i[0].endsWith("/")===i[1].endsWith("/"))if(i[0].endsWith("/")){const s={};t[i[0]]<0?H(Q(i[0])[0],Q(i[1],e[""].data)[0],"/",s):H(Q(i[0],e[""].data)[0],Q(i[1])[0],"/",s),0===Object.keys(s).length?G[1](t[i[0]]<0?{from:i[0],to:i[1]}:{from:i[1],to:i[0]}):o=!0}else t[i[0]]+t[i[1]]===0?Y[1](t[i[0]]<0?{from:i[0],to:i[1]}:{from:i[1],to:i[0]}):o=!0;else o=!0;o&&B.setRoot(e[""].data),W.data=e[""].data}else{const i=parseInt(t),o=e[t];!isNaN(i)&&b(o.data)&&C.set(i,o)}}})),h.registerTag("note",((e,i,o)=>{const a=i.next(!0).value;if(a&&t.isOpenTag(a)&&a.attr){const r=parseInt(a.attr);isNaN(r)||s.amendNode(e,t.process(n.span({class:d.psuedoLink,onclick:()=>k.get(r)?.show()}),i,o,a.tagName))}}))}else h.registerTag("note",e.none);return{}}],["/plugins/spells.js",async()=>{const[t,e,i,o,s,a,n,r,l,M,g,c,d,I,h,T,u]=await Promise.all(["/lib/css.js","/lib/dom.js","/lib/events.js","/lib/html.js","/lib/misc.js","/lib/svg.js","/colours.js","/ids.js","/keys.js","/language.js","/map.js","/map_fns.js","/map_tokens.js","/rpc.js","/settings.js","/shared.js","/tools.js"].map(include)),A={stroke:"#f00",fill:"rgba(255, 0, 0, 0.5)",style:"clip-path: none; pointer-events: none;"},L=a.circle(),m=a.g(A,L),y=a.path(),N=a.g(A,y),D=a.rect(),p=a.g(A,D),E=a.rect(),w=a.g(A,E),f=a.rect(),x=a.g(A,f),S=[m,N,p,w,x],C=new Map([[N,y],[p,D],[w,E],[x,f]]),k=(t,i)=>{const{gridSize:o,gridDistance:s}=g.mapData,a=o*t/(s||1),n=a>>1,r=o*i/(s||1);e.amendNode(L,{r:a}),e.amendNode(y,{d:`M0,0 L${a},-${n} q${.425*a},${n} 0,${a} z`}),e.amendNode(D,{x:-n,y:-n,width:a,height:a}),e.amendNode(E,{x:0,y:-r/2,width:a,height:r}),e.amendNode(f,{x:-n,y:-r/2,width:a,height:r})},O=["#ff0000","#ddddff","#00ff00","#0000ff","#ffffff","#000000","#ffff00","#996622","#000000"].map(((t,e)=>[n.hex2Colour(t),n.hex2Colour(t,8===e?255:128)]));let v=20,b=5;if(I.isAdmin){let n=m,A=!1,L=0,y=0,D=0,E=0,f=!1,j=!1;const z=M.makeLangPack({ADD_SPELL:"Add Spell to Map",DAMAGE_TYPE:"Damage Type",SPELL_SIZE:"Spell Size",SPELL_TYPE:"Spell Shape",SPELL_TYPE_CIRCLE:"Circle Spell",SPELL_TYPE_CONE:"Cone Spell",SPELL_TYPE_CUBE:"Cube Spell",SPELL_TYPE_LINE:"Line Spell",SPELL_TYPE_WALL:"Wall Spell",SPELL_WIDTH:"Spell Width",TITLE:"Spell Effects",TYPE_0:"Fire",TYPE_1:"Ice",TYPE_2:"Acid",TYPE_3:"Water",TYPE_4:"Steam",TYPE_5:"Necrotic",TYPE_6:"Lightning",TYPE_7:"Earth",TYPE_8:"Darkness"}),Y=t.id(),_=t=>{D=0,n!==t&&n.parentNode&&n.replaceWith(t),n=t,n!==N&&n!==w||R(),e.amendNode(tt,{style:{"--spell-display":n===w||n===x?"block":""}})},P=()=>I.rpc.broadcast({type:"plugin-spells",data:[S.indexOf(n)??0,v,b,L,y,D,E]}),G=()=>I.rpc.broadcast({type:"plugin-spells",data:null}),R=()=>{const{token:t}=d.selected;t?(e.amendNode(n,{transform:`translate(${L=Math.round(t.x+t.width/2)}, ${y=Math.round(t.y+t.height/2)})`}),n.parentNode||e.amendNode(g.root,n)):(N.remove(),w.remove())},U=o.input({type:"checkbox",checked:h.autosnap.value,class:r.settingsTicker}),W=()=>U.click(),[Q,Z]=i.keyEvent("Shift",W,W),[B,H]=i.mouseDragEvent(0,void 0,(()=>j=!1)),[F,$]=i.mouseDragEvent(2,void 0,(()=>{f=!1,G()})),[V,K]=i.mouseMoveEvent((t=>{if(j||n===N||n===w){const[i,o]=g.screen2Grid(t.clientX,t.clientY,U.checked);e.amendNode(C.get(n),{transform:`rotate(${D=s.mod(Math.round(180*Math.atan2(o-y,i-L)/Math.PI),360)})`})}else[L,y]=g.screen2Grid(t.clientX,t.clientY,U.checked),e.amendNode(n,{transform:`translate(${L}, ${y})`});f&&P()}),(()=>A=!1)),J=()=>{if(n!==N&&n!==w){const{layer:t}=d.selected;if(t){const{gridSize:e,gridDistance:i}=g.mapData,o=(n===m?2:1)*e*v/i,a=n===x?e*b/i:o;c.doTokenAdd(t.path,{id:0,x:L-(o>>1),y:y-(a>>1),width:o,height:a,rotation:s.mod(Math.floor(256*D/360),256),snap:U.checked,fill:O[E][1],stroke:O[E][0],strokeWidth:1,tokenType:1,isEllipse:n===m,lightColours:[],lightStages:[],lightTimings:[],tokenData:{}})}}},[X,q]=l.registerKeyEvent("spells-create",z.ADD_SPELL,"Enter",J),tt=o.div([T.labels([z.DAMAGE_TYPE,": "],o.select({onchange:function(){E=s.checkInt(parseInt(this.value),0,O.length-1);for(const t of S)e.amendNode(t,{stroke:O[E][0],fill:O[E][1]})}},Array.from({length:O.length},((t,e)=>o.option({value:e},z["TYPE_"+e]))))),o.fieldset([o.legend(z.SPELL_TYPE),[[m,"SPELL_TYPE_CIRCLE"],[N,"SPELL_TYPE_CONE"],[p,"SPELL_TYPE_CUBE"],[w,"SPELL_TYPE_LINE"],[x,"SPELL_TYPE_WALL"]].map((([t,e],i)=>[i>0?o.br():[],T.labels(o.input({type:"radio",name:"plugin-spell-type",checked:!i,class:r.settingsTicker,onclick:()=>_(t)}),[z[e],": "])]))]),T.labels(U,`${M.default.TOOL_MEASURE_SNAP}: `),o.br(),T.labels([z.SPELL_SIZE,": "],o.input({type:"number",min:1,value:v,onchange:function(){k(v=s.checkInt(parseInt(this.value),1,1e3,10),b)}})),o.div({style:"display: var(--spell-display, none)"},T.labels([z.SPELL_WIDTH,": "],o.input({type:"number",min:1,value:b,onchange:function(){k(v,b=s.checkInt(parseInt(this.value),1,1e3,10))}})))]),et=()=>{!A||n!==N&&n!==w||R()};u.addTool(Object.freeze({name:z.TITLE,id:"tool_spells",icon:a.svg({viewBox:"0 0 100 100"},[a.title(z.TITLE),a.g({fill:"currentColor",stroke:"currentColor"},[a.path({d:"M60,35 v70 h-20 v-100 h20 v30 h-20 v-30 h20","fill-rule":"evenodd",transform:"rotate(-45, 50, 50)"}),a.path({d:"M50,10 q0,10 10,10 q-10,0 -10,10 q0,-10 -10,-10 q10,0 10,-10",id:Y}),a.use({href:`#${Y}`,transform:"translate(5, 0) scale(1.5)"}),a.use({href:`#${Y}`,transform:"translate(-45, 30) scale(1.2)"}),a.use({href:`#${Y}`,transform:"translate(-30, -5) scale(0.8)"})])]),options:tt,mapMouseOver:function(t){return!A&&(A=!0,n===N||n===w?R():[L,y]=g.screen2Grid(t.clientX,t.clientY,U.checked),e.amendNode(n,{transform:`translate(${L}, ${y})`}),n!==N&&n!==w&&e.amendNode(this,n),X(),V(),!0)},mapMouse0:()=>n!==p&&n!==x||(j=!0,B(),!1),mapMouse2:()=>(f=!0,P(),F(),!1),tokenMouse0:function(t){return!this.previousSibling&&t.shiftKey},tokenMouse2:u.ignore,set:Q,unset:()=>{f&&(G(),f=!1),K(),$(),q(),H(),n?.remove(),Z()}})),T.mapLoadedReceive((()=>k(v,b))),d.tokenSelectedReceive(et);for(const t of["waitTokenMoveLayerPos","waitTokenSet","waitTokenSetMulti","waitLayerShift"])I.combined[t]().when((()=>setTimeout(et)))}else{let t=null;I.rpc.waitBroadcast().when((({type:i,data:o})=>{if("plugin-spells"!==i)return;if(null===o)return t?.remove(),void(t=null);if(!(o instanceof Array)||7!==o.length)return void console.log("plugin spells: broadcast data must be an array with length 7");const[a,n,r,l,M,c,d]=o,I=S[a];for(const[t,e]of[[s.isInt(a,0,S.length-1),"invalid type"],[s.isInt(n,1,1e3),"invalid size"],[s.isInt(r,1,1e3),"invalid width"],[s.isInt(l)&&s.isInt(M),"invalid coords"],[s.isInt(c,0,360),"invalid rotation"],[s.isInt(d,0,O.length-1),"invalid damage type"]])if(!t)return void console.log("plugin spells: "+e);t!==I&&(t?.remove(),e.amendNode(g.root,I)),k(v=n,b=r),e.amendNode(C.get(e.amendNode(t=I,{transform:`translate(${l}, ${M})`,stroke:O[d][0],fill:O[d][1]})),{transform:`rotate(${c})`})}))}return I.combined.waitGridDistanceChange().when((()=>setTimeout(k,0,v,b))),{}}]]);return i=>Promise.resolve(t.get(i)??e.get(i)?.()??import(i))})()});const e=(t,i=[])=>{if(r(t))i.push(t[M]);else if("string"==typeof t||t instanceof Node)i.push(t);else if(Array.isArray(t))for(const o of t)e(o,i);else(t instanceof NodeList||t instanceof HTMLCollection)&&i.push(...t);return i},i=t=>t instanceof Function||(t=>t instanceof Object&&t.handleEvent instanceof Function)(t)&&(!(c in t)||i(t[c])),o=t=>i(t)||t instanceof Array&&3===t.length&&i(t[0])&&t[1]instanceof Object&&"boolean"==typeof t[2],s=t=>t instanceof Object&&!n(t),a=t=>t instanceof CSSStyleDeclaration||t instanceof Object&&!n(t),n=t=>t instanceof Object&&g in t,r=t=>t instanceof Object&&M in t,l=(t,e)=>{const i=document.createAttributeNS(null,t);return i.textContent=e,i},M=Symbol("child"),g=Symbol("attr"),c=Symbol("value"),d=t=>t instanceof Array||"string"==typeof t||t instanceof Element||t instanceof DocumentFragment||t instanceof Text||r(t)||t instanceof NodeList||t instanceof HTMLCollection,I=(t,i,r)=>{if(i&&d(i))r=i;else if(i instanceof NamedNodeMap&&t instanceof Element)for(const e of i)t.setAttributeNode(e.cloneNode());else if(t&&"object"==typeof i){const e=!!((M=t).style&&M.classList&&M.removeAttribute&&M.setAttributeNode&&M.toggleAttribute);for(const r in i){const M=i[r];if(o(M)&&r.startsWith("on")){const e=M instanceof Array;t[e&&M[2]?"removeEventListener":"addEventListener"](r.slice(2),e?M[0]:M,!!e&&M[1])}else if(e)if("boolean"==typeof M)t.toggleAttribute(r,M);else if(void 0===M)t.removeAttribute(r);else if(M instanceof Array||M instanceof DOMTokenList){if("class"===r&&M.length)for(const e of M){const i=e.slice(0,1),o="!"!==i&&("~"!==i||void 0);t.classList.toggle(o?e:e.slice(1),o)}}else if("class"===r&&s(M))for(const e in M)t.classList.toggle(e,M[e]??void 0);else if("style"===r&&a(M))for(const[e,i]of M instanceof CSSStyleDeclaration?Array.from(M,(t=>[t,M.getPropertyValue(t)])):Object.entries(M))void 0===i?t.style.removeProperty(e):t.style.setProperty(e,i.toString());else null!==M&&t.setAttributeNode(M instanceof Attr?M:Object.assign(n(M)?M[g](r):l(r,M),{realValue:M}))}}var M;return t instanceof Node&&("string"!=typeof r||t.firstChild?r&&(r instanceof Node?t.appendChild(r):t instanceof Element||t instanceof DocumentFragment?t.append(...e(r)):t.appendChild(y(r))):t.textContent=r),t},h=(t,e)=>Object.defineProperty(((i,o)=>I(document.createElementNS(t,e),i,o)),"name",{value:e}),T=1,u=2,A=4,L=8,m=(t,e,i)=>[t,{once:!!(e&T),capture:!!(e&u),passive:!!(e&A),signal:i},!!(e&L)],y=t=>{const i=document.createDocumentFragment();return"string"==typeof t?i.textContent=t:t instanceof Node?i.append(t):void 0!==t&&i.append(...e(t)),i},N=(t,i,o)=>{if(!t)return t;if(i&&d(i)&&(i=void(o=i)),"string"==typeof o)o=void(t.textContent=o);else if(o&&t instanceof Element)o=void t.replaceChildren(...e(o));else for(;t.lastChild;)t.lastChild.remove();return I(t,i,o)},D=Symbol("setNode"),p=Symbol("update"),E=Symbol("remove");class w{#S=new Set;#s;#C=-1;#k(t){t&&this.#S.delete(t);for(const e of Array.from(this.#S))if(e instanceof WeakRef){const i=e.deref();i&&i!==t?(e instanceof w&&e.#S.size||e instanceof Text&&e.parentNode||e instanceof Attr&&e.ownerElement)&&(this.#S.delete(e),this.#S.add(i)):this.#S.delete(e)}else(e instanceof w&&!e.#S.size||e instanceof Text&&!e.parentNode||e instanceof Attr&&!e.ownerElement)&&(this.#S.delete(e),this.#S.add(new WeakRef(e)));-1!==this.#C&&(clearTimeout(this.#C),this.#C=-1),this.#S.size&&(this.#C=setTimeout(this.#s??=()=>this.#k(),5e4+Math.floor(2e4*Math.random())))}[g](t){const e=document.createAttributeNS(null,t);return e.textContent=this+"",this[D](e)}get[M](){return this[D](new Text(this+""))}[D](t){return this.#k(),this.#S.add(t),t}[p](){const t=this+"";for(const e of this.#S){const i=e instanceof WeakRef?e.deref():e;i instanceof w?i[p]():i&&(i.textContent=t)}this.#k()}[E](t){this.#k(t)}}class f extends w{#O;#v;constructor(t,...e){super(),this.#O=t,this.#v=e;for(const t of e)t instanceof w&&t[D](this)}toString(){let t="";for(let e=0;e<this.#O.length;e++)t+=this.#O[e]+(this.#v[e]??"");return t}}class x extends w{#b;constructor(t){super(),this.#b=t,t instanceof w&&t[D](this)}[c](){return this.value}get value(){return this.#b instanceof x?this.#b.value:this.#b}set value(t){this.#b!==t&&(this.#b instanceof w&&this.#b[E](this),this.#b=t,t instanceof w&&t[D](this)),this[p]()}handleEvent(t){const e=this.value;var i;e instanceof Function?e.call(t.currentTarget,t):(i=e)instanceof Object&&i.handleEvent instanceof Function&&e.handleEvent(t)}toString(){return this.value?.toString()??""}}const S=(t,e,...i)=>t instanceof Array&&e?new f(t,e,...i):new x(t);class C extends CSSStyleSheet{#j;#z;constructor(t="",e=0){super(),this.#j=b.test(t)?t:"_",this.#z=e}add(t,e={}){for(const[i,o]of"string"==typeof t?[[t,e]]:Object.entries(t))for(const t of j(i,o))this.insertRule(t,this.cssRules.length);return this}at(t,e){if(e){let i="";for(const t in e)for(const o of j(t,e[t]))i+=o;i&&this.insertRule(t+"{"+i+"}",this.cssRules.length)}else this.insertRule(t,this.cssRules.length);return this}id(){return this.#j+this.#z++}ids(t){return Array.from({length:t},(()=>this.id()))}toString(){let t="";for(const e of this.cssRules)t+=e.cssText;return t}render(){const t=document.createElement("style");return t.setAttribute("type","text/css"),t.textContent=this+"",t}}const k=t=>{const e=[],i=[];let o=0;for(let s=0;s<t.length;s++){const a=t.charAt(s);if('"'===a||"'"===a)for(s++;s<t.length;s++){const e=t.charAt(s);if("\\"===e)s++;else if(e===a)break}else","!==a||e.length?a===e.at(-1)?e.pop():"["===a?e.push("]"):"("===a&&e.push(")"):(i.push(t.slice(o,s)),o=s+1)}return i.push(t.slice(o,t.length)),i},O=(t,e)=>{const i=k(e);let o="";for(const e of k(t))for(const t of i)o+=(o.length?",":"")+e+t;return o},v=t=>Object.getPrototypeOf(t)===Object.prototype,b=/^\-?[_a-z\240-\377][_a-z0-9\-\240-\377]*$/i,j=(t,e)=>{const i=[];let o="";for(const s in e){const a=e[s];v(a)?i.push(...j(O(t,s),a)):o+=`${s}:${a};`}return o&&i.unshift(t+"{"+o+"}"),i},z=new C,Y=z.add.bind(z),_=z.at.bind(z),P=z.id.bind(z),G=z.ids.bind(z),R=z.render.bind(z),U=(t,e)=>{for(const i in e){const o=e[i];if(v(o)){const e=t[i]??={};v(e)&&U(e,o)}else t[i]=o}return t};let W=0;const Q={altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1},Z=new Set,B=new Map,H=new Map,F=t=>Object.assign(t,Q),$=(t,e)=>new KeyboardEvent(`key${t}`,F({key:e})),V=t=>new MouseEvent("mouseup",F({button:t,clientX:st,clientY:at,view:window})),K=new Map,J=new Map,X=Array.from({length:16},(()=>new Map)),q=(t,e)=>{Q.altKey=e.altKey,Q.ctrlKey=e.ctrlKey,Q.metaKey=e.metaKey,Q.shiftKey=e.shiftKey;const{key:i,target:o}=e,s=et(F({key:i}));if(t)o instanceof HTMLInputElement||o instanceof HTMLTextAreaElement||o instanceof HTMLSelectElement||o instanceof HTMLButtonElement||Z.has(s)||(tt(e,B.get(s)),Z.add(s));else{const t=s.charAt(0);for(const o of Z)o.startsWith(t)&&o.slice(1)!==i||(tt(e,H.get(o)),Z.delete(o))}},tt=(t,e)=>{if(e)for(const i of e)i[0](t),i[1]&&e.delete(i)},et=t=>(+!t.altKey+2*+!t.ctrlKey+4*+!t.metaKey+8*+!t.shiftKey).toString(16)+(t.key??""),it=t=>{const e=t.split("+").map((t=>t.trim())),i={altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1,key:e.at(-1)};for(const t of e)switch(t.toLowerCase()){case"alt":case"option":i.altKey=!0;break;case"control":case"ctrl":i.ctrlKey=!0;break;case"command":case"meta":case"super":case"windows":i.metaKey=!0;break;case"shift":i.shiftKey=!0}return et(i)},ot=(t,e)=>{let i=t.get(e);return i||t.set(e,i=new Set),i};let st=0,at=0;const nt=(t,e,i,o=!1)=>{const s=[e,o],a=[i,o],n=("string"==typeof t?[t]:t).filter((t=>!!t)).map(it),r=()=>{for(const t of n){if(e){const i=Z.has(t),a=t.slice(1);i&&t===et(F({key:a}))&&e($("down",a)),i&&o||ot(B,t).add(s)}i&&ot(H,t).add(a)}M=!0},l=(t=!0)=>{for(const e of n){const i=t&&Z.has(e)&&H.get(e)?.has(a)?a[0]:null;B.get(e)?.delete(s),H.get(e)?.delete(a),i?.($("up",e))}M=!1};let M=!1;return[r,l,(t,e=!0)=>{const i=M;i&&l(e),n.splice(0,n.length,...("string"==typeof t?[t]:t).filter((t=>!!t)).map(it)),i&&r()}]},rt=(t,e)=>{const i=W++;return[()=>{K.set(i,t),e&&J.set(i,e)},(t=!0)=>{const e=t?J.get(i):null;K.delete(i),J.delete(i),e?.()}]},lt=(t,e,i=(()=>{}))=>{const o=W++;return[()=>{e&&K.set(o,e),X[t].set(o,i)},(e=!0)=>{const i=e?X[t].get(o):null;K.delete(o),X[t].delete(o),i?.(V(t))}]},Mt=t=>{const e=it(t);for(const t of[B,H])if(t.get(e)?.size)return!0;return!1};for(const[t,e]of[["keydown",t=>q(!0,t)],["keyup",t=>q(!1,t)],["mousemove",t=>{st=t.clientX,at=t.clientY;for(const[,e]of K)e(t)}],["mouseup",t=>{const{button:e}=t;if(!(e<0||e>=16)&&Number.isInteger(e)){for(const[i,o]of X[e])o(t),K.delete(i);X[e].clear()}}],["blur",()=>{for(const t of Z)tt($("up",t),H.get(t)),Z.delete(t);for(let t=0;t<16;t++)if(X[t].size){const e=V(t);for(const[,i]of X[t])i(e);X[t].clear()}K.clear();for(const[t,e]of J)K.delete(t),e();J.clear()}]])window.addEventListener(t,e);const gt="http://www.w3.org/1999/xhtml",[ct,dt,It,ht,Tt,ut,At,Lt,mt,yt,Nt,Dt,pt,Et,wt,ft,xt,St,Ct,kt,Ot,vt,bt,jt,zt,Yt,_t,Pt,Gt,Rt,Ut,Wt,Qt,Zt,Bt,Ht,Ft,$t,Vt,Kt,Jt,Xt,qt,te,ee,ie,oe,se,ae,ne,re,le,Me,ge,ce,de,Ie,he,Te,ue,Ae,Le,me,ye,Ne,De,pe,Ee,we,fe,xe,Se,Ce,ke,Oe,ve,be,je,ze,Ye,_e,Pe,Ge,Re,Ue,We,Qe,Ze,Be,He,Fe,$e,Ve,Ke,Je,Xe,qe,ti,ei,ii,oi,si,ai,ni,ri,li,Mi,gi,ci,di,Ii]="a abbr address area article aside audio b base bdi bdo blockquote body br button canvas caption cite code col colgroup data datalist dd del details dfn dialog div dl dt em embed fieldset figcaption figure footer form h1 h2 h3 h4 h5 h6 head header hgroup hr html i iframe img input ins kbd label legend li link main map mark menu meta meter nav noscript object ol optgroup option output p picture pre progress q rp rt ruby s samp script section select slot small source span strong style sub summary sup table tbody td template textarea tfoot th thead time title tr track u ul var video wbr".split(" ").map((t=>h(gt,t))),hi=(t,e=-1/0,i=1/0)=>"number"==typeof t&&(0|t)===t&&t>=e&&t<=i,Ti=(t,e=-1/0,i=1/0,o=0)=>hi(t,e,i)?t:o,ui=(t,e)=>(t%e+e)%e,Ai=(t,e,i)=>(t.set(e,i),i),Li=(t,e)=>(t.push(e),e),mi=(t,e)=>(t.add(e),e),yi=(()=>{let t=Promise.resolve();return e=>t=t.finally(e)})(),Ni=(t,e=!0)=>(window.setTimeout((()=>{t.focus(),(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement)&&e&&t.select()}),0),t),Di=t=>{const e=document.createElement("template");return e.innerHTML=t,e.content},pi=Symbol("s");class Ei{#c;#b;#Y=[];constructor(t,e){this.#c=t,this.#b=e}get name(){return this.#c}get value(){return this.#b}[pi](t){return t+""}set(t){const e=this.#b,i=this[pi](this.#b=t);if(this.#b!==e||this.#b instanceof Object){null===i?window.localStorage.removeItem(this.#c):window.localStorage.setItem(this.#c,i);for(const e of this.#Y)e(t)}return this}remove(){return window.localStorage.removeItem(this.#c),this}wait(t){return t(this.#b),this.#Y.push(t),this}}class wi extends Ei{constructor(t){super(t,null!==window.localStorage.getItem(t))}[pi](t){return t?"":null}}class fi extends Ei{#_;#P;constructor(t,e=0,i=-1/0,o=1/0){const s=parseInt(window.localStorage.getItem(t)??"");super(t,isNaN(s)||s<i||s>o?e:s),this.#_=i,this.#P=o}set(t){return Number.isInteger(t)&&t>=this.#_&&t<=this.#P?super.set(t):this}}class xi extends Ei{#_;#P;constructor(t,e=0,i=-1/0,o=1/0){const s=parseFloat(window.localStorage.getItem(t)??"");super(t,isNaN(s)||s<i||s>o?e:s),this.#_=i,this.#P=o}set(t){return t>=this.#_&&t<=this.#P?super.set(t):this}}class Si extends Ei{constructor(t,e=""){super(t,window.localStorage.getItem(t)??e)}}class Ci extends Ei{constructor(t,e,i){const o=window.localStorage.getItem(t);let s=e;if(o)try{const t=JSON.parse(o);i(t)&&(s=t)}catch{}super(t,s)}save(){return this.set(this.value),this}[pi](t){return JSON.stringify(t)}}class ki{#G=new Map;#R=0;#U;#W="";constructor(t){this.#U=t}register(t){const e=this.#R+++"";return this.#G.set(e,t),e}get(t){t.preventDefault();const e=this.#G.get(t.dataTransfer?.getData(this.#U)||this.#W);return e instanceof Function?e():e?.transfer()}set(t,e,i,o=-5,s=-5){this.#W=e,t.dataTransfer?.setData(this.#U,e),i&&t.dataTransfer?.setDragImage(i,o,s)}deregister(t){this.#G.delete(t),this.#W===t&&(this.#W="")}is(t){return t.dataTransfer?.types.includes(this.#U)??!1}}class Oi{#Q;constructor(...t){this.#Q=Object.freeze(t)}get mimes(){return this.#Q}asForm(t,e){const i=new FormData;if(t.dataTransfer){t.preventDefault();for(const o of t.dataTransfer.files)i.append(e,o)}return i}is(t){if(t.dataTransfer?.types.includes("Files")){for(const e of t.dataTransfer.items)if("file"!==e.kind||!this.#Q.includes(e.type))return!1;return!0}return!1}}const vi=t=>e=>{if(e.dataTransfer)for(const i in t)for(const o of t[i]??[])if(o.is(e))return e.preventDefault(),e.dataTransfer.dropEffect=i,!0;return!1};class bi{#Z=[];get length(){return this.#Z.length}send(t){for(const e of this.#Z)e(t)}receive(t){if(t instanceof Function)this.#Z.push(t);else if(null!=t)throw new TypeError("pipe.receive requires function type")}remove(t){for(const[e,i]of this.#Z.entries())if(i===t)return void this.#Z.splice(e,1)}bind(t=7){return[1&t?t=>this.send(t):void 0,2&t?t=>this.receive(t):void 0,4&t?t=>this.remove(t):void 0]}}class ji{#B;request(...t){const e=this.#B;if(void 0===e)throw new Error("no responder set");return e instanceof Function?e(...t):e}responder(t){this.#B=t}}class zi{#H;#F;#$;#V;constructor(t){const[e,i]=(new bi).bind(3),o=new bi,[,s]=o.bind(2);t(e,(t=>{if(!o.length)throw t;o.send(t)}),(t=>this.#$=t)),this.#H=i,this.#F=s}when(t,e){const i=new zi(((i,o)=>{this.#H(t instanceof Function?e=>{try{i(t(e))}catch(t){o(t)}}:i),this.#F(e instanceof Function?t=>{try{i(e(t))}catch(t){o(t)}}:o)}));return i.#V=i.#$=this.#V??=()=>this.#$?.(),i}cancel(){this.#$?.()}catch(t){return this.when(void 0,t)}finally(t){return this.when((e=>(t(),e)),(e=>{throw t(),e}))}splitCancel(t=!1){const[e,i,o]=(new bi).bind(),[s,a,n]=(new bi).bind();let r=0;return this.when(e,s),()=>new zi(((e,s,l)=>{i(e),a(s),r++,l((()=>{o(e),n(s),l((()=>{})),!--r&&t&&this.cancel()}))}))}static merge(...t){return new zi(((e,i,o)=>{for(const o of t)o.when(e,i);o((()=>{for(const e of t)e.cancel()}))}))}static bind(t=7){let e,i,o;return[new zi(((t,s,a)=>{e=t,i=s,o=a})),1&t?e:void 0,2&t?i:void 0,4&t?o:void 0]}}class Yi{#K=0;#J=0;#X=0;#q=new bi;#tt=new bi;add(){this.#K++,this.#et()}done(){this.#J++,this.#et()}error(){this.#X++,this.#et()}onUpdate(t){return this.#q.receive(t),()=>this.#q.remove(t)}onComplete(t){return this.#tt.receive(t),()=>this.#tt.remove(t)}#et(){const t={waits:this.#K,done:this.#J,errors:this.#X};this.#q.send(t),this.#J+this.#X===this.#K&&this.#tt.send(t)}}class _i{#G;set(t){return this.#G=t}get(){const t=this.#G;return this.#G=void 0,t}}const Pi=Symbol("blur"),Gi=Symbol("disconnect"),Ri=Symbol("itemElement"),Ui=Symbol("menuElement"),Wi=[(new C).add({":host":{outline:"none",display:"inline-flex","flex-flow":"column wrap"},"::slotted(menu-item),::slotted(menu-submenu)":{display:"block","user-select":"none"}})],Qi=[(new C).add({":host":{position:"relative"},"::slotted(menu-item)":{display:"block"}})];class Zi extends HTMLElement{#it;#ot;constructor(){super(),I(this.attachShadow({mode:"closed",slotAssignment:"manual"}),this.#it=We()).adoptedStyleSheets=Wi,setTimeout(I,0,this,{tabindex:-1,onblur:()=>this[Pi](),onkeydown:t=>{const e=document.activeElement;switch(t.key){case"Escape":this.parentNode instanceof Hi||e?.blur?.();case"ArrowLeft":this.parentNode instanceof Hi&&this.parentNode[Ri]()?.focus();break;case"Enter":e instanceof Bi&&e.select();break;case"ArrowRight":const i=e?.parentNode;e instanceof Bi&&i instanceof Hi&&(i.select(),setTimeout((()=>{const t=i[Ui]();t&&t.#it.assignedNodes()[0]?.focus()})));break;case"Tab":t.preventDefault();case"ArrowDown":case"ArrowUp":const o=this.#it.assignedNodes().filter((t=>!t.hasAttribute("disabled"))),s=o.findIndex((t=>t.contains(e)));o.at("ArrowUp"===t.key?s<0?s:s-1:(s+1)%o.length)?.focus();break;default:const a=this.#it.assignedNodes().filter((e=>e.getAttribute("key")===t.key&&!e.hasAttribute("disabled")));a.at((a.findIndex((t=>t.contains(e)))+1)%a.length)?.focus(),1===a.length&&a[0]?.select()}t.stopPropagation()}}),new MutationObserver((()=>this.#it.assign(...Array.from(this.children).filter((t=>t instanceof Bi||t instanceof Hi))))).observe(this,{childList:!0})}[Pi](){setTimeout((()=>{this.contains(document.activeElement)||(this.parentNode instanceof Hi?this.parentNode[Pi]():this.remove())}))}connectedCallback(){if(!(this.parentNode instanceof Hi)){I(window,{onmousedown:m(this.#ot=t=>{this.contains(t.target)||this.remove()},u)});const{offsetParent:t}=this,e=parseInt(this.getAttribute("x")??"0")||0,i=parseInt(this.getAttribute("y")??"0")||0;I(this,{style:{position:"absolute",left:void 0,top:void 0,width:void 0,"max-height":t.clientHeight+"px",visibility:"hidden"}}),setTimeout((()=>{const o=2*Math.max(this.offsetWidth,this.scrollWidth)-this.clientWidth;I(this,{style:{visibility:void 0,position:"absolute",width:o+"px",left:Math.max(e+o<t.clientWidth?e:e-o,0)+"px",top:Math.max(i+this.offsetHeight<t.clientHeight?i:i-this.offsetHeight,0)+"px"}}),this.focus()}))}}disconnectedCallback(){this.#ot&&(I(window,{onmousedown:m(this.#ot,u|L)}),this.#ot=void 0);for(const t of this.children)t instanceof Hi&&t[Gi]()}}class Bi extends HTMLElement{constructor(){super(),setTimeout(I,0,this,{tabindex:-1,onblur:()=>this.parentNode?.[Pi]?.(),onclick:()=>this.select(),onmouseover:()=>{document.activeElement!==this&&this.focus()}})}focus(){this.hasAttribute("disabled")||this.parentNode instanceof Hi&&this.parentNode.hasAttribute("disabled")||super.focus()}select(){this.hasAttribute("disabled")||(this.parentNode instanceof Hi?this.parentNode.select():this.dispatchEvent(new CustomEvent("select",{cancelable:!0}))&&this.blur())}}class Hi extends HTMLElement{#it;#st;#at=null;#nt=null;#rt=!1;constructor(){super(),I(this.attachShadow({mode:"closed",slotAssignment:"manual"}),[this.#it=We(),this.#st=We()]).adoptedStyleSheets=Qi,new MutationObserver((()=>{this.#nt=null,this.#at=null;for(const t of this.children)if(!this.#nt&&t instanceof Bi){if(this.#it.assign(this.#nt=t),this.#at)return}else if(!this.#at&&t instanceof Zi&&(this.#at=t,this.#nt))return;this.#nt||this.#it.assign(),this.#at||this.#st.assign()})).observe(this,{childList:!0})}select(){if(!this.hasAttribute("disabled")){const t=this.#at;if(t){let e=this,i=0,o=0;for(;e instanceof Zi||e instanceof Hi;)i+=e.offsetLeft-e.clientWidth+e.offsetWidth,o+=e.offsetTop-e.clientHeight+e.offsetHeight,e=e.offsetParent;I(this,{open:!0}),this.#st.assign(I(t,{style:{position:"absolute",left:void 0,top:void 0,width:void 0,"max-height":e.clientHeight+"px",visibility:"hidden"}})),setTimeout((()=>{const s=2*Math.max(t.offsetWidth,t.scrollWidth)-t.clientWidth;I(t,{style:{visibility:void 0,position:"absolute",width:s+"px",left:Math.max(i+s+this.offsetWidth<e.clientWidth?this.offsetWidth:-s,-i)+"px",top:Math.max(o+t.offsetHeight<e.clientHeight?0:this.offsetHeight-t.offsetHeight,-o)+"px"}}),this.#rt=!0,t.focus()}))}}}[Ri](){return this.#nt}[Ui](){return this.#at}focus(){this.#nt?.focus()}[Pi](){this.#rt?this.#rt=!1:(I(this,{open:!1}),this.#st.assign(),this.parentNode?.[Pi]?.())}[Gi](){for(const t of this.#at?.children??[])t instanceof Hi&&t[Gi]();I(this,{open:!1}),this.#st.assign()}}customElements.define("menu-menu",Zi),customElements.define("menu-item",Bi),customElements.define("menu-submenu",Hi);const Fi=h(gt,"menu-menu"),$i=h(gt,"menu-item"),Vi=h(gt,"menu-submenu"),Ki=Symbol("node"),Ji=()=>0,Xi=(new Intl.Collator).compare,qi=t=>class extends t{[Ki]=this},to=(t,e)=>{for(;e.p.i&&t.s(e.i,e.p.i)*t.o<0;){e.n.p=e.p,e.p.n=e.n,e.n=e.p;const t=e.p.p;e.p.p=e,e.p=t,t.n=e}for(;e.n.i&&t.s(e.i,e.n.i)*t.o>0;){e.n.p=e.p,e.p.n=e.n,e.p=e.n;const t=e.n.n;e.n.n=e,e.n=t,t.p=e}return e.n.i?t.h.insertBefore(e.i[Ki],e.n.i[Ki]):t.h.appendChild(e.i[Ki]),e},eo=(t,e)=>{const i=e;if(e<0){e++;for(let o=t.p;o.i;e++,o=o.p)if(!e)return[o,t.l+i]}else if(e<t.l)for(let o=t.n;o.i;e--,o=o.n)if(!e)return[o,i];return[t,-1]},io=(t,e,i)=>(t.l++,to(t,e.n=e.n.p={p:e,n:e.n,i})),oo=(t,e)=>{e.p.n=e.n,e.n.p=e.p,e.i[Ki].parentNode===t.h&&t.h.removeChild(e.i[Ki]),t.l--},so=function*(t,e=0,i=1){for(let[o,s]=eo(t,e);o.i;s+=i,o=1===i?o.n:o.p)yield[s,o.i]},ao=t=>({[Ki]:t}),no=(t,e)=>{if(e&&(t.s=e,t.o=1,e===Ji))return;let i=t.n;for(t.n=t.p=t;i.i;){const e=i.n;i.p=t.p,i.n=t,to(t,t.p=t.p.n=i),i=e}},ro=t=>{[t.p,t.n]=[t.n,t.p],t.o*=-1;for(let e=t.n;e.i;e=e.n)[e.n,e.p]=[e.p,e.n],t.h.appendChild(e.i[Ki])},lo=(t,e,i,o)=>{const s=t.m.get(e);if(s){if(s.i===i&&s.p===o)return;oo(t,s)}t.m.set(e,Object.assign(io(t,o,i),{k:e}))},Mo=Symbol("realTarget"),go=(t,e)=>{if("number"==typeof t)return e(t);if("string"==typeof t){const i=parseInt(t);if(i.toString()===t)return e(i)}},co={has:(t,e)=>go(e,(e=>e>=0&&e<=t.length))||e in t,get:(t,e)=>go(e,(e=>t.at(e)))||t[e],set:(t,e,i)=>go(e,(e=>!!t.splice(e,1,i)))||!1,deleteProperty:(t,e)=>go(e,(e=>t.splice(e,1).length>0))||delete t[e]};class Io{#lt;[Mo];constructor(t,e=Ji,i=[]){const o=this.#lt={s:e,h:t,l:0,o:1};Object.defineProperty(this,Mo,{value:this}),o.p=o.n=o;for(const t of i)io(o,o.p,t);return new Proxy(this,co)}get[Ki](){return this[Mo].#lt.h}get length(){return this[Mo].#lt.l}at(t){const[e,i]=eo(this[Mo].#lt,t);return-1!==i?e.i:void 0}concat(...t){return Array.from(this.values()).concat(...t)}copyWithin(t,e,i){throw new Error("invalid")}*entries(){yield*so(this[Mo].#lt)}every(t,e){for(const[i,o]of so(this[Mo].#lt))if(!t.call(e,o,i,this))return!1;return!0}fill(t,e,i){throw new Error("invalid")}filter(t,e){const i=[];for(const[o,s]of so(this[Mo].#lt))t.call(e,s,o,this)&&i.push(s);return i}filterRemove(t,e){const i=this[Mo].#lt,o=[];for(let s=i.n,a=0;s.i;s=s.n,a++)t.call(e,s.i,a,this)&&(oo(i,s),o.push(s.i));return o}find(t,e){for(const[i,o]of so(this[Mo].#lt))if(t.call(e,o,i,this))return o}findIndex(t,e){for(const[i,o]of so(this[Mo].#lt))if(t.call(e,o,i,this))return i;return-1}findLast(t,e){for(const[i,o]of so(this[Mo].#lt,-1,-1))if(t.call(e,o,i,this))return o}findLastIndex(t,e){for(const[i,o]of so(this[Mo].#lt,-1,-1))if(t.call(e,o,i,this))return i;return-1}flat(t){return Array.from(this.values()).flat(t)}flatMap(t,e){return this.map(t,e).flat()}forEach(t,e){for(const[i,o]of so(this[Mo].#lt))t.call(e,o,i,this)}static from(t,e=ao){const i=new Io(t),o=i[Mo].#lt;for(const i of t.childNodes){const t=e(i);t&&(o.p=o.p.n={p:o.p,n:o,i:t},o.l++)}return i}includes(t,e=0){for(const[,i]of so(this[Mo].#lt,e))if(t===i)return!0;return!1}indexOf(t,e=0){for(const[i,o]of so(this[Mo].#lt,e))if(t===o)return i;return-1}join(t){return Array.from(this.values()).join(t)}*keys(){for(let t=0;t<this[Mo].#lt.l;t++)yield t}lastIndexOf(t,e=-1){for(const[i,o]of so(this[Mo].#lt,e,-1))if(t===o)return i;return-1}map(t,e){const i=[];for(const[o,s]of so(this[Mo].#lt))i.push(t.call(e,s,o,this));return i}pop(){const t=this[Mo].#lt,e=t.p;return e.i&&oo(t,e),e.i}push(t,...e){const i=this[Mo].#lt;io(i,i.p,t);for(const t of e)io(i,i.p,t);return i.l}reduce(t,e){for(const[i,o]of so(this[Mo].#lt))e=void 0===e?o:t(e,o,i,this);return e}reduceRight(t,e){for(const[i,o]of so(this[Mo].#lt,-1,-1))e=void 0===e?o:t(e,o,i,this);return e}reverse(){return ro(this[Mo].#lt),this}shift(){const t=this[Mo].#lt,e=t.n;return e.i&&oo(t,e),e.i}slice(t=0,e){const i=this[Mo].#lt,o=[];t<=-i.l&&(t=0),void 0===e?e=i.l:e<0&&(e+=i.l);for(const[s,a]of so(i,t)){if(s>=e)break;o.push(a)}return o}some(t,e){for(const[i,o]of so(this[Mo].#lt))if(t.call(e,o,i,this))return!0;return!1}sort(t){return no(this[Mo].#lt,t),this}splice(t,e=0,...i){const o=this[Mo].#lt,s=[];let[a]=eo(o,t),n=a.p;for(;a.i&&e>0;e--,a=a.n)s.push(a.i),oo(o,a);for(const t of i)n=io(o,n,t);return s}unshift(t,...e){const i=this[Mo].#lt;let o=io(i,i,t);for(const t of e)o=io(i,o,t);return i.l}*values(){for(let t=this[Mo].#lt.n;t.i;t=t.n)yield t.i}*[Symbol.iterator](){yield*this.values()}get[Symbol.unscopables](){return{__proto__:null,at:!0,copyWithin:!0,entries:!0,fill:!0,find:!0,findIndex:!0,findLast:!0,findLastIndex:!0,flat:!0,flatMap:!0,includes:!0,keys:!0,toLocaleString:void 0,toString:void 0,values:!0}}}class ho{#lt;constructor(t,e=Ji,i=[]){const o=this.#lt={s:e,h:t,l:0,o:1,m:new Map};o.p=o.n=o;for(const[t,e]of i)lo(o,t,e,o.p)}get[Ki](){return this.#lt.h}get size(){return this.#lt.l}clear(){const t=this.#lt;for(let e=t.n;e.i;e=e.n)oo(t,e);t.m.clear()}delete(t){const e=this.#lt,i=e.m.get(t);return!!i&&(oo(e,i),e.m.delete(t))}*entries(){for(const[t,e]of this.#lt.m)yield[t,e.i]}forEach(t,e=this){this.#lt.m.forEach(((i,o)=>t.call(e,i.i,o,this)))}get(t){return this.#lt.m.get(t)?.i}has(t){return this.#lt.m.has(t)}insertAfter(t,e,i){const o=this.#lt,s=o.m.get(i);return!!s&&(lo(o,t,e,s),!0)}insertBefore(t,e,i){const o=this.#lt,s=o.m.get(i);return!!s&&(lo(o,t,e,s.p),!0)}keyAt(t){for(;t<0;)t+=this.#lt.l;for(let e=this.#lt.n;e.i;t--,e=e.n)if(0===t)return e.k}keys(){return this.#lt.m.keys()}position(t){const e=this.#lt;let i=-1,o=e.m.get(t)??e;for(;o!==e;)o=o.p,i++;return i}reSet(t,e){const i=this.#lt,o=i.m.get(t);o&&(i.m.delete(t),o.k=e,i.m.set(e,o))}reverse(){return ro(this.#lt),this}set(t,e){const i=this.#lt;return lo(i,t,e,i.p),this}sort(t){return no(this.#lt,t),this}*values(){for(const t of this.#lt.m.values())yield t.i}*[Symbol.iterator](){yield*this.entries()}get[Symbol.species](){return ho}get[Symbol.toStringTag](){return"[object NodeMap]"}}const To="http://www.w3.org/2000/svg",uo=t=>"data:image/svg+xml,"+encodeURIComponent('<svg xmlns="'+To+'"'+(t instanceof SVGSVGElement?t.outerHTML.slice(4):t.outerHTML.slice(7,-7)+"svg>")),[Ao,Lo,mo,yo,No,Do,po,Eo,wo,fo,xo,So,Co,ko,Oo,vo,bo,jo,zo,Yo,_o,Po,Go,Ro,Uo,Wo,Qo,Zo,Bo,Ho,Fo,$o,Vo,Ko,Jo,Xo,qo,ts,es,is,os,ss,as,ns,rs,ls,Ms,gs,cs,ds,Is,hs,Ts,us,As,Ls,ms,ys,Ns,Ds,ps,Es,ws]="a animate animateMotion animateTransform circle clipPath defs desc ellipse feBlend feColorMatrix feComponentTransfer feComposite feConvolveMatrix feDiffuseLighting feDisplacementMap feDistantLight feDropShadow feFlood feFuncA feFuncB feFuncG feFuncR feGaussianBlur feImage feMerge feMergeNode feMorphology feOffset fePointLight feSpecularLighting feSpotLight feTile feTurbulence filter foreignObject g image line linearGradient marker mask metadata mpath path pattern polygon polyline radialGradient rect script set stop style svg switch symbol text textPath title tspan use view".split(" ").map((t=>h(To,t))),fs={once:!0},xs=new URL(window.location+""),Ss=(t,e={})=>new Promise(((i,o)=>{const s=new XMLHttpRequest;if(s.open(e.method??"GET",t),e.hasOwnProperty("headers")&&"object"==typeof e.headers)for(const[t,i]of Object.entries(e.headers))s.setRequestHeader(t,i);switch(void 0!==e.type&&s.setRequestHeader("Content-Type",e.type),(e.user||e.password)&&s.setRequestHeader("Authorization","Basic "+btoa(`${e.user??""}:${e.password??""}`)),s.addEventListener("readystatechange",(()=>{4===s.readyState&&(200===s.status?"json"===e.response&&e.checker&&!e.checker(s.response)?o(new TypeError("received JSON does not match expected format")):i("xh"===e.response?s:s.response):o(new Error(s.responseText)))})),e.onuploadprogress&&s.upload.addEventListener("progress",e.onuploadprogress),e.ondownloadprogress&&s.addEventListener("progress",e.ondownloadprogress),e.response){case"text":s.overrideMimeType("text/plain");break;case"xml":s.overrideMimeType("text/xml"),s.responseType="document";break;case"json":s.overrideMimeType("application/json");case"document":case"blob":case"arraybuffer":s.responseType=e.response}if(e.signal){const t=e.signal;t.addEventListener("abort",(()=>{s.abort(),o(t.reason instanceof Error?t.reason:new Error(t.reason))}),fs)}s.send(e.data??null)})),Cs=t=>new Promise(((e,i)=>{const o=new ks(t);o.addEventListener("open",(()=>{o.removeEventListener("error",i),e(o)}),fs),o.addEventListener("error",i,fs)}));class ks extends WebSocket{constructor(t,e){super(new URL(t,xs),e)}when(t,e){return new zi(((t,e,i)=>{const o=this,s=new AbortController,a={signal:s.signal};o.addEventListener("message",t,a),o.addEventListener("error",(t=>e(t.error)),a),o.addEventListener("close",(t=>{const i=new Error(t.reason);i.name="CloseError",e(i),s.abort()}),a),i((()=>s.abort()))})).when(t,e)}}xs.protocol="https"===xs.protocol?"wss":"ws";const[Os,vs,bs,js,zs,Ys,_s,Ps,Gs,Rs,Us,Ws,Qs,Zs,Bs,Hs,Fs,$s,Vs,Ks,Js,Xs]=G(22),qs=G(4),ta=new Si("language",navigator.language),ea=(t,e={})=>{const i={};for(const e in t)i[e]=S("");return ta.wait((o=>{const s=e[o];for(const e in t)i[e].value=s?.[e]??t[e]})),Object.freeze(i)},ia=["en-GB","en-US"],oa=ea({ARE_YOU_SURE:"Are you sure?",CANCEL:"Cancel",CHARACTER:"Character",CHARACTERS:"Characters",CHARACTER_CREATE:"Create Character",CHARACTER_DRAG_ICON:"Drag icon here",CHARACTER_EDIT:"Edit Character",CHARACTER_IMAGE:"Character Image",CHARACTER_NAME:"Character Name",CHARACTER_NEED_ICON:"A character needs an icon",CHARACTER_NEED_NAME:"A character needs a name",CHARACTER_NEW:"New Character",CLOSE:"Close",COLOUR:"Colour",COLOUR_ALPHA:"Alpha",COLOUR_UPDATE:"Update Colour",CONTEXT_DELETE:"Delete",CONTEXT_EDIT_TOKEN:"Edit Token Data",CONTEXT_FLIP:"Flip",CONTEXT_FLOP:"Flop",CONTEXT_MOVE_BOTTOM:"Move to Bottom",CONTEXT_MOVE_DOWN:"Move Down",CONTEXT_MOVE_LAYER:"Move to Layer",CONTEXT_MOVE_TOP:"Move to Top",CONTEXT_MOVE_UP:"Move Up",CONTEXT_SET_IMAGE:"Set as Image",CONTEXT_SET_LIGHTING:"Set Lighting",CONTEXT_SET_PATTERN:"Set as Pattern",CONTEXT_SNAP:"Snap",CONTEXT_UNSNAP:"Unsnap",CURRENT_LOCATION:"Current Location",ERROR:"Error",ERROR_UNKNOWN:"Unknown error occurred, connection closed",FILTER:"Filter",FILTER_CLEAR:"Clear Filter",FOLDER_ADD:"Add Folder",FOLDER_MOVE:"Move Folder",FOLDER_NAME:"Folder Name",FOLDER_REMOVE:"Remove Folder",FOLDER_REMOVE_CONFIRM:"Remove the following folder? NB: This will remove all folders and items it contains.",HELP:"Help",HELP_DEMO_DRAG:"The map can be moved around by left-click dragging it.",HELP_DEMO_SCROLL:"The map can also be moved around with the scroll wheel. Up & Down on the scroll wheel will move the map Up & Down, and holding the Shift key while scrolling will move the map Left & Right accordingly.",HELP_DEMO_SIDEPANEL_OPEN:"The Red outlined (Semi-)Circle can be used to toggle the display of the Sidepanel, where settings for the map are stored.",HELP_DEMO_SIDEPANEL_RESIZE:"When the Sidepanel is open, left-click dragging it will adjust the width of the sidebar.",HELP_DEMO_SIGNAL:"Right clicking on the map will produce a signal, an expanding circle, that both you and the GM are able to see.",HELP_DEMO_ZOOM:"The map can be zoomed In & Out by holding the Ctrl key on the keyboard and scrolling the mouse's scroll wheel Up & Down.",HELP_MAP_DRAG:"Map Moving",HELP_MAP_SCROLL:"Map Scrolling",HELP_MAP_SIGNAL:"Signalling",HELP_MAP_ZOOM:"Map Zoom",HELP_OPEN:"Press F1 anytime, or click here, to open Help",HELP_PANEL_OPEN:"Opening/Closing Side Panel",HELP_PANEL_RESIZE:"Resizing Side Panel",INVALID_ACTION:"Invalid Action",INVALID_REMOVE:"Cannot remove active map",INVALID_REMOVE_CONTAIN:"Cannot remove while containing active map",INVALID_RENAME:"Cannot rename active map",INVALID_RENAME_CONTAIN:"Cannot rename while containing active map",ITEM_COPY:"Copy Item",ITEM_COPY_ADD:"Copy Item",ITEM_COPY_NEW:"Copy To",ITEM_MOVE:"Move Item",ITEM_REMOVE:"Remove Item",ITEM_REMOVE_CONFIRM:"Remove the following item?",KEY_CENTRE_MAP:"Centre Map",KEY_HELP:"Help Key",KEY_LAYER_NEXT:"Next Layer Key",KEY_LAYER_PREV:"Previous Layer Key",KEY_PANEL_TOGGLE:"Toggle Panel Key",KEY_TOOL_NEXT:"Next Tool Key",KEY_TOOL_PREV:"Previous Tool Key",LAYER_ADD:"Add Layer",LAYER_GRID:"Grid",LAYER_LIGHT:"Light",LAYER_LIGHT_COLOUR:"Change Light Colour",LAYER_LIGHT_TOGGLE:"Toggle Light Display",LAYER_NAME:"Name",LAYER_RENAME:"Rename Layer",LAYER_TOGGLE_LOCK:"Toggle Layer Lock",LAYER_TOGGLE_VISIBILITY:"Toggle Visibility",LIGHTING_ADD_STAGE:"Add Light Stage",LIGHTING_ADD_TIMING:"Add Timing",LIGHTING_DRAG:"Drag Light Settings",LIGHTING_REMOVE_STAGE:"Remove Light Stage",LIGHTING_REMOVE_TIMING:"Remove Timing",LIGHTING_SET_COLOUR:"Set Lighting Colour",LIGHTING_STAGES:"Stages",LIGHTING_TIMING:"Light Timing (ms)",LOADING:"Loading\u2026",LOADING_MAP:"Loading Map",LOGIN:"Login",LOGOUT:"Logout",MAP_ADD:"Add Map",MAP_CHANGED:"Map Changed",MAP_CHANGED_LONG:"An error occurred because the map was changed",MAP_EDIT:"Edit Map",MAP_NAME:"Map Name",MAP_NEW:"New Map",MAP_NONE_SELECTED:"No Map Selected",MAP_SET_USER:"Set User Map",MAP_SQUARE_COLOUR:"Tile Line Colour",MAP_SQUARE_HEIGHT:"Height in Tiles",MAP_SQUARE_LINE:"Tile Line Width",MAP_SQUARE_SIZE:"Tile Size",MAP_SQUARE_TYPE:"Tile Type",MAP_SQUARE_TYPE_HEX_H:"Hexagon Tiles - Horizontal",MAP_SQUARE_TYPE_HEX_V:"Hexagon Tiles - Vertical",MAP_SQUARE_TYPE_SQUARE:"Square Tiles",MAP_SQUARE_WIDTH:"Width in Tiles",MAXIMISE:"Maximise",MINIMISE:"Minimise",MUSIC_ADD:"Add Music Pack",MUSIC_ADD_NAME:"Please enter a name for this new music pack",MUSIC_COPY:"Copy Music Pack",MUSIC_COPY_LONG:"Please enter a name for this music pack copy",MUSIC_DROP:"To add a track, drag an Audio Asset here",MUSIC_ENABLE:"Autoplay is disabled, please click here to enable",MUSIC_PAUSE:"Pause",MUSIC_PLAY:"Play",MUSIC_REMOVE:"Remove Music Pack",MUSIC_REMOVE_LONG:"Are you sure you wish to remove this music pack",MUSIC_RENAME:"Rename Music Pack",MUSIC_RENAME_LONG:"Please enter a new name for this music pack",MUSIC_STOP:"Stop",MUSIC_TRACK:"Track",MUSIC_TRACK_REMOVE:"Remove Music Track",MUSIC_TRACK_REMOVE_LONG:"Are you sure you wish to remove this track?",MUSIC_WINDOW_TITLE:"Music Pack",NAME:"Name",NEW_LOCATION:"New Location",OK:"Ok",OLD_LOCATION:"Old Location",PANEL_GRABBER:"Click to Show/Hide - Drag to Resize",PLUGINS:"Plugins",PLUGIN_REFRESH:"Refresh Page?",PLUGIN_REFRESH_REQUEST:"Plugin settings have change and a page refresh is required to load changes. Refresh the page now?",POPOUT:"Popout",RESTORE:"Restore",SAVE:"Save",SETTINGS_AUTH:"Authentication",SETTINGS_AUTOSNAP:"Autosnap",SETTINGS_CLEAR:"Clear Settings",SETTINGS_INVERT:"Invert Colours",SETTINGS_ENABLE_ANIMATION:"Enable Animations",SETTINGS_HIDE_MENU:"Hide Menu Button?",SETTINGS_KEYS:"Key Bindings",SETTINGS_KEYS_DELETE:"Delete Key Binding",SETTINGS_KEYS_NEW:"Enter New Key",SETTINGS_LANGUAGE:"Language",SETTINGS_LANGUAGE_SELECT:"Select Language",SETTINGS_LAYER_HIDDEN_OPACITY:"Hidden Layer Opacity",SETTINGS_LAYER_HIDDEN_SELECTED_OPACITY:"Selected Hidden Layer Opacity",SETTINGS_MAP:"Map Settings",SETTINGS_MEASURE_TOKEN_MOVE:"Automatically Measure Token Moves",SETTINGS_MINI_TOOLS:"Mini Tools Windows",SETTINGS_MUSIC_SORT:"Move Active Music Packs to Top",SETTINGS_PANEL_ON_TOP:"Show Side Panel above Windows",SETTINGS_RESET:"Reset",SETTINGS_RESET_CONFIRM:"Are you sure that you wish to clear all settings? This cannot be undone",SETTINGS_SCROLL_AMOUNT:"Scroll (zero is square width)",SETTINGS_TAB_ICONS:"Show Tab Icons",SETTINGS_THEME:"Theme & Layout",SETTINGS_UNDO_LIMIT:"Undo Limit (-1 for infinite, 0 to disable)",SETTINGS_ZOOM_SLIDER_HIDE:"Hide Zoom Slider",SHARE:"Share",TAB_AUDIO:"Audio",TAB_CHARACTERS:"Characters",TAB_IMAGES:"Images",TAB_LAYERS:"Layers",TAB_MAPS:"Maps",TAB_MUSIC_PACKS:"Music",TAB_SETTINGS:"Settings",TAB_TOOLS:"Tools",TITLE:"Battlemap",TOKEN:"Token",TOKEN_ADD:"Add Token",TOKEN_NEXT:"Next Token",TOKEN_NONE_SELECTED:"No token selected",TOKEN_ORDER:"Token Order",TOKEN_ORDER_NORMAL:"Normal",TOKEN_ORDER_SHUFFLE:"Shuffle",TOKEN_PREV:"Previous Token",TOKEN_REMOVE:"Remove Token?",TOKEN_REMOVE_CONFIRM:"Are you sure that you wish to remove this token?",TOKEN_REPLACE:"Replace Token?",TOKEN_REPLACE_CONFIRM:"Are you sure that you wish to replace the current token with the currently selected token?",TOKEN_SELECT:"Select Token",TOKEN_USE_SELECTED:"Use currently selected token",TOOL:"Tool",TOOL_DEFAULT:"Default",TOOL_DRAW:"Draw",TOOL_DRAW_ELLIPSE:"Ellipse",TOOL_DRAW_ERROR:"No Layer Selected",TOOL_DRAW_FILL_COLOUR:"Fill Colour",TOOL_DRAW_POLYGON:"Polygon",TOOL_DRAW_RECT:"Rectangle",TOOL_DRAW_SHAPE:"Draw Shape",TOOL_DRAW_SNAP:"Snap to Grid",TOOL_DRAW_STROKE_COLOUR:"Stroke Colour",TOOL_DRAW_STROKE_WIDTH:"Stroke Width",TOOL_MASK:"Mask Tool",TOOL_MASK_CLEAR:"Clear Mask",TOOL_MASK_CLEAR_CONFIRM:"Are you sure you wish to clear the mask?",TOOL_MASK_DRAW_SHAPE:"Draw Shape",TOOL_MASK_DRAW_TYPE:"Draw Type",TOOL_MASK_OPACITY:"Mask Opacity",TOOL_MASK_OPAQUE:"Opaque",TOOL_MASK_REMOVE:"Remove",TOOL_MASK_TRANSPARENT:"Transparent",TOOL_MEASURE:"Measuring Tool",TOOL_MEASURE_CELL:"Cell Distance",TOOL_MEASURE_DIAGONALS:"Measure Diagonals",TOOL_MEASURE_MULTI:"Multiple Measuring Points",TOOL_MEASURE_SNAP:"Snap to Grid",TOOL_MOVE:"Move All",TOOL_MULTIPLACE:"Multi-Place",TOOL_MULTIPLACE_MODE:"Grab Mode",TOOL_OPTIONS:"Options",TOOL_WALL:"Wall Tool",TOOL_WALL_COLOUR:"Wall Colour",TOOL_WALL_COLOUR_SET:"Set Wall Colour",TOOL_WALL_CONTINUOUS:"Continuous Placement",TOOL_WALL_LAYER:"Wall Layer",TOOL_WALL_MODE:"Wall Mode",TOOL_WALL_PLACE:"Place Wall",TOOL_WALL_SCATTER:"Wall Light Scattering",TOOL_WALL_SCATTER_SET:"Set Wall Light Scattering",TOOL_WALL_SELECT:"Select Wall",TOOL_WALL_SNAP:"Snap to Grid",TOOL_WALL_UNDERLAY:"Underlay Colour",UNDO_CHARACTER:"Character change",UNDO_LAYER_ADD:"Add Layer",UNDO_LAYER_FOLDER_ADD:"Add Layer Folder",UNDO_LAYER_HIDE:"Hide Layer",UNDO_LAYER_LOCK:"Lock Layer",UNDO_LAYER_MOVE:"Move Layer",UNDO_LAYER_RENAME:"Rename Layer",UNDO_LAYER_SHIFT:"Layer Shift",UNDO_LAYER_SHOW:"Show Layer",UNDO_LAYER_UNLOCK:"Unlock Layer",UNDO_LIGHT_COLOUR:"Map Light Colour",UNDO_MAP_CHANGE:"Map Settings Change",UNDO_MAP_DATA_REMOVE:"Map Data Remove",UNDO_MAP_DATA_SET:"Map Data Set",UNDO_MAP_LOAD:"Map Loaded",UNDO_MASK_ADD:"Mask Added",UNDO_MASK_REMOVE:"Mask Removed",UNDO_MASK_SET:"Mask Set",UNDO_REDO:"Redo",UNDO_TOKEN_ADD:"Token Add",UNDO_TOKEN_MOVE:"Token Move Layer/Position",UNDO_TOKEN_REMOVE:"Token Remove",UNDO_TOKEN_SET:"Token Update",UNDO_TOKEN_SET_MULTI:"Multi-Token Update",UNDO_UNDO:"Undo",UNDO_WALL_ADD:"Wall Add",UNDO_WALL_MODIFY:"Wall Modified",UNDO_WALL_MOVE:"Wall Move",UNDO_WALL_REMOVE:"Wall Remove",UNDO_WINDOW_REDOS:"Redo List",UNDO_WINDOW_TITLE:"Undo Debug",UNDO_WINDOW_UNDOS:"Undo List",UNSAVED_CHANGES:"There are unsaved changes, are you sure you wish to close?",UPLOAD_AUDIO:"Upload Sound",UPLOAD_IMAGES:"Upload Image",UPLOADING:"Uploading Files..."},{"en-US":{COLOUR:"Color",COLOUR_UPDATE:"Update Color",KEY_CENTRE_MAP:"Center Map",LAYER_LIGHT_COLOUR:"Change Light Color",LIGHTING_SET_COLOUR:"Set Lighting Color",MAP_SQUARE_COLOUR:"Tile Line Color",MAXIMISE:"Maximize",MINIMISE:"Minimize",SETTINGS_INVERT:"Invert Colors",TOOL_DRAW_FILL_COLOUR:"Fill Color",TOOL_DRAW_STROKE_COLOUR:"Stroke Color",TOOL_WALL_COLOUR:"Wall Color",TOOL_WALL_COLOUR_SET:"Set Wall Color",TOOL_WALL_UNDERLAY:"Underlay Color",UNDO_LIGHT_COLOUR:"Map Light Color"}}),sa="complete"===document.readyState?Promise.resolve():new Promise((t=>window.addEventListener("load",t,{once:!0}))),aa=()=>{},na=[aa,aa],ra=(t,e)=>{const i=new Set;return t.set(e,i),i};class la{code;message;data;constructor(t,e,i){this.code=t,this.message=e,this.data=i,Object.freeze(this)}get name(){return"RPCError"}toString(){return this.message}}class Ma{#ot;#z=0;#Mt=new Map;#gt=new Map;constructor(t){this.#ct(t)}#ct(t){(this.#ot=t).when((({data:t})=>{const e=JSON.parse(t),i="string"==typeof e.id?parseInt(e.id):e.id,o=e.error,s=+!!o,a=o?new la(o.code,o.message,o.data):e.result;if(i>=0)(this.#Mt.get(i)??na)[s](a),this.#Mt.delete(i);else for(const t of this.#gt.get(i)??[])t[s](a)}),(t=>{this.close();for(const[,e]of this.#Mt)e[1](t);for(const[,e]of this.#gt)for(const i of e)i[1](t)}))}reconnect(t){this.#ot?.close(),this.#ct(t)}request(t,e,i){const o=this.#ot;return o?new Promise(((s,a)=>{i??=e instanceof Function?e:void 0;const n=this.#z++;this.#Mt.set(n,[t=>!i||i(t)?s(t):a(new TypeError("invalid type")),a]),o.send(JSON.stringify({id:n,method:t,params:e instanceof Function?void 0:e}))})):Promise.reject("RPC Closed")}await(t,e){const i=[aa,aa],o=this.#gt,s=o.get(t)??ra(o,t),a=new Promise(((t,o)=>{i[0]=i=>!e||e(i)?t(i):o(new TypeError("invalid type")),i[1]=o,s.add(i)}));return a.finally((()=>s.delete(i))).catch((()=>{})),a}subscribe(t,e){return new zi(((i,o,s)=>{const a=[t=>!e||e(t)?i(t):o(new TypeError("invalid type")),o],n=this.#gt,r=n.get(t)??ra(n,t);r.add(a),s((()=>r.delete(a)))}))}close(){this.#ot?.close(),this.#ot=null}}const ga=P(),ca=As({style:"width: 0"}),da=t=>{const e=P();return I(ca,I(t,{id:e})),[(t={})=>As(t,[t.title instanceof w?Ds(t.title):[],Es({href:`#${e}`})]),uo(t)]},[Ia,ha]=da(ms({viewBox:"0 0 34 37"},rs({d:"M14,6 h-13 v30 h21 v-22 z v8 h8 M12,6 v-5 h13 l8,8 v22 h-11 m11,-22 h-8 v-8 M6,20 h11 m-11,5 h11 m-11,5 h11",stroke:"currentColor",fill:"none"}))),[Ta,ua]=da(ms({viewBox:"0 0 37 28"},qo({"stroke-width":2,stroke:"currentColor",fill:"none","stroke-linejoin":"round"},[rs({d:"M32,27 h-30 v-20 h2 l5,-5 h5 l5,5 h13 v3"}),rs({d:"M31,27 h1 v-20 h-30",style:"display: var(--folder-closed, block)"}),rs({d:"M31,27 h1 l5,-16 h-30 l-5,16",style:"display: var(--folder-open, none)"})]))),[Aa,La]=da(ms({viewBox:"0 0 24 20"},rs({d:"M1,4 h22 v15 h-22 Z m2,0 l3,-3 h5 l3,3 m3,2 v12 m-6,-6 h12",stroke:"currentColor",fill:"none","stroke-linejoin":"round"}))),[ma,ya]=da(ms({viewBox:"0 0 10 10"},rs({d:"M1,1 v8 l8,-4 z",fill:"currentColor"}))),[Na,Da]=da(ms({viewBox:"0 0 15 15"},rs({d:"M7,1 H1 V14 H14 V8 M9,1 h5 v5 m0,-5 l-6,6","stroke-linejoin":"round",fill:"none",stroke:"currentColor"}))),[pa,Ea]=da(ms({viewBox:"0 0 32 34"},rs({d:"M10,5 v-3 q0,-1 1,-1 h10 q1,0 1,1 v3 m8,0 h-28 q-1,0 -1,1 v2 q0,1 1,1 h28 q1,0 1,-1 v-2 q0,-1 -1,-1 m-2,4 v22 q0,2 -2,2 h-20 q-2,0 -2,-2 v-22 m2,3 v18 q0,1 1,1 h3 q1,0 1,-1 v-18 q0,-1 -1,-1 h-3 q-1,0 -1,1 m7.5,0 v18 q0,1 1,1 h3 q1,0 1,-1 v-18 q0,-1 -1,-1 h-3 q-1,0 -1,1 m7.5,0 v18 q0,1 1,1 h3 q1,0 1,-1 v-18 q0,-1 -1,-1 h-3 q-1,0 -1,1",stroke:"currentColor",fill:"none"}))),[wa,fa]=da(ms({viewBox:"0 0 30 20"},rs({d:"M1,5 v10 h28 v-10 Z M17,1 h10 m-5,0 V19 m-5,0 h10",stroke:"currentColor","stroke-linejoin":"round",fill:"none"}))),[xa,Sa]=da(ms({viewBox:"0 0 10 10"},No({cx:5,cy:5,r:4,"stroke-width":2,stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-dasharray":"12 12"},yo({attributeName:"transform",type:"rotate",from:"0 5 5",to:"360 5 5",dur:"2s",repeatCount:"indefinite"})))),[Ca,ka]=da(ms({viewBox:"0 0 90 90"},rs({d:"M75,15 c-15,-15 -45,-15 -60,0 c-15,15 -15,45 0,60 c15,15 45,15 60,0 c15,-15 15,-45 0,-60 z M25,25 v40 h40 v-40 z",fill:"currentColor",stroke:"none","fill-rule":"evenodd"}))),[Oa,va]=da(ms({viewBox:"0 0 47 47"},[ds({width:47,height:47,fill:"#eee"}),qo({style:"display: var(--map-selected, none)"},[ds({width:47,height:47,fill:"#cfc"}),rs({d:"M3,17 H11 V27 H35 V17 H43 V40 H3 M14,6 H32 V24 H14"})])])),[ba,ja]=da(ms({viewBox:"0 0 47 47"},[rs({d:"M3,17 H11 V27 H35 V17 H43 V40 H3 M14,6 H32 V24 H14",fill:"currentColor"}),qo({"stroke-width":6},[rs({d:"M10,30 L20,47 L47,0",stroke:"#0f0",fill:"none",style:"display: var(--check-on, block)"}),rs({d:"M10,47 L47,0 M10,0 L47,47",stroke:"#f00",fill:"none",style:"display: var(--check-off, none)"})])])),[za,Ya]=da(ms({viewBox:"0 0 100 70"},[wo({cx:50,cy:35,rx:49,ry:34,"stroke-width":2,stroke:"#000",fill:"#fff"}),qo({style:"display: var(--invisible, block)"},[No({cx:50,cy:35,r:27,stroke:"#888","stroke-width":10}),No({cx:59,cy:27,r:10,fill:"#fff"})])])),[_a,Pa]=da(ms({viewBox:"0 0 44 75",stroke:"currentColor",fill:"none","stroke-linejoin":"round","stroke-linecap":"round"},[rs({d:"M12,61 c0,-20 -30,-58 10,-60 c40,2 10,40 10,60 q-10,3 -20,0 Z","stroke-width":2,style:"fill: var(--off, #fff)"}),rs({id:ga,d:"M12,61 q-2,2 0,4 q10,3 20,0 q2,-2 0,-4"}),Es({href:`#${ga}`,y:4}),Es({href:`#${ga}`,y:8})])),[Ga,Ra]=da(ms({viewBox:"0 0 33 33"},[rs({d:"M11,0 V33 M22,0 V33 M0,11 H33 M0,22 H33",stroke:"#000"}),["#800","#880","#808","#880","#080","#088","#088","#808","#008"].map(((t,e)=>ds({x:11*(e/3|0)+2,y:e%3*11+2,width:7,height:7,fill:t})))])),[Ua,Wa]=da(ms({viewBox:"0 0 20 20"},[No({cx:3,cy:10,r:3}),No({cx:17,cy:3,r:3}),No({cx:17,cy:17,r:3}),rs({d:"M17,3 L3,10 17,17",stroke:"#000",fill:"none"})])),[Qa,Za]=da(ms({viewBox:"0 0 70 100",style:"stroke: currentColor","stroke-width":2,"stroke-linejoin":"round"},[rs({d:"M15,45 v-20 a1,1 0,0,1 40,0 a1,1 0,0,1 -10,0 a1,1 0,0,0 -20,0 v20 z",fill:"#ccc",style:"display: var(--unlocked, block)"}),rs({d:"M15,45 v-20 a1,1 0,0,1 40,0 v20 h-10 v-20 a1,1 0,0,0 -20,0 v20 z",fill:"#ccc",style:"display: var(--locked, none)"}),ds({x:5,y:45,width:60,height:50,fill:"#aaa","stroke-width":4,rx:10}),rs({d:"M30,78 l2,-8 c-7,-12 13,-12 6,0 l2,8 z",fill:"#666",stroke:"#000","stroke-linejoin":"round"})])),[Ba,Ha]=da(ms({viewBox:"0 0 73 50"},[rs({d:"M5,0 H45 s5,0 10,5 L70,20 s5,5 0,10 L55,45 s-5,5 -10,5 H5 s-5,0 -5,-5 V5 s0,-5 5,-5 z",fill:"#000"}),rs({d:"M15,10 l30,30 M15,40 l30,-30",stroke:"#fff","stroke-width":8,"stroke-linecap":"round"})])),Fa=function(t){if("Enter"===t.key)for(let t=this.nextSibling;t;t=t.nextSibling)if(t instanceof HTMLButtonElement){t.click();break}},[$a,Va]=(new bi).bind(3),Ka=(t,e,i={})=>{const o={id:i.for=P()};return t instanceof HTMLInputElement||t instanceof HTMLButtonElement||t instanceof HTMLTextAreaElement||t instanceof HTMLSelectElement?[I(t,o),de(i,e)]:[de(i,t),I(e,o)]},Ja=(()=>{const t=new Map,e=i=>{if(i instanceof Object&&!Object.isFrozen(i)){const o=t.get(i);if(o)return o;if(Array.isArray(i)){const o=[];t.set(i,o);for(const t of i)o.push(e(t));return o}const s={};t.set(i,s);for(const t in i)i.hasOwnProperty(t)&&(s[t]=e(i[t]));return s}return i};return i=>{const o=e(i);return t.clear(),o}})(),Xa=new Map,[qa,tn]=(()=>{const t=Symbol("tokens");return[e=>{let i=e[t];if(void 0===i||0===i.length){const o=e["store-image-data"];if(o){if(!(o.data instanceof Array))return Ja(o.data);if(e[t]=i=Array.from(o.data),e?.tokens_order?.data)for(let t=i.length-1;t>=0;t--){const e=Math.floor(Math.random()*i.length);[i[t],i[e]]=[i[e],i[t]]}else i.reverse()}}const o=i?.pop();return o?Ja(o):null},e=>delete e[t]]})(),en=new Map,on=()=>[Kt(oa.LOADING),xa({style:"width: 64px"})],sn=[],an={CANCEL:"Cancel",CLOSE:"Close",MAXIMISE:"Maximise",MINIMISE:"Minimise",OK:"Ok",RESTORE:"Restore"},nn=[(new C).add({":host":{display:"block",position:"relative",overflow:"hidden",width:"var(--shell-width, 100%)",height:"var(--shell-height, 100%)"},"::slotted(windows-window)":{"--taskmanager-on":"none"},"::slotted(windows-window:last-of-type)":{"--overlay-on":"none"}})],rn=[(new C).add(":host",{position:"absolute",top:0,left:0,bottom:0,right:0})],ln=[(new C).add(":host",{position:"absolute",display:"block","background-color":"#fff",color:"#000",border:"1px solid #000",width:"var(--window-width, auto)",height:"var(--window-height, auto)","min-width":"100px","min-height":"100px",top:"var(--window-top, 0)",left:"var(--window-left, 0)","list-style":"none",padding:0,"z-index":0,"([maximised])":{left:0,right:0,top:0,bottom:0,width:"auto",height:"auto",">div:nth-child(2)>div>button:nth-of-type(2)":{"background-image":`url('data:image/svg+xml,%3Csvg viewBox="0 0 15 13" xmlns="${To}"%3E%3Cpath d="M1,5 h8 v-1 h-8 v8 h8 v-8 m-3,0 v-3 h8 v8 h-5 m5,-7 h-8" stroke="%23000" fill="none" /%3E%3C/svg%3E')`}},"([resizable])":{"border-width":0,">div":{":nth-child(1)":{display:"block"},":nth-child(3)":{overflow:"auto",position:"absolute",bottom:0,left:0,right:0,top:"calc(1em + 6px)"},":nth-child(4)":{top:"var(calc(--window-resize), -2px)",left:"var(calc(--window-resize), -2px)",bottom:"var(calc(--window-resize), -2px)",right:"var(calc(--window-resize), -2px)"}}},">div":{":nth-child(1)>div":{position:"absolute","border-color":"currentColor","border-style":"solid","border-width":0,"z-index":-1,":nth-child(1)":{top:"-2px",left:"-2px",width:"10px",height:"10px",cursor:"nwse-resize","border-left-width":"3px","border-top-width":"3px"},":nth-child(2)":{top:"-2px",left:"8px",right:"8px","border-top-width":"3px",cursor:"ns-resize"},":nth-child(3)":{top:"-2px",right:"-2px",width:"10px",height:"10px","border-top-width":"3px","border-right-width":"3px",cursor:"nesw-resize"},":nth-child(4)":{top:"8px",right:"-2px",bottom:"8px","border-right-width":"3px",cursor:"ew-resize"},":nth-child(5)":{bottom:"-2px",right:"-2px",width:"10px",height:"10px","border-right-width":"3px","border-bottom-width":"3px",cursor:"nwse-resize"},":nth-child(6)":{bottom:"-2px",left:"8px",right:"8px","border-bottom-width":"3px",cursor:"ns-resize"},":nth-child(7)":{bottom:"-2px",left:"-2px",width:"10px",height:"10px","border-left-width":"3px","border-bottom-width":"3px",cursor:"nesw-resize"},":nth-child(8)":{top:"8px",left:"-2px",bottom:"8px","border-left-width":"3px",cursor:"ew-resize"}},":nth-child(2)":{"white-space":"nowrap",height:"calc(1em + 6px)","background-color":"#aaa",overflow:"hidden","user-select":"none",display:"flex","align-items":"center",">span":{"margin-right":"calc(3em + 24px)"},">img":{height:"1em","pointer-events":"none"},">div":{position:"absolute",right:0,top:0,">button":{":nth-of-type(1)":{"background-image":`url('data:image/svg+xml,%3Csvg viewBox="0 0 10 10" xmlns="${To}"%3E%3Cpath d="M1,1 L9,9 M9,1 L1,9" stroke="black" /%3E%3C/svg%3E')`},":nth-of-type(2)":{"background-image":`url('data:image/svg+xml,%3Csvg viewBox="0 0 10 10" xmlns="${To}"%3E%3Cpath d="M9,3 h-8 v-1 h8 v-1 h-8 v8 h8 v-8" stroke="black" fill="none" /%3E%3C/svg%3E')`},":nth-of-type(3)":{display:"var(--taskmanager-on, block)","background-image":`url('data:image/svg+xml,%3Csvg viewBox="0 0 10 10" xmlns="${To}"%3E%3Cline x1="1" y1="9" x2="9" y2="9" stroke="black" /%3E%3C/svg%3E')`}}}," button":{padding:0,"border-width":"2px",float:"right","background-repeat":"no-repeat","background-position":"center","background-color":"#eee","background-size":"1em 1em",width:"calc(1em + 8px)",height:"calc(1em + 8px)"}},":nth-child(3)":{"user-select":"contain",":not(.hasChild)+div:nth-child(5)":{"pointer-events":"none"}},":nth-child(4)":{display:"var(--overlay-on, block)",position:"absolute","background-color":"RGBA(0, 0, 0, 0.1)",top:0,left:0,bottom:0,right:0,"pointer-events":"none"}},"([minimised]),>div:nth-child(1),([hide-titlebar])>div:nth-child(2),([hide-close])>div:nth-child(2)>div>button:nth-of-type(1),([hide-maximise])>div:nth-child(2)>div>button:nth-of-type(2),([hide-minimise])>div:nth-child(2)>div>button:nth-of-type(3),([window-hide])>div:nth-child(2)>div>button:nth-of-type(3)":{display:"none"}})];let Mn=null,gn=!1;class cn extends HTMLElement{alert(t,e,i){return new Promise(((o,s)=>{const a=An({"window-hide":!0,"window-icon":i,"window-title":t,"hide-maximise":!0,onremove:()=>o(!1)},[Gt(e),Gt({style:"text-align: center"},Ni(wt({onclick:()=>{o(!0),a.remove()}},an.OK)))]);this.addWindow(a)||s(new Error("invalid target"))}))}confirm(t,e,i){return new Promise(((o,s)=>{const a=An({"window-hide":!0,"window-icon":i,"window-title":t,"hide-maximise":!0,onremove:()=>o(!1)},[Gt(e),Gt({style:"text-align: center"},[Ni(wt({onclick:()=>{o(!0),a.remove()}},an.OK)),wt({onclick:()=>a.remove()},an.CANCEL)])]);this.addWindow(a)||s(new Error("invalid target"))}))}prompt(t,e,i="",o){return new Promise(((s,a)=>{const n=()=>{s(r.value),l.remove()},r=Ni(Me({value:i,onkeydown:t=>{switch(t.key){case"Enter":n();break;case"Escape":l.remove()}}})),l=An({"window-hide":!0,"window-icon":o,"window-title":t,"hide-maximise":!0,onremove:()=>s(null)},[Gt(e),r,Gt({style:"text-align: center"},wt({onclick:n},an.OK))]);this.addWindow(l)||a(new Error("invalid target"))}))}}class dn extends cn{constructor(){super(),new.target===dn&&(I(this.attachShadow({mode:"closed"}),[We({name:"desktop"}),Gt(We())]).adoptedStyleSheets=nn)}addWindow(t){return t.parentNode!==this?I(this,t):t.nextElementSibling&&t.focus(),!0}realignWindows(){const{offsetWidth:t,offsetHeight:e}=this;for(const i of this.childNodes)if(i instanceof hn){const{offsetLeft:o,offsetTop:s,offsetWidth:a,offsetHeight:n}=i;o+a>t?I(i,{style:{"--window-left":Math.max(t-a,0)+"px"}}):o<0&&I(i,{style:{"--window-left":"0px"}}),s+n>e?I(i,{style:{"--window-top":Math.max(e-n)+"px"}}):s<0&&I(i,{style:{"--window-top":"0px"}})}}}class In extends HTMLElement{constructor(){super(),setTimeout(I,0,this,{slot:"desktop"}),I(this.attachShadow({mode:"closed"}),We({slot:"desktop"})).adoptedStyleSheets=rn}attributeChangedCallback(t,e,i){"slot"===t&&"desktop"!==i&&I(this,{slot:"desktop"})}static get observedAttributes(){return["slot"]}}class hn extends cn{#dt;#It;#n;#ht;#Tt=null;#ut=null;#At;constructor(){super();const t=()=>this.focus();I(this.attachShadow({mode:"closed"}),{onclick:m(t,u)},[Gt(Array.from({length:8},((t,e)=>Gt({onmousedown:t=>((t,e,i)=>{const o=t.parentNode;if(gn||!(o instanceof dn)||0!==i.button)return;gn=!0,I(o,{style:{"user-select":"none"}});const s=t.offsetLeft,a=t.offsetTop,n=t.offsetWidth,r=t.offsetHeight,l=i.clientX,M=i.clientY,g=new AbortController,{signal:c}=g;I(o,{onmousemove:m((i=>{const o=i.clientX-l,g=i.clientY-M;switch(e){case 0:case 1:case 2:{const e=r-g;e>(parseInt(t.style.getPropertyValue("min-height")||"")||100)&&I(t,{style:{"--window-top":`${a+g}px`,"--window-height":`${e}px`}})}break;case 4:case 5:case 6:{const e=r+g;e>(parseInt(t.style.getPropertyValue("min-height")||"")||100)&&I(t,{style:{"--window-height":`${e}px`}})}}switch(e){case 2:case 3:case 4:{const e=n+o;e>(parseInt(t.style.getPropertyValue("min-width")||"")||100)&&I(t,{style:{"--window-width":`${e}px`}})}break;case 0:case 7:case 6:{const e=n-o;e>(parseInt(t.style.getPropertyValue("min-width")||"")||100)&&I(t,{style:{"--window-left":`${s+o}px`,"--window-width":`${e}px`}})}}}),0,c),onmouseup:m((e=>{0===e.button&&(I(o,{style:{"user-select":void 0}}),g.abort(),gn=!1,t.dispatchEvent(new CustomEvent("resized")))}),0,c)})})(this,e,t)})))),Gt({part:"titlebar",onmousedown:t=>((t,e)=>{if(e.target instanceof HTMLButtonElement)return;const i=t.parentNode;if(gn||!(i instanceof dn)||0!==e.button)return;gn=!0,I(i,{style:{"user-select":"none"}});const o=e.clientX-t.offsetLeft,s=e.clientY-t.offsetTop,a=new AbortController,{signal:n}=a;I(i,{onmousemove:m((e=>{const a=parseInt(i.getAttribute("snap")||"0"),{offsetLeft:n,offsetTop:r,offsetWidth:l,offsetHeight:M}=t,g=n+l,c=r+M,d=e.clientX-o,h=e.clientY-s,T=d+l,u=h+M;let A=0,L=0;if(a>0){n>=0&&d<0&&d>=-a?A=-d:g<=i.offsetWidth&&T>i.offsetWidth&&T<=i.offsetWidth+a&&(A=i.offsetWidth-T),r>=0&&h<0&&h>=-a?L=-h:c<=i.offsetHeight&&u>i.offsetHeight&&u<=i.offsetHeight+a&&(L=i.offsetHeight-u);for(const e of i.childNodes)if(e instanceof hn&&e!==t){const t=e.offsetLeft,i=e.offsetTop,o=t+e.offsetWidth,s=i+e.offsetHeight;h<=s&&u>=i&&(g<=t&&T>=t&&T<=t+a?A=t-T:n>=o&&d<=o&&d>=o-a&&(A=o-d)),d<=o&&T>=t&&(c<=i&&u>=i&&u<=i+a?L=i-u:r>=s&&h<=s&&h>=s-a&&(L=s-h))}}I(t,{style:{"--window-left":d+A+"px","--window-top":h+L+"px"}})}),0,n),onmouseup:m((e=>{0===e.button&&(I(i,{style:{"user-select":void 0}}),a.abort(),gn=!1,t.dispatchEvent(new CustomEvent("moved")))}),0,n)})})(this,t),ondblclick:t=>{t.target instanceof HTMLButtonElement||this.hasAttribute("hide-maximise")||this.toggleAttribute("maximised")}},[this.#It=le({part:"icon",src:yn}),this.#dt=Be({part:"title"}),Gt({part:"controls"},[wt({part:"close",title:an.CLOSE,onclick:()=>this.close()}),this.#At=wt({part:"maximise",title:an.MAXIMISE,onclick:()=>this.toggleAttribute("maximised")}),wt({part:"minimise",title:an.MINIMISE,onclick:()=>this.toggleAttribute("minimised")}),this.#n=Be()])]),this.#ht=Gt(We()),Gt()]).adoptedStyleSheets=ln,setTimeout(I,0,this,{onmousedown:m(t,u)})}connectedCallback(){Mn===this&&(Mn=null)}disconnectedCallback(){if(Mn===this)return;const t=this.#ut,e=this.#Tt;t&&(I(t.#ht,{class:["!hasChild"]}),t.#Tt=null,this.#ut=null),e&&(e.remove(),this.#Tt=null),this.dispatchEvent(new CustomEvent("remove"))}attributeChangedCallback(t,e,i){switch(t){case"window-title":N(this.#dt,{title:i??""},i??"");break;case"window-icon":I(this.#It,{src:i??yn});break;case"maximised":I(this.#At,{title:null===i?an.MAXIMISE:an.RESTORE})}}static get observedAttributes(){return["maximised","window-icon","window-title"]}addWindow(t){return!!this.parentNode&&(this.#Tt?(this.#Tt.addWindow(t),!0):(this.#Tt=t,t.#ut=this,I(this.#ht,{class:["hasChild"]}),I(this.parentNode,t),!0))}addControlButton(t,e,i){const o=wt({style:{"background-image":`url(${JSON.stringify(t)})`},onclick:()=>e.call(this),title:i});return I(this.#n,o),()=>o.remove()}focus(){this.toggleAttribute("minimised",!1);const t=this.#Tt;if(t)t.focus();else{if(this.parentNode&&this.nextElementSibling){Mn=this;const t=[],e=document.createNodeIterator(this,NodeFilter.SHOW_ELEMENT);for(let i=this.#ht;i;i=e.nextNode()){const{scrollTop:e,scrollLeft:o}=i;(e||o)&&t.push([i,e,o])}I(this.parentNode,this);for(const[e,i,o]of t)e.scrollTop=i,e.scrollLeft=o}this.contains(document.activeElement)||super.focus()}}close(){if(this.#Tt)this.#Tt.focus();else if(this.dispatchEvent(new CustomEvent("close",{cancelable:!0})))return this.remove(),!0;return!1}}customElements.define("windows-shell",dn),customElements.define("windows-desktop",In),customElements.define("windows-window",hn);const Tn=h(gt,"windows-shell"),un=h(gt,"windows-desktop"),An=h(gt,"windows-window"),Ln=t=>yn=t,mn=t=>{Object.assign(an,t)};let yn=`data:image/svg+xml,%3Csvg viewBox="0 0 14 18" xmlns="${To}"%3E%3Cpath d="M9,1 h-8 v16 h12 v-12 Z v4 h4" stroke="black" fill="none" /%3E%3Cpath d="M3,8 h8 m-8,3 h8 m-8,3 h8" stroke="gray" /%3E%3C/svg%3E`;const Nn={attributeFilter:["window-icon","window-title","minimised"],attributes:!0},Dn={attributeFilter:["maximised"],attributes:!0},pn=[(new C).add({":host":{display:"block",position:"relative",overflow:"hidden",width:"var(--shell-width, 100%)",height:"var(--shell-height, 100%)",">footer":{display:"flex",position:"absolute","grid-gap":"5px","flex-wrap":"wrap-reverse",width:"100%",bottom:0,left:0,"pointer-events":"none",">div":{width:"200px",position:"relative",">windows-window":{"min-height":"auto",position:"relative","pointer-events":"auto","--overlay-on":"none",":not([maximised])":{"pointer-events":"none",visibility:"hidden"}}}}},"::slotted(windows-window:last-of-type)":{"--overlay-on":"none"}})];class En extends dn{constructor(){super();let t=!1;const e=new Map,i=new Map,o=new MutationObserver((t=>t.forEach((({target:t,type:e,attributeName:o})=>{"attributes"===e&&"maximised"===o&&t instanceof hn&&!t.hasAttribute("maximised")&&I(i.get(t),{minimised:!1}).focus()})))),s=new MutationObserver((t=>t.forEach((({target:t,type:s,attributeName:n})=>{if("attributes"!==s||!(t instanceof hn))return;const r=e.get(t);switch(n){case"window-icon":r.item&&I(r.item.firstChild,{"window-icon":t.getAttribute("window-icon")??void 0});break;case"window-title":r.item&&I(r.item.firstChild,{"window-title":t.getAttribute("window-title")||""});break;case"minimised":if(!t.hasAttribute("minimised"))return void I(r.item?.firstChild,{maximised:!1});if(r.item)return void I(r.item.firstChild,{maximised:!0});for(const t of a.children)if(0===t.childElementCount&&t instanceof HTMLDivElement){r.item=t;break}r.item||I(a,r.item=Gt());const e=An({"window-icon":t.getAttribute("window-icon")??void 0,"window-title":t.getAttribute("window-title")??void 0,"hide-minimise":!0,maximised:!0,exportparts:"close, minimise, maximise, titlebar, title, controls, icon",onclose:e=>{e.preventDefault(),t.close()},onremove:()=>i.delete(e)});i.set(e,t),I(r.item,e),o.observe(e,Dn),I(t,{onremove:m((()=>e.remove()),T)})}})))),a=Ft();I(this.attachShadow({mode:"closed"}),[We({name:"desktop"}),a,Gt(We({onslotchange:function(){t=!t;for(const i of this.assignedElements()){if(!(i instanceof hn))return;e.has(i)?e.get(i).state=t:i.hasAttribute("window-hide")||(s.observe(i,Nn),e.set(i,{item:null,state:t}))}for(const[i,o]of e.entries())o.state!==t&&(o.item&&N(o.item),e.delete(i))}}))]).adoptedStyleSheets=pn}}customElements.define("windows-shell-taskmanager",En);const wn=h(gt,"windows-shell-taskmanager");mn(Object.fromEntries(["CANCEL","CLOSE","MAXIMISE","MINIMISE","OK","RESTORE"].map((t=>[t,oa[t]])))),Ln(document.getElementsByTagName("link")[0]?.getAttribute("href")??yn);const fn={"hide-maximise":!0,"hide-minimise":!0,tabindex:-1,onkeydown:function(t){"Escape"!==t.key||this.hasAttribute("hide-close")||Mt("Escape")||this.close()}},xn={style:{visibility:"hidden"}},Sn={style:{visibility:void 0}},Cn=(t,e,i=oa.LOADING,o)=>{const s=An({"window-title":i,"hide-minimise":!0},o||on());return e.addWindow(s),t.finally((()=>s.remove()))},kn=(t,e)=>{const i=I(An(fn),t,e),o=i.getAttribute("window-data");if(o){const t=new Ci(o,bn(i),jn),e=()=>t.set(bn(i));I(i,{style:{"--window-left":t.value[0]+"px","--window-top":t.value[1]+"px","--window-width":t.value[2]+"px","--window-height":t.value[3]+"px"},onmoved:e,onresized:e})}else i.style.getPropertyValue("--window-width")||i.style.getPropertyValue("--window-height")||(I(i,xn),setTimeout((()=>{if(i.parentNode===vn){const{offsetWidth:t,offsetHeight:e}=i,{offsetWidth:o,offsetHeight:s}=vn;I(i,{style:{"--window-width":t+"px","--window-height":e+"px","--window-left":(o-t)/2+"px","--window-top":(s-e)/2+"px"}})}I(i,Sn),i.focus()})));return i},On=un(),vn=wn({snap:50},On),bn=t=>[parseInt(t.style.getPropertyValue("--window-left")||"0"),parseInt(t.style.getPropertyValue("--window-top")||"0"),parseInt(t.style.getPropertyValue("--window-width")||"200"),parseInt(t.style.getPropertyValue("--window-height")||"600")],jn=t=>t instanceof Array&&4===t.length&&hi(t[0])&&hi(t[1])&&hi(t[2],0)&&hi(t[3],0);class zn{r=0;g=0;b=0;a=255;constructor(t,e,i,o=255){return this.r=Ti(t,0,255),this.g=Ti(e,0,255),this.b=Ti(i,0,255),this.a=Ti(o,0,255),Object.freeze(this)}static from(t){return t instanceof zn?t:Object.freeze(Object.setPrototypeOf(t,zn.prototype))}toString(){return`rgba(${this.r}, ${this.g}, ${this.b}, ${this.a/255})`}toHexString(){return`#${Math.round(this.r).toString(16).padStart(2,"0")}${Math.round(this.g).toString(16).padStart(2,"0")}${Math.round(this.b).toString(16).padStart(2,"0")}`}}class Yn extends Ci{constructor(t,e){super(t,e,(t=>!!(t instanceof Object&&hi(t.r,0,255)&&hi(t.g,0,255)&&hi(t.b,0,255)&&hi(t.a,0,255))&&(zn.from(t),!0)))}}const _n=(t,e=255)=>new zn(Ti(parseInt(t.slice(1,3),16),0,255),Ti(parseInt(t.slice(3,5),16),0,255),Ti(parseInt(t.slice(5,7),16),0,255),e),Pn=new zn(0,0,0,0),Gn=(t,e,i=Pn,o)=>new Promise(((s,a)=>{const n=Un.register((()=>_n(M.value,Ti(parseInt(g.value),0,255,255)))),r=Gt({style:`background-color: ${i}`,draggable:"true",ondragstart:t=>Un.set(t,n,Wn),ondragover:Qn,ondrop:t=>{if(Un.is(t)){const e=Un.get(t);M.value=e.toHexString(),g.value=e.a+"",I(r,{style:{"background-color":e}})}}}),l=()=>I(r,{style:{"background-color":_n(M.value,Ti(parseInt(g.value),0,255,255))}}),M=Me({type:"color",value:i.toHexString(),onchange:l}),g=Me({type:"range",min:0,max:255,step:1,value:i.a,oninput:l}),c=kn({"window-icon":o,"window-title":e,onremove:()=>{Un.deregister(n),a()}},[Vt(e),Gt({class:Zn},r),Ka([oa.COLOUR,": "],M),Et(),Ka([oa.COLOUR_ALPHA,": "],g),Et(),wt({onclick:function(){I(this,{disabled:!0}),s(_n(M.value,Ti(parseInt(g.value),0,255,255))),c.remove()}},oa.COLOUR_UPDATE)]);(t.parentNode?t:vn).addWindow(c)})),Rn=(()=>{const t=(t,e)=>(I(t,{style:{"background-color":e}}),e);return(e,i,o,s,a)=>{let n=!1;const r=Un.register(o),l=Gt({draggable:"true",ondragstart:t=>Un.set(t,r,Wn)}),M=wt({class:[Zn,Bn],onclick:()=>{n||(n=!0,Gn(e??vn,i,o(),a).then((e=>s(t(l,e)))).finally((()=>n=!1)))},ondragover:Qn,ondrop:e=>{Un.is(e)&&s(t(l,Un.get(e)))}},l);return t(l,o()),M}})(),Un=new ki("colour"),Wn=le({src:'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30"%3E%3Cstyle type="text/css"%3Esvg%7Bbackground-color:%23000%7Dcircle%7Bmix-blend-mode:screen%7D%3C/style%3E%3Ccircle r="10" cx="10" cy="10" fill="%23f00" /%3E%3Ccircle r="10" cx="20" cy="10" fill="%230f0" /%3E%3Ccircle r="10" cx="15" cy="20" fill="%2300f" /%3E%3C/svg%3E%0A'}),Qn=vi({copy:[Un]}),[Zn,Bn]=G(2);Y({[`.${Zn}`]:{"background-color":"#ccc","background-image":'url(\'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="20" height="20"%3E%3Cpath d="M0,0H10V20H20V10H0Z" fill="gray" /%3E%3C/svg%3E\')',width:"200px",height:"200px"," div":{width:"200px",height:"200px"}},[`.${Bn}`]:{display:"inline-block",width:"50px",height:"50px",padding:0," div":{width:"100%",height:"100%"}}});let Hn,Fn,$n=0;const Vn={images:{},audio:{},characters:{},maps:{}},Kn={images:{},audio:{},characters:{},maps:{}},Jn={images:{},audio:{},characters:{},maps:{}},Xn=t=>or.push(t),qn=t=>ar.push(t),tr=t=>sr.push(t),er=t=>{console.log(t),vn.alert(oa.ERROR,(t instanceof Error?t.message:Object.getPrototypeOf(t)===Object.prototype?JSON.stringify(t):t.toString())||oa.ERROR_UNKNOWN)},ir=sa.then((()=>Cs("/socket").then((t=>{const e=new Ma(t),i={"":()=>{},"!":t=>t[0],"*":(t,e)=>Object.fromEntries(e.map(((e,i)=>[e,t[i]])))},o={"":[["waitCurrentUserMap",-2,Mr],["waitCurrentUserMapData",-3,Il],["waitMapDataSet",-4,Yr],["waitMapDataRemove",-5,dr],["waitCharacterDataChange",-36,Qr],["waitMapChange",-35,Br],["waitMapStartChange",-6,cl],["waitLayerAdd",-37,dr],["waitLayerFolderAdd",-38,dr],["waitLayerMove",-39,kr],["waitLayerRename",-40,vr],["waitLayerRemove",-41,dr],["waitGridDistanceChange",-42,Mr],["waitGridDiagonalChange",-43,Ir],["waitMapLightChange",-44,Ar],["waitLayerShow",-45,dr],["waitLayerHide",-46,dr],["waitLayerLock",-47,dr],["waitLayerUnlock",-48,dr],["waitMaskAdd",-49,Zl],["waitMaskRemove",-50,Mr],["waitMaskSet",-51,gl],["waitTokenAdd",-52,sl],["waitTokenRemove",-53,Mr],["waitTokenMoveLayerPos",-54,Fr],["waitTokenSet",-55,Vr],["waitTokenSetMulti",-56,Kr],["waitLayerShift",-57,Tl],["waitWallAdded",-58,ml],["waitWallRemoved",-59,Mr],["waitWallModified",-60,Al],["waitWallMoved",-61,Er],["waitMusicPackAdd",-62,Nr],["waitMusicPackRename",-63,Nr],["waitMusicPackRemove",-64,Mr],["waitMusicPackCopy",-65,Pl],["waitMusicPackVolume",-66,fl],["waitMusicPackPlay",-67,Sl],["waitMusicPackStop",-68,Mr],["waitMusicPackStopAll",-69,nr],["waitMusicPackTrackAdd",-70,kl],["waitMusicPackTrackRemove",-71,vl],["waitMusicPackTrackVolume",-72,jl],["waitMusicPackTrackRepeat",-73,Yl],["waitPluginChange",-74,nr],["waitPluginSetting",-75,Ul],["waitSignalMeasure",-77,Wl],["waitSignalPosition",-78,Ql],["waitSignalMovePosition",-79,Ql],["waitBroadcastWindow",-76,Hl],["waitBroadcast",-80,Fl]],images:[["waitAdded",-7,Dr],["waitMoved",-11,fr],["waitRemoved",-15,dr],["waitCopied",-19,Sr],["waitFolderAdded",-23,dr],["waitFolderMoved",-27,fr],["waitFolderRemoved",-31,dr]],audio:[["waitAdded",-8,Dr],["waitMoved",-12,fr],["waitRemoved",-16,dr],["waitCopied",-20,Sr],["waitFolderAdded",-24,dr],["waitFolderMoved",-28,fr],["waitFolderRemoved",-32,dr]],characters:[["waitAdded",-9,Dr],["waitMoved",-13,fr],["waitRemoved",-17,dr],["waitCopied",-21,Sr],["waitFolderAdded",-25,dr],["waitFolderMoved",-29,fr],["waitFolderRemoved",-33,dr]],maps:[["waitAdded",-10,Dr],["waitMoved",-14,fr],["waitRemoved",-18,dr],["waitCopied",-22,Sr],["waitFolderAdded",-26,dr],["waitFolderMoved",-30,fr],["waitFolderRemoved",-34,dr]]},s={"":[["ready","conn.ready","",nr,"",""],["setCurrentMap","maps.setCurrentMap","!",nr,"",""],["getUserMap","maps.getUserMap","",Mr,"",""],["setUserMap","maps.setUserMap","!",nr,"waitCurrentUserMap",""],["getMapData","maps.getMapData","!",Il,"",""],["newMap","maps.new","!",Nr,"",""],["setMapDetails","maps.setMapDetails","!",nr,"waitMapChange",""],["setMapStart","maps.setMapStart","!",nr,"waitMapStartChange",""],["setGridDistance","maps.setGridDistance","!",nr,"waitGridDistanceChange",""],["setGridDiagonal","maps.setGridDiagonal","!",nr,"waitGridDiagonalChange",""],["setLightColour","maps.setLightColour","!",nr,"waitMapLightChange",""],["setMapKeyData","maps.setData",["key","data"],nr,"waitMapDataSet",""],["removeMapKeyData","maps.removeData","!",nr,"waitMapDataRemove",""],["signalMeasure","maps.signalMeasure","!",nr,"",""],["signalPosition","maps.signalPosition","!",nr,"",""],["signalMovePosition","maps.signalMovePosition","!",nr,"",""],["addLayer","maps.addLayer","!",dr,"waitLayerAdd","*"],["addLayerFolder","maps.addLayerFolder","!",dr,"waitLayerFolderAdd","*"],["renameLayer","maps.renameLayer",["path","name"],vr,"waitLayerRename","*"],["moveLayer","maps.moveLayer",["from","to","position"],nr,"waitLayerMove",""],["showLayer","maps.showLayer","!",nr,"waitLayerShow",""],["hideLayer","maps.hideLayer","!",nr,"waitLayerHide",""],["lockLayer","maps.lockLayer","!",nr,"waitLayerLock",""],["unlockLayer","maps.unlockLayer","!",nr,"waitLayerUnlock",""],["addToMask","maps.addToMask","!",nr,"waitMaskAdd",""],["removeFromMask","maps.removeFromMask","!",nr,"waitMaskRemove",""],["setMask","maps.setMask",["baseOpaque","masks"],nr,"waitMaskSet",""],["removeLayer","maps.removeLayer","!",nr,"waitLayerRemove",""],["addToken","maps.addToken",["path","token","pos"],Mr,"waitTokenAdd","token/id"],["removeToken","maps.removeToken","!",nr,"waitTokenRemove",""],["setToken","maps.setToken","!",nr,"waitTokenSet",""],["setTokenMulti","maps.setTokenMulti","!",nr,"waitTokenMultiSet",""],["setTokenLayerPos","maps.setTokenLayerPos",["id","to","newPos"],nr,"waitTokenMoveLayerPos",""],["shiftLayer","maps.shiftLayer",["path","dx","dy"],nr,"waitLayerShift",""],["addWall","maps.addWall",["path","wall"],Mr,"waitWallAdded","wall/id"],["removeWall","maps.removeWall","!",nr,"waitWallRemoved",""],["modifyWall","maps.modifyWall","!",nr,"waitWallModified",""],["moveWall","maps.moveWall",["id","path"],nr,"waitWallMoved",""],["musicPackList","music.list","",El,"",""],["musicPackAdd","music.new","!",Nr,"waitMusicPackAdd","*"],["musicPackRename","music.rename",["id","name"],dr,"waitMusicPackRename","*"],["musicPackRemove","music.remove","!",nr,"waitMusicPackRemove",""],["musicPackCopy","music.copy",["id","name"],Nr,"waitMusicPackCopy","name"],["musicPackSetVolume","music.setVolume",["id","volume"],nr,"waitMusicPackVolume",""],["musicPackPlay","music.playPack",["id","playTime"],Mr,"waitMusicPackPlay","*"],["musicPackStop","music.stopPack","!",nr,"waitMusicPackStop",""],["musicPackStopAll","music.stopAllPacks","",nr,"waitMusicPackStopAll",""],["musicPackTrackAdd","music.addTracks",["id","tracks"],nr,"waitMusicPackTrackAdd",""],["musicPackTrackRemove","music.removeTrack",["id","track"],nr,"waitMusicPackTrackRemove",""],["musicPackTrackVolume","music.setTrackVolume",["id","track","volume"],nr,"waitMusicPackTrackVolume",""],["musicPackTrackRepeat","music.setTrackRepeat",["id","track","repeat"],nr,"waitMusicPackTrackRepeat",""],["characterCreate","characters.create",["path","data"],Er,"",""],["characterModify","characters.modify",["id","setting","removing"],nr,"waitCharacterDataChange",""],["characterGet","characters.get","!",Ur,"",""],["listPlugins","plugins.list","",Gl,"",""],["enablePlugin","plugins.enable","!",nr,"",""],["disablePlugin","plugins.disable","!",nr,"",""],["pluginSetting","plugins.set",["id","setting","removing"],nr,"waitPluginSetting",""],["broadcastWindow","broadcastWindow",["module","id","contents"],nr,"waitBroadcastWindow",""],["broadcast","broadcast","!",nr,"waitBroadcast",""]],images:[["list","imageAssets.list","",jr,"",""],["createFolder","imageAssets.createFolder","!",dr,"waitFolderAdded","*"],["move","imageAssets.move",["from","to"],dr,"waitMoved","to"],["moveFolder","imageAssets.moveFolder",["from","to"],dr,"waitFolderMoved","to"],["remove","imageAssets.remove","!",nr,"waitRemoved",""],["removeFolder","imageAssets.removeFolder","!",nr,"waitFolderRemoved",""],["copy","imageAssets.copy",["id","path"],Er,"waitCopied","name"]],audio:[["list","audioAssets.list","",jr,"",""],["createFolder","audioAssets.createFolder","!",dr,"waitFolderAdded",""],["move","audioAssets.move",["from","to"],dr,"waitMoved","to"],["moveFolder","audioAssets.moveFolder",["from","to"],dr,"waitFolderMoved","to"],["remove","audioAssets.remove","!",nr,"waitRemoved",""],["removeFolder","audioAssets.removeFolder","!",nr,"waitFolderRemoved",""],["copy","audioAssets.copy",["id","path"],Er,"waitCopied","name"]],characters:[["list","characters.list","",jr,"",""],["createFolder","characters.createFolder","!",dr,"waitFolderAdded",""],["move","characters.move",["from","to"],dr,"waitMoved","to"],["moveFolder","characters.moveFolder",["from","to"],dr,"waitFolderMoved","to"],["remove","characters.remove","!",nr,"waitRemoved",""],["removeFolder","characters.removeFolder","!",nr,"waitFolderRemoved",""],["copy","characters.copy",["id","path"],Er,"waitCopied","name"]],maps:[["list","maps.list","",jr,"",""],["createFolder","maps.createFolder","!",dr,"waitFolderAdded",""],["move","maps.move",["from","to"],dr,"waitMoved","to"],["moveFolder","maps.moveFolder",["from","to"],dr,"waitFolderMoved","to"],["remove","maps.remove","!",nr,"waitRemoved",""],["removeFolder","maps.removeFolder","!",nr,"waitFolderRemoved",""],["copy","maps.copy",["id","path"],Er,"waitCopied","name"]]},a=()=>new zi((()=>{}));for(const t in s){const o=""===t?Jn:Jn[t],a=""===t?Vn:Vn[t];for(const[n,r,l,M,g,c]of s[t]){const t=i["string"==typeof l?l:"*"];if(""===g)o[n]=(...i)=>e.request(r,t(i,l),M).catch(er);else{const[i,s]=zi.bind(1);a[g]=i.splitCancel(),o[n]=""===c?(...i)=>{const o=t(i,l);return s(o),e.request(r,o,M).catch(er)}:"*"===c?(...i)=>e.request(r,t(i,l),M).catch(er).then((t=>(s(t),t))):"token/id"===c?(...i)=>{const o=t(i,l);return e.request(r,o,M).catch(er).then((t=>(o.token.id=t,s(o),t)))}:(...i)=>{const o=t(i,l);return e.request(r,o,M).catch(er).then((t=>(s(Object.assign(o,{[c]:t})),t)))}}}}for(const t in o){const i=""===t?Jn:Jn[t],s=""===t?Vn:Vn[t],n=""===t?Kn:Kn[t];for(const[r,l,M]of o[t]){const[t,o]=zi.bind(1);e.subscribe(l,M).when((t=>yi((async()=>o(t))))).catch(er),i[r]=()=>t,s[r]?n[r]=zi.merge(i[r](),s[r]()).splitCancel():(s[r]=a,n[r]=i[r])}}return e.await(-999).catch(er),Object.freeze(Jn),e.await(-1,Mr).then((t=>(Hn=2===t,Fn=1===t,e.request("conn.currentTime",(t=>Mr(t,"currentTime")))))).then((t=>{$n=t-Date.now()/1e3}))})))).catch(er),or=[],sr=[],ar=[],nr=t=>!0,rr=t=>{throw new TypeError(t)},lr=(t,e="Int",i="")=>(hi(t)||rr(i?`invalid ${e} object, key '${i}' contains an invalid Int: ${JSON.stringify(t)}`:`expecting Int type, got ${JSON.stringify(t)}`),!0),Mr=(t,e="Uint",i="",o=Number.MAX_SAFE_INTEGER)=>(hi(t,0,o)||rr(i?`invalid ${e} object, key '${i}' contains an invalid Uint: ${JSON.stringify(t)}`:`expecting Uint type, got ${JSON.stringify(t)}`),!0),gr=(t,e="Byte",i="")=>Mr(t,e,i,255),cr=(t,e,i="")=>("object"!=typeof t&&rr(i?`invalid ${e} object, key '${i}' contains invalid data: ${JSON.stringify(t)}`:`expecting ${e} object, got ${JSON.stringify(t)}`),!0),dr=(t,e="String",i="")=>("string"!=typeof t&&rr(i?`invalid ${e} object, key '${i}' contains an invalid string: ${JSON.stringify(t)}`:`expecting ${e} type, got ${JSON.stringify(t)}`),!0),Ir=(t,e="Boolean",i="")=>("boolean"!=typeof t&&rr(i?`invalid ${e} object, key '${i}' contains an invalid boolean: ${JSON.stringify(t)}`:`expecting ${e} type, got ${JSON.stringify(t)}`),!0),hr=(t,e,i="")=>(t instanceof Array||rr(`invalid ${e} object, key '${i}' contains an invalid Array: ${JSON.stringify(t)}`),!0),Tr=(t,e,i)=>{for(let[o,s]of i)if(("?"!==s.charAt(0)||void 0!==t[s=s.slice(1)])&&!o(s?t[s]:t,e,s))return!1;return!0},ur=[[cr,""],[gr,"r"],[gr,"g"],[gr,"b"],[gr,"a"]],Ar=(t,e="Colour")=>(Tr(t,e,ur),zn.from(t),!0),Lr=[[cr,""],[Mr,"id"]],mr=(t,e)=>Tr(t,e,Lr),yr=[[mr,""],[dr,"name"]],Nr=t=>Tr(t,"IDName",yr),Dr=t=>{hr(t,"added");for(const e of t)Nr(e);return!0},pr=[[mr,""],[dr,"path"]],Er=t=>Tr(t,"IDPath",pr),wr=[[cr,""],[dr,"from"],[dr,"to"]],fr=(t,e="FromTo")=>Tr(t,e,wr),xr=[[cr,""],[Mr,"oldID"],[Mr,"newID"],[dr,"path"]],Sr=t=>Tr(t,"Copied",xr),Cr=[[fr,""],[Mr,"position"]],kr=t=>Tr(t,"LayerMove",Cr),Or=[[cr,""],[dr,"path"],[dr,"name"]],vr=t=>Tr(t,"LayerRename",Or),br=[[cr,""],[cr,"folders"],[cr,"items"]],jr=t=>{Tr(t,"FolderItems",br);for(const e in t.folders)jr(t.folders[e]);for(const e in t.items)Mr(t.items[e],"FolderItems",e);return!0},zr=[[cr,""],[dr,"key"]],Yr=t=>{Tr(t,"KeyData",zr);const e={[t.key]:t.data};for(const t of or)t(e);if(!e[t.key]){for(const e of t)delete t[e];t[""]=""}return!0},_r=[[cr,""],[Ir,"user"]],Pr=(t,e="KeystoreData")=>{cr(t,e);for(const i in t)Tr(t[i],e,_r),void 0===t[i].data&&rr(`invalid KeystoreData object, key '${i}' contains no data`);return!0},Gr=[[cr,""],[Pr,"setting"],[hr,"removing"]],Rr=(t,e)=>{Tr(t,e,Gr);for(const i of t.removing)dr(i,e,"removing");return!0},Ur=t=>{Pr(t,"Character");for(const e of ar)e(t);return!0},Wr=[[Rr,""],[Mr,"id"]],Qr=t=>{Tr(t,"CharacterDataChange",Wr);for(const e of ar)e(t.setting);return!0},Zr=[[cr,""],[gr,"gridType"],[Mr,"gridSize"],[Mr,"gridStroke"],[Ar,"gridColour"]],Br=(t,e="MapDetails")=>Tr(t,e,Zr),Hr=[[mr,""],[dr,"to"],[Mr,"newPos"]],Fr=t=>Tr(t,"TokenMoveLayer",Hr),$r=[[mr,""],[lr,"?x"],[lr,"?y"],[Mr,"?width"],[Mr,"?height"],[gr,"?rotation"],[Ir,"?snap"],[Mr,"?src"],[Mr,"?patternWidth"],[Mr,"?patternHeight"],[Ir,"?flip"],[Ir,"?flop"],[Pr,"?tokenData"],[hr,"?removeTokenData"],[Ar,"?fill"],[Ar,"?stroke"],[Mr,"?strokeWidth"],[hr,"?points"],[hr,"?lightColours"],[hr,"?lightStages"],[hr,"?lightTimings"]],Vr=(t,e="TokenSet")=>{if(Tr(t,e,$r),t.lightColours)for(const i of t.lightColours){hr(i,e,"lightColours");for(const t of i)Ar(t,`${e}->lightColours`)}if(t.lightStages)for(const i of t.lightStages)Mr(i,e,"lightStages");if(t.lightTimings)for(const i of t.lightTimings)Mr(i,e,"lightTimings");if(t.removeTokenData)for(const i of t.removeTokenData)dr(i,e,"removeTokenData");if(t.points)for(const i of t.points)Tr(i,`${e}->Points`,tl);return!0},Kr=t=>{hr(t,"TokenSetMulti");for(const e of t)Vr(e,"TokenSetMulti");return!0},Jr=[[mr,""],[lr,"x"],[lr,"y"],[Mr,"width"],[Mr,"height"],[gr,"rotation"],[Ir,"snap"],[hr,"lightColours"],[hr,"lightStages"],[hr,"lightTimings"],[Pr,"tokenData"]],Xr=[[Mr,"src"],[Mr,"patternWidth"],[Mr,"patternHeight"],[Ir,"flip"],[Ir,"flop"]],qr=[[Ar,"fill"],[Ar,"stroke"],[Mr,"strokeWidth"],[Mr,"fillType"],[hr,"fills"]],tl=[[cr,""],[lr,"x"],[lr,"y"]],el=[[cr,""],[gr,"pos"],[Ar,"colour"]],il=(t,e="Token")=>{Tr(t,e,Jr);for(const e of t.lightColours){hr(e,"TokenSet","lightColours");for(const t of e)Ar(t,"TokenSet->lightColours")}for(const e of t.lightStages)Mr(e,"TokenSet","lightStages");for(const e of t.lightTimings)Mr(e,"TokenSet","lightTimings");switch(t.tokenType){case void 0:case 0:Tr(t,e,Xr);break;case 2:hr(t.points,e,"points");for(const e of t.points)Tr(e,"Token->Points",tl);case 1:Tr(t,e,qr),void 0!==t.isEllipse&&Ir(t.isEllipse,"Token","isEllipse");for(const e of t.fills)Tr(e,"Token->Fills",el);break;default:throw new TypeError("invalid Token object, key 'tokenType' contains invalid data")}for(const e of sr)e(t.tokenData);return!0},ol=[[cr,""],[dr,"path"],[il,"token"],[Mr,"?pos"]],sl=t=>Tr(t,"TokenAdd",ol),al=[[dr,"name"],[Ir,"hidden"],[hr,"children"]],nl=[[dr,"name"],[Ir,"hidden"],[Ir,"locked"],[hr,"tokens"],[hr,"walls"]],rl=[[Ir,"hidden"]],ll=(t,e="LayerFolder")=>{"MapData"!==e&&Tr(t,e,al);for(const e of t.children)if(cr(e,"LayerFolder"),void 0!==e.children)ll(e);else if("Grid"===e.name||"Light"===e.name)Tr(e,"LayerGrid",rl);else{Tr(e,"LayerTokens",nl);for(const t of e.tokens)il(t);for(const t of e.walls)Al(t,"Layer->Wall")}return!0},Ml=[[cr,""],[Ir,"baseOpaque"],[hr,"masks"]],gl=t=>{Tr(t,"MaskSet",Ml);for(const e of t.masks)Zl(e);return!0},cl=t=>(hr(t,"MapStart"),2!==t.length&&rr("invalid number of coords for MapStart"),Mr(t[0],"MapStart->startX"),Mr(t[1],"MapStart->startY"),!0),dl=[[Br,""],[Mr,"startX"],[Mr,"startY"],[Mr,"gridDistance"],[Ir,"gridDiagonal"],[Ar,"lightColour"],[gl,""],[hr,"children"],[ll,""],[cr,"data"]],Il=t=>{Tr(t,"MapData",dl);for(const e of or)e(t.data);return!0},hl=[[cr,""],[dr,"path"],[lr,"dx"],[lr,"dy"]],Tl=t=>Tr(t,"LayerShift",hl),ul=[[cr,""],[Mr,"id"],[lr,"x1"],[lr,"y1"],[lr,"x2"],[lr,"y2"],[Ar,"colour"],[gr,"scattering"]],Al=(t,e="Wall")=>Tr(t,e,ul),Ll=[[Al,""],[dr,"path"]],ml=t=>Tr(t,"WallPath",Ll),yl=[[mr,""],[Mr,"volume"],[lr,"repeat"]],Nl=t=>Tr(t,"musicTrack",yl),Dl=[[Nr,""],[hr,"tracks"],[Mr,"volume"],[Mr,"playTime"]],pl=t=>{Tr(t,"musicPack",Dl);for(const e of t.tracks)Nl(e);return!0},El=t=>{hr(t,"musicPacks");for(const e of t)pl(e);return!0},wl=[[mr,""],[Mr,"volume"]],fl=t=>Tr(t,"MusicPackVolume",wl),xl=[[mr,""],[Mr,"playTime"]],Sl=t=>Tr(t,"MusicPackPlay",xl),Cl=[[mr,""],[hr,"tracks"]],kl=t=>{Tr(t,"MusicPackTrackAdd",Cl);for(const e of t.tracks)Mr(e,"MusicPackTrackAdd->Track");return!0},Ol=[[mr,""],[Mr,"track"]],vl=(t,e="MusicPackTrackRemove")=>Tr(t,e,Ol),bl=[[vl,""],[Mr,"volume"]],jl=t=>Tr(t,"MusicPackTrackVolume",bl),zl=[[vl,""],[lr,"repeat"]],Yl=t=>Tr(t,"MusicPackTrackRepeat",zl),_l=[[Nr,""],[Mr,"newID"]],Pl=t=>Tr(_l,"MusicPackCopy",t),Gl=t=>{cr(t,"plugins");for(const e in t)cr(t,"plugins->plugin",e),Ir(t[e].enabled,"plugin->enabled","enabled"),cr(t[e].data,"plugin->data","data");return!0},Rl=[[Rr,""],[dr,"id"]],Ul=t=>Tr(t,"PluginSetting",Rl),Wl=t=>{if(null===t)return!0;if(hr(t,"SignalMeasure"),t.length<4||t.length%2==1)throw new TypeError("invalid SignalMeasure array, needs even length at least 4");for(let e=0;e<t.length;e++)Mr(t[e],`SignalPosition.${e%2==0?"x":"y"}${1+(e>>1)}`);return!0},Ql=t=>{if(hr(t,"SignalPosition"),2!==t.length)throw new TypeError("invalid SignalPosition array, needs length 2");return Mr(t[0],"SignalPosition.x"),Mr(t[1],"SignalPosition.y"),!0},Zl=t=>{switch(hr(t,"Mask"),0===t.length&&rr("invalid mask data"),t[0]){case 0:case 1:5!==t.length&&rr("invalid number of points for rect mask");break;case 2:case 3:5!==t.length&&rr("invalid number of points for ellipse mask");break;case 4:case 5:(t.length<7||0==(1&t.length))&&rr("invalid number of points for poly mask")}for(let e=1;e<t.length;e++)Mr(t[e],"Mask",e+"");return!0},Bl=[[mr,""],[dr,"module"],[dr,"contents"]],Hl=t=>Tr(t,"BroadcastWindow",Bl),Fl=t=>(cr(t,"Broadcast"),void 0===t.type&&rr("invalid Broadcast object, missing 'type' key"),!0),$l=rs({stroke:"currentColor",fill:"none"}),Vl=ys({x:22,y:17,fill:"currentColor"},oa.TAB_SETTINGS),[Kl,Jl,Xl,ql,tM,eM,iM,oM,sM,aM,nM,rM,lM,MM,gM,cM,dM,IM,hM,TM,uM,AM,LM,mM,yM]=G(25),[NM,DM,pM,EM,wM,fM]=Array.from({length:6},((t,e)=>Me({type:"radio",name:Kl,checked:!e}))),xM=()=>{const t=()=>{for(const[t,e]of d)if(t.checked)return void e.beginElement()},e=()=>setTimeout((()=>(fM.checked?g:M).beginElement()),500),i=mo({dur:"1s",fill:"freeze",path:"M0,0 L250,150",onendEvent:t}),o=Lo({id:eM,attributeName:"fill",values:"#000",fill:"freeze",dur:"0.2s",begin:"indefinite"}),s=yo({id:oM,dur:"1s",attributeName:"transform",type:"scale",from:"1 1",to:"0.5 0.5",begin:"indefinite"}),a=mo({id:nM,dur:"6s",path:"M0,0 h-300 v-300 h300 v300",begin:"indefinite",onendEvent:t}),n=mo({id:rM,dur:"1s",fill:"freeze",path:"M250,150 L495,13",begin:"indefinite"}),r=mo({id:lM,dur:"1s",fill:"freeze",path:"M253,13 C300,20 300,0 495,13",begin:"indefinite"}),l=mo({dur:"0.5s",fill:"freeze",path:"M253,13 L250,150",begin:"indefinite",onendEvent:t}),M=Lo({id:gM,attributeName:"fill",values:"#000",dur:"0.2s",begin:"indefinite"}),g=Lo({id:hM,attributeName:"fill",values:"#000",fill:"freeze",dur:"0.5s",begin:"indefinite"}),c=Lo({id:TM,attributeName:"fill",values:"#000",dur:"0.2s",begin:"indefinite"}),d=[[NM,o],[DM,s],[pM,a],[EM,c],[wM,n],[fM,n]];return As({id:ql,viewBox:"0 0 500 300"},[po(ls({id:yM,patternUnits:"userSpaceOnUse",width:100,height:100},rs({d:"M0,100 V0 H100",stroke:"#000",fill:"none"}))),qo([ds({width:1e3,height:600,fill:"#00f"}),rs({d:"M50,150 C200,0 400,300 500,250 S600,300 700,200 S750,400 850,500 S400,600 300,550 S0,300 50,150 Z",fill:"#0f0"}),ds({width:1e3,height:600,fill:`url(#${yM})`}),mo({dur:"4s",path:"M0,0 C-50,150 -150,-150 -250,-150 C-150,150 250,150 0,0",begin:`${eM}.end`}),s,yo({id:sM,dur:"2s",attributeName:"transform",type:"scale",from:"0.5 0.5",to:"2 2",begin:`${oM}.end`}),yo({id:aM,dur:"1s",attributeName:"transform",type:"scale",from:"2 2",to:"1 1",begin:`${sM}.end`,onendEvent:t}),mo({dur:"1s",path:"M0,0 L125,75",begin:`${oM}.begin`}),mo({dur:"2s",path:"M125,75 L-250,-150",begin:`${sM}.begin`}),mo({dur:"1s",path:"M-250,-150 L0,0",begin:`${aM}.begin`}),a]),qo({transform:"translate(500, 0)"},[ds({id:Xl,width:500,height:301}),$l,No({cy:11,r:10,stroke:"#f00","stroke-width":2,fill:"#000"},[Lo({attributeName:"fill",dur:"1s",values:"#000;#fff",fill:"freeze",begin:`${MM}.end 0.1s`}),Lo({attributeName:"fill",dur:"1s",values:"#fff;#000",fill:"freeze",begin:`${gM}.end 0.1s`})]),Vl,yo({attributeName:"transform",type:"translate",from:"500 0",to:"250 0",dur:"1s",fill:"freeze",begin:`${MM}.end 0.1s`}),yo({attributeName:"transform",type:"translate",from:"250 0",to:"500 0",dur:"1s",fill:"freeze",begin:`${gM}.end 0.1s`,onendEvent:()=>{wM.checked?r.beginElement():l.beginElement()}}),yo({id:cM,attributeName:"transform",type:"translate",from:"250 0",to:"100 0",dur:"1s",begin:`${hM}.end`}),yo({id:dM,attributeName:"transform",type:"translate",from:"100 0",to:"400 0",dur:"2s",begin:`${cM}.end`}),yo({id:IM,attributeName:"transform",type:"translate",from:"400 0",to:"250 0",dur:"1s",begin:`${dM}.end`})]),qo([No({cx:50,cy:50,stroke:"#f00","stroke-width":8,fill:"none"},Lo({attributeName:"r",values:"4;46",dur:"1s",begin:`${TM}.end; ${uM}.end; ${AM}.end`})),No({cx:50,cy:50,stroke:"#00f","stroke-width":4,fill:"none"},Lo({attributeName:"r",values:"4;46",dur:"1s",begin:`${TM}.end; ${uM}.end; ${AM}.end`})),yo({attributeName:"transform",type:"translate",from:"200 100",to:"200 100",fill:"freeze",dur:"0.1s",begin:`${TM}.end`}),yo({attributeName:"transform",type:"translate",from:"50 150",to:"50 150",fill:"freeze",dur:"0.1s",begin:`${uM}.end`}),yo({attributeName:"transform",type:"translate",from:"300 200",to:"300 200",fill:"freeze",dur:"0.1s",begin:`${AM}.end`})]),qo({stroke:"#000",fill:"#fff"},[rs({d:"M0,0 v12 l3,-1 l2,5 l2,-0.75 l-2,-5 l3,-1 z"}),ds({y:17,width:15,height:20,rx:2}),qo({"stroke-width":.5},[ds({x:1,y:18,width:3,height:10,rx:1},[o,Lo({attributeName:"fill",values:"#fff",fill:"freeze",dur:"1s",begin:`${iM}.end`,onendEvent:t}),Lo({id:MM,attributeName:"fill",values:"#000",dur:"0.2s",begin:`${rM}.end 0.5s;${lM}.end 0.5s`}),M,g,Lo({attributeName:"fill",values:"#fff",dur:"0.2s",fill:"freeze",begin:`${IM}.end 0.5s`,onendEvent:e})]),ds({x:11,y:18,width:3,height:10,rx:1},[c,Lo({id:uM,attributeName:"fill",values:"#000",dur:"0.2s",begin:`${LM}.end`}),Lo({id:AM,attributeName:"fill",values:"#000",dur:"0.2s",begin:`${mM}.end`})]),rs({d:"M7.5,17.5 l-3,3 h2 v2 h2 v-2 h2 z"},[Lo({attributeName:"fill",values:"#000",dur:"2s",begin:`${sM}.begin`}),Lo({attributeName:"fill",values:"#000",dur:"3s",begin:`${nM}.begin 3s`})]),rs({d:"M7.5,27.5 l-3,-3 h2 v-2 h2 v2 h2 z"},[Lo({attributeName:"fill",values:"#000",dur:"1s",begin:`${oM}.begin`}),Lo({attributeName:"fill",values:"#000",dur:"1s",begin:`${aM}.begin`}),Lo({attributeName:"fill",values:"#000",dur:"3s",begin:`${nM}.begin`})])]),qo([ds({y:37,width:15,height:7,rx:2}),ys({x:2,y:42,textLength:11,style:"font:arial;font-size:5px","stroke-width":.3},"Shift"),Lo({attributeName:"fill",values:"#000",dur:"1.5s",begin:`${nM}.begin; ${nM}.begin 3s`}),Lo({attributeName:"stroke",values:"#fff",dur:"1.5s",begin:`${nM}.begin; ${nM}.begin 3s`})]),qo([ds({y:44,width:15,height:7,rx:2}),ys({x:2,y:49,style:"font:arial;font-size:5px","stroke-width":.3},"Ctrl"),Lo({attributeName:"fill",values:"#000",dur:"4s",begin:`${oM}.begin`}),Lo({attributeName:"stroke",values:"#fff",dur:"4s",begin:`${oM}.begin`})]),i,mo({id:iM,dur:"4s",path:"M250,150 C200,300 100,0 0,0 C100,300 500,300 250,150",begin:`${eM}.end`}),n,mo({dur:"1.5s",path:"M495,13 C200,300 150,100 253,13",fill:"freeze",begin:`${MM}.end 0.5s`,onendEvent:e}),r,l,mo({dur:"4s",path:"M253,13 h-150 h300 h-150",fill:"freeze",begin:`${hM}.end`}),mo({id:LM,dur:"1s",path:"M250,150 L100,200",fill:"freeze",begin:`${TM}.end`}),mo({id:mM,dur:"1s",path:"M100,200 L350,250",fill:"freeze",begin:`${uM}.end`}),mo({dur:"1s",path:"M350,250 L250,150",fill:"freeze",begin:`${AM}.end`,onendEvent:t})])])},SM=kn({"window-title":oa.HELP,maximised:!0});Y({[`#${Jl}`]:{height:"calc(100vh - 1em - 6px)","overflow-y":"scroll"},[`#${Xl}`]:{fill:"#fff"},[`#${ql}`]:{cursor:"crosshair","max-width":"100%",height:"80vh"," input":{display:"none"}},[`#${tM}`]:{" label":{display:"inline-block",border:"5px solid transparent","border-radius":"0.5em",cursor:"pointer",padding:"5px","margin-right":"5px"}," input:checked+label":{"border-style":"inset","border-color":"#000"}," div":{display:"none"},[Array.from({length:6},((t,e)=>` input:nth-of-type(${e+1}):checked~div:nth-of-type(${e+1})`)).join(",")]:{display:"block"}}});const CM=()=>{SM.parentNode?SM.remove():(I(vn,N(SM,Gt({id:Jl},[Vt(oa.HELP),xM(),Gt({id:tM},[Ka(NM,oa.HELP_MAP_DRAG),Ka(DM,oa.HELP_MAP_ZOOM),Ka(pM,oa.HELP_MAP_SCROLL),Ka(EM,oa.HELP_MAP_SIGNAL),Ka(wM,oa.HELP_PANEL_OPEN),Ka(fM,oa.HELP_PANEL_RESIZE),Gt(oa.HELP_DEMO_DRAG),Gt(oa.HELP_DEMO_ZOOM),Gt(oa.HELP_DEMO_SCROLL),Gt(oa.HELP_DEMO_SIGNAL),Gt(oa.HELP_DEMO_SIDEPANEL_OPEN),Gt(oa.HELP_DEMO_SIDEPANEL_RESIZE)])]))),setTimeout((()=>{const t=Vl.getComputedTextLength()+5;I($l,{d:`M0,0 v300 M0,23 h10 q5,0 5,-5 v-10 q0,-5 5,-5 h${t} q5,0 5,5 v10 q0,5 5,5 h${470-t}`}),NM.click()})))},kM=new Ci("keys",{},(t=>{for(const e in t)if("string"!=typeof t[e])return!1;return!0})),OM={},vM=(t,e,i,o,s,a=!1)=>{const[n,r,l]=nt(kM.value[t]??=i,o,s,a);return OM[t]=[e,l],[n,r]},bM=(t,e="")=>{OM[t]?.[1](e),kM.value[t]=e,kM.save()},jM=t=>kM.value[t],zM=t=>OM[t][0],YM=()=>Object.keys(OM);class _M{x;y;#Lt;#mt;lightColours;lightStages;lightTimings;constructor(t,e,i,o,s,a,n){this.x=t,this.y=e,this.#Lt=i,this.#mt=o,this.lightColours=s,this.lightStages=a,this.lightTimings=n}getCentre(){return[this.x,this.y]}getLightPos(){return[this.#Lt,this.#mt]}wallInteraction(t,e,i,o,s,a,n=!1){const r=[],l=[],{r:M,g,b:c,a:d}=s,I=n?1-d/255:d/255;let h=!1,T=0;for(let t=0;t<this.lightStages.length;t++){const e=this.lightStages[t],i=this.lightColours[t]??[];if(T+e<=a)l.push(e),r.push(i);else{l.push(T>a?Math.round(e*I):Math.round(a-T+(T+e-a)*I));const t=[];for(const{r:e,g:o,b:s,a}of i){const i=new zn(Math.round(Math.sqrt(M*e)*I),Math.round(Math.sqrt(g*o)*I),Math.round(Math.sqrt(c*s)*I),Math.round(255*(1-(1-a/255)*I)));i.a&&(i.r||i.g||i.b)&&(h=!0),t.push(i)}r.push(t)}T+=e}return h?new _M(t,e,i,o,r,l,this.lightTimings):null}createLightPolygon(t,e){const i=Ms({points:t});return XM.addLighting(i,this,e),i}}class PM extends _M{id;rotation=0;flip=!1;flop=!1;width;height;snap;tokenData;tokenType;constructor(t){super(t.x,t.y,0,0,t.lightColours,t.lightStages,t.lightTimings),this.id=t.id,this.width=t.width,this.height=t.height,this.rotation=t.rotation,this.snap=t.snap,this.tokenData=t.tokenData,this.tokenType=t.tokenType??0}at(t,e){const{x:i,y:o}=new DOMPoint(t,e).matrixTransform(this[Ki].getScreenCTM().inverse());return i>=0&&i<this.width&&o>=0&&o<this.height}transformString(t=!0){let e="";const i=t&&(this.flip||this.flop);return(0!==this.x||0!==this.y||i)&&(e+=`translate(${this.x+(t&&this.flop?this.width:0)}, ${this.y+(t&&this.flip?this.height:0)}) `),i&&(e+=`scale(${this.flop?-1:1}, ${this.flip?-1:1}) `),0!==this.rotation&&(e+=`rotate(${(t&&this.flop?-1:1)*(t&&this.flip?-1:1)*360*this.rotation/256}, ${this.width/2}, ${this.height/2})`),e}getData(t){if(this.tokenData[t])return this.tokenData[t].data;if(this.tokenData["store-character-id"]){const e=Xa.get(this.tokenData["store-character-id"].data);if(e&&e[t])return e[t].data}return null}hasLight(){return!(!this.lightStages.length||!this.lightTimings.length)}getCentre(){return[this.x+(this.width>>1),this.y+(this.height>>1)]}getLightPos(){return this.getCentre()}cleanup(){}uncleanup(){}}class GM extends PM{[Ki];src;patternWidth;patternHeight;constructor(t,e){super(t),e?.add(),this.src=t.src,this.flip=t.flip,this.flop=t.flop,this.patternWidth=t.patternWidth,this.patternHeight=t.patternWidth,this[Ki]=ts(Object.assign({class:"mapToken",href:ld(t.src),preserveAspectRatio:"none",width:t.patternWidth>0?t.patternWidth:t.width,height:t.patternHeight>0?t.patternHeight:t.height,transform:this.transformString()},e?{onload:()=>e.done(),onerror:()=>e.error()}:{})),t.patternWidth>0&&setTimeout((()=>this.updateNode()))}get isPattern(){return this.patternWidth>0}cleanup(){this.isPattern&&XM.remove(this[Ki].getAttribute("fill").slice(5,-1))}uncleanup(){this.isPattern&&I(this[Ki],{fill:`url(#${XM.add(this)})`})}updateSource(t){I(this[Ki]instanceof SVGRectElement?XM.list.get(this[Ki].getAttribute("fill").slice(5,-1)).firstChild:this[Ki],{href:`images/${this.src=t}`})}updateNode(){this[Ki]instanceof SVGRectElement&&!this.isPattern?(XM.remove(this[Ki].getAttribute("fill").slice(5,-1)),this[Ki].replaceWith(this[Ki]=ts({href:ld(this.src),preserveAspectRatio:"none"}))):this[Ki]instanceof SVGImageElement&&this.isPattern&&this[Ki].replaceWith(this[Ki]=ds({class:"mapPattern",fill:`url(#${XM.add(this)})`})),I(this[Ki],{width:this.width,height:this.height,transform:this.transformString()})}}class RM extends PM{[Ki];fill;stroke;strokeWidth;isEllipse;constructor(t){super(t),this.fill=t.fill,this.stroke=t.stroke,this.strokeWidth=t.strokeWidth,this.isEllipse=t.isEllipse??!1;const e=t.width/2,i=t.height/2;this[Ki]=I(t.isEllipse?wo({cx:e,cy:i,rx:e,ry:i}):ds({width:t.width,height:t.height}),{class:"mapShape",fill:t.fill,stroke:t.stroke,"stroke-width":t.strokeWidth,transform:this.transformString()})}get isPattern(){return!1}updateNode(){if(this.isEllipse){const t=this.width/2,e=this.height/2;I(this[Ki],{cx:t,cy:e,rx:t,ry:e,transform:this.transformString()})}else I(this[Ki],{width:this.width,height:this.height,transform:this.transformString()})}}class UM extends PM{[Ki];fill;stroke;strokeWidth;points;#yt;#Nt;isEllipse=!1;constructor(t){super(t),this.fill=t.fill,this.stroke=t.stroke,this.strokeWidth=t.strokeWidth,this.points=t.points;let e=0,i=0;for(const o of t.points)o.x>e&&(e=o.x),o.y>i&&(i=o.y);this.#yt=e,this.#Nt=i;const o=t.width/e,s=t.height/i;this[Ki]=rs({class:"mapDrawing",d:`M${t.points.map((t=>`${t.x*o},${t.y*s}`)).join(" L")}${0===t.fill.a?"":" Z"}`,fill:t.fill,stroke:t.stroke,"stroke-width":t.strokeWidth,transform:this.transformString()})}get isPattern(){return!1}updateNode(){const t=this.width/this.#yt,e=this.height/this.#Nt;I(this[Ki],{d:`M${this.points.map((i=>`${i.x*t},${i.y*e}`)).join(" L")}${0===this.fill.a?"":" Z"}`,transform:this.transformString()})}}const WM=Date.now()/1e3,[QM,ZM]=(new bi).bind(3),BM=new Map,HM={layer:null,token:null},FM=qo(),$M=t=>qs[(t+143>>5)%4],VM=()=>{HM.token=null,I(FM,{style:{display:"none"}}),QM()},KM=(()=>{const t=ds({width:"100%",height:"100%",fill:"#000"}),e=new Io(qo()),i=ss({id:Js},[t,e[Ki]]);let o=!1;return{get[Ki](){return i},get baseOpaque(){return o},get masks(){return Ja(e)},index:t=>e[t],at(t,i){let o=-1,s=null;for(const[a,n]of e.entries())switch(n[0]){case 0:case 1:{const[,e,r,l,M]=n;e<=t&&t<=e+l&&r<=i&&i<=r+M&&(o=a,s=n)}break;case 2:case 3:{const[,e,r,l,M]=n,g=l*l,c=M*M;c*Math.pow(t-e,2)+g*Math.pow(i-r,2)<=g*c&&(o=a,s=n)}break;case 4:case 5:{const e=n.reduce(((t,e,i)=>(i%2==1&&t.push([n[i],n[i+1]]),t)),[]);let r=e[e.length-1],l=!1;for(const o of e)i>Math.min(o[1],r[1])&&i<=Math.max(o[1],r[1])&&t<=(i-o[1])*(r[0]-o[0])/(r[1]-o[1])+o[0]&&(l=!l),r=o;l&&(o=a,s=n)}}return[s,o]},add(t){const i=1&t[0]?"#000":"#fff";let o;switch(t[0]){case 0:case 1:o=ds({x:t[1],y:t[2],width:t[3],height:t[4],fill:i});break;case 2:case 3:o=wo({cx:t[1],cy:t[2],rx:t[3],ry:t[4],fill:i});break;case 4:case 5:o=Ms({points:t.reduce(((e,i,o)=>o%2==1?`${e} ${t[o]},${t[o+1]}`:e),""),fill:i});break;default:return-1}return e.push(Object.assign(t,{[Ki]:o}))-1},remove(t){e.splice(t,1)},set(i,s){I(t,{fill:(o=i)?"#fff":"#000"}),e.splice(0,e.length);for(const t of s)this.add(t)}}})(),JM=Math.sqrt(3),XM=(()=>{let t=0,e=qo(),i=qo();const o=new Map,s=ds({width:"100%",height:"100%"}),a=qo({id:Ks},[s,e]),n=po([KM[Ki],a,i]),r=new Map([["",[e,i]]]);return{get[Ki](){return n},get list(){return o},add(t){let e=0;for(;o.has(`Pattern_${e}`);)e++;const i=`Pattern_${e}`;return I(n,Ai(o,i,ls({id:i,patternUnits:"userSpaceOnUse",width:t.patternWidth,height:t.patternHeight},ts({href:ld(t.src),width:t.patternWidth,height:t.patternHeight,preserveAspectRatio:"none"})))),i},remove(t){n.removeChild(o.get(t)),o.delete(t)},setGrid({gridSize:t,gridColour:e,gridStroke:i,gridType:s}){switch(o.get("grid")?.remove(),s){case 1:{const s=2*t/JM,a=3*t/JM;I(n,Ai(o,"grid",ls({id:Xs,patternUnits:"userSpaceOnUse",width:t,height:a},rs({d:`M${t/2},${a} V${s} l${t/2},-${s/4} V${s/4} L${t/2},0 L0,${s/4} v${s/2} L${t/2},${s}`,stroke:e,"stroke-width":i,fill:"transparent"}))))}break;case 2:{const s=2*t/JM,a=3*t/JM;I(n,Ai(o,"grid",ls({id:Xs,patternUnits:"userSpaceOnUse",width:a,height:t},rs({d:`M${a},${t/2} H${s} l-${s/4},${t/2} H${s/4} L0,${t/2} L${s/4},0 h${s/2} L${s},${t/2}`,stroke:e,"stroke-width":i,fill:"transparent"}))))}break;default:I(n,Ai(o,"grid",ls({id:Xs,patternUnits:"userSpaceOnUse",width:t,height:t},rs({d:`M0,${t} V0 H${t}`,stroke:e,"stroke-width":i,fill:"transparent"}))))}},setLight(t){I(s,{fill:t})},addLighting(o,s,a){const{lightTimings:n,lightStages:r,lightColours:l}=s;if(n.length&&r.length){let M=0,g=0;const c="LG_"+t++,[d,h]=s.getLightPos(),T=n.reduce(((t,e)=>t+e),0),u="0;"+n.map((t=>(g+=t)/T)).join(";"),A=r.reduce(((t,e)=>t+e),0),L=$n-WM+"s",m=cs({id:c,r:A*a,cx:d,cy:h,gradientUnits:"userSpaceOnUse"},[r.map(((t,e)=>{const i=Ts({offset:100*M/A+"%","stop-color":1!==n.length?void 0:l[e]?.[0]??Pn},1!==n.length?Lo({attributeName:"stop-color",begin:L,keyTimes:u,dur:T+"ms",repeatCount:"indefinite",values:n.map(((t,i)=>l[e]?.[i]??Pn)).join(";")+";"+l[e]?.[0]??Pn}):[]);return M+=t,i}))]);return I(i,I(m,I(m.lastChild?.cloneNode(!0),{offset:"100%","stop-opacity":0}))),I(e,I(o,{fill:`url(#${c})`})),m}return null},clearLighting(){N(a,[s,e=qo()]);for(const[,[,t]]of r)t.remove();r.clear(),r.set("",[e,i=n.appendChild(qo())]),t=0},setLightGroup(t){[e,i]=r.get(t)??Ai(r,t,[a.appendChild(qo()),n.appendChild(qo())])},clearLightGroup(t){const e=r.get(t);e&&(N(e[0]),N(e[1]))},clear(){this.clearLighting();for(const t of o.values())t.remove();o.clear()}}})(),qM=new Map,tg=new Map,eg=t=>Array.from(qM.entries()).filter((e=>e[1][t])).sort(((e,i)=>e[1][t].priority===i[1][t].priority?Xi(e[0],i[0]):(e[1][t].priority??0)-(i[1][t].priority??0))),ig=({url:t})=>t.split("/").pop()??"",og=()=>{if(0===tg.size)return[];const t=Me({type:"checkbox",class:Os,disabled:!0}),e=Ue({onchange:function(){const e=tg.get(this.value),o={disabled:!e};I(t,o),I(i,o),t.checked=e?.enabled??!1}},[xe({value:""}),Array.from(tg.keys()).sort().map((t=>xe({value:t},t)))]),i=wt({disabled:!0,onclick:()=>{const i=e.value,o=tg.get(i);o&&t.checked!==o.enabled&&((o.enabled=t.checked)?Jn.enablePlugin:Jn.disablePlugin)(i).then(rg).catch(er)}},oa.SAVE);return[Hn?Yt([Ve(Vt(oa.PLUGINS)),Ka([oa.PLUGINS,": "],e),Ka(t,""),Et(),i]):[],eg("settings").map((([t,{settings:{fn:e}}])=>Yt([Ve(Vt(t.charAt(0).toUpperCase()+t.slice(1))),e])))]},sg=(t,e,i,o,s,a,n)=>{const r=[];for(const[l,{characterEdit:{fn:M}}]of eg("characterEdit")){const g=y(),c=M(g,e,i,o,s,a,n);c&&r.push(c),I(t,Zt([Ie(l.charAt(0).toUpperCase()+l.slice(1)),g]))}return()=>{for(const t of r)t()}},ag=(t,e)=>{qM.set(t,e)},ng=t=>tg.get(t)?.data,rg=()=>Hn?vn.confirm(oa.PLUGIN_REFRESH,oa.PLUGIN_REFRESH_REQUEST).then((t=>t&&window.location.reload())):window.location.reload(),lg=()=>{const t=[];for(const[,{tokenContext:{fn:e}}]of eg("tokenContext")){const i=e();i&&t.push(i)}return t},Mg=()=>{const t=[];for(const[,{tokenDataFilter:{fn:e}}]of eg("tokenDataFilter"))t.push(...e);return t},gg=()=>eg("menuItem").map((t=>t[1].menuItem.fn)),cg=t=>eg("addWalls").reduce(((e,[,{addWalls:{fn:i}}])=>e.concat(i(t))),[]),dg=t=>eg("addLights").reduce(((e,[,{addLights:{fn:i}}])=>e.concat(i(t))),[]),Ig=t=>{for(const[,{handleWalls:{fn:e}}]of eg("handleWalls"))e(t)};let hg=GM,Tg=RM,ug=UM;const Ag=()=>(Jn.waitPluginChange().when(rg),Jn.listPlugins().then((t=>{let e=Promise.resolve();for(const i of Object.keys(t).sort(Xi))Ai(tg,i,t[i]).enabled&&(e=e.finally((()=>include(`/plugins/${i}`))));return e})).then((()=>{for(const[,{tokenClass:{fn:t}}]of eg("tokenClass")){const e=t(hg);e.prototype instanceof hg&&(hg=e)}for(const[,{shapeClass:{fn:t}}]of eg("shapeClass")){const e=t(Tg);e.prototype instanceof Tg&&(Tg=e)}for(const[,{drawingClass:{fn:t}}]of eg("drawingClass")){const e=t(ug);e.prototype instanceof ug&&(ug=e)}}))),[Lg,mg,yg,Ng,Dg,pg,Eg,wg,fg,xg]=["autosnap","menuHide","invert","miniTools","tabIcons","zoomSlider","panelOnTop","measureTokenMove","enableAnimation","musicSort"].map((t=>new wi(t))),Sg=new fi("scrollAmount"),Cg=new fi("undoLimit",100,-1),[kg,Og]=["hiddenLayerOpacity","hiddenLayerSelectedOpacity"].map((t=>new fi(t,128,0,255))),vg=P();Y({[`.${Os}`]:{display:"none","[disabled]+label":{color:"#888",":after":{"background-image":"none !important"}},"+label:after":{width:"1.2em",height:"1em",display:"inline-block",content:'""',"background-repeat":"no-repeat","background-size":"1em","background-position":"bottom center","background-image":'url(\'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 10"%3E%3Cpath d="M2,1 q5,6 8,8 M2,9 q5,-3 8,-8" stroke="%23f00" stroke-linecap="round" stroke-linejoin="round" fill="none" stroke-width="2" /%3E%3C/svg%3E\')'},":checked+label:after":{"background-image":'url(\'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 10"%3E%3Cpath d="M1,6 l3,3 7,-8" stroke="%230f0" stroke-linecap="round" stroke-linejoin="round" fill="none" stroke-width="2" /%3E%3C/svg%3E\')'},"[type=radio]:checked+label:after":{"background-image":'url(\'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 10"%3E%3Cpath d="M1,6 l3,3 7,-8" stroke="%2300f" stroke-linecap="round" stroke-linejoin="round" fill="none" stroke-width="2" /%3E%3C/svg%3E\')'}},[`#${vg}`]:{" h1":{display:"inline-block"}," ul":{"list-style":"none",padding:0}}}),sn.push([7,()=>[oa.TAB_SETTINGS,Gt({id:vg},[wt({onclick:CM},oa.HELP_OPEN),Et(),Vt(oa.SETTINGS_AUTH),$t({action:Hn?"?":"?admin",method:"post"},Me({type:"submit",value:oa[Hn?"LOGOUT":"LOGIN"]})),Et(),Yt([Ve(Vt(oa.SETTINGS_LANGUAGE)),Ka([oa.SETTINGS_LANGUAGE_SELECT,": "],Ue({onchange:function(){ta.set(this.value)}},ia.map((t=>xe({selected:t===ta.value},t)))))]),Yt([Ve(Vt(oa.SETTINGS_THEME)),Ka(Me({type:"checkbox",class:Os,checked:yg.value,onchange:function(){yg.set(this.checked)}}),[oa.SETTINGS_INVERT,": "]),Et(),Ka(Me({type:"checkbox",class:Os,checked:Dg.value,onchange:function(){Dg.set(this.checked)}}),[oa.SETTINGS_TAB_ICONS,": "]),Et(),Ka(Me({type:"checkbox",class:Os,checked:Eg.value,onchange:function(){Eg.set(this.checked)}}),[oa.SETTINGS_PANEL_ON_TOP,": "]),Et(),Ka(Me({type:"checkbox",class:Os,checked:mg.value,onchange:function(){mg.set(this.checked)}}),[oa.SETTINGS_HIDE_MENU,": "]),Et(),Ka(Me({type:"checkbox",class:Os,checked:pg.value,onchange:function(){pg.set(this.checked)}}),[oa.SETTINGS_ZOOM_SLIDER_HIDE,": "]),Hn?[Et(),Ka(Me({type:"checkbox",class:Os,checked:Ng.value,onchange:function(){Ng.set(this.checked)}}),[oa.SETTINGS_MINI_TOOLS,": "]),Et(),Ka(Me({type:"checkbox",class:Os,checked:xg.value,onchange:function(){xg.set(this.checked)}}),[oa.SETTINGS_MUSIC_SORT,": "])]:[]]),Yt([Ve(Vt(oa.SETTINGS_MAP)),Hn?[Ka(Me({type:"checkbox",class:Os,checked:Lg.value,onchange:function(){Lg.set(this.checked)}}),[oa.SETTINGS_AUTOSNAP,": "]),Et(),Ka(Me({type:"checkbox",class:Os,checked:wg.value,onchange:function(){wg.set(this.checked)}}),[oa.SETTINGS_MEASURE_TOKEN_MOVE,": "]),Et()]:[],Ka([oa.SETTINGS_SCROLL_AMOUNT,": "],Me({type:"number",value:Sg.value,step:1,onchange:function(){Sg.set(parseInt(this.value))}})),Et(),Hn?[Ka([oa.SETTINGS_UNDO_LIMIT,": "],Me({type:"number",value:Cg.value,step:1,min:-1,onchange:function(){Cg.set(parseInt(this.value))}})),Et()]:[],Ka(Me({type:"checkbox",class:Os,checked:fg.value,onchange:function(){fg.set(this.checked)}}),[oa.SETTINGS_ENABLE_ANIMATION,": "]),Hn?[Et(),Ka([oa.SETTINGS_LAYER_HIDDEN_OPACITY,": "],Me({type:"range",min:0,max:255,value:kg.value,oninput:function(){kg.set(parseInt(this.value))}})),Et(),Ka([oa.SETTINGS_LAYER_HIDDEN_SELECTED_OPACITY,": "],Me({type:"range",min:0,max:255,value:Og.value,oninput:function(){Og.set(parseInt(this.value))}}))]:[]]),og(),Yt([Ve(Vt(oa.SETTINGS_KEYS)),gi(YM().map((t=>he(Ka([zM(t),": "],wt({onclick:function(){let e="";const i=Be(),o=t=>{N(i,e=(t.ctrlKey?"Ctrl+":"")+(t.altKey?"Alt+":"")+(t.shiftKey?"Shift+":"")+(t.metaKey?"Meta+":""))},s=kn({"window-title":oa.SETTINGS_KEYS_NEW,onkeydown:i=>{switch(i.key){default:i.stopPropagation(),bM(t,e+i.key),N(this,e+i.key),s.close();case"OS":case"Meta":case"Shift":case"Control":case"Alt":o(i)}},onkeyup:o},[oa.SETTINGS_KEYS_NEW,Et(),i]);s.addControlButton(Ea,(()=>{bM(t),N(this,"\u202f"),s.close()}),oa.SETTINGS_KEYS_DELETE),I(vn,s)}},jM(t)||"\u202f"))))))]),Yt([Ve(Vt(oa.SETTINGS_RESET)),wt({onclick:()=>vn.confirm(oa.ARE_YOU_SURE,oa.SETTINGS_RESET_CONFIRM).then((t=>{t&&(window.localStorage.clear(),window.location.reload())}))},oa.SETTINGS_CLEAR)])]),!1,`data:image/svg+xml,%3Csvg xmlns="${To}" viewBox="0 0 100 100"%3E%3Cg fill="none"%3E%3Ccircle cx="50" cy="50" r="35" stroke="%23ccc" stroke-width="10" /%3E%3Ccircle cx="50" cy="50" r="5" stroke="%23ccc" stroke-width="2" /%3E%3C/g%3E%3Cpath id="settings-spoke" d="M35,15 l5,-15 h20 l5,15" fill="%23ccc" /%3E%3Cuse href="%23settings-spoke" transform="rotate(60, 50, 50)" /%3E%3Cuse href="%23settings-spoke" transform="rotate(120, 50, 50)" /%3E%3Cuse href="%23settings-spoke" transform="rotate(180, 50, 50)" /%3E%3Cuse href="%23settings-spoke" transform="rotate(240, 50, 50)" /%3E%3Cuse href="%23settings-spoke" transform="rotate(300, 50, 50)" /%3E%3Cpath d="M21.5,33.5 L46,47.5 M50,81 L50,55 M78.5,33.5 L54,47.5" stroke="%23ccc" stroke-width="2" /%3E%3C/svg%3E`]]);const bg=(t,e)=>Xi(t.name,e.name),jg=(t,e)=>e.id-t.id,zg=new WeakMap,Yg=(t,e)=>[e,...Array.from(t.children.values()).filter((t=>t instanceof Bg)).flatMap((t=>Yg(t,e+t.name+"/"))).sort(Xi)],_g=Gt({style:"transform: translateX(-9999px); display: inline-block"},Ta({style:"width: 2em; height: 2em"})),Pg=({root:{[Ki]:t}})=>{I(t,{class:{[_s]:!1}});for(const e of[...t.getElementsByClassName(Ps),t])I(e,{class:{[Ps]:!1}})},[Gg,Rg,Ug,Wg]=G(4);yg.wait((t=>I(_g,{style:{"background-color":t?"#000":"#fff"}})));class Qg{id;name;parent;[Ki];nameElem;renamer;copier;remover;constructor(t,e,i){this.id=e,this.name=i,this.parent=t,this[Ki]=he({class:Rs},[this.nameElem=Be({class:Gg,onclick:()=>this.show()},i),this.renamer=wa({title:oa.ITEM_MOVE,class:Us,onclick:()=>this.rename()}),this.copier=Ia({title:oa.ITEM_COPY_ADD,class:Us,onclick:()=>this.copy()}),this.remover=pa({title:oa.ITEM_REMOVE,class:Us,onclick:()=>this.remove()})])}rename(){const t=this,e=t.parent.root,i=this.parent.getPath()+"/",o=Ue(Yg(e.folder,"/").map((t=>xe(t===i?{value:t,selected:!0}:{value:t},t)))),s=Me({type:"text",value:this.name,onkeypress:Fa}),a=kn({"window-icon":e.windowIcon,"window-title":oa.ITEM_MOVE},[Vt(oa.ITEM_MOVE),Gt([oa.OLD_LOCATION,`: ${i}${this.name}`]),Ka([oa.NEW_LOCATION,": "],o),s,Et(),wt({onclick:function(){I(this,{disabled:!0}),Cn(yi((()=>e.rpcFuncs.move(i+t.name,o.value+s.value).then((o=>{e.moveItem(i+t.name,o),a.remove()})).finally((()=>I(this,{disabled:!1}))))),a)}},oa.ITEM_MOVE)]);return I(vn,a),Ni(s),a}copy(){const t=this,e=t.parent.root,i=this.parent.getPath()+"/",o=Ue(Yg(e.folder,"/").map((t=>xe(t===i?{value:t,selected:!0}:{value:t},t)))),s=Me({type:"text",value:this.name,onkeypress:Fa}),a=kn({"window-icon":e.windowIcon,"window-title":oa.ITEM_COPY_ADD},[Vt(oa.ITEM_COPY_ADD),Gt([oa.CURRENT_LOCATION,`: ${i}${this.name}`]),Ka([oa.ITEM_COPY_NEW,": "],o),s,Et(),wt({onclick:function(){I(this,{disabled:!0}),Cn(yi((()=>e.rpcFuncs.copy(t.id,o.value+s.value).then((i=>{e.copyItem(t.id,i.id,i.path),a.remove()})).finally((()=>I(this,{disabled:!1}))))),a)}},oa.ITEM_COPY_ADD)]);return I(vn,a),Ni(s),a}remove(){const t=this.parent.root,e=this.getPath(),i=Gt(e),o=wt({onclick:function(){I(this,{disabled:!0}),Cn(yi((()=>t.rpcFuncs.remove(e).then((()=>{t.removeItem(e),s.remove()})).finally((()=>I(this,{disabled:!0}))))),s)}},oa.ITEM_REMOVE),s=kn({"window-icon":t.windowIcon,"window-title":oa.ITEM_REMOVE},[Vt(oa.ITEM_REMOVE),Gt(oa.ITEM_REMOVE_CONFIRM),i,o]);return I(vn,s),Ni(o),s}getPath(){return this.parent.getPath()+"/"+this.name}delete(){}filter(t){const e=this.name.toLowerCase();let i=!0;for(const o of t)if(!e.includes(o)){i=!1;break}return I(this[Ki],{style:{display:i?void 0:"none"}}),i}}class Zg extends Qg{image=le({class:Ws,loading:"lazy",onload:()=>{this.#Dt=this.image.naturalWidth,this.#pt=this.image.naturalHeight}});#It=Gt(this.image);#Dt=-1;#pt=-1;#Et;#wt;constructor(t,e,i,o,s=!1){super(t,e,i),this.#wt=o,this.#Et=o.register(this),I(this[Ki].firstChild,{draggable:"true",onmouseover:()=>I(document.body,I(this.#It,{style:s?void 0:{transform:"translateX(-9999px)"}})),onmousemove:s?t=>I(this.#It,{style:{"--icon-top":t.clientY+5+"px","--icon-left":t.clientX+5+"px"}}):void 0,onmouseout:()=>this.removeIcon(),ondragstart:this,ondragend:this})}get width(){return this.#Dt}get height(){return this.#pt}handleEvent(t){"dragend"===t.type?this.ondragend(t):"dragstart"===t.type&&this.ondragstart(t)}ondragstart(t){-1!==this.#Dt&&-1!==this.#pt?(this.#wt.set(t,this.#Et,this.#It),I(this.#It.parentNode?null:document.body,I(this.#It,{style:{transform:"translateX(-9999px)"}})),setTimeout(I,0,this.parent.root[Ki],{class:[_s]})):t.preventDefault()}ondragend(t){this.parent instanceof Hg&&Pg(this.parent)}transfer(){return this}delete(){this.removeIcon(),this.#wt.deregister(this.#Et)}removeIcon(){I(this.#It,{style:{transform:void 0}}).remove()}}class Bg{parent;name;[Ki];children;root;nameElem;renamer;newer;remover;constructor(t,e,i,o){this.root=t,this.parent=e,this.children=new ho(gi({class:Gs}),this.sorter),this.nameElem=Be(i),this.renamer=wa({title:oa.FOLDER_MOVE,class:Us,onclick:t=>this.rename(t)}),this.newer=Aa({title:oa.FOLDER_ADD,class:Us,onclick:t=>this.newFolder(t)}),this.remover=pa({title:oa.FOLDER_REMOVE,class:Us,onclick:t=>this.remove(t)}),this[Ki]=(this.name=i)?he({class:Ug},[Yt([Ve([Ta({class:Rg}),this.nameElem,this.renamer,this.newer,this.remover]),this.children[Ki]])]):Gt();for(const e in o.folders)this.children.set(e,new this.root.newFolder(t,this,e,o.folders[e]));for(const t in o.items)this.children.set(t,new this.root.newItem(this,o.items[t],t))}get folderSorter(){return bg}get itemSorter(){return null===this.parent?jg:bg}get sorter(){const t=this.folderSorter,e=this.itemSorter,i=zg.get(t);if(i){const t=i.get(e);if(t)return t}const o=(i,o)=>i instanceof Bg?o instanceof Bg?t(i,o):-1:o instanceof Bg?1:e(i,o);return i?i.set(e,o):zg.set(t,new WeakMap([[e,o]])),o}rename(t){t.preventDefault();const e=this.root,i=this.getPath()+"/",o=this.parent?this.parent.getPath()+"/":"/",s=Ue(Yg(e.folder,"/").filter((t=>!t.startsWith(i))).map((t=>xe(t===o?{value:t,selected:!0}:{value:t},t)))),a=Me({type:"text",value:this.name,onkeypress:Fa}),n=kn({"window-icon":e.windowIcon,"window-title":oa.FOLDER_MOVE},[Vt(oa.FOLDER_MOVE),Gt([oa.OLD_LOCATION,`: ${i.slice(0,-1)}`]),Ka([oa.NEW_LOCATION,": "],s),a,Et(),wt({onclick:function(){I(this,{disabled:!0}),Cn(yi((()=>e.rpcFuncs.moveFolder(i,s.value+"/"+a.value).then((t=>{e.moveFolder(i.slice(0,-1),t),n.remove()})).finally((()=>I(this,{disabled:!0}))))),n)}},oa.FOLDER_MOVE)]);return I(vn,n),Ni(a),n}remove(t){t.preventDefault();const e=this.root,i=this.getPath(),o=Gt(i),s=wt({onclick:function(){I(this,{disabled:!0}),Cn(yi((()=>e.rpcFuncs.removeFolder(i).then((()=>{e.removeFolder(i),a.remove()})).finally((()=>I(this,{disabled:!0}))))),a)}},oa.FOLDER_REMOVE),a=kn({"window-icon":e.windowIcon,"window-title":oa.FOLDER_REMOVE},[Vt(oa.FOLDER_REMOVE),Gt(oa.FOLDER_REMOVE_CONFIRM),o,s]);return I(vn,a),Ni(s),a}newFolder(t){t.preventDefault();const e=this.root,i=this.getPath(),o=Me({onkeypress:Fa}),s=kn({"window-icon":e.windowIcon,"window-title":oa.FOLDER_ADD},[Vt(oa.FOLDER_ADD),Ka([oa.FOLDER_NAME,": "+i+"/"],o),Et(),wt({onclick:function(){I(this,{disabled:!0}),Cn(yi((()=>e.rpcFuncs.createFolder(i+"/"+o.value).then((t=>{e.addFolder(t),s.remove()})).finally((()=>I(this,{disabled:!0}))))),s)}},oa.FOLDER_ADD)]);return I(vn,s),Ni(o),s}addItem(t,e){return this.getItem(e)??Ai(this.children,e,new this.root.newItem(this,t,e))}getItem(t){return this.children.get(t)}removeItem(t){const e=this.children.get(t);return e?(this.children.delete(t),e.delete(),e.id):-1}addFolder(t){return""===t?this:this.getFolder(t)??Ai(this.children,t,new this.root.newFolder(this.root,this,t,{folders:{},items:{}}))}getFolder(t){return this.children.get(t)}removeFolder(t){const e=this.children.get(t);return e&&this.children.delete(t),e}getPath(){const t=[];for(let e=this;e;e=e.parent)t.push(e.name);return t.reverse().join("/")}delete(){this.children.clear()}filter(t){const e=this.name.toLowerCase();let i=!0;for(const o of t)if(!e.includes(o)){i=!1;break}for(const[,e]of this.children)e.filter(t)&&(i=!0);return this.name&&I(this[Ki],{style:{display:i?void 0:"none"}}),i}}class Hg extends Bg{#wt;#ft;#Et;constructor(t,e,i,o,s,a){super(t,e,i,o),this.#wt=s,this.#Et=(this.#ft=a)?.register(this)??"",i&&a&&I(this.nameElem,{draggable:"true",ondragstart:this,ondragend:this}),I(this[Ki],{ondragover:this,ondrop:this,ondragenter:this,ondragleave:this}),null===e&&I(this[Ki],{onmouseover:()=>Pg(this)})}handleEvent(t){switch(t.type){case"dragover":return this.ondragover(t);case"drop":return this.ondrop(t);case"dragenter":return this.ondragenter(t);case"dragleave":return this.ondragleave(t);case"dragstart":_g.parentNode||I(document.body,_g),this.#ft?.set(t,this.#Et,_g);break;case"dragend":Pg(this)}}ondragover(t){if(t.stopPropagation(),this.#ft?.is(t)){const e=this.#ft.get(t);for(let i=this;i;i=i.parent)if(i===e)return void(t.dataTransfer.dropEffect="none");t.preventDefault(),t.dataTransfer.dropEffect="move"}else this.#wt.is(t)&&(t.preventDefault(),t.dataTransfer.dropEffect="move")}ondragenter(t){if(t.stopPropagation(),this.#ft?.is(t)){const e=this.#ft.get(t);for(let t=this;t;t=t.parent)if(t===e)return}else if(!this.#wt.is(t))return;I(this[Ki],{class:[Ps]}),I(this.root[Ki],{class:[_s]})}ondragleave(t){I(this[Ki],{class:{[Ps]:!1}}),t.stopPropagation()}ondrop(t){if(Pg(this),t.stopPropagation(),this.#wt.is(t)){const{parent:e,name:i}=this.#wt.get(t);if(e!==this){const t=e.getPath()+"/";yi((()=>this.root.rpcFuncs.move(t+i,this.getPath()+"/"+i).then((e=>this.root.moveItem(t+i,e)))))}}else if(this.#ft?.is(t)){const e=this.#ft.get(t);if(e.parent!==this){for(let t=this;t;t=t.parent)if(t===e)return;const t=e.getPath();yi((()=>this.root.rpcFuncs.moveFolder(t+"/",this.getPath()+"/"+e.name).then((e=>this.root.moveFolder(t,e)))))}}}transfer(){return this}}class Fg{#xt;folder;rpcFuncs;newItem;newFolder;windowIcon;[Ki];constructor(t,e,i,o,s=Bg){this.newItem=o,this.newFolder=s,this.#xt=e,i&&(this.setRPCFuncs(i),Fg.prototype.setRoot.call(this,t))}setRoot(t){if(this.rpcFuncs){const e=this.folder=new this.newFolder(this,null,"",t);N(this[Ki]??=this.folder[Ki],[Be({style:"margin-right: 0.5em"},this.#xt),e.newer,this.filter?[Ka(Me({class:Wg,placeholder:oa.FILTER,oninput:function(){const t=this.value.toLowerCase().split(" ");for(let e=0;e<t.length;e++)if('"'===t[e].charAt(0)){for(;t.length>e+1&&'"'!==t[e].slice(-1);)t[e]+=" "+t.splice(e+1,1)[0];t[e]=t[e].slice(1,'"'===t[e].slice(-1)?-1:void 0)}e.filter(t)}}),Ba(),{title:oa.FILTER_CLEAR,onclick:function(){const t=this.control;t.value="",t.dispatchEvent(new Event("input"))}}),Et()]:[],e.children[Ki]])}}setRPCFuncs(t){this.rpcFuncs||(this.rpcFuncs=t,t.waitAdded().when((t=>{for(const{id:e,name:i}of t)this.addItem(e,i)})),t.waitMoved().when((({from:t,to:e})=>this.moveItem(t,e))),t.waitRemoved().when((t=>this.removeItem(t))),t.waitCopied().when((({oldID:t,newID:e,path:i})=>this.copyItem(t,e,i))),t.waitFolderAdded().when((t=>this.addFolder(t))),t.waitFolderMoved().when((({from:t,to:e})=>this.moveFolder(t,e))),t.waitFolderRemoved().when((t=>this.removeFolder(t))))}get filter(){return!0}get root(){return this}resolvePath(t){const e=t.split("/"),i=e.pop()??"";let o=this.folder;for(const t of e)if(t){const e=o.getFolder(t);if(!e)return[null,i];o=e}return[o,i]}addItem(t,e){const[i,o]=this.resolvePath(e);return i?.addItem(t,o)}getItem(t){const[e,i]=this.resolvePath(t);return e?.getItem(i)}moveItem(t,e){this.addItem(this.removeItem(t),e)}copyItem(t,e,i){this.addItem(e,i)}removeItem(t){const[e,i]=this.resolvePath(t);return e?.removeItem(i)??-1}addFolder(t){const e=t.split("/");let i=this.folder.addFolder(e.shift());for(const t of e)i=i.addFolder(t);return i}moveFolder(t,e){const i=this.removeFolder(t);if(i){const t=this.addFolder(e);for(const[e,o]of i.children)o.parent=t,t.children.set(e,o);return i}}removeFolder(t){const[e,i]=this.resolvePath(t);return e?.removeFolder(i)}}ir.then((()=>{Hn&&(Y({[`.${Gs}`]:{margin:0," details summary":{"list-style":"none",outline:"none",cursor:"pointer","grid-template-columns":"1em auto 1em 1em 1em"},[` summary>.${Rg}`]:{width:"1em",height:"1em"},[` details[open]>summary>.${Rg}`]:{"--folder-closed":"none","--folder-open":"block"}},"summary::-webkit-details-marker":{display:"none"},[`.${Gg}`]:{cursor:"pointer"},[`.${Rs}:hover,.${Ug}>details summary:hover`]:{"background-color":"#888"},[`.${Gs} summary,.${Rs}`]:{display:"grid","grid-template-columns":"auto 1em 1em 1em"},[`.${Us}`]:{"background-size":"1em","background-position":"bottom center","background-repeat":"no-repeat",width:"1em",height:"1em",display:"inline-block","margin-right":"0.2em",cursor:"pointer"},[`.${Ws}`]:{position:"absolute",top:"var(--icon-top, 0)",left:"var(--icon-left, 0)","max-width":"100px","max-height":"100px","z-index":2},[`.${Wg}`]:{float:"right","text-align":"right","border-width":"2px 2px 2px 0","border-color":"#000","border-style":"inset",background:"#fff",outline:"none",height:"1em","+br":{"border-width":"1px",clear:"right"},":placeholder-shown":{"padding-left":"calc(1em + 4px)","border-left-width":"2px","+label":{display:"none"}},"+label":{float:"right",display:"inline-block","font-size":"0.83333333em","border-width":"2px 0px 2px 2px","border-color":"#000","border-style":"inset",padding:"1px",background:"#fff",cursor:"pointer",height:"1em"," svg":{width:"1em",height:"1em"}}},[`.${Ps}`]:{"background-color":"#aaa",">details>summary,>span":{"background-color":"#888"}},[`.${_s}`]:{" *":{"pointer-events":"none"},[` .${Ug}`]:{"pointer-events":"auto"},">ul:after":{content:'" "',height:"1em",display:"block"}}}),_("@media (prefers-color-scheme: light)",{[`:root.${vs} .${Ps}`]:{"background-color":"#555"}}),_("@media (prefers-color-scheme: dark)",{[`:root:not(.${vs}) .${Ps}`]:{"background-color":"#555"}}))}));const $g=Symbol("text"),Vg=t=>"object"==typeof t&&void 0!==t.attr,Kg=t=>"object"==typeof t&&void 0===t.attr,Jg=t=>"string"==typeof t,Xg=(t,e,i,o)=>{for(;;){const s=e.next().value;if(!s)break;if(Vg(s)){const o=i[s.tagName];o?o(t,e,i):i[$g](t,s.fullText)}else if(Kg(s)){if(s.tagName===o)break;i[$g](t,s.fullText)}else i[$g](t,s)}return t},qg=(t,e)=>Xg(document.createDocumentFragment(),function*(t){const e=[];let i=0;for(let o=0;o<t.length;o++)if("["===t.charAt(o)){const s=o,a="/"===t.charAt(o+1);a&&o++;t:for(o++;o<t.length;o++){let n=t.charCodeAt(o);if(!(n>=65&&n<=90||n>=97&&n<=122||n>=48&&n<=57)){if(o>s+ +a+1){const r=o;let l=null;if(61===n&&!a){if('"'===t.charAt(o+1)){l="",o++;e:for(o++;o<t.length;o++){const e=t.charAt(o);switch(e){case'"':if("]"===t.charAt(o+1)){o++;break e}o=r;break t;case"\\":o++;const i=t.charAt(o);switch(i){case'"':case"'":case"\\":l+=i}break;default:l+=e}}}else{for(o++;o<t.length&&"]"!==t.charAt(o);o++);l=t.slice(r+1,o)}n=t.charCodeAt(o)}if(93===n){if(i!==s){const e=t.slice(i,s);for(;yield e;);}i=o+1;const n=Object.freeze(a?{tagName:t.slice(s+2,o).toLowerCase(),fullText:t.slice(s,o+1)}:{tagName:t.slice(s+1,r).toLowerCase(),attr:l,fullText:t.slice(s,o+1)});if(a){if(e[0]===n.tagName)for(e.shift();1!==(yield););for(;yield n;);}else e:for(;;)switch(yield n){default:break e;case 1:e.unshift(n.tagName);case!0:}}}break}}}if(i<t.length){const e=t.slice(i);for(;yield e;);}}(e),t),tc=(t,e)=>(i,o,s)=>{const a=o.next(!0).value;a&&Vg(a)&&I(i,Xg(t({style:e}),o,s,a.tagName))},ec=(t,e)=>{let i="";for(;;){const o=t.next().value;if(!o||Kg(o)&&o.tagName===e)return i;i+=Jg(o)?o:o.fullText}},ic=tc(Be,"font-weight: bold"),oc=tc(Be,"font-style: italic"),sc=tc(Be,"text-decoration: underline"),ac=tc(Be,"text-decoration: line-through"),nc=tc(Gt,"text-align: left"),rc=tc(Gt,"text-align: center"),lc=rc,Mc=tc(Gt,"text-align: right"),gc=tc(Gt,"text-align: justify"),cc=gc,dc=tc(Le),Ic=(t,e,i)=>{const o=e.next(!0).value;o&&Vg(o)&&(o.attr?I(t,Xg(Be({style:{color:o.attr}}),e,i,o.tagName)):i[$g](t,o.fullText))},hc=Ic,Tc=(t,e,i)=>{const o=e.next(!0).value;if(o&&Vg(o)){const s=o.attr?parseInt(o.attr):0;s>0&&s<=100?I(t,Xg(Be({style:{"font-size":s/10+"em"}}),e,i,o.tagName)):i[$g](t,o.fullText)}},uc=(t,e,i)=>{const o=e.next(!0).value;o&&Vg(o)&&(o.attr?I(t,Xg(Be({style:{"font-family":o.attr}}),e,i,o.tagName)):i[$g](t,o.fullText))},Ac=tc(Vt),Lc=tc(Kt),mc=tc(Jt),yc=tc(Xt),Nc=tc(qt),Dc=tc(te),pc=t=>I(t,se()),Ec=(t,e,i)=>{const o=e.next(!0).value;if(o&&Vg(o))if(o.attr)try{I(t,Xg(ct({href:new URL(o.attr,window.location.href).href}),e,i,o.tagName))}catch{i[$g](t,o.fullText)}else{const s=ec(e,o.tagName),a=e.next(!0).value;if(s&&a&&Kg(a))try{return void I(t,ct({href:new URL(s,window.location.href).href},s))}catch{}i[$g](t,o.fullText),i[$g](t,s),a&&Kg(a)&&i[$g](t,a.fullText)}},wc=(t,e,i)=>{const o=e.next(!0).value;if(o&&Vg(o)){const s=ec(e,o.tagName),a=e.next(!0).value;if(a&&Kg(a))if(s)try{I(t,At({src:new URL(s,window.location.href).href,controls:!0}))}catch{i[$g](t,o.fullText),i[$g](t,s),i[$g](t,a.fullText)}else i[$g](t,o.fullText),a&&Kg(a)&&i[$g](t,a.fullText);else i[$g](t,o.fullText),i[$g](t,s)}},fc=(t,e,i)=>{const o=e.next(!0).value;if(o&&Vg(o)){let s=ec(e,o.tagName);const a=e.next(!0).value;if(!a||!Kg(a))return i[$g](t,o.fullText),void i[$g](t,s);if(!s)return i[$g](t,o.fullText),void(a&&Kg(a)&&i[$g](t,a.fullText));try{s=new URL(s,window.location.href).href}catch{return i[$g](t,o.fullText),i[$g](t,s),void i[$g](t,a.fullText)}const n={src:s};if(o.attr){const[t,e]=o.attr.split("x");if(t){const e=t.endsWith("%")?"%":"",i=parseInt(e?t.slice(0,-1):t);isNaN(i)||(n.width=i+e)}if(e){const t=e.endsWith("%")?"%":"",i=parseInt(t?e.slice(0,-1):e);isNaN(i)||(n.height=i+t)}}I(t,le(n))}},xc=(t,e)=>{const i=e.next(!0).value;i&&Vg(i)&&I(t,Oe(ec(e,i.tagName)))},Sc=(t,e,i)=>{const o=e.next(!0).value;if(o&&Vg(o)){const s=[],a=[],n=[],{tagName:r}=o;let l=0,M=!1,g=!1,c=!1,d=null;for(;;){const o=e.next().value;if(!o)break;if(Vg(o))switch(o.tagName){case"thead":M||(M=!0,l=2);break;case"tbody":g||(g=!0,l=4);break;case"tfoot":c||(c=!0,l=8);break;case"tr":if(1==(1&l))break;switch(0===l&&(g=!0,l=4),d=ri(),l){case 2:s.push(d);break;case 4:a.push(d);break;case 8:n.push(d)}break;case"th":case"td":d&&I(d,Xg("th"===o.tagName?oi():qe(),e,i,o.tagName))}else if(Kg(o)){if(o.tagName===r)return void((M||g||c)&&I(t,Je([M?si(s):[],g?Xe(a):[],c?ii(n):[]])));if(1==(1&l)&&"tr"===o.tagName)l^=1,d=null;else switch(-2&l){case 2:"thead"===o.tagName&&(l=0);break;case 4:"tbody"===o.tagName&&(l=0);break;case 8:"tfoot"===o.tagName&&(l=0)}}}}},Cc=(t,e,i)=>{const o=e.next(1).value;o&&Vg(o)&&(I(t,Zt([o.attr?Ie(o.attr):[],Xg(Dt(),e,i,o.tagName)])),e.next(1))},kc=(t,e,i)=>{const o=e.next(!0).value;if(o&&Vg(o)){let s="";switch(o.attr){case"a":case"A":case"i":case"I":case"1":s=o.attr}const a=""===s?gi():we({type:s}),{tagName:n}=o;let r=null;for(;;){const t=e.next().value;if(!t||Kg(t)&&t.tagName===n)break;if(Jg(t)){let e=0;for(;e<t.length;){const o=t.indexOf("[*]",e),s=t.indexOf("[/*]",e);if(o<s&&-1!==o||-1===s&&-1!==o)r&&i[$g](r,t.slice(e,o)),I(a,r=he()),e=o+3;else{if(!(s<o&&-1!==s||-1===o&&-1!==s)){r&&i[$g](r,t.slice(e));break}r&&(i[$g](r,t.slice(e,s)),r=null),e=s+4}}}else r&&(Vg(t)&&i[t.tagName]?i[t.tagName](r,e,i):i[$g](r,t.fullText))}I(t,a)}},Oc=(t,e)=>I(t,e.split("\n").map(((t,e)=>[e>0?Et():[],t]))),vc=Object.freeze({b:ic,i:oc,u:sc,s:ac,left:nc,centre:rc,center:lc,right:Mc,justify:gc,full:cc,colour:Ic,color:hc,size:Tc,font:uc,h1:Ac,h2:Lc,h3:mc,h4:yc,h5:Nc,h6:Dc,highlight:dc,hr:pc,url:Ec,audio:wc,img:fc,code:xc,table:Sc,quote:Cc,list:kc,[$g]:Oc}),bc=(t,e,i)=>{const o=e.next(!0).value;o&&Vg(o)&&Xg(t,e,i,o.tagName)},jc=new Map,zc=Object.assign({},vc),Yc=(t,e)=>jc.set(t,e),_c=(t,e)=>(zc[t]??=e)===e,Pc=t=>qg(zc,t),Gc=new ki("bbcode");ir.then((()=>Jn.waitBroadcastWindow().when((t=>{const e=jc.get(t.module);if(e){const[i,o]=e instanceof Array?e:e(t.id);I(vn,kn({"window-title":o,"window-icon":i,resizable:!0,style:"--window-width: 50%; --window-height: 50%"},Pc(t.contents)))}}))));class Rc extends Hg{#St;#i;constructor(t,e,i,o,s,a,n,r){super(t,e,i,o,s,a),this.#St=n,this.#i=r;for(const t in o.items)this.#Ct(o.items[t],t)}#Ct(t,e){const i=this.assetMap(),o=i.get(t);o?o[0].send(o[1]=e):i.set(t,[new bi,e])}addItem(t,e){return this.#Ct(t,e),super.addItem(t,e)}ondragenter(t){super.ondragenter(t),this.#St.is(t)&&(I(this[Ki],{class:[Ps]}),I(this.root[Ki],{class:[_s]}))}ondragover(t){super.ondragover(t),this.#St.is(t)&&(t.preventDefault(),t.dataTransfer.dropEffect="copy")}ondrop(t){super.ondrop(t),this.#St.is(t)&&this.#i(this.#St.asForm(t,"asset"),vn,this.getPath())}}const Uc=new Fg({folders:{},items:{}},oa.TAB_IMAGES,null,class extends Zg{#p;constructor(t,e,i){super(t,e,i,rd,!0),I(this.image,{src:ld(e)}),this.#p=Gc.register((()=>()=>`[img]${ld(e)}[/img]`))}show(){const t=kn({"window-icon":Qc,"window-title":this.name,"hide-minimise":!1,class:qc},le({src:ld(this.id),draggable:"true",ondragstart:this}));return t.addControlButton(Wa,(()=>Jn.broadcastWindow("imageAsset",0,`[img=100%]${ld(this.id)}[/img]`)),oa.SHARE),I(vn,t),t}ondragstart(t){super.ondragstart(t),t.defaultPrevented||Gc.set(t,this.#p)}delete(){super.delete(),Gc.deregister(this.#p)}},class extends Rc{constructor(t,e,i,o){super(t,e,i,o,rd,Kc,sd,id)}assetMap(){return Hc}}),Wc=new Fg({folders:{},items:{}},oa.TAB_AUDIO,null,class extends Zg{#p;constructor(t,e,i){super(t,e,i,nd),I(this.image,{src:Zc}),this.#p=Gc.register((()=>()=>`[audio]${Md(e)}[/audio]`))}show(){const t=kn({"window-icon":Zc,"window-title":this.name,"hide-minimise":!1,class:qc},At({src:Md(this.id),controls:"controls",draggable:"true",ondragstart:this}));return t.addControlButton(Wa,(()=>Jn.broadcastWindow("audioAsset",0,`[audio]${Md(this.id)}[/audio]`)),oa.SHARE),I(vn,t),t}ondragstart(t){super.ondragstart(t),t.defaultPrevented||Gc.set(t,this.#p)}delete(){super.delete(),Gc.deregister(this.#p)}},class extends Rc{constructor(t,e,i,o){super(t,e,i,o,nd,Jc,ad,od)}assetMap(){return Bc}}),Qc=`data:image/svg+xml,%3Csvg xmlns="${To}" viewBox="0 0 100 100"%3E%3Crect x="4" y="4" width="92" height="92" fill="%2344f" /%3E%3Ccircle cx="20" cy="20" r="12" fill="%23ff0" /%3E%3Cpath d="M50,65 l20,-20 a3,2 0,0,1 5,0 l20,20 v30 h-20 z" fill="%2305b" /%3E%3Cpath d="M3,70 l30,-30 a3,2 0,0,1 5,0 l55,55 h-90 z" fill="%23039" /%3E%3Crect x="3" y="3" width="94" height="94" stroke-width="6" rx="8" stroke="%23840" fill="none" /%3E%3C/svg%3E`,Zc=`data:image/svg+xml,%3Csvg xmlns="${To}" viewBox="0 0 53 71"%3E%3Cpath d="M12,56 s-5,-2 -10,5 s7,15 15,0 v-30 l30,-10 v30 s-5,-2 -10,5 s7,15 15,0 v-55 l-40,13 z m5,-29 l30,-10 v-5 l-30,10 v5 z" fill="%23000" stroke="%23fff" stroke-linejoin="round" fill-rule="evenodd" /%3E%3C/svg%3E`,Bc=new Map,Hc=new Map,Fc=(t,e,i)=>{const o=i.get(t)??Ai(i,t,[new bi,""]);return e(o[1]),o[0].receive(e),()=>o[0].remove(e)},$c=(t,e,i,o=vn,s="/")=>{const a=ve({style:"width: 100%"});return Cn(Ss(`/${e}/?path=${encodeURIComponent(s)}`,{data:i,method:"POST",response:"json",checker:t=>t instanceof Array&&t.every((t=>t instanceof Object&&"id"in t&&hi(t.id,0)&&"name"in t&&"string"==typeof t.name)),onuploadprogress:t=>{t.lengthComputable&&N(a,{value:t.loaded,max:t.total},Math.floor(100*t.loaded/t.total)+"%")}}).then((e=>{for(const{id:i,name:o}of e)t.addItem(i,o);return e})),o,oa.UPLOADING,Gt([Gt(oa.UPLOADING),a]))},Vc=(t,e,i,o,s,a)=>{const n=Gt(on()),r=a.mimes.join(", ");return t.list().then((a=>{e.setRPCFuncs(t),e.setRoot(a),e.windowIcon=i,N(n,{class:`${Xc} ${Gs}`},[wt({onclick:()=>{const t=Me({accept:r,multiple:!0,name:"asset",type:"file",onchange:()=>{$c(e,o,new FormData(a),n).then((()=>n.remove())).catch(er).finally((()=>I(t,{disabled:!1}))),I(t,{disabled:!0})}}),a=$t({enctype:"multipart/form-data",method:"post"},Ka(s,t)),n=kn({"window-icon":i,"window-title":s},[Vt(s),a]);I(vn,n),Ni(t)}},s),e[Ki]])})),n},Kc=new ki("imagefolder"),Jc=new ki("audiofolder"),[Xc,qc]=G(2),td=(t,e)=>Fc(t,e,Bc),ed=(t,e)=>Fc(t,e,Hc),id=$c.bind(null,Uc,"images"),od=$c.bind(null,Wc,"audio"),sd=new Oi("image/gif","image/png","image/jpeg","image/webp","video/apng","image/svg+xml"),ad=new Oi("application/ogg","audio/mpeg"),nd=new ki("audioasset"),rd=new ki("imageasset"),ld=e=>t.urls.images[e],Md=e=>t.urls.audio[e];Yc("imageAsset",[Qc,oa.TAB_IMAGES]),Yc("audioAsset",[Zc,oa.TAB_AUDIO]),sn.push([0,()=>Hn?[oa.TAB_IMAGES,Vc(Jn.images,Uc,Qc,"images",oa.UPLOAD_IMAGES,sd),!0,Qc]:null],[1,()=>Hn?[oa.TAB_AUDIO,Vc(Jn.audio,Wc,Zc,"audio",oa.UPLOAD_AUDIO,ad),!0,Zc]:null]),ir.then((()=>{Hn&&Y({[`.${Xc}`]:{" ul":{margin:0,"padding-left":"calc(1em + 4px)","list-style":"none"},">div>ul":{"padding-left":0}},[`.${qc}`]:{"max-height":"100%","max-width":"100%","min-height":"10px",overflow:"clip"," img":{"max-height":"calc(100vh - 20px)","max-width":"calc(100vw - 1em - 6px)"}}})}));const gd=(t,e)=>0n===e?t:gd(e,t%e);class cd{#kt;#Ot;static zero=new cd(0n);static one=new cd(1n);static NaN=new cd(0n,0n);constructor(t,e=1n){e<0n?(this.#kt=-t,this.#Ot=-e):(this.#kt=t,this.#Ot=e)}add(t){return this.#Ot===t.#Ot?new cd(this.#kt+t.#kt,this.#Ot):new cd(this.#kt*t.#Ot+this.#Ot*t.#kt,this.#Ot*t.#Ot)}sub(t){return this.#Ot===t.#Ot?new cd(this.#kt-t.#kt,this.#Ot):new cd(this.#kt*t.#Ot-this.#Ot*t.#kt,this.#Ot*t.#Ot)}mul(t){return new cd(this.#kt*t.#kt,this.#Ot*t.#Ot)}div(t){return new cd(this.#kt*t.#Ot,this.#Ot*t.#kt)}cmp(t){if(!this.#Ot||!t.#Ot)return NaN;const e=this.#kt*t.#Ot-this.#Ot*t.#kt;return e<0n?-1:e>0n?1:0}isNaN(){return!this.#Ot}sign(){return this.#Ot?this.#kt?this.#kt<0n?-1:1:0:NaN}simplify(){if(!this.#Ot)return cd.NaN;if(!this.#kt)return cd.zero;if(this.#kt===this.#Ot)return cd.one;const t=this.#kt<0n?-this.#kt:this.#kt,e=this.#Ot,i=t>e?gd(t,e):gd(e,t);return new cd(this.#kt/i,e/i)}[Symbol.toPrimitive](t){return"number"===t?this.toFloat():this.toString()}toFloat(){return this.#Ot?Number(10000n*this.#kt/this.#Ot)/1e4:NaN}toString(){switch(this.#Ot){case 0n:return"NaN";case 1n:return`${this.#kt}`;default:return`${this.#kt} / ${this.#Ot}`}}static min(t,e){return-1===t.cmp(e)?t:e}static max(t,e){return 1===t.cmp(e)?t:e}}const dd=cd,Id=new dd(-1n),hd=new dd(2n),Td=new dd(3n),ud=new dd(4n),Ad=new dd(5n),Ld=new dd(6n),md=new dd(7n),yd=(t,e)=>{const i=e.div(t),o=e.cmp(dd.zero);switch(i.cmp(dd.one)){case-1:switch(i.cmp(Id)){case-1:switch(o){case-1:return Td.add(Id.div(i));case 1:return md.add(Id.div(i))}case 0:switch(o){case-1:return ud;case 1:return dd.zero}case 1:switch(t.cmp(dd.zero)){case-1:return dd.one.add(i);case 1:return Ad.add(i)}}case 0:switch(o){case-1:return hd;case 1:return Ld}case 1:switch(o){case-1:return Td.sub(dd.one.div(i));case 1:return md.sub(dd.one.div(i))}default:switch(o){case-1:return Td;case 1:return md}}return dd.NaN},Nd=(t,e,i,o)=>{for(const{x1:s,y1:a,a1:n,a2:r}of i){const[i,l]=(!s.cmp(t)&&!a.cmp(e))===o?[r,n]:[n,r];if(1===i.cmp(l)&&-1===i.cmp(l.add(ud))||-1===i.cmp(l.sub(ud)))return!0}return!1},Dd=(t,e,i)=>{for(const o of t)for(const t of e)if(o.id===t.id){if(!i)return o;for(const t of i)if(o.id===t.id)return o}return null},pd=(t,e,i,o,s,a)=>{if(!t.cmp(i))return[t,new dd(BigInt(a))];const n=o.sub(e).div(i.sub(t)),r=new dd(BigInt(s)),l=r.sub(e.sub(new dd(BigInt(a))).sub(t.sub(r).mul(n)).div(n.add(dd.one.div(n))));return[l,n.mul(l).add(e.sub(t.mul(n)))]},Ed=(t,e,i,o,s,a)=>{const[n,r]=pd(t,e,i,o,s,a);if(-1===n.cmp(dd.min(t,i))||1===n.cmp(dd.max(t,i))||-1===r.cmp(dd.min(e,o))||1===r.cmp(dd.max(e,o))){const n=Math.hypot(+t-s,+e-a),r=Math.hypot(+i-s,+o-a);return n<r?[t,e,n]:[i,o,r]}return[n,r,Math.hypot(+n-s,+r-a)]},wd=(t,e,i,o,s,a,n,r)=>{const l=t.sub(i),M=e.sub(o),g=s.sub(n),c=a.sub(r),d=g.mul(M).sub(c.mul(l));if(d.cmp(dd.zero)){const I=s.mul(r).sub(a.mul(n)),h=t.mul(o).sub(e.mul(i));return[l.mul(I).sub(g.mul(h)).div(d),M.mul(I).sub(c.mul(h)).div(d)]}return[dd.NaN,dd.NaN]},fd=(t,e,i,o,s=0)=>{const[a,n]=t.getLightPos(),[r,l]=t.getCentre(),M=t.lightStages.reduce(((t,e)=>t+e),0)*i,g=new dd(BigInt(a)),c=new dd(BigInt(n)),d=[],I=new Map,h=[],T=[],u=[];if(5===s)return u;if(o){const{x1:t,y1:i,x2:s,y2:a}=o;e.push({id:0,x1:t,y1:i,x2:t.add(t).sub(s),y2:i.add(i).sub(a),colour:Pn,scattering:0},{id:0,x1:s.add(s).sub(t),y1:a.add(a).sub(i),x2:s,y2:a,colour:Pn,scattering:0})}for(const t of e){if(t.id===o?.id)continue;const{id:e,x1:i,y1:s,x2:r,y2:l}=t,M=i.sub(g),h=r.sub(g),u=s.sub(c),A=l.sub(c);if(u.mul(h.sub(M)).cmp(M.mul(A.sub(u)))){const o=+M,g=+u,c=+h,L=+A,m=yd(M,u),y=yd(h,A),N=`${+i},${+s}`,D=`${+r},${+l}`,p=I.get(N)??Ai(I,N,[]),E=I.get(D)??Ai(I,D,[]),[w,f,x]=Ed(i,s,r,l,a,n),S=Object.assign({cx:w,cy:f,cl:x,a1:m,a2:y},t);p.length||d.push({w:p,x:i,y:s,a:m,d:Math.hypot(o,g)}),E.length||d.push({w:E,x:r,y:l,a:y,d:Math.hypot(c,L)}),p.push(S),E.push(S),e&&T.push(S)}}o&&e.splice(e.length-2,2),T.sort((({cl:t},{cl:e})=>t-e));let A=dd.NaN;for(const t of Array.from(d.values()).sort((({a:t,d:e},{a:i,d:o})=>i.cmp(t)||e-o))){if(!A.isNaN()&&!A.cmp(t.a))continue;A=t.a;const{x:e,y:i,w:s}=t,a=e.sub(g),n=i.sub(c),r=Nd(e,i,s,!0);let l=e,M=i,d=s,u=1/0,L=0;if(o){const{x1:s,y1:r,x2:l,y2:M}=o,[d,I]=wd(s,r,l,M,g,c,e,i),h=g.sub(d),T=c.sub(I),u=Math.hypot(+h,+T)-1e-8;if(-1===d.cmp(dd.min(s,l))||1===d.cmp(dd.max(s,l))||-1===I.cmp(dd.min(r,M))||1===I.cmp(dd.max(r,M))||-a.sign()!==h.sign()||-n.sign()!==T.sign()||u>t.d)continue;L=u}for(const t of T){if(t.cl>u)break;const{id:o,x1:s,y1:h,x2:T,y2:A}=t,[m,y]=wd(s,h,T,A,g,c,e,i);if(!m.isNaN()){const e=g.sub(m),i=c.sub(y),N=Math.hypot(+e,+i),D=I.get(`${+m},${+y}`),p=D?.some((({id:t})=>o===t));(p?Nd(m,y,D,!r):m.cmp(dd.min(s,T))>-1&&m.cmp(dd.max(s,T))<1&&y.cmp(dd.min(h,A))>-1&&y.cmp(dd.max(h,A))<1)&&N<u&&N>L&&-a.sign()===e.sign()&&-n.sign()===i.sign()&&(l=m,M=y,u=N,d=p?D:[t,...D??[]])}}r&&u>t.d&&h.push({x:e,y:i,w:s}),h.push({x:l,y:M,w:d}),!r&&u>t.d&&h.push({x:e,y:i,w:s})}if(h.length<3)return u;for(;Dd(h[h.length-2].w,h[h.length-1].w,h[0].w);)h.splice(h.length-1,1);let L="";for(let o=0;o<h.length;o++){const{w:g,x:c,y:d}=h[o],I=h[0===o?h.length-1:o-1],T=h[o===h.length-1?0:o+1];if(Dd(I.w,g,T.w))h.splice(o--,1);else{I.y.sub(d).mul(c.sub(T.x)).cmp(d.sub(T.y).mul(I.x.sub(c)))&&(L+=`${+c},${+d} `);const o=Dd(I.w,g);if(o){const{id:g,colour:{r:h,g:T,b:A,a:L},x1:m,y1:y,x2:N,y2:D,scattering:p}=o;if(h||T||A){const[h,T,A]=Ed(m,y,N,D,a,n);if(A<M){const M={id:g,x1:c,y1:d,x2:I.x,y2:I.y,colour:Pn,scattering:0},m=r+Math.round(p*(+h-r)/256),y=l+Math.round(p*(+T-l)/256);if(L<255){const r=t.wallInteraction(Math.round(m),Math.round(y),a,n,o.colour,A/i,!0);r&&u.push(...fd(r,e,i,M,s+1))}if(L>0){const[a,n]=pd(c,d,I.x,I.y,m,y),g=+a.add(a),h=+n.add(n),T=t.wallInteraction(Math.round(g-m),Math.round(h-y),Math.round(g-r),Math.round(h-l),o.colour,A/i);T&&u.push(...fd(T,e,i,M,s+1))}}}}}}return u.push(t.createLightPolygon(L,i)),u},xd=[],Sd=`data:image/svg+xml,%3Csvg xmlns="${To}" viewBox="0 0 100 100"%3E%3Cg stroke-width="3"%3E%3Cpath d="M45,1 a2,3 0,0,0 0,30 v38 a2,3 0,0,0 0,30 v-15 a1,1 0,0,1 10,0 v15 a2,3 0,0,0 0,-30 v-38 a2,3 0,0,0 0,-30 v15 a1,1 0,0,1 -10,0 z" fill="%23dde" stroke="%23000" transform="rotate(45, 50, 50)" /%3E%3Cg transform="rotate(315, 50, 50)"%3E%3Cpath d="M47.5,50 v-35 q-2,-3 -2,-5 l2,-8 h5 l2,8 q0,2 -2,5 v35 z" fill="%23eee" stroke="%23000" /%3E%3Cpath d="M40,90 a1,1 0,0,0 20,0 v-25 a1,2 0,0,1 0,-10 a1,1 0,0,0 0,-5 h-20 a1,1 0,0,0 0,5 a1,2 0,0,1 0,10 z" fill="%23dd0" stroke="%23000" stroke-linejoin="round" /%3E%3C/g%3E%3C/g%3E%3C/svg%3E`,Cd={name:oa.TOOL_DEFAULT,id:"tool_default",icon:As({viewBox:"0 0 20 20"},[Ds(oa.TOOL_DEFAULT),rs({d:"M1,1 L20,20 M1,10 V1 H10",fill:"none",stroke:"currentColor","stroke-width":2})])},kd=t=>xd.push(t),Od=()=>!1,vd=t=>(t.stopPropagation(),!1),bd=qo({fill:"#000",stroke:"#fff","stroke-width":.5},["5,0 16,0 10.5,5","0,5 0,16 5,10.5","5,21 16,21 10.5,16","21,16 21,5 16,10.5"].map((t=>Ms({points:t})))),jd=function(t,e=0){t.preventDefault();const i="tokenMouse"+t.button;(Wd[i]?.call(this,t,e)??1)&&Cd[i]?.call(this,t,e)},zd=function(t){t.preventDefault(),(Wd.tokenMouseWheel?.call(this,t)??1)&&Cd.tokenMouseWheel?.call(this,t)},Yd=function(t){t.preventDefault(),(Wd.tokenMouseOver?.call(this,t)??1)&&Cd.tokenMouseOver?.call(this,t)},_d=function(t){t.preventDefault();const e="mapMouse"+t.button;(Wd[e]?.call(this,t)??1)&&Cd[e]?.call(this,t)},Pd=function(t){t.preventDefault(),(Wd.mapMouseWheel?.call(this,t)??1)&&Cd.mapMouseWheel?.call(this,t)},Gd=function(t){t.preventDefault(),(Wd.mapMouseOver?.call(this,t)??1)&&Cd.mapMouseOver?.call(this,t)},Rd=kn({"window-title":oa.TOOL_OPTIONS,"window-icon":Sd}),Ud=()=>Wd===Cd;let Wd=Cd;sn.push([6,()=>Hn?[oa.TAB_TOOLS,(()=>{xd.sort(((t,e)=>Xi(t.name+"",e.name+""))),xd.unshift(Cd);let t=!1,e=null,i=0;const o=Gt(),s=Gt(),a=Gt([Kt(oa.TOOL_OPTIONS),s]),n=xd.map(((o,n)=>{const r=he({onclick:function(){Wd.unset?.(),o.set?.(),Wd=o,i=n,o.options?(N(s,o.options),t&&Ng.value?I(vn,Ni(Rd)):I(a,{style:{display:void 0}})):t&&Ng.value?Rd.remove():I(a,{style:{display:"none"}}),I(e,{class:{[M]:!1}}),I(e=this,{class:[M]})}},[o.icon,Be(o.name)]);return o.id&&vM(o.id,S`${oa.TOOL}: ${o.name}`,"",(()=>r.click()))[0](),r})),r=n[0],[l,M,g]=G(3);return Y({[`#${l}`]:{">ul":{"list-style":"none",padding:0,"margin-top":0,">li":{cursor:"pointer",padding:"0.4em"," :is(img, svg)":{width:"2em",height:"2em","padding-right":"3px","background-color":"transparent"}}},[` li.${M}`]:{"background-color":"#888"}},[`.${g} #${l}>ul`]:{"margin-bottom":0,"padding-bottom":0," svg + span":{display:"none"}}}),I(o,{id:l,onpopout:()=>{t=!0,Ng.value&&(I(Rd,s),Wd.options&&(I(a,{style:{display:"none"}}),I(vn,Ni(Rd))))},onpopin:()=>{t=!1,Ng.value&&(I(a,s),Wd.options&&(I(a,{style:{display:void 0}}),Rd.remove()))}},[gi(n),a]),r.click(),Va((()=>r.click())),Ng.wait((e=>{I(document.body,{class:{[g]:e}}),t&&(e?(I(Rd,s),Wd.options&&(I(a,{style:{display:"none"}}),I(vn,Ni(Rd)))):(I(a,s),Wd.options&&(I(a,{style:{display:void 0}}),Rd.remove())))})),vM("toolPrev",oa.KEY_TOOL_PREV,"Shift+(",(()=>n[ui(i-1,xd.length)].click()))[0](),vM("toolNext",oa.KEY_TOOL_NEXT,"Shift+)",(()=>n[ui(i+1,xd.length)].click()))[0](),o})(),!0,Sd]:null]);let Qd,Zd,Bd=As(),Hd=[];const Fd={"":0,Grid:-1,Light:-2},$d=(t,e,i="")=>{i+="/"+e.name;const o=qo(Hn&&e.hidden?{class:Bs}:void 0);if(Vd(e)){const s=new Io(o);for(const o of e.children)s.push($d(t,o,i));return Object.assign(e,{[Ki]:Fn&&e.hidden?qo():o,l:o,children:s,path:i})}const s=new Io(o);if("Grid"!==e.name&&"Light"!==e.name)for(const i of e.tokens)s.push(hI(i)?new hg(i,t):TI(i)?new ug(i):new Tg(i));else I(o,{id:"Grid"===e.name?Zs:Qs}),e.walls=[];return Object.assign(e,{id:Fd[e.name]??1,[Ki]:Fn&&e.hidden?qo():o,l:o,path:i,tokens:s})},Vd=t=>void 0!==t.children,Kd=(t,e)=>t.children.some((t=>e(t)||iI(t)&&Kd(t,e))),Jd=[],[Xd,qd]=G(3),tI=t=>{const e=t.lastIndexOf("/");return[t.slice(0,e),t.slice(e+1)]},eI=(t,e=Qd,i=!1)=>{for(const o of e.children)oI(o)?t(o,i||o.hidden):eI(t,o,i||o.hidden)},iI=t=>void 0!==t.children,oI=t=>void 0!==t.tokens,sI=(t,e=Qd)=>t.split("/").filter((t=>t)).every((t=>{if(iI(e)){const i=e.children.filter((e=>e.name===t)).pop();if(i)return e=i,!0}return!1}))?e:null,aI=t=>{const[e,i]=tI(t),o=sI(e);return o&&iI(o)?[o,sI(i,o)]:[null,null]},nI=(t,e)=>{const i=sI(t);Fn?i&&(e?i[Ki]!==i.l&&i[Ki].replaceWith(i[Ki]=i.l):i[Ki]===i.l&&i.l.replaceWith(i[Ki]=qo()),i.hidden=!e):i?.[Ki].classList.toggle(Bs,i.hidden=!e),AI()},rI=t=>(Qd.children.push($d(void 0,{id:0,name:tI(t)[1],hidden:!1,locked:!1,children:[],folders:{},items:{}})),t),lI=(t,e)=>{const i=sI(t);return i.path=`${tI(t)[0]}/${e}`,i.name=e},MI=t=>{const[e,i]=aI(t);e.children.filterRemove((t=>Object.is(t,i))),AI()},gI=t=>(Qd.children.push($d(void 0,{name:t,id:0,hidden:!1,locked:!1,tokens:[],walls:[]})),t),cI=(t,e,i)=>{const[o,s]=tI(t),a=sI(o),n=sI(e);if(iI(a)){const t=a.children.filterRemove((t=>t.name===s)).pop();t.path=e+"/"+t.name,n.children.splice(i,0,t)}AI()},dI=t=>{Object.assign(Zd,t),I(Bd,{width:t.width,height:t.height}),XM.setGrid(t),AI()},II=t=>XM.setLight(Zd.lightColour=t),hI=t=>void 0!==t.src,TI=t=>void 0!==t.points,uI=t=>((t.x1>t.x2||t.x1===t.x2&&t.y1>t.y2)&&([t.x1,t.x2,t.y1,t.y2]=[t.x2,t.x1,t.y2,t.y1]),t),AI=()=>{const{gridSize:t,gridDistance:e,width:i,height:o}=Zd,s=new dd(BigInt(i)),a=new dd(BigInt(o)),n=[{id:-1,x1:dd.zero,y1:dd.zero,x2:s,y2:dd.zero,colour:Pn,scattering:0},{id:-2,x1:s,y1:dd.zero,x2:s,y2:a,colour:Pn,scattering:0},{id:-3,x1:dd.zero,y1:a,x2:s,y2:a,colour:Pn,scattering:0},{id:-4,x1:dd.zero,y1:dd.zero,x2:dd.zero,y2:a,colour:Pn,scattering:0}],r=[],l=t=>{for(const{id:e,x1:i,y1:o,x2:s,y2:a,colour:r,scattering:l}of t){const t=n.length,M=new dd(BigInt(i)),g=new dd(BigInt(o)),c=new dd(BigInt(s)),d=new dd(BigInt(a)),I=[[M,g],[c,d]];for(let e=0;e<t;e++){const{id:t,x1:i,y1:o,x2:s,y2:a,colour:r,scattering:l}=n[e],[h,T]=wd(M,g,c,d,i,o,s,a);1===h.cmp(dd.min(M,c))&&1===h.cmp(dd.min(i,s))&&-1===h.cmp(dd.max(M,c))&&-1===h.cmp(dd.max(i,s))&&1===T.cmp(dd.min(g,d))&&1===T.cmp(dd.min(o,a))&&-1===T.cmp(dd.max(g,d))&&-1===T.cmp(dd.max(o,a))&&(n[e].x2=h,n[e].y2=T,n.push({id:t,x1:h,y1:T,x2:s,y2:a,colour:r,scattering:l}),I.push([h,T]))}I.sort((([t,e],[i,o])=>t.cmp(i)||e.cmp(o)));for(let t=1;t<I.length;t++){const[i,o]=I[t-1],[s,a]=I[t];n.push({id:e,x1:i,y1:o,x2:s,y2:a,colour:r,scattering:l})}}},M=t=>{for(const e of t)if(e.lightTimings.length&&e.lightStages.reduce(((t,e)=>t+e),0))if(e.lightTimings.length>1&&!fg.value){const[t,i]=e.getCentre(),[o,s]=e.getLightPos();r.push(new _M(t,i,o,s,e.lightColours.map((t=>[t[0]??Pn])),e.lightStages,[0]))}else r.push(e)};let g=-5;eI(((t,e)=>{e||(l(cg(t.name).map((t=>(t.id=g--,t))).concat(...t.walls)),M(dg(t.name).concat(...t.tokens)))})),l(cg("").map((t=>(t.id=g--,t)))),M(dg(""));let c=n.length!==Hd.length,d=0;for(let t=0;t<n.length;t++){const e=n[t];if(!c){const i=Hd[t];c=!!(e.x1.cmp(i.x1)||e.x2.cmp(i.x2)||e.y1.cmp(i.y1)||e.y2.cmp(i.y2)||e.scattering!==i.scattering||e.colour.toString()!==i.colour.toString())}Object.freeze(e)}for(c&&XM.clearLighting();d<r.length;d++){const i=r[d];if(!c&&Jd.length>d){const t=Jd[d],e=i.getCentre(),o=t.getCentre(),s=i.getLightPos(),a=t.getLightPos();let n=e[0]!==o[0]||e[1]!==o[1]||s[0]!==a[0]||s[1]!==a[1]||i.lightStages.length!==t.lightStages.length||i.lightTimings.length!==t.lightTimings.length;if(!n)for(let e=0;!n&&e<i.lightStages.length;e++)n=i.lightStages[e]!==t.lightStages[e];if(!n)for(let e=0;!n&&e<i.lightTimings.length;e++)n=i.lightTimings[e]!==t.lightTimings[e];if(!n)for(let e=0;!n&&e<i.lightColours.length;e++)for(let o=0;!n&&o<i.lightColours[0].length;o++)n=i.lightColours[e][o].toString()!==t.lightColours[e][o].toString();if(!n)continue;XM.clearLightGroup("L"+d)}XM.setLightGroup("L"+d),fd(i,n,t/(e||1));const[o,s]=i.getCentre(),[a,l]=i.getLightPos();Jd.splice(d,1,new _M(o,s,a,l,Ja(i.lightColours),Ja(i.lightStages),Ja(i.lightTimings)))}for(;d<Jd.length;d++)XM.clearLightGroup("L"+d);Jd.length>r.length&&Jd.splice(r.length,Jd.length-r.length),c&&(Hd=n,Ig(n))},LI=(()=>{const t=Lo({attributeName:"r",values:"4;46",dur:"1s"}),e=Lo({attributeName:"r",values:"4;46",dur:"1s"}),i=qo([No({cx:50,cy:50,stroke:"#f00","stroke-width":8,fill:"none"},t),No({cx:50,cy:50,stroke:"#00f","stroke-width":4,fill:"none"},e)]);return o=>{I(Bd,I(i,{transform:`translate(${o[0]-50}, ${o[1]-50})`})),t.beginElement(),e.beginElement()}})(),mI={x:0,y:0,zoom:1},yI=(()=>{const t=[[0,1/6],[0,2/6],[0,.5],[0,5/6],[1/4,1/12],[1/4,7/12],[.5,0],[.5,1/3],[.5,2/3],[.5,5/6],[.5,1],[3/4,1/12],[3/4,7/12],[1,1/6],[1,2/6],[1,.5],[1,5/6]];return(e,i,o=!1)=>{const{width:s,height:a,gridType:n,gridSize:r}=Zd,{x:l,y:M,zoom:g}=mI,c=(e+(g-1)*s/2-l)/g,d=(i+(g-1)*a/2-M)/g;if(o)switch(n){case 1:case 2:{const e=2*Math.round(1.5*r/JM),i=1===n?r:e,o=2===n?r:e,s=c/i,a=d/o,l=s%1,M=a%1,g=n-1,I=1-g;let h=[0,0],T=1/0;for(const e of t){const t=Math.hypot(e[g]-l,e[I]-M);t<T&&(T=t,h=e)}return[Math.round((Math.floor(s)+h[g])*i),Math.round((Math.floor(a)+h[I])*o)]}default:const e=r>>1;return[e*Math.round(c/e),e*Math.round(d/e)]}return[Math.round(c),Math.round(d)]}})(),NI=(()=>{const t=t=>{const e=Math.max(10,Math.min(110,t.clientY));I(o,{cy:e}),NI(Math.pow(1.4,(60-e)/10)/mI.zoom,window.innerWidth>>1,window.innerHeight>>1,!1)},[e]=lt(0,t,(()=>I(document.body,{class:{[Vs]:!1}}))),i=t=>NI(.95*Math.sign(t.deltaY),window.innerWidth>>1,window.innerHeight>>1),o=No({cx:10,cy:60,r:10,stroke:"#000",onmousedown:t=>{0===t.button&&(e(),I(document.body,{class:[Vs]}))},onwheel:i}),s=Math.log(1.4);return ir.then((()=>I(On,As({id:$s,viewBox:"0 0 20 120"},[ds({width:20,height:120,rx:10,stroke:"#000",onclick:e=>{0===e.button&&t(e)},onwheel:i}),o])))),pg.wait((t=>I(On,{class:{[Fs]:t}}))),Va((()=>I(o,{cy:"60"}))),(t,e,i,a=!0)=>{const n=Ti(parseInt(Bd.getAttribute("width")||"0"),0)/2,r=Ti(parseInt(Bd.getAttribute("height")||"0"),0)/2,l=mI.zoom;t<0?mI.zoom/=-t:t>0&&(mI.zoom*=t),mI.x+=e-(mI.zoom*(e+(l-1)*n-mI.x)/l+mI.x-(mI.zoom-1)*n),mI.y+=i-(mI.zoom*(i+(l-1)*r-mI.y)/l+mI.y-(mI.zoom-1)*r),I(Bd,{transform:`scale(${mI.zoom})`,style:{left:mI.x+"px",top:mI.y+"px","--zoom":mI.zoom}}),a&&I(o,{cy:Math.max(10,120-Math.min(110,60+10*Math.log(mI.zoom)/s))})}})(),DI=(t,e)=>{const{width:i,height:o}=Zd,s=window.innerWidth,a=window.innerHeight,{zoom:n}=mI;mI.x=Math.min(Math.max((s-i)/2-(t-i/2)*n,s-i*(n+1)/2),i*(n-1)/2),mI.y=Math.min(Math.max((a-o)/2-(e-o/2)*n,a-o*(n+1)/2),o*(n-1)/2),I(Bd,{style:{left:mI.x+"px",top:mI.y+"px"}})},pI=(t,e=!1)=>{Hd=[],Jd.splice(0,Jd.length),Zd=t,BM.clear(),en.clear(),KM.set(Zd.baseOpaque,Zd.masks),XM.clear();const i=new Yi,{width:o,height:s,lightColour:a,startX:n,startY:r}=Zd,l=Gt(),M=ve(),g=Gt({id:qd},Gt([oa.LOADING_MAP,": ",M,l])),c=qo(),d=new Io(c);for(const t of Zd.children)d.push($d(i,t));return Qd={id:0,name:"",hidden:!1,locked:!1,[Ki]:c,l:c,children:d,folders:{},items:{},path:"/"},Bd=As({id:Hs,width:o,height:s},[XM[Ki],c,ds({width:"100%",height:"100%",fill:"#000",style:Hn?{"fill-opacity":"var(--maskOpacity, 1)"}:void 0,mask:`url(#${Js})`})]),i.onComplete((()=>setTimeout((()=>g.remove()),Hn?0:1e3))),XM.setGrid(Zd),I(sI("/Grid").l,ds({width:"100%",height:"100%",fill:`url(#${Xs})`})),I(sI("/Light").l,Es({href:`#${Ks}`,style:"mix-blend-mode: multiply"})),XM.setLight(a),Kd(Qd,(t=>{if(!Vd(t)){for(const o of t.tokens)if(BM.set(o.id,{layer:t,token:o}),hI(o)&&o.tokenData){const t=o.tokenData["store-character-id"];if(e&&t&&"number"==typeof t.data&&!Xa.has(t.data)){const e=t.data;Xa.set(e,{}),i.add(),yi((()=>Jn.characterGet(e).then((t=>Xa.set(e,t))).finally((()=>i.done()))))}}for(const e of t.walls)en.set(e.id,{layer:t,wall:e})}return!1})),i.onUpdate((({waits:t,done:e,errors:i})=>{const o=e+i;N(l,`${o} / ${t}`),I(M,{max:t,value:o})})),i.add(),i.done(),AI(),mI.zoom=1,DI(n,r),Gt({id:Xd,onmousedown:t=>_d.call(Bd,t),onwheel:t=>Pd.call(Bd,t),onmouseover:t=>Gd.call(Bd,t)},[Bd,g])};Y({[`#${Xd}`]:{height:"100%"},[`#${Hs}`]:{"background-color":"#fff",outline:"none",position:"absolute",">g":{"clip-path":"view-box"}},[`#${Qs}.hiddenLayer,#${Zs}.hiddenLayer`]:{display:"none"},[`#${Ks}>*`]:{"mix-blend-mode":"screen"},[`#${qd}`]:{"background-color":"#fff",position:"fixed",top:0,left:0,bottom:0,right:0,">div":{display:"flex","align-items":"center","justify-content":"center","flex-wrap":"wrap",height:"100%"}," progress":{margin:"0 1em"}},[`.${Fs} #${$s}`]:{display:"none"},[`#${$s}`]:{"z-index":"10",position:"absolute",top:"3px",left:"3px",width:"20px",height:"120px",fill:"rgba(255, 255, 255, 0.2)"," :is(rect, circle)":{transition:"fill 0.5s"}," rect":{cursor:"pointer"}," circle":{cursor:"ns-resize"}},[`#${$s}:hover, .${Vs} #${$s}`]:{" rect":{fill:"#fff"}," circle":{fill:"#f00"}}}),_("@media (prefers-color-scheme: light)",{[`:root.${vs} #${qd}`]:{"background-color":"#000"}}),_("@media (prefers-color-scheme: dark)",{[`:root.:not(${vs}) #${qd}`]:{"background-color":"#000"}}),Cd.mapMouseWheel=t=>{if(t.ctrlKey)NI(.95*Math.sign(t.deltaY),t.clientX,t.clientY);else{const e=Sg.value||100;I(Bd,{style:{left:(mI.x+=Math.sign(t.shiftKey?t.deltaY:t.deltaX)*-e)+"px",top:(mI.y+=(t.shiftKey?0:Math.sign(t.deltaY))*-e)+"px"}})}return!1},fg.wait((()=>Zd&&AI())),ir.then((()=>{Jn.waitMapStartChange().when((t=>[Zd.startX,Zd.startY]=t)),Jn.waitSignalPosition().when(LI),Kn.waitGridDistanceChange().when((t=>{Zd.gridDistance=t,AI()})),Kn.waitGridDiagonalChange().when((t=>Zd.gridDiagonal=t))})),vM("centreMap",oa.KEY_CENTRE_MAP,"c",(()=>DI(Zd.startX,Zd.startY)))[0]();const EI=t=>{Jn.waitCurrentUserMapData().when((e=>{t.replaceWith(t=pI(e,!0)),$a(!1)}));let e=-1,i=0,o=0;const s=t=>{I(Bd,{style:{left:`${mI.x+=t.clientX-i}px`,top:`${mI.y+=t.clientY-o}px`}}),i=t.clientX,o=t.clientY},a=()=>I(document.body,{class:{[g]:!1}}),[n]=lt(0,s,a),[r]=lt(1,s,a),l=(t,e)=>(i=t.clientX,o=t.clientY,I(document.body,{class:[g]}),e(),!1),M=(t,e)=>{const i=t.hasLight();for(const i in e)switch(i){case"id":break;case"src":t instanceof GM&&e.src&&t.updateSource(e.src);break;case"tokenData":const o=e[i];for(const e in o)t.tokenData[e]=o[e];break;case"removeTokenData":const s=e[i];for(const e of s)delete t.tokenData[e];break;default:t[i]=e[i]}return t.updateNode(),i||t.hasLight()},[g,c,d]=G(3);fg.wait((t=>I(document.documentElement,{class:{[d]:t}}))),Y(`#${Hs}`,{overflow:"hidden",cursor:"grab"}),Y(`.${g} #${Hs}`,{cursor:"grabbing"}),Y(`.${d} .${c} #${Hs}`,{"transition-property":"left, top","transition-duration":"1s","transition-timing-function":"ease"}),Cd.mapMouse0=t=>l(t,n),Cd.mapMouse1=t=>l(t,r),Cd.mapMouse2=t=>{const e=yI(t.clientX,t.clientY);return LI(e),Jn.signalPosition(e),!1},Jn.waitSignalMovePosition().when((t=>{-1===e?I(document.body,{class:[c]}):clearTimeout(e),e=setTimeout((()=>{I(document.body,{class:{[e]:!1}}),e=-1}),1e3),DI(t[0],t[1]),LI(t)})),Jn.waitMapChange().when(dI),Jn.waitMapLightChange().when(II),Jn.waitLayerShow().when((t=>nI(t,!0))),Jn.waitLayerHide().when((t=>nI(t,!1))),Jn.waitLayerAdd().when(gI),Jn.waitLayerFolderAdd().when(rI),Jn.waitLayerMove().when((({from:t,to:e,position:i})=>cI(t,e,i))),Jn.waitLayerRename().when((({path:t,name:e})=>lI(t,e))),Jn.waitLayerRemove().when(MI),Jn.waitTokenAdd().when((t=>{const e=sI(t.path);if(e&&oI(e)){let i;if(delete t.path,hI(t.token)){i=new hg(t.token);const e=t.token.tokenData["store-character-id"];e&&"number"==typeof e.data&&Jn.characterGet(e.data).then((t=>Xa.set(e.data,t)))}else i=TI(t.token)?new ug(t.token):new Tg(t.token);void 0===t.pos?e.tokens.push(i):e.tokens.splice(t.pos,0,i),BM.set(i.id,{layer:e,token:i}),i.hasLight()&&AI()}})),Jn.waitTokenMoveLayerPos().when((({id:t,to:e,newPos:i})=>{const o=BM.get(t)??{layer:null,token:null},{layer:s,token:a}=o,n=sI(e);s&&a&&n&&oI(n)&&(i>n.tokens.length&&(i=n.tokens.length),n.tokens.splice(i,0,s.tokens.splice(s.tokens.findIndex((t=>t===a)),1)[0]),o.layer=n,a.hasLight()&&AI())})),Jn.waitTokenSet().when((t=>{const{token:e}=BM.get(t.id)??{token:null};e&&M(e,t)&&AI()})),Jn.waitTokenSetMulti().when((t=>{let e=!1;for(const i of t){const{token:t}=BM.get(i.id)??{token:null};t&&M(t,i)&&(e=!0)}e&&AI()})),Jn.waitTokenRemove().when((t=>{const{layer:e,token:i}=BM.get(t);e.tokens.splice(e.tokens.findIndex((t=>t===i)),1),i instanceof GM&&i.cleanup(),i.hasLight()&&AI()})),Jn.waitLayerShift().when((({path:t,dx:e,dy:i})=>{const o=sI(t);if(o&&oI(o)){for(const t of o.tokens)t.x+=e,t.y+=i,t.updateNode();for(const t of o.walls)t.x1+=e,t.y1+=i,t.x2+=e,t.y2+=i;AI()}})),Jn.waitWallAdded().when((({path:t,wall:e})=>{const i=sI(t);i&&oI(i)&&(i.walls.push(uI(e)),AI())})),Jn.waitWallRemoved().when((t=>{const{layer:e,wall:i}=en.get(t);e.walls.splice(e.walls.findIndex((t=>t===i)),1),AI()})),Jn.waitWallModified().when((t=>{const e=en.get(t.id);e&&(Object.assign(e.wall,t),AI())})),Jn.waitWallMoved().when((({id:t,path:e})=>{const i=en.get(t),o=sI(e);i&&o&&oI(o)&&(i.layer.walls.splice(i.layer.walls.findIndex((t=>t===i.wall))),o.walls.push(i.wall),i.layer=o)})),Jn.waitMapDataSet().when((t=>{t.key&&(Zd.data[t.key]=t.data)})),Jn.waitMapDataRemove().when((t=>delete Zd.data[t])),Jn.waitMaskAdd().when(KM.add),Jn.waitMaskRemove().when(KM.remove),Jn.waitMaskSet().when((({baseOpaque:t,masks:e})=>KM.set(t,e))),Jn.waitGridDistanceChange().when(AI)},wI=new Io(gi()),fI=new Io(gi()),xI={add:(t,e)=>{yi((async()=>{fI.splice(0,fI.length),0!==Cg.value?(-1!==Cg.value&&wI.length>=Cg.value&&wI.splice(0,wI.length-Cg.value),wI.push({fn:t,[Ki]:he(e)})):wI.splice(0,wI.length)}))},clear:()=>{yi((async()=>{wI.splice(0,wI.length),fI.splice(0,fI.length)}))},undo:()=>{yi((async()=>{const t=wI.pop();t&&(t.fn=t.fn(),fI.unshift(t))}))},redo:()=>{yi((async()=>{const t=fI.shift();t&&(t.fn=t.fn(),wI.push(t))}))}};ir.then((()=>{if(!Hn)return;const t=new wi("undo-window-show").wait((t=>{t&&I(vn,e)})),e=kn({"window-title":oa.UNDO_WINDOW_TITLE,style:"--window-left: 0px; --window-top: 0px; --window-width: 200px; --window-height: 600px","window-data":"undo-window-settings",resizable:!0,onremove:()=>t.set(!1)},[wt({onclick:xI.undo},oa.UNDO_UNDO),wt({onclick:xI.redo},oa.UNDO_REDO),Vt(oa.UNDO_WINDOW_UNDOS),wI[Ki],Vt(oa.UNDO_WINDOW_REDOS),fI[Ki]]);Object.defineProperty(window,"showUndoWindow",{value:()=>t.set(!0)})}));const SI=xI,CI=new zi((()=>{})),kI=()=>CI,OI=()=>Promise.reject("invalid"),vI=t=>(YI(t),MI(t),Jn.removeLayer(t)),bI=(t,e)=>{const i={id:t.id,tokenData:{},removeTokenData:[]};for(const o in t)switch(o){case"id":break;case"tokenData":const s=t[o];for(const t in s)e.tokenData[t]?i.tokenData[t]=e.tokenData[t]:i.removeTokenData.push(t);break;case"removeTokenData":const a=t[o];for(const t of a)i.tokenData[t]=e.tokenData[t];break;default:i[o]=e[o]}return i},jI=(t,e)=>{for(const i in t)switch(i){case"id":break;case"src":e instanceof GM&&t.src&&e.updateSource(t.src);break;case"tokenData":const o=t[i];for(const t in o)e.tokenData[t]=o[t];break;case"removeTokenData":const s=t[i];for(const t of s)delete e.tokenData[t];break;default:e[i]=t[i]}e.updateNode(),HM.token===e&&(I(FM,{style:{"--outline-width":e.width+"px","--outline-height":e.height+"px"},class:$M(e.rotation),transform:e.transformString(!1)}),PI.x=e.x,PI.y=e.y,PI.width=e.width,PI.height=e.height,PI.rotation=e.rotation)},zI=()=>{const{token:t}=HM;if(t instanceof GM&&!t.isPattern){const{src:e,width:i,height:o,patternWidth:s,patternHeight:a,rotation:n,flip:r,flop:l,snap:M,lightColours:g,lightStages:c,lightTimings:d}=t,I=Ja(t.tokenData);for(const t of Mg())delete I[t];return{src:e,width:i,height:o,patternWidth:s,patternHeight:a,rotation:n,flip:r,flop:l,snap:M,lightColours:Ja(g),lightStages:Ja(c),lightTimings:Ja(d),tokenData:I}}},YI=t=>{const{layer:e}=HM;e&&(e.path===t||e.path.startsWith(t+"/"))&&(HM.layer=null,HM.token&&VM())},_I=t=>VI[1](t.path),PI={mouseX:0,mouseY:0,x:0,y:0,width:0,height:0,rotation:0},GI=zi.bind(1),RI=zi.bind(1),UI=zi.bind(1),WI=zi.bind(1),QI=zi.bind(1),ZI=zi.bind(1),BI=zi.bind(1),HI=zi.bind(1),FI=zi.bind(1),$I=zi.bind(1),VI=zi.bind(1),KI=(t,e=!0)=>{let i={width:Zd.width,height:Zd.height,gridType:Zd.gridType,gridSize:Zd.gridSize,gridStroke:Zd.gridStroke,gridColour:Zd.gridColour};const o=(e=!0)=>(dI(t),e&&yi(Jn.setMapDetails.bind(Jn,t)),[t,i]=[i,t],o);SI.add(o(e),oa.UNDO_MAP_CHANGE)},JI=(t,e=!0)=>{let i=Zd.lightColour;const o=(e=!0)=>(II(t),e&&yi(Jn.setLightColour.bind(Jn,t)),[t,i]=[i,t],o);SI.add(o(e),oa.UNDO_LIGHT_COLOUR)},XI=(t,e,i=!0)=>{const o=(i=!0)=>(nI(t,e),i&&yi(e?()=>(QI[1](t),Jn.showLayer(t)):()=>(ZI[1](t),Jn.hideLayer(t))),e=!e,o);return SI.add(o(i),oa[e?"UNDO_LAYER_SHOW":"UNDO_LAYER_HIDE"]),t},qI=(t,e,i=!0)=>{const o=sI(t),s=(i=!0)=>(i&&yi(e?()=>(BI[1](t),Jn.showLayer(t)):()=>(HI[1](t),Jn.hideLayer(t))),o&&(o.locked=e),e=!e,s);return SI.add(s(i),oa[e?"UNDO_LAYER_LOCK":"UNDO_LAYER_UNLOCK"]),t},th=(t,e=!0)=>{const i="/"+t,o=(e=!0)=>(gI(t),e&&yi((()=>(GI[1]([{id:1,name:t}]),Jn.addLayer(t)))),s),s=()=>(YI(i),MI(i),yi((()=>(RI[1](i),Jn.removeLayer(i)))),o);return SI.add(o(e),oa.UNDO_LAYER_ADD),t},eh=(t,e=!0)=>{const i=(e=!0)=>(rI(t),e&&yi((()=>(UI[1](t),Jn.addLayerFolder(t)))),o),o=()=>(YI(t),MI(t),yi((()=>(WI[1](t),Jn.removeLayer(t)))),i);return SI.add(i(e),oa.UNDO_LAYER_FOLDER_ADD),t},ih=(t,e,i,o=!0)=>{const[s,a]=aI(t);if(!s||!a)return void er("Invalid layer move");let[n,r]=tI(t),l=s.children.indexOf(a);const M=(o=!0)=>{if(VM(),cI(t,e,i),o){const o={from:t,to:e,position:i};yi((()=>(FI[1](o),Jn.moveLayer(o.from,o.to,o.position))))}return[e,n]=[n,e],t=n+"/"+r,[l,i]=[i,l],M};SI.add(M(o),oa.UNDO_LAYER_MOVE)},oh=(t,e,i=!0)=>{let[o,s]=tI(t),a=o+"/"+s;const n=(i=!0)=>{if(lI(t,e),i){const i={path:t,name:e};yi((()=>($I[1](i),Jn.renameLayer(i.path,i.name))))}return[t,a]=[a,t],[s,e]=[e,s],n};SI.add(n(i),oa.UNDO_LAYER_RENAME)},sh=(t,e,i=!0,o)=>{const s=sI(t);if(!s||!oI(s))return er("Invalid layer for token add"),()=>{};const a=hI(e)?new hg(e):TI(e)?new ug(e):new Tg(e),n=a.hasLight(),r=t=>{a.id=t,void 0===o?s.tokens.push(a):s.tokens.splice(o,0,a),BM.set(t,{layer:s,token:a}),n&&AI()},l=(e=!0)=>(e&&yi((()=>Jn.addToken(t,a,o).then(r))),M),M=()=>(a===HM.token&&VM(),BM.delete(a.id),s.tokens.pop(),yi((()=>Jn.removeToken(a.id))),n&&AI(),l);return SI.add(l(i),oa.UNDO_TOKEN_ADD),r},ah=(t,e,i,o=!0)=>{let s=BM.get(t).layer,a=sI(e);const n=BM.get(t).token;if(!(s&&n&&a&&oI(a)))return void er("Invalid Token Move Layer/Pos");i>a.tokens.length&&(i=a.tokens.length);let r=s.tokens.findIndex((t=>t===n));const l=n.hasLight(),M=(e=!0)=>(a.tokens.splice(i,0,s.tokens.splice(r,1)[0]),BM.get(t).layer=a,l&&AI(),HM.token===n&&VM(),e&&yi(Jn.setTokenLayerPos.bind(Jn,t,a.path,i)),[r,i]=[i,r],[s,a]=[a,s],M);SI.add(M(o),oa.UNDO_TOKEN_MOVE)},nh=(t,e=!0)=>{const{token:i}=BM.get(t.id);if(!i)return void er("Invalid token for token set");let o=bI(t,i);const s=t.lightColours||t.lightStages||t.lightTimings||void 0!==t.x||void 0!==t.y||t.width||t.height,a=(e=!0)=>(jI(t,i),e&&yi(Jn.setToken.bind(Jn,t)),s&&AI(),[o,t]=[t,o],a);SI.add(a(e),oa.UNDO_TOKEN_SET)},rh=(t,e=!0)=>{const i=[];let o=[];for(const e of t){const{token:t}=BM.get(e.id);if(!t)return void er("Invalid token for token set (multi)");i.push(t),o.push(bI(e,t))}const s=t.some((t=>t.lightStages?.length||t?.lightTimings?.length||void 0!==t.x||void 0!==t.y||t.width||t.height)),a=(e=!0)=>{for(let e=0;e<o.length;e++)jI(t[e],i[e]);return e&&yi(Jn.setTokenMulti.bind(Jn,t)),s&&AI(),[o,t]=[t,o],a};SI.add(a(e),oa.UNDO_TOKEN_SET_MULTI)},lh=(t,e=!0)=>{const{layer:i,token:o}=BM.get(t);if(!o)return void er("invalid token for removal");const s=i.tokens.findIndex((t=>t===o)),a=o.hasLight(),n=(e=!0)=>(o===HM.token&&VM(),i.tokens.splice(s,1),BM.delete(t),o.cleanup(),a&&AI(),e&&yi((()=>Jn.removeToken(o.id))),r),r=()=>(i.tokens.splice(s,0,o),yi((()=>Jn.addToken(i.path,o,s).then((t=>{o.id=t,BM.set(t,{layer:i,token:o})})))),o.uncleanup(),a&&AI(),n);SI.add(n(e),oa.UNDO_TOKEN_REMOVE)},Mh=(t,e,i,o=!0)=>{const s=sI(t);if(!s||!oI(s))return void er("invalid layer for shifting");const a=(o=!0)=>{for(const t of s.tokens)t.x+=e,t.y+=i,t.updateNode();for(const t of s.walls)t.x1+=e,t.y1+=i,t.x2+=e,t.y2+=i;return AI(),o&&yi(Jn.shiftLayer.bind(Jn,t,e,i)),e=-e,i=-i,a};SI.add(a(o),oa.UNDO_LAYER_SHIFT)},gh=(t,e=!0)=>{const i=sI(t.path);if(!i||!oI(i))return void er("invalid layer for wall add");const{path:o,wall:{id:s,x1:a,y1:n,x2:r,y2:l,colour:M,scattering:g}}=t,c=uI({id:s,x1:a,y1:n,x2:r,y2:l,colour:M,scattering:g}),d=(t=!0)=>(i.walls.push(c),t?yi((()=>Jn.addWall(o,{id:s,x1:a,y1:n,x2:r,y2:l,colour:M,scattering:g}).then((t=>{c.id=t,en.set(t,{layer:i,wall:c}),AI()})))):s>0&&(en.set(s,{layer:i,wall:c}),AI()),I),I=()=>{i.walls.splice(i.walls.findIndex((t=>t===c)),1),AI();const t=c.id;return yi((()=>Jn.removeWall(t))),en.delete(t),c.id=0,d};a===r&&n===l||SI.add(d(e),oa.UNDO_WALL_ADD)},ch=(t,e=!0)=>{const{layer:i,wall:o}=en.get(t);if(!i||!o)return void er("invalid wall to remove");const s=(t=!0)=>{if(i.walls.splice(i.walls.findIndex((t=>t===o)),1),AI(),t){const t=o.id;yi((()=>Jn.removeWall(t)))}return en.delete(o.id),o.id=0,a},a=()=>(i.walls.push(o),yi((()=>Jn.addWall(i.path,o).then((t=>{en.set(o.id=t,{layer:i,wall:o}),AI()})))),s);SI.add(s(e),oa.UNDO_WALL_REMOVE)},dh=(t,e=!0)=>{const i=en.get(t.id);if(!i)return void er("invalid wall to modify");let o=Ja(i.wall);const s=(e=!0)=>(Object.assign(i.wall,t),e&&yi(Jn.modifyWall.bind(Jn,t)),AI(),[o,t]=[t,o],s);SI.add(s(e),oa.UNDO_WALL_MODIFY)},Ih=(t,e,i=!0)=>{const o=en.get(t);if(!o)return void er("invalid wall to modify");let s=o.layer,a=s.path,n=sI(e);if(!n||!oI(n))return void er("invalid layer for wall move");const r=(i=!0)=>(o.layer=n,n.walls.push(s.walls.splice(s.walls.findIndex((({id:e})=>e===t)),1)[0]),i&&yi(Jn.moveWall.bind(Jn,t,e)),[s,a,n,e]=[n,e,s,a],r);SI.add(r(i),oa.UNDO_WALL_MOVE)},hh=(t,e,i=!0)=>{const o=Zd.data[t],s=(i=!0)=>(Zd.data[t]=e,i&&yi((()=>Jn.setMapKeyData(t,e))),a),a=()=>(o?yi((()=>Jn.setMapKeyData(t,Zd.data[t]=o))):(delete Zd.data[t],yi((()=>Jn.removeMapKeyData(t)))),s);SI.add(s(i),oa.UNDO_MAP_DATA_SET)},Th=(t,e=!0)=>{const i=Zd.data[t];if(!i)return;const o=(e=!0)=>(delete Zd.data[t],e&&yi((()=>Jn.removeMapKeyData(t))),s),s=()=>(Zd.data[t]=i,yi((()=>Jn.setMapKeyData(t,i))),o);SI.add(o(e),oa.UNDO_MAP_DATA_REMOVE)},uh=(t,e=!0)=>{let i=-1;const o=(e=!0)=>(i=KM.add(t),e&&yi((()=>Jn.addToMask(t))),s),s=()=>(KM.remove(i),yi((()=>Jn.removeFromMask(i))),o);SI.add(o(e),oa.UNDO_MASK_ADD)},Ah=(t,e=!0)=>{const i=KM.baseOpaque,o=Ja(KM.masks),s=(e=!0)=>(KM.remove(t),e&&yi((()=>Jn.removeFromMask(t))),a),a=()=>(KM.set(i,o),yi((()=>Jn.setMask(i,o))),s);SI.add(s(e),oa.UNDO_MASK_REMOVE)},Lh=(t,e=!0)=>{let i={baseOpaque:KM.baseOpaque,masks:KM.masks};const o=(e=!0)=>(KM.set(t.baseOpaque,t.masks),e&&yi(Jn.setMask.bind(Jn,t.baseOpaque,t.masks)),[i,t]=[t,i],o);SI.add(o(e),oa.UNDO_MASK_SET)},mh=(t,e,i,o)=>{const s=Zd.gridSize;switch(Zd.gridType){case 1:{const a=1.5*s/JM,n=Math.round(e/a),r=n%2==0?0:s>>1;return[Math.round((t-r)/s)*s+r+(Math.round(i/s)*s-i>>1),Math.round(n*a+(2*s/JM+a*(Math.round(o/a)-1)-o>>1))]}case 2:{const a=1.5*s/JM,n=Math.round(t/a),r=n%2==0?0:s>>1;return[Math.round(n*a+(2*s/JM+a*(Math.round(i/a)-1)-i>>1)),Math.round((e-r)/s)*s+r+(Math.round(o/s)*s-o>>1)]}}return[Math.round(t/s)*s+(Math.round(i/s)*s-i>>1),Math.round(e/s)*s+(Math.round(o/s)*s-o>>1)]},yh=Object.freeze({waitAdded:()=>GI[0],waitMoved:kI,waitRemoved:()=>RI[0],waitCopied:kI,waitFolderAdded:()=>UI[0],waitFolderMoved:kI,waitFolderRemoved:()=>WI[0],waitLayerSetVisible:()=>QI[0],waitLayerSetInvisible:()=>ZI[0],waitLayerSetLock:()=>BI[0],waitLayerSetUnlock:()=>HI[0],waitLayerPositionChange:()=>FI[0],waitLayerRename:()=>$I[0],waitLayerSelect:()=>VI[0],list:OI,createFolder:t=>Jn.addLayerFolder(t).then((t=>eh(t,!1))),move:OI,moveFolder:OI,remove:t=>(SI.clear(),vI(t)),removeFolder:t=>(SI.clear(),vI(t)),copy:OI});let Nh=0,Dh=0;const ph=new ki("character"),Eh=`data:image/svg+xml,%3Csvg xmlns="${To}" viewBox="0 0 100 100"%3E%3Cg stroke-width="2" stroke="%23000" fill="%23fff"%3E%3Cpath d="M99,89 A1,1 0,0,0 1,89 v10 H99 z" /%3E%3Ccircle cx="50" cy="31" r="30" /%3E%3C/g%3E%3C/svg%3E`,wh=(t,e,i,o)=>{const s=Nh,a={},n=new Set,r=kn({"window-icon":Eh,"window-title":e,"hide-minimise":!1,class:vh,style:{"--window-width":"auto"},ondragover:()=>r.focus(),onclose:t=>{(n.size>0||Object.keys(a).length>0)&&(t.preventDefault(),r.confirm(oa.ARE_YOU_SURE,oa.UNSAVED_CHANGES).then((t=>{t&&r.remove()})))}}),l=()=>a.name={user:g.checked,data:M.value},M=Me({type:"text",value:i.name?.data??"",onchange:l}),g=Me({type:"checkbox",class:kh,checked:!1!==i.name?.user,onchange:l}),c=(t,e)=>Object.assign({[Ki]:he({class:zs},[wt({style:`background-image: url(${ld(e.src)})`,onclick:function(){r.confirm(oa.TOKEN_REPLACE,oa.TOKEN_REPLACE_CONFIRM).then((t=>{if(t){const t=zI();if(!t)return void r.alert(oa.TOKEN_SELECT,oa.TOKEN_NONE_SELECTED);a["store-image-data"]={user:!1,data:Ja(Array.from(d.values()))},I(this,{style:`background-image: url(${ld(t.src)})`})}}))}},oa.TOKEN_USE_SELECTED),pa({onclick:()=>r.confirm(oa.TOKEN_REMOVE,oa.TOKEN_REMOVE_CONFIRM).then((e=>{e&&(d.delete(t),a["store-image-data"]={user:!1,data:Ja(Array.from(d.values()))})}))})])},e),d=new ho(gi({class:Oh}),Ji,(i["store-image-data"]?i["store-image-data"].data instanceof Array?i["store-image-data"].data:[i["store-image-data"].data]:[]).map(((t,e)=>[e,c(e,t)]))),h=Gt([Ka([oa.NAME,": "],M),Ka(g,ba()),Et(),o?[de([oa.CHARACTER_IMAGE,": "]),Gt({style:"overflow: hidden; display: inline-block; width: 200px; height: 200px; border: 1px solid #888; text-align: center",ondragover:Ch,ondrop:function(t){const{id:e}=rd.get(t);a["store-image-icon"]={user:i["store-image-icon"].user,data:e},N(this,le({src:ld(e),style:"max-width: 100%; max-height: 100%"}))}},le({src:ld(i["store-image-icon"].data),style:"max-width: 100%; max-height: 100%"})),Et(),de([oa.TOKEN,": "]),d[Ki],wt({onclick:()=>{const t=zI();t?(d.set(u,c(u,t)),u++,a["store-image-data"]={user:!1,data:Array.from(d.values())}):r.alert(oa.TOKEN_SELECT,oa.TOKEN_NONE_SELECTED)}},oa.TOKEN_ADD),Et(),de([oa.TOKEN_ORDER,": "]),Ka(Me({type:"radio",name:`tokens_ordered_${Dh}`,class:Os,checked:!i.tokens_order?.data,onclick:()=>a.tokens_order={user:!1,data:!1}}),[oa.TOKEN_ORDER_NORMAL,": "]),Ka(Me({type:"radio",name:"tokens_ordered_"+Dh++,class:Os,checked:i.tokens_order?.data,onclick:()=>a.tokens_order={user:!1,data:!0}}),[oa.TOKEN_ORDER_SHUFFLE,": "])]:[de([oa.CHARACTER,": "]),Gt({style:"overflow: hidden; display: inline-block; width: 200px; height: 200px; border: 1px solid #888; text-align: center",ondragover:Sh,ondrop:function(t){const{id:e}=ph.get(t),i=Xa.get(e);a["store-character-id"]={user:!0,data:e},N(this,le({src:ld(i["store-image-icon"].data),style:"max-width: 100%; max-height: 100%; cursor: pointer",onclick:()=>wh(e,oa.CHARACTER_EDIT,i,!0)}))}},i["store-character-id"]?le({src:ld(Xa.get(i["store-character-id"].data)["store-image-icon"].data),style:"max-width: 100%; max-height: 100%; cursor: pointer",onclick:()=>wh(i["store-character-id"].data,oa.CHARACTER_EDIT,Xa.get(i["store-character-id"].data),!0)}):[])]]),T=sg(h,t,i,o,a,n,r);let u=d.size;I(vn,Ni(I(r,I(h,wt({onclick:function(){if(I(this,{disabled:!0}),Nh!==s&&!o)throw r.remove(),vn.alert(oa.MAP_CHANGED,oa.MAP_CHANGED_LONG),new Error("map changed");const e=Array.from(n.values()).filter((t=>(delete a[t],void 0!==i[t]))),l={},M=Object.keys(a).filter((t=>{const e=i[t];return e&&e.user===a[t].user&&e.data===a[t].data?(delete a[t],!1):(l[t]=a[t],!0)}));Cn((o?(fh(t,l,e),Jn.characterModify(t,l,e)):xh(t,l,e)).then((()=>{T();for(const t of M)delete a[t];n.clear(),I(this,{disabled:!1})})),r)}},oa.SAVE)))))},fh=(t,e,i)=>{let o={},s=[];const a=Xa.get(t),n=(r=!0)=>{Object.assign(a,e),(e["store-image-data"]||e.tokens_order)&&tn(a);for(const t of i)delete a[t];return r&&yi((()=>Jn.characterModify(t,e,i))),[e,o]=[o,e],[i,s]=[s,i],n};for(const t in e)a[t]?o[t]=a[t]:s.push(t);for(const t of i)a[t]&&(o[t]=a[t]);SI.add(n(!1),oa.UNDO_CHARACTER)},xh=(t,e,i)=>{const o={id:t,tokenData:e,removeTokenData:i};return nh(o,!1),Jn.setToken(o)},Sh=vi({link:[ph]}),Ch=vi({link:[rd]}),[kh,Oh,vh]=G(3);ir.then((()=>{Jn.waitCharacterDataChange().when((({id:t,setting:e,removing:i})=>fh(t,e,i))),Va((()=>Nh=Date.now())),Y({[`.${kh}`]:{display:"none","+label>svg":{display:"inline-block",width:"1em",height:"1em"},":not(:checked)+label>svg":{"--check-on":"none","--check-off":"block"}},[`.${Oh}`]:{margin:0,"list-style":"none"},[`.${zs}`]:{overflow:"hidden",">button":{"background-color":"transparent","background-size":"cover","background-repeat":"no-repeat",width:"200px",height:"200px",color:"#000","text-shadow":"#fff 0 0 5px"},">img":{"max-width":"200px","max-height":"200px"},">svg":{width:"2em",height:"2em",cursor:"pointer"}},[`.${vh}>div`]:{"max-height":"90vh","overflow-y":"scroll"}})}));const bh=(t,e)=>{const{width:i,height:o}=Zd;return[mI.zoom*t-(mI.zoom-1)*i/2+mI.x,mI.zoom*e-(mI.zoom-1)*o/2+mI.y]},jh=Gt({style:"border: 1px solid #000; padding: 5px; background-color: #fff; color: #000; position: absolute; pointer-events: none"}),zh=No({r:8,fill:"#000",stroke:"#fff","stroke-width":2}),Yh=gs({stroke:"#fff","stroke-width":8,"stroke-linecap":"square","stroke-linejoin":"round",fill:"none"}),_h=gs({stroke:"#000","stroke-width":6,"stroke-linejoin":"round",fill:"none"}),Ph=qo([Yh,_h,zh]),Gh=Me({type:"number",value:1,min:0,onchange:()=>{const t=parseInt(Gh.value);hi(t,0)&&Jn.setGridDistance(t)}}),Rh=Me({type:"checkbox",checked:!0,class:Os,onchange:()=>Jn.setGridDiagonal(Rh.checked)}),Uh=[NaN,NaN],Wh=(t,e)=>{Uh.splice(0,Uh.length,t,e);const i={points:`${t},${e} ${t},${e}`},[o,s]=bh(t,e);I(Yh,i),I(_h,i),I(zh,{cx:Uh[0],cy:Uh[1]}),Ph.parentNode||(bd.parentNode?Bd.insertBefore(Ph,bd):I(Bd,Ph)),I(jh,{style:{left:`${o+5}px`,top:`${s+5}px`}}),jh.parentNode||I(document.body,jh)},Qh=(t,e)=>{if(isNaN(Uh[0])||isNaN(Uh[1]))return;let i=0;const{gridSize:o}=Zd,s=[0,0],a=Ti(parseInt(Gh.value),1,1/0,o),n={points:Uh.reduce(((t,e,o)=>{if(o%2==0){const e=Uh[o],n=Uh[o+1];if(t+=` ${e},${n}`,o>=2){const t=e-s[0],o=n-s[1];i+=a*(Rh.checked?Math.hypot(t,o):Math.max(Math.abs(t),Math.abs(o)))}s[0]=e,s[1]=n}return t}),"")+` ${t},${e}`},[r,l]=bh(t,e),M=t-s[0],g=e-s[1];i+=a*(Rh.checked?Math.hypot(M,g):Math.max(Math.abs(M),Math.abs(g))),N(jh,{style:{left:`${r+5}px`,top:`${l+5}px`}},Math.round(i/o)+""),I(Yh,n),I(_h,n)},Zh=()=>{Ph.remove(),jh.remove(),Uh.splice(0,Uh.length,NaN,NaN)};ir.then((()=>{if(Va((()=>{Gh.value=Zd.gridDistance+"",Rh.checked=Zd.gridDiagonal})),!Hn)return void Jn.waitSignalMeasure().when((t=>{if(!t)return void Zh();const[e,i,...o]=t,s=o.pop(),a=o.pop();Wh(e,i),Uh.push(...o),Qh(a,s)}));let t=!1;const e=Me({type:"checkbox",class:Os}),i=Me({type:"checkbox",checked:!1,class:Os}),o=()=>e.click(),[s,a]=lt(0,void 0,(t=>{t.ctrlKey||(Zh(),r())})),[n,r]=lt(2,void 0,(()=>{t&&(Jn.signalMeasure(null),t=!1)})),[l,M]=rt((i=>{const[o,s]=yI(i.clientX,i.clientY,e.checked);I(bd,{transform:`translate(${o-10/mI.zoom}, ${s-10/mI.zoom}) scale(${1/mI.zoom})`}),isNaN(Uh[0])||(Qh(o,s),t&&Jn.signalMeasure([...Uh,o,s]))})),[g,c]=nt("Shift",o,o),[d,h]=nt("Escape",(()=>{if(2===Uh.length)Zh(),r();else{const e=Uh.pop(),i=Uh.pop();Qh(i,e),t&&Jn.signalMeasure([...Uh,i,e])}}));kd({name:oa.TOOL_MEASURE,id:"tool_measure",icon:As({viewBox:"0 0 50 50"},[Ds(oa.TOOL_MEASURE),rs({d:"M0,40 l10,10 l40,-40 l-10,-10 z m5,-5 l5,5 m-3,-7 l3,3 m-1,-5 l3,3 m-1,-5 l3,3 m-1,-5 l3,3 m-1,-5 l5,5 m-3,-7 l3,3 m-1,-5 l3,3 m-1,-5 l3,3 m-1,-5 l3,3 m-1,-5 l5,5 m-3,-7 l3,3 m-1,-5 l3,3 m-1,-5 l3,3 m-1,-5 l3,3 m-1,-5 l5,5",style:"stroke: currentColor","stroke-linejoin":"round",fill:"none"})]),options:Gt([Ka(e,[oa.TOOL_MEASURE_SNAP,": "]),Et(),Ka(Rh,[oa.TOOL_MEASURE_DIAGONALS,": "]),Et(),Ka(i,[oa.TOOL_MEASURE_MULTI,": "]),Et(),Ka([oa.TOOL_MEASURE_CELL,": "],Gh)]),mapMouseOver:()=>(l(),!1),tokenMouseOver:function(){return I(Bd,{style:{"--outline-cursor":"none"}}),I(this,{onmouseout:m((()=>I(Bd,{style:{"--outline-cursor":void 0}})),T)}),!1},tokenMouse0:Od,tokenMouse2:Od,mapMouse0:t=>{const[o,a]=yI(t.clientX,t.clientY,e.checked);return isNaN(Uh[0])?Wh(o,a):Uh.push(o,a),t.ctrlKey||i.checked||s(),!1},mapMouse2:i=>{const[o,s]=yI(i.clientX,i.clientY,e.checked);return Jn.signalMeasure([...Uh,o,s]),t=!0,n(),!1},set:()=>{I(Bd,{style:{cursor:"none"}},bd),I(e,{checked:Lg.value}),g(),d()},unset:()=>{I(Bd,{style:{cursor:void 0}}),bd.remove(),a(),r(),M(),c(),h(),Zh()}}),Jn.waitGridDistanceChange().when((t=>Gh.value=t+"")),Jn.waitGridDiagonalChange().when((t=>Rh.checked=t))}));const[Bh,Hh]=(new bi).bind(3),Fh=new ki("light"),$h=t=>{_I(BM.get(t.id).layer),HM.token=t,I(FM,{transform:t.transformString(!1),style:`--outline-width: ${t.width}px; --outline-height: ${t.height}px`,class:$M(t.rotation)});for(const e of["x","y","rotation","width","height"])PI[e]=t[e];QM()},Vh=t=>{let e=null,i=-1,o=null,s=0,a=0,n=!1,r=!1;const l=(t,e="",i=Qd)=>i.children.map((i=>i.id<0?[]:iI(i)?Vi([$i(i.name),Fi(l(t,e,i))]):$i(i.name===e?{disabled:!0}:{onselect:()=>t(i)},i.name))),[M,g]=lt(0,(t=>{let{x:e,y:o,width:s,height:a,rotation:n}=PI;const[r,l]=yI(t.clientX,t.clientY),M=r-PI.mouseX,g=l-PI.mouseY,c=Zd.gridSize,d=HM.token,h=(d?.snap??!1)!=t.shiftKey;if(d){switch(i){case 0:e+=M,o+=g,h&&([e,o]=mh(e,o,s,a)),wg.value&&Qh(e+(s>>1),o+(a>>1));break;case 1:if(n=ui(Math.round(-128*Math.atan2(mI.zoom*(e+s/2)+mI.x-(mI.zoom-1)*Zd.width/2-t.clientX,mI.zoom*(o+a/2)+mI.y-(mI.zoom-1)*Zd.height/2-t.clientY)/Math.PI),256),h){const t=256/(1===Zd.gridType||2===Zd.gridType?12:8);n=Math.round(n/t)*t%256}I(FM,{class:$M(n)});break;default:{const t=-360*n/256,{x:r,y:l}=new DOMPoint(M,g).matrixTransform((new DOMMatrix).rotateSelf(t)),d=(new DOMMatrix).translateSelf(e+s/2,o+a/2).rotateSelf(-t).translateSelf(-(e+s/2),-(o+a/2)),I=[2,5,7].includes(i)?-1:[4,6,9].includes(i)?1:0,T=[2,3,4].includes(i)?-1:[7,8,9].includes(i)?1:0,u=h?c:10;let A=r*I,L=l*T;0!==I&&L<A*a/s||0===T?L=A*a/s:A=L*s/a,0!==I&&s+A<u&&(A=u-s,L=u*a/s-a),0!==T&&a+L<u&&(A=u*s/a-s,L=u-a),A*=I,L*=T,h&&(A=Math.round(A/c)*c,L=Math.round(L/c)*c),-1===I?(e+=A,s-=A):1===I&&(s+=A),-1===T?(o+=L,a-=L):1===T&&(a+=L),h&&([e,o]=mh(e,o,s=Math.max(Math.round(s/c)*c,c),a=Math.max(Math.round(a/c)*c,c)));const{x:m,y}=new DOMPoint(e+s/2,o+a/2).matrixTransform(d),{x:N,y:D}=new DOMPoint(e,o).matrixTransform(d).matrixTransform((new DOMMatrix).translateSelf(m,y).rotateSelf(t).translateSelf(-m,-y));e=N,o=D}}d.x=Math.round(e),d.y=Math.round(o),d.width=Math.round(s),d.height=Math.round(a),d.rotation=Math.round(n),d.updateNode(),I(FM,{style:{"--outline-width":s+"px","--outline-height":a+"px"},transform:d.transformString(!1)})}}),(()=>{if(!HM.token)return;I(Bd,{style:{"--outline-cursor":void 0}}),i=-1;const{token:t}=HM,e={id:t.id,x:Math.round(t.x),y:Math.round(t.y),rotation:Math.round(t.rotation),width:Math.round(t.width),height:Math.round(t.height)};let o=!1;for(const i of["x","y","rotation","width","height"])PI[i]!==e[i]?(t[i]=PI[i],o=!0):delete e[i];o&&nh(e),Zh()})),c=vi({link:[ph,rd],copy:[sd]}),d=t=>{if(!HM.layer)return;if(sd.is(t)){const[e,i]=yI(t.clientX,t.clientY),{layer:o}=HM;return void id(sd.asForm(t,"asset")).then((t=>{for(const s of t)le({src:ld(s.id),onload:function(){const{width:t,height:a}=this;if(HM.layer===o&&t>0&&a>0){const n={id:0,src:s.id,x:e,y:i,width:t||Zd.gridSize,height:a||Zd.gridSize,patternWidth:0,patternHeight:0,stroke:Pn,strokeWidth:0,rotation:0,flip:!1,flop:!1,tokenData:{},tokenType:0,snap:Lg.value,lightColours:[],lightStages:[],lightTimings:[]};n.snap&&([n.x,n.y]=mh(n.x,n.y,n.width,n.height)),sh(o.path,n)}}})})).catch(er)}const e={id:0,src:0,x:0,y:0,width:0,height:0,patternWidth:0,patternHeight:0,stroke:Pn,strokeWidth:0,rotation:0,flip:!1,flop:!1,tokenData:{},tokenType:0,snap:Lg.value,lightColours:[],lightStages:[],lightTimings:[]};if(ph.is(t)){const{id:i,width:o,height:s}=ph.get(t),a=Xa.get(i);a&&Object.assign(e,qa(a)??{src:parseInt(a["store-image-icon"].data),width:o,height:s})}else{if(!rd.is(t))return;{const{id:i,width:o,height:s}=rd.get(t);e.src=i,e.width=o||Zd.gridSize,e.height=s||Zd.gridSize}}[e.x,e.y]=yI(t.clientX,t.clientY),e.snap&&([e.x,e.y]=mh(e.x,e.y,e.width,e.height)),sh(HM.layer.path,e)},h=function*(t=Qd){for(const e of t.children)yield*e.locked?[]:oI(e)?e.tokens:h(e)},T=[0,0],u=t=>{n=!0,I(Bd,{style:{left:(mI.x+=t.clientX-s)+"px",top:(mI.y+=t.clientY-a)+"px"}}),s=t.clientX,a=t.clientY},[A]=lt(0,u,(t=>{n||t.ctrlKey||(VM(),D(t)),I(Bd,{style:{"--outline-cursor":void 0}})})),[L]=lt(1,u,(()=>I(Bd,{style:{"--outline-cursor":void 0}}))),m=(t,e)=>(I(Bd,{style:{"--outline-cursor":"grabbing"}}),s=t.clientX,a=t.clientY,n=!1,e(),!1),y=[-1,-1,-1,-1],N=(t,e=1)=>t.rotation=ui(t.snap?Math.round(t.rotation+256*e/(0===Zd.gridType?8:12)):t.rotation+e,256),D=({target:t,clientX:e,clientY:i,ctrlKey:o})=>I(document.body,{style:{"--outline-cursor":!o&&(r=t?.parentNode===FM)?void 0:!o&&HM.layer?.tokens?.some((t=>t.at(e,i)))?"pointer":"grab"}}),p=(t,e)=>D({target:t,clientX:st,clientY:at,ctrlKey:e}),[E,w]=rt(D),f=t=>p(r?FM.firstChild:null,t.ctrlKey),[x,S]=nt("Control",f,f),C=[nt("Ctrl+c",(()=>e=Ja(HM.token))),nt("Ctrl+x",(()=>lh((e=Ja(HM.token)).id))),nt("Escape",(t=>{if(-1==i)return VM(),void p(Bd,t.ctrlKey);I(Bd,{style:{"--outline-cursor":void 0}}),i=-1;const{token:e}=HM,{x:o,y:s,width:a,height:n,rotation:r}=PI;e&&(e.x=o,e.y=s,e.width=a,e.rotation=r,e.height=n,e.updateNode(),I(FM,{style:{"--outline-width":a+"px","--outline-height":n+"px"},class:$M(r),transform:e.transformString(!1)})),Zh(),g()})),nt("Delete",(()=>lh(HM.token.id))),vM("tokenEdit",oa.CONTEXT_EDIT_TOKEN,"",(()=>{const{token:t}=HM;t instanceof GM&&BM.has(t.id)&&wh(t.id,oa.CONTEXT_EDIT_TOKEN,t.tokenData,!1)})),vM("tokenLight",oa.CONTEXT_SET_LIGHTING,"",(()=>{const{token:t}=HM;t&&BM.has(t.id)&&O(t)})),...[["Up",(t,e)=>t.y-=e],["Down",(t,e)=>t.y+=e],["Left",(t,e,i,o=!1)=>o?N(t,-1):t.x-=i],["Right",(t,e,i,o=!1)=>o?N(t):t.x+=i]].map((([t,e],i)=>((t,e,i)=>nt([`Arrow${e}`,`Shift+Arrow${e}`],(e=>{const{token:o}=HM;o&&!o.snap&&(y[t]=setInterval((()=>{i(o,1,1,e.shiftKey),o.x=Math.min(Math.max(0,o.x),Zd.width-o.width),o.y=Math.min(Math.max(0,o.y),Zd.height-o.height),o.updateNode(),I(FM,{transform:o.transformString(!1)})}),5))}),(e=>{if(-1!==y[t]){if(clearInterval(y[t]),y[t]=-1,o&&y.every((t=>-1===t))){const{id:t,x:e,y:i,rotation:s}=o;o.x=PI.x,o.y=PI.y,o.rotation=PI.rotation,nh({id:t,x:e,y:i,rotation:s})}}else{const{gridSize:t,gridType:s,width:a,height:n}=Zd,{token:r}=HM;if(e.isTrusted&&r&&(i(r,1===s?Math.round(1.5*t/JM):2===s?t>>1:t,2===s?Math.round(1.5*t/JM):1===s?t>>1:t,e.shiftKey),r.x=Math.min(Math.max(0,r.x),a-r.width),r.y=Math.min(Math.max(0,r.y),n-r.height),o)){const{id:t,x:e,y:i,rotation:s}=o;o.x=PI.x,o.y=PI.y,o.rotation=PI.rotation,nh({id:t,x:e,y:i,rotation:s})}}})))(i,t,e)))],k=vi({copy:[Fh]}),O=t=>{const{lightColours:e,lightStages:i,lightTimings:o}=t,s=()=>({id:t.id,lightColours:A.map((t=>t.colours.map((t=>t.value)))),lightStages:A.map((t=>t.value)),lightTimings:u.map((t=>t.value))}),a=Fh.register(s),n=Ja(e),r=i.length?Ja(i):[0],l=o.length?Ja(o):[0],M=kn({"window-icon":Pa,"window-title":oa.CONTEXT_SET_LIGHTING,resizable:!0,style:"--window-width: 50%; --window-height: 50%"}),g=oi({colspan:l.length},oa.LIGHTING_TIMING),c=oi({rowspan:r.length+1,style:"min-width:1em; writing-mode: vertical-rl; transform: scale(-1, -1)"},oa.LIGHTING_STAGES),d=(t=0)=>{const e={[Ki]:oi([Me({type:"number",value:t,onchange:function(){e.value=Ti(parseInt(this.value),0)}}),pa({title:oa.LIGHTING_REMOVE_TIMING,class:Us,onclick:()=>{const t=u.findIndex((t=>Object.is(t,e)));u.splice(t,1),l.pop();for(const e of A)e.colours.splice(t,1);I(g,{colspan:u.length})}})]),value:t};return e},h=(t=-1,e=-1)=>{const i={[Ki]:qe(),value:n[t]?.[e]??Pn};return I(i[Ki],Rn(M,oa.LIGHTING_SET_COLOUR,(()=>i.value),(t=>i.value=t))),i},T=(t=0,e=-1)=>{const i=ri(qe([Me({type:"number",value:t,onchange:function(){o.value=Ti(parseInt(this.value),0)}}),pa({title:oa.LIGHTING_REMOVE_STAGE,class:Us,onclick:()=>{A.filterRemove((t=>t===o)),I(c,{rowspan:A.length+1})}})])),o={[Ki]:i,value:t,colours:new Io(i,Ji,l.map(((t,i)=>h(e,i))))};return o},u=new Io(I(ri(),qe({colspan:2})),Ji,l.map(d)),A=new Io(Xe(ri(c)),Ji,r.map(T));I(vn,I(M,{onremove:()=>Fh.deregister(a),ondragover:k,ondrop:e=>{if(Fh.is(e)){const{id:i,lightColours:o,lightStages:s,lightTimings:a}=Fh.get(e);i!==t.id&&(n.splice(0,n.length,...o),r.splice(0,r.length,...s),l.splice(0,l.length,...a),u.splice(0,u.length,...a.map(d)),A.splice(0,A.length,...s.map(T)),I(g,{colspan:u.length}),I(c,{rowspan:A.length+1}))}}},[Vt([Gt({draggable:"true",style:"display: inline-block; cursor: grab",ondragstart:t=>Fh.set(t,a)},Ga({title:oa.LIGHTING_DRAG,width:"1em",height:"1em"})),oa.CONTEXT_SET_LIGHTING]),wt({onclick:()=>I(c,{rowspan:A.push(T())+1})},oa.LIGHTING_ADD_STAGE),wt({onclick:()=>{I(g,{colspan:u.push(d())}),l.push(0);for(const t of A)t.colours.push(h())}},oa.LIGHTING_ADD_TIMING),Je([si([ri([qe({colspan:2}),g]),u[Ki]]),A[Ki]]),wt({onclick:()=>{BM.has(t.id)&&nh(s()),M.close()}},oa.SAVE)]))},v=t=>{const{layer:e,token:i}=HM;if(e){const o=e.tokens.findIndex((t=>t===i)),s=e.tokens.at(t.shiftKey?(o+1)%e.tokens.length:o<0?-1:o-1);s&&s!==i&&$h(s),t.preventDefault()}},[b,j]=vM("nextToken",oa.TOKEN_NEXT,"Tab",v),[z,_]=vM("prevToken",oa.TOKEN_PREV,"Shift+Tab",v),G=P();Y({[`#${Hs}`]:{cursor:"var(--outline-cursor)",overflow:"visible"},[`#${G}`]:{outline:"none","clip-path":"initial !important"," rect":{"stroke-width":"calc(1px / var(--zoom, 1))",stroke:"#000",width:"calc(10px / var(--zoom, 1))",height:"calc(10px / var(--zoom, 1))",fill:"#f00",":nth-child(1)":{width:"var(--outline-width)",height:"var(--outline-height)",fill:"transparent",cursor:"var(--outline-cursor, move)"},":nth-child(2)":{x:"calc(var(--outline-width) / 2 - 5px / var(--zoom, 1))",y:"calc(-20px / var(--zoom, 1))",cursor:"var(--outline-cursor, cell)"},":nth-child(3)":{x:"calc(-5px / var(--zoom, 1))",y:"calc(-5px / var(--zoom, 1))"},":nth-child(4)":{x:"calc(var(--outline-width) / 2 - 5px / var(--zoom, 1))",y:"calc(-5px / var(--zoom, 1))"},":nth-child(5)":{x:"calc(var(--outline-width) - 5px / var(--zoom, 1))",y:"calc(-5px / var(--zoom, 1))"},":nth-child(6)":{x:"calc(-5px / var(--zoom, 1))",y:"calc(var(--outline-height) / 2 - 5px / var(--zoom, 1))"},":nth-child(7)":{x:"calc(var(--outline-width) - 5px / var(--zoom, 1))",y:"calc(var(--outline-height) / 2 - 5px / var(--zoom, 1))"},":nth-child(8)":{x:"calc(-5px / var(--zoom, 1))",y:"calc(var(--outline-height) - 5px / var(--zoom, 1))"},":nth-child(9)":{x:"calc(var(--outline-width) / 2 - 5px / var(--zoom, 1))",y:"calc(var(--outline-height) - 5px / var(--zoom, 1))"},":nth-child(10)":{x:"calc(var(--outline-width) - 5px / var(--zoom, 1))",y:"calc(var(--outline-height) - 5px / var(--zoom, 1))"}}},[`.${qs[0]} :is(rect:nth-child(3), rect:nth-child(10)), .${qs[1]} :is(rect:nth-child(6), rect:nth-child(7)), .${qs[2]} :is(rect:nth-child(5), rect:nth-child(8)), .${qs[3]} :is(rect:nth-child(4), rect:nth-child(9))`]:{cursor:"var(--outline-cursor, nwse-resize)"},[`.${qs[0]} :is(rect:nth-child(4), rect:nth-child(9)), .${qs[1]} :is(rect:nth-child(3), rect:nth-child(10)), .${qs[2]} :is(rect:nth-child(6), rect:nth-child(7)), .${qs[3]} :is(rect:nth-child(5), rect:nth-child(8))`]:{cursor:"var(--outline-cursor, ns-resize)"},[`.${qs[0]} :is(rect:nth-child(5), rect:nth-child(8)), .${qs[1]} :is(rect:nth-child(4), rect:nth-child(9)), .${qs[2]} :is(rect:nth-child(3), rect:nth-child(10)), .${qs[3]} :is(rect:nth-child(6), rect:nth-child(7))`]:{cursor:"var(--outline-cursor, nesw-resize)"},[`.${qs[0]} :is(rect:nth-child(6), rect:nth-child(7)), .${qs[1]} :is(rect:nth-child(5), rect:nth-child(8)), .${qs[2]} :is(rect:nth-child(4), rect:nth-child(9)), .${qs[3]} :is(rect:nth-child(3), rect:nth-child(10))`]:{cursor:"var(--outline-cursor, ew-resize)"},[`.${Bs}`]:{opacity:"var(--hiddenLayerOpacity, 0.5)",[`.${js}`]:{opacity:"var(--hiddenLayerSelectedOpacity, 0.5)"}},[`.${bs} #${Qs}`]:{display:"none"}}),I(FM,{id:G,style:"display: none",onwheel:zd},Array.from({length:10},((t,e)=>ds({onmouseover:Yd,onmousedown:function(t){jd.call(this,t,e)}})))),ZM((()=>{if(HM.token)for(const[t]of C)t();else for(const[,t]of C)t();o=HM.token})),nt("Ctrl+z",SI.undo)[0](),nt(["Ctrl+r","Ctrl+y","Ctrl+Shift+Z"],SI.redo)[0](),nt("Ctrl+v",(()=>{if(e&&HM.layer){const{snap:t,width:i,height:o}=e,[s,a]=t?mh(T[0]-(i>>1),T[1]-(o>>1),i,o):[T[0]-(i>>1),T[1]-(o>>1)],n=Object.assign(Ja(e),{id:0,x:Math.min(Math.max(0,s),Zd.width-i),y:Math.min(Math.max(0,a),Zd.height-o)});sh(HM.layer.path,n)}}))[0](),Hh((e=>Jn.getMapData(e).then((e=>{VM(),HM.layer=null,t.replaceWith(t=pI(e)),I(Bd,{ondragover:c,ondrop:d},I(FM,{style:"display: none"})),T[0]=0,T[1]=0,$a(!0)})))),Cd.mapMouse0=function(t){[T[0],T[1]]=yI(t.clientX,t.clientY);const{layer:e}=HM;if(!t.ctrlKey||t.shiftKey){let i=null;for(const o of t.ctrlKey?h():e?.tokens??[])o.at(t.clientX,t.clientY)&&(i=o);if(i)return $h(i),p(FM.firstChild,t.ctrlKey),!1}return!(!t.ctrlKey&&("pointer"===document.body.style.getPropertyValue("--outline-cursor")||t.target&&t.target.parentNode===FM))&&m(t,A)},Cd.mapMouse1=t=>m(t,L),Cd.mapMouseOver=()=>(E(),x(),!1),Cd.tokenMouse0=(t,e)=>{if((!t.ctrlKey||t.shiftKey)&&HM.token)if(t.stopPropagation(),0===e&&t.shiftKey){const{layer:e,token:i}=HM;if(e){let o=null;for(const s of t.ctrlKey?h():e.tokens)if(s===i){if(o)break}else s.at(t.clientX,t.clientY)&&(o=s);o&&$h(o)}}else if(M(),i=e,I(Bd,{style:{"--outline-cursor":["move","cell","nwse-resize","ns-resize","nesw-resize","ew-resize"][i<2?i:(3.5-Math.abs(5.5-i)+(HM.token.rotation+143>>5))%4+2]}}),[PI.mouseX,PI.mouseY]=yI(t.clientX,t.clientY),0===e&&wg.value){const{token:t}=HM;Wh(t.x+(t.width>>1),t.y+(t.height>>1))}return!1},Cd.tokenMouse2=t=>{t.stopPropagation();const{layer:e,token:i}=HM;if(e&&i){const o=e.tokens.findIndex((t=>t===i));I(document.body,Fi({x:t.clientX,y:t.clientY},[lg(),hI(i)?[$i({onselect:()=>i instanceof GM&&BM.has(i.id)&&wh(i.id,oa.CONTEXT_EDIT_TOKEN,i.tokenData,!1)},oa.CONTEXT_EDIT_TOKEN),$i({onselect:()=>{i instanceof GM&&BM.has(i.id)&&nh({id:i.id,flip:!i.flip})}},oa.CONTEXT_FLIP),$i({onselect:()=>{i instanceof GM&&BM.has(i.id)&&nh({id:i.id,flop:!i.flop})}},oa.CONTEXT_FLOP),$i({onselect:()=>{i instanceof GM&&BM.has(i.id)&&nh(i.isPattern?{id:i.id,patternWidth:0,patternHeight:0}:{id:i.id,patternWidth:i.width,patternHeight:i.height})}},i.isPattern?oa.CONTEXT_SET_IMAGE:oa.CONTEXT_SET_PATTERN)]:[],$i({onselect:()=>{const t=i.snap,{x:e,y:o,width:s,height:a,rotation:n}=i;if(BM.has(i.id))if(t)nh({id:i.id,snap:!t});else{const[r,l]=mh(e,o,s,a),M=32*Math.round(n/32)%256;nh({id:i.id,x:r,y:l,rotation:M,snap:!t})}}},i.snap?oa.CONTEXT_UNSNAP:oa.CONTEXT_SNAP),$i({onselect:()=>{BM.has(i.id)&&O(i)}},oa.CONTEXT_SET_LIGHTING),o<e.tokens.length-1?[$i({onselect:()=>{const t=BM.get(i.id)?.layer;t&&BM.has(i.id)&&ah(i.id,t.path,t.tokens.length-1)}},oa.CONTEXT_MOVE_TOP),$i({onselect:()=>{const t=BM.get(i.id)?.layer;t&&BM.has(i.id)&&ah(i.id,t.path,t.tokens.findIndex((t=>t===i))+1)}},oa.CONTEXT_MOVE_UP)]:[],o>0?[$i({onselect:()=>{const t=BM.get(i.id)?.layer;t&&BM.has(i.id)&&ah(i.id,t.path,t.tokens.findIndex((t=>t===i))-1)}},oa.CONTEXT_MOVE_DOWN),$i({onselect:()=>{const t=BM.get(i.id)?.layer;t&&BM.has(i.id)&&ah(i.id,t.path,0)}},oa.CONTEXT_MOVE_BOTTOM)]:[],Vi([$i(oa.CONTEXT_MOVE_LAYER),Fi(l((t=>{BM.has(i.id)&&ah(i.id,t.path,t.tokens.length)}),e.name))]),$i({onselect:()=>lh(i.id)},oa.CONTEXT_DELETE)]))}return!1},Cd.mapMouse2=t=>{const e=yI(t.clientX,t.clientY);return LI(e),t.ctrlKey?(t.altKey&&(Jn.setMapStart(e),[Zd.startX,Zd.startY]=e),Jn.signalMovePosition(e)):Jn.signalPosition(e),!1},Cd.set=()=>{b(),z()},Cd.unset=()=>{j(),_(),w(),S(),I(document.body,{style:{"--outline-cursor":void 0}})},Jn.waitMapChange().when((t=>KI(t,!1))),Jn.waitMapLightChange().when((t=>JI(t,!1))),Jn.waitLayerShow().when((t=>QI[1](XI(t,!0,!1)))),Jn.waitLayerHide().when((t=>ZI[1](XI(t,!1,!1)))),Jn.waitLayerShow().when((t=>BI[1](qI(t,!0,!1)))),Jn.waitLayerHide().when((t=>HI[1](qI(t,!1,!1)))),Jn.waitLayerAdd().when((t=>GI[1]([{id:1,name:th(t,!1)}]))),Jn.waitLayerFolderAdd().when((t=>UI[1](eh(t,!1)))),Jn.waitLayerMove().when((({from:t,to:e,position:i})=>{ih(t,e,i,!1),FI[1]({from:t,to:e,position:i})})),Jn.waitLayerRename().when((t=>{oh(t.path,t.name,!1),$I[1](t)})),Jn.waitLayerRemove().when((t=>{YI(t);const e=sI(t);e?((iI(e)?WI:RI)[1](t),MI(t),SI.clear()):er("Invalid layer remove")})),Jn.waitTokenAdd().when((({path:t,token:e,pos:i})=>sh(t,e,!1,i)(e.id))),Jn.waitTokenMoveLayerPos().when((({id:t,to:e,newPos:i})=>ah(t,e,i,!1))),Jn.waitTokenSet().when((t=>nh(t,!1))),Jn.waitTokenSetMulti().when((t=>rh(t,!1))),Jn.waitTokenRemove().when((t=>lh(t,!1))),Jn.waitLayerShift().when((({path:t,dx:e,dy:i})=>Mh(t,e,i,!1))),Jn.waitWallAdded().when((t=>gh(t,!1))),Jn.waitWallRemoved().when((t=>ch(t,!1))),Jn.waitWallModified().when((t=>dh(t,!1))),Jn.waitWallMoved().when((({id:t,path:e})=>Ih(t,e,!1))),Jn.waitMapDataSet().when((({key:t,data:e})=>{t&&hh(t,e,!1)})),Jn.waitMapDataRemove().when((t=>Th(t,!1))),Jn.waitMaskAdd().when((t=>uh(t,!1))),Jn.waitMaskRemove().when((t=>Ah(t,!1))),Jn.waitMaskSet().when((t=>Lh(t,!1))),Jn.waitGridDistanceChange().when(AI),kg.wait((t=>I(document.body,{style:{"--hiddenLayerOpacity":Math.max(Math.min(t,255),0)/255}}))),Og.wait((t=>I(document.body,{style:{"--hiddenLayerSelectedOpacity":Math.max(Math.min(t,255),0)/255}})))};class Kh extends Zg{constructor(t,e,i){if(super(t,e,i,ph,!0),Xa.has(e)){const t=Xa.get(e)?.["store-image-icon"];t&&this.setIcon(t.data)}else Jn.characterGet(e).then((t=>{Xa.set(e,t),t["store-image-icon"]&&this.setIcon(t["store-image-icon"].data)}));qh.set(e,this)}setIcon(t){I(this.image,{src:ld(t)})}show(){wh(this.id,this.name,Xa.get(this.id),!0)}}class Jh extends Hg{constructor(t,e,i,o){super(t,e,i,o,ph,eT);for(const t in o.items)this.#Ct(o.items[t],t)}#Ct(t,e){const i=tT.get(t);i?i[0].send(i[1]=e):tT.set(t,[new bi,e])}addItem(t,e){return this.#Ct(t,e),super.addItem(t,e)}}class Xh extends Fg{removeItem(t){const e=super.removeItem(t);return e>0&&qh.delete(e),e}copyItem(t,e,i){const o=Xa.get(t);o&&(Xa.set(e,Ja(o)),super.copyItem(t,e,i))}}const qh=new Map,tT=new Map,eT=new ki("characterfolder"),iT=(t,e)=>{const i=tT.get(t)??Ai(tT,t,[new bi,""]);return e(i[1]),i[0].receive(e),()=>i[0].remove(e)};sn.push([2,()=>Hn?[oa.TAB_CHARACTERS,(()=>{const t=Jn.characters,e=Gt(on()),i=vi({link:[rd]}),o=P();return Y(`#${o}`,{" ul":{margin:0,"padding-left":"calc(1em + 4px)","list-style":"none"},">div>ul":{"padding-left":0}}),t.list().then((s=>{const a=new Xh(s,oa.CHARACTERS,t,Kh,Jh);a.windowIcon=Eh,N(e,{id:o},[wt({onclick:()=>{let t=0;const e=Me({onkeypress:Fa}),o=kn({"window-icon":Eh,"window-title":oa.CHARACTER_NEW,ondragover:()=>o.focus()},[Vt(oa.CHARACTER_NEW),Ka([oa.CHARACTER_NAME,": "],e),Et(),de([oa.CHARACTER_IMAGE,": "]),Gt({style:"overflow: hidden; display: inline-block; width: 200px; height: 200px; border: 1px solid #888; text-align: center",ondragover:i,ondrop:function(e){N(this,le({src:ld(t=rd.get(e).id),style:"max-width: 100%; max-height: 100%"}))}},oa.CHARACTER_DRAG_ICON),Et(),wt({onclick:function(){e.value?t?(Cn(Jn.characterCreate(e.value,{name:{user:!1,data:e.value},"store-image-icon":{user:!1,data:t}}).then((({id:t,path:e})=>a.addItem(t,e))),o).then((()=>o.remove())).finally((()=>I(this,{disabled:!1}))),I(this,{disabled:!0})):o.alert(oa.ERROR,oa.CHARACTER_NEED_ICON):o.alert(oa.ERROR,oa.CHARACTER_NEED_NAME)}},oa.CHARACTER_CREATE)]);I(vn,o),Ni(e)}},oa.CHARACTER_NEW),a[Ki]]),Jn.waitCharacterDataChange().when((t=>{const e=t.setting["store-image-icon"];e&&qh.get(t.id)?.setIcon(parseInt(e.data))}))})),e})(),!0,Eh]:null]);const oT=`data:image/svg+xml,%3Csvg xmlns="${To}" viewBox="0 0 100 100"%3E%3Cpath d="M50,50 l50,25 l-50,25 l-50,-25 Z" fill="%2300f" /%3E%3Cpath d="M50,25 l50,25 l-50,25 l-50,-25 Z" fill="%230f0" /%3E%3Cpath d="M50,0 l50,25 l-50,25 l-50,-25 Z" fill="%23f00" /%3E%3C/svg%3E`;sn.push([5,()=>Hn?[oa.TAB_LAYERS,(()=>{let t=null,e=null;ta.wait((()=>{t&&(N(t.nameElem,oa.LAYER_GRID),t.name=oa.LAYER_GRID+""),e&&(N(e.nameElem,oa.LAYER_LIGHT),e.name=oa.LAYER_LIGHT+"")}));class i extends Qg{constructor(i,o,s,n=!1,r=!1){super(i,o,-1===o?oa.LAYER_GRID+"":-2===o?oa.LAYER_LIGHT+"":s),r&&I(this[Ki],{class:[W]}),o<0?(N(this[Ki],[this.nameElem,-2===o?Z:[]]),-1===o?t=this:-2===o&&(e=this)):(this.copier.remove(),void 0===a&&this.show()),n&&I(this[Ki],{class:[U]}),this[Ki].insertBefore(y([o<0?[]:Qa({title:oa.LAYER_TOGGLE_LOCK,class:P,onclick:()=>{E(this)}}),za({title:oa.LAYER_TOGGLE_VISIBILITY,class:R,onclick:()=>D(this)})]),this.nameElem),I(this[Ki],[Gt({class:z,onmouseup:()=>L(this,!1)}),Gt({class:j,onmouseup:()=>L(this,!0)})]),I(this.nameElem,{onmousedown:t=>m(this,t)})}show(){if(-1===this.id){const t=Me({type:"number",min:1,max:1e3,value:Math.round(Zd.width/Zd.gridSize),onkeypress:Fa}),e=Me({type:"number",min:1,max:1e3,value:Math.round(Zd.height/Zd.gridSize),onkeypress:Fa}),i=Ue([oa.MAP_SQUARE_TYPE_SQUARE,oa.MAP_SQUARE_TYPE_HEX_H,oa.MAP_SQUARE_TYPE_HEX_V].map(((t,e)=>xe({value:e,selected:Zd.gridType===e},t)))),o=Me({type:"number",min:10,max:1e3,value:Zd.gridSize}),s=Me({type:"color",value:Zd.gridColour.toHexString()}),a=Me({type:"number",min:0,max:10,value:Zd.gridStroke}),n=kn({"window-icon":oT,"window-title":oa.MAP_EDIT},[Vt(oa.MAP_EDIT),[["MAP_SQUARE_WIDTH",t],["MAP_SQUARE_HEIGHT",e],["MAP_SQUARE_TYPE",i],["MAP_SQUARE_SIZE",o],["MAP_SQUARE_COLOUR",s],["MAP_SQUARE_LINE",a]].map((([t,e])=>[Ka([oa[t],": "],e),Et()])),wt({onclick:function(){I(this,{disabled:!0});const r=Ti(parseInt(o.value),10,1e3,10);Cn(yi((()=>{const o={width:Ti(parseInt(t.value),1,1e3,1)*r,height:Ti(parseInt(e.value),1,1e3,1)*r,gridType:Ti(parseInt(i.value),0,2,0),gridSize:r,gridColour:_n(s.value),gridStroke:Ti(parseInt(a.value),0,10,0)};return KI(o,!1),Jn.setMapDetails(o).then((()=>n.remove())).finally((()=>I(this,{disabled:!1})))})),n)}},oa.SAVE)]);I(vn,n)}else-2===this.id?Gn(vn,oa.LAYER_LIGHT_COLOUR,Zd.lightColour,oT).then((t=>Cn(yi((()=>(JI(t,!1),Jn.setLightColour(t)))),vn))):this.isLocked()||(I(a?.[Ki],{class:{[js]:!1}}),I(this[Ki],{class:[js]}),a=this,VM(),I(HM.layer?.[Ki],{class:{[js]:!1}}),_I(HM.layer=sI(this.getPath())),I(HM.layer[Ki],{class:[js]}))}isLocked(){return sI(this.getPath())?.locked||this.parent.isLocked()}rename(){return A(this)}}class o extends Bg{id;open;constructor(t,e,s,a,n=!1,r=!1){super(t,e,s,{folders:{},items:{}});const l=a;if(this.open=this[Ki].firstChild,n&&I(this[Ki],{class:[U]}),r&&I(this[Ki],{class:[W]}),this.id=l.id??=1,l.children)for(const e of l.children)this.children.set(e.name,u(e)?new i(this,e.id,e.name,e.hidden,e.locked):new o(t,this,e.name,e,e.hidden));l.id>0&&(I(this.open.firstChild,[Gt({class:z,onmouseup:()=>L(this,!1)}),Gt({class:j,onmouseup:()=>L(this,!0)})]).insertBefore(y([Qa({title:oa.LAYER_TOGGLE_LOCK,class:P,onclick:t=>{E(this),t.preventDefault()}}),za({title:oa.LAYER_TOGGLE_VISIBILITY,class:R,onclick:t=>{D(this),t.preventDefault()}})]),I(this.nameElem,{onmousedown:t=>{this.open.open||m(this,t)}})),I(this[Ki],{class:[C]},Gt(this[Ki].childNodes)))}isLocked(){return sI(this.getPath())?.locked||(this.parent?.isLocked()??!1)}get sorter(){return Ji}rename(){return A(this)}}class s extends Fg{constructor(t){super(t,oa.TAB_LAYERS,yh,i,o)}get filter(){return!1}getLayer(t){const[e,i]=this.resolvePath(t);return e?i?e.children.get(i):e:null}}let a,n,r,l,M=0,g=()=>{const n=new s(Qd),r=t=>{const e={clientX:st,clientY:at};Bd.dispatchEvent(new MouseEvent("mouseout",e)),Bd.dispatchEvent(new MouseEvent("mouseleave",e)),t.show(),Bd.parentNode?.dispatchEvent(new MouseEvent("mouseover",e))};vM("layerPrev",oa.KEY_LAYER_PREV,"[",(()=>{let t;w(n.folder,(e=>{if(e.id>0&&!e.isLocked()){if(e===a)return!0;t=e}return!1})),t&&r(t)}))[0](),vM("layerNext",oa.KEY_LAYER_NEXT,"]",(()=>{let t=!1;w(n.folder,(e=>{if(e.id>0&&!e.isLocked()){if(t)return r(e),!0;t=e===a}return!1}))}))[0](),yh.waitLayerSetVisible().when((t=>I(n.getLayer(t)?.[Ki],{class:{[U]:!1}}))),yh.waitLayerSetInvisible().when((t=>I(n.getLayer(t)?.[Ki],{class:[U]}))),yh.waitLayerSetLock().when((t=>{const e=n.getLayer(t);e&&(a===e&&p(),I(e[Ki],{class:[W]}))})),yh.waitLayerSetUnlock().when((t=>I(n.getLayer(t)?.[Ki],{class:{[W]:!1}}))),yh.waitLayerPositionChange().when((t=>{const e=n.getLayer(t.from),i=n.getLayer(t.to);e&&i instanceof o&&(e.parent.children.delete(e.name+""),e.parent=i,t.position>=i.children.size?i.children.set(e.name+"",e):i.children.insertBefore(e.name+"",e,i.children.keyAt(t.position)))})),yh.waitLayerRename().when((t=>{const e=n.getLayer(t.path);e&&(e.parent.children.reSet(e.name+"",t.name),N(e.nameElem,e.name=t.name))})),yh.waitLayerSelect().when((t=>{const e=n.getLayer(t);e!==a&&e instanceof i&&e.show()})),N(x,{id:S},[wt({onclick:()=>{const t=Me({onkeypress:Fa}),e=kn({"window-icon":oT,"window-title":oa.LAYER_ADD},[Vt(oa.LAYER_ADD),Ka(oa.LAYER_NAME,t),Et(),wt({onclick:function(){I(this,{disabled:!0}),Cn(yi((()=>Jn.addLayer(t.value).then((t=>{th(t,!1),n.addItem(1,t),e.remove()})).finally((()=>I(this,{disabled:!1}))))),e)}},oa.LAYER_ADD)]);I(vn,e),Ni(t)}},oa.LAYER_ADD),n[Ki]]),g=()=>{t=null,e=null,a=void 0,n.setRoot(Qd)}};const[c,d]=lt(0,(t=>{r||(I(n[Ki],{class:[k]}),I(document.body,r=Be({class:v},n.name)),I(l,{class:[O]})),I(r,{style:{top:t.clientY+1+"px",left:t.clientX+M+"px"}})}),(()=>{T(),I(n[Ki],{class:{[k]:!1}}),n=void 0,r?.remove(),r=void 0,I(l,{class:{[O]:!1,[b]:!1}})})),[h,T]=nt("Escape",(()=>d())),u=t=>void 0===t.children,A=t=>{const e=Me({type:"text",value:t.name,onkeypress:Fa}),i=kn({"window-icon":oT,"window-title":oa.LAYER_RENAME},[Vt(oa.LAYER_RENAME),Ka([oa.LAYER_NAME,": "],e),Et(),wt({onclick:function(){I(this,{disabled:!0}),Cn(yi((()=>Jn.renameLayer(t.getPath(),e.value).then((({path:e,name:o})=>{t.parent.children.reSet(t.name+"",o),N(t.nameElem,t.name=o),oh(e,o,!1),i.remove()})).finally((()=>I(this,{disabled:!0}))))),i)}},oa.LAYER_RENAME)]);return I(vn,i),Ni(e),i},L=(t,e)=>{if(n&&(n.id>=0||t.parent===n.parent)){n.parent.children.delete(n.name+"");const i=n.getPath();let o,s=0;n.id>=0&&void 0!==t.open&&e&&t.open.open?(0===t.children.size?t.children.set(n.name+"",n):(t.children.insertBefore(n.name+"",n,t.children.keyAt(0)),s=t.children.position(n.name+"")),o=t.getPath()+"/",n.parent=t):(t.parent.children[e?"insertAfter":"insertBefore"](n.name+"",n,t.name+""),o=t.parent.getPath()+"/",s=t.parent.children.position(n.name+""),n.parent=t.parent),Cn(yi((()=>(ih(i,o,s,!1),Jn.moveLayer(i,o,s)))),vn)}},m=(t,e)=>{if(!n&&0===e.button){t.id<0&&I(l,{class:[b]}),M=t.nameElem.offsetLeft-e.clientX;for(let e=t.nameElem.offsetParent;e instanceof HTMLElement;e=e.offsetParent)M+=e.offsetLeft;n=t,c(),h()}},D=t=>yi((()=>{const e=!t[Ki].classList.toggle(U);return(e?Jn.showLayer:Jn.hideLayer)(XI(t.getPath(),e,!1))})),p=()=>{VM(),I(a?.[Ki],{class:{[js]:!1}}),I(HM.layer?.[Ki],{class:{[js]:!1}}),a=void 0,HM.layer=null},E=t=>yi((()=>{const e=t[Ki].classList.toggle(W);return e&&a&&t[Ki].contains(a[Ki])&&p(),(e?Jn.lockLayer:Jn.unlockLayer)(qI(t.getPath(),e,!1))})),w=(t,e)=>{for(const[,s]of t.children)if(s instanceof o){if(w(s,e))return!0}else if(s instanceof i&&e(s))return!0;return!1},f=new wi("lightToggle").wait((t=>I(document.body,{class:{[bs]:t}}))),x=l=Gt(Vt(oa.MAP_NONE_SELECTED)),[S,C,k,O,v,b,j,z,P,R,U,W,Q]=G(13),Z=_a({id:Q,class:Us,title:oa.LAYER_LIGHT_TOGGLE,onclick:()=>f.set(!f.value)}),B={[` .${js}`]:{"background-color":"#555"},[` .${O}`]:{[` .${z}:hover`]:{"border-top-color":"#fff"},[` .${j}:hover`]:{"border-bottom-color":"#fff"}}};return Y({[`#${S}`]:{" ul":{"list-style":"none","padding-left":"calc(2em + 4px)"},[` li, .${C}>div`]:{position:"relative"}},[`.${k}`]:{visibility:"hidden"},[`.${v}`]:{position:"absolute"},[`.${b} .${Gs} .${Gs} :is(.${j}, .${z})`]:{display:"none"},[`.${O}`]:{[` :is(.${j}, .${z})`]:{display:"block",height:"calc(50% - 1px)",position:"absolute",width:"100%"},[` .${j}`]:{top:"50%","border-bottom":"1px solid transparent",":hover":{"border-bottom-color":"#000"}},[` .${z}`]:{top:0,"border-top":"1px solid transparent",":hover":{"border-top-color":"#000"}}},[`.${P}`]:{left:"calc(-2em - 4px) !important"},[`.${P},.${R}`]:{display:"inline-block",width:"1em",height:"1em",position:"absolute",left:"calc(-1em - 4px)",cursor:"pointer"},[`.${U} .${R}`]:{"--invisible":"none"},[`.${W} .${P}`]:{"--locked":"block","--unlocked":"none"},[`.${js}`]:{"background-color":"#eee"},[`#${Qd} .${Rs}`]:{"grid-template-columns":"auto 1em 1em"},[`.${bs} #${Q}`]:{"--off":"#000"}}),_("@media (prefers-color-scheme: light)",{[`:root.${vs}`]:B}),_("@media (prefers-color-scheme: dark)",{[`:root:not(.${vs})`]:B}),Va((()=>g())),x})(),!0,oT]:null]);const sT=`data:image/svg+xml,%3Csvg xmlns="${To}" viewBox="0 0 100 100"%3E%3Cg stroke-width="2" fill="none"%3E%3Cpath d="M30,1 L70,5 V99 L30,95" fill="%238f0" /%3E%3Cpath d="M30,55 h0.5 L69.5,48 H70 M40,53 L60,96 v2" stroke="%23333" stroke-width="10" /%3E%3Cpath d="M1,5 L30,1 70,5 99,1 M1,99 L30,95 70,99 99,95" stroke="%23eee" /%3E%3Cpath d="M30,1 L1,5 V99 L30,95 M70,5 L99,1 V95 L70,99" stroke="%23aaa" fill="%234a0" /%3E%3Cpath d="M2,40 Q10,40 30,35 V2 L2,6 Z M70,40 Q80,30 98,30 V2 L70,6 Z" fill="%2300a" /%3E%3Cpath d="M30,35 C50,30 50,50 70,40 V6 L30,2 Z" fill="%2300f" /%3E%3Cpath d="M2,75 h5 L26,55 H30 M70,48 h3 L96,37 H98" stroke="%23000" stroke-width="10" /%3E%3C/g%3E%3C/svg%3E`,aT=(t,e,i,o)=>{if(e){I(e[Ki],{class:{[i]:!1}});for(let t=e.parent;t;t=t.parent)I(t[Ki],{class:{[o]:!1}})}if(t){I(t[Ki],{class:[i]});for(let e=t.parent;e;e=e.parent)I(e[Ki],{class:[o]})}},nT=new fi("selectedMap"),rT=new ki("mapfolder"),[lT,MT,gT,cT,dT,IT]=G(6),hT=new ki("map");let TT=null,uT=null;class AT extends Zg{constructor(t,e,i){super(t,e,i,hT),I(this.image,{src:sT}),I(this[Ki],{class:[lT]}),this[Ki].insertBefore(Oa({class:IT,title:oa.MAP_SET_USER,onclick:()=>{this.setUserMap(),Jn.setUserMap(e)}}),this[Ki].firstChild)}show(){if(uT!==this){let t=this,e=uT;const i=()=>{aT(t,e,dT,cT),uT=t;const o=t.id;return yi((()=>Jn.setCurrentMap(o).then((()=>Bh(o))))),nT.set(o),[t,e]=[e,t],i};uT?SI.add(i(),oa.UNDO_MAP_LOAD):i()}}rename(){return this[Ki].classList.contains(dT)||this[Ki].classList.contains(MT)?vn.appendChild(kn({"window-icon":sT,"window-title":oa.INVALID_ACTION},Kt(oa.INVALID_RENAME))):super.rename()}remove(){return this[Ki].classList.contains(dT)||this[Ki].classList.contains(MT)?vn.appendChild(kn({"window-icon":sT,"window-title":oa.INVALID_ACTION},Kt(oa.INVALID_REMOVE))):super.remove()}setUserMap(){aT(this,TT,MT,gT),TT=this}}class LT extends Hg{constructor(t,e,i,o){super(t,e,i,o,hT,rT)}rename(t){return this[Ki].classList.contains(cT)||this[Ki].classList.contains(gT)?vn.appendChild(kn({"window-icon":sT,"window-title":oa.INVALID_ACTION},Kt(oa.INVALID_RENAME_CONTAIN))):super.rename(t)}remove(t){return this[Ki].classList.contains(cT)||this[Ki].classList.contains(gT)?vn.appendChild(kn({"window-icon":sT,"window-title":"Invalid Action"},Kt(oa.INVALID_REMOVE_CONTAIN))):super.remove(t)}}class mT extends Fg{moveItem(t,e){uT&&uT.getPath()===t?(aT(null,uT,dT,cT),super.moveItem(t,e),aT(uT,null,dT,cT)):super.moveItem(t,e)}removeItem(t){return uT&&uT.getPath()===t&&(aT(null,uT,dT,cT),Bh(0)),super.removeItem(t)}moveFolder(t,e){const[i]=this.resolvePath(t);if(i&&i[Ki].classList.contains(cT)){aT(null,uT,dT,cT);const i=super.moveFolder(t,e);return aT(uT,null,dT,cT),i}return super.moveFolder(t,e)}removeFolder(t){const[e]=this.resolvePath(t);return e&&e[Ki].classList.contains(cT)&&(aT(null,uT,dT,cT),Bh(0)),super.removeFolder(t)}}sn.push([4,()=>Hn?[oa.TAB_MAPS,(()=>{const t=Jn.maps,e=Gt(on()),i=P(),o={[` .${dT}`]:{"background-color":"#555"},[` .${cT}>details>summary`]:{"background-color":"#600"},[` .${gT}>details>summary`]:{"background-color":"#400"}};return Y({[`#${i}`]:{" ul":{"list-style":"none",margin:0,"padding-left":"calc(1em + 4px)"}," li>svg:first-child":{display:"inline-block",width:"1em",height:"1em",margin:"0 2px"},[` li.${lT}>svg:first-child`]:{cursor:"pointer"},[` li.${MT}>svg:first-child`]:{"--map-selected":"block"},[` .${Rs}`]:{"grid-template-columns":"auto 1em 1em 1em"}},[`.${gT}>details>summary`]:{"background-color":"#ccffcc"},[`.${cT}>details>summary`]:{"background-color":"#f8f8f8"},[`.${dT}`]:{"background-color":"#eee"},[`.${IT}`]:{position:"absolute",left:0}}),_("@media (prefers-color-scheme: light)",{[`:root.${vs}`]:o}),_("@media (prefers-color-scheme: dark)",{[`:root:not(.${vs})`]:o}),Promise.all([t.list(),Jn.getUserMap()]).then((([o,s])=>{const a=new mT(o,oa.TAB_MAPS,t,AT,LT),n=(t,e)=>{for(const[,i]of t.children)if(i instanceof Bg){const t=n(i,e);if(t)return t}else if(i.id===e)return i},r=(t,e=!1)=>{const i=n(a.folder,t);i&&(i.setUserMap(),e&&i.show())};a.windowIcon=sT,Jn.waitCurrentUserMap().when(r);let l=!0;if(nT.value>0){const t=n(a.folder,nT.value);t&&(t.show(),l=!1)}s>0&&r(s,l),N(e,{id:i},[wt({onclick:()=>{const t=Me({type:"text",onkeypress:Fa}),e=Me({type:"number",min:10,max:1e3,value:30,onkeypress:Fa}),i=Me({type:"number",min:10,max:1e3,value:30,onkeypress:Fa}),o=Ue([oa.MAP_SQUARE_TYPE_SQUARE,oa.MAP_SQUARE_TYPE_HEX_H,oa.MAP_SQUARE_TYPE_HEX_V].map(((t,e)=>xe({value:e},t)))),s=Me({type:"number",min:1,max:1e3,value:100}),n=Me({type:"color"}),r=Me({type:"number",min:0,max:10,value:1}),l=kn({"window-icon":sT,"window-title":oa.MAP_NEW},[Vt(oa.MAP_NEW),Ka([oa.MAP_NAME,": "],t),Et(),Ka([oa.MAP_SQUARE_WIDTH,": "],e),Et(),Ka([oa.MAP_SQUARE_HEIGHT,": "],i),Et(),Ka([oa.MAP_SQUARE_TYPE,": "],o),Et(),Ka([oa.MAP_SQUARE_SIZE,": "],s),Et(),Ka([oa.MAP_SQUARE_COLOUR,": "],n),Et(),Ka([oa.MAP_SQUARE_LINE,": "],r),Et(),wt({onclick:function(){I(this,{disabled:!0});const M=Ti(parseInt(s.value),1,1e3,1);Cn(Jn.newMap({name:t.value,width:Ti(parseInt(e.value),1,1e3,1)*M,height:Ti(parseInt(i.value),1,1e3,1)*M,gridType:Ti(parseInt(o.value),0,2,0),gridSize:M,gridColour:_n(n.value),gridStroke:Ti(parseInt(r.value),0,10,0)}),l).then((({id:t,name:e})=>{a.addItem(t,e),l.remove()})).finally((()=>I(this,{disabled:!1})))}},oa.MAP_ADD)]);I(vn,l),Ni(t)}},oa.MAP_NEW),a[Ki]])})),e})(),!0,sT]:null]);class yT{id;volume;repeat;audioElement=null;#vt=-1;#ut;constructor(t,e){this.id=e.id,this.volume=e.volume,this.repeat=e.repeat,this.#ut=t}setVolume(t){this.volume=t,this.updateVolume()}setRepeat(t){this.repeat=t,this.waitPlay()}play(){this.audioElement?this.waitPlay():this.audioElement=At({src:Md(this.id),onloadeddata:m((()=>{this.updateVolume(),this.waitPlay()}),T),onended:()=>this.waitPlay()})}updateVolume(){this.audioElement&&(this.audioElement.volume=this.volume*this.#ut.volume/65025)}waitPlay(){if(this.audioElement){-1!==this.#vt&&(clearTimeout(this.#vt),this.#vt=-1);const t=fT(),e=this.audioElement.duration;if(-1===this.repeat)t<this.#ut.playTime+e?(this.audioElement.currentTime=t-this.#ut.playTime,this.audioElement.play()):(this.stop(),this.#ut.checkPlayState());else{const i=e+this.repeat,o=(t-this.#ut.playTime)%i;o<e?(this.audioElement.currentTime=o,this.audioElement.play()):(this.audioElement.pause(),this.#vt=setTimeout((()=>{this.audioElement?.play(),this.#vt=-1}),1e3*(i-o)))}}}stop(){this.audioElement&&(this.audioElement.pause(),this.audioElement=null,-1!==this.#vt&&(clearTimeout(this.#vt),this.#vt=-1))}remove(){const t=this.#ut.tracks.findIndex((t=>t===this));return this.#ut.tracks.splice(t,1),this.stop(),t}}class NT{tracks;volume;playTime;currentTime=0;constructor(t){this.tracks=[];for(const e of t.tracks)this.tracks.push(new yT(this,e));this.volume=t.volume,this.playTime=t.playTime,this.playTime&&setTimeout((()=>this.play(this.playTime)))}setVolume(t){this.volume=t,this.updateVolume()}play(t){if(t){this.playTime=t;for(const t of this.tracks)t.play()}else this.stop()}pause(){this.stop()}stop(){this.playTime=0;for(const t of this.tracks)t.stop()}checkPlayState(){if(this.playTime){for(const t of this.tracks)if(null!==t.audioElement)return;this.stop()}}updateVolume(){for(const t of this.tracks)t.updateVolume()}remove(){for(const t of this.tracks)t.stop()}}const DT=()=>new Promise((t=>At({src:"data:audio/wav;base64,UklGRiwAAABXQVZFZm10IBAAAAABAAIARKwAABCxAgAEABAAZGF0YQgAAAAAAAAAAAD//w=="}).play().then(t).catch((()=>I(document.body,Gt({style:"position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.75); cursor: pointer; z-index: 2",onclick:function(){this.remove(),t()}},Gt({style:"display: flex; align-items: center; justify-content: center; height: 100%; font-size: 3em; color: #fff"},oa.MUSIC_ENABLE))))))),pT=`data:image/svg+xml,%3Csvg xmlns="${To}" viewBox="0 0 100 100"%3E%3Cdefs%3E%3Cmask id="recordMask"%3E%3Cpath d="M0,10 L50,50 0,90 M100,10 L50,50 100,90" fill="%23fff" /%3E%3C/mask%3E%3C/defs%3E%3Cg fill="none" stroke="%23fff"%3E%3Ccircle cx="50" cy="50" r="30" stroke="%23000" stroke-width="40" /%3E%3Ccircle cx="50" cy="50" r="20" stroke="%23111" stroke-width="5" /%3E%3Ccircle cx="50" cy="50" r="10" stroke="%23a00" stroke-width="15" /%3E%3Ccircle cx="50" cy="50" r="49.5" stroke-width="1" /%3E%3Cg stroke-width="0.25" mask="url(%23recordMask)"%3E%3Ccircle cx="50" cy="50" r="45" /%3E%3Ccircle cx="50" cy="50" r="42" /%3E%3Ccircle cx="50" cy="50" r="39" /%3E%3Ccircle cx="50" cy="50" r="36" /%3E%3Ccircle cx="50" cy="50" r="33" /%3E%3Ccircle cx="50" cy="50" r="30" /%3E%3Ccircle cx="50" cy="50" r="27" /%3E%3C/g%3E%3C/g%3E%3C/svg%3E`,ET=(t,e="",i=[],o=255)=>({id:t,name:e,tracks:i,volume:o,playTime:0,playing:!1}),wT=t=>{Jn.waitMusicPackVolume().when((e=>t.get(e.id)?.setVolume(e.volume))),Jn.waitMusicPackPlay().when((e=>t.get(e.id)?.play(e.playTime))),Jn.waitMusicPackStop().when((e=>t.get(e)?.stop())),Jn.waitMusicPackTrackRemove().when((e=>t.get(e.id)?.tracks[e.track]?.remove())),Jn.waitMusicPackTrackVolume().when((e=>t.get(e.id)?.tracks[e.track]?.setVolume(e.volume))),Jn.waitMusicPackTrackRepeat().when((e=>t.get(e.id)?.tracks[e.track]?.setRepeat(e.repeat)))},fT=()=>$n+Date.now()/1e3,xT=new ki("musicpack");let ST=t=>{};ir.then((()=>{Hn?(_c("musicpack",((t,e,i)=>{const o=e.next(!0).value;if(o&&Vg(o)&&o.attr){const s=parseInt(o.attr);isNaN(s)||I(t,Xg(Be({class:Ys,onclick:t=>{0===t.button&&ST(s)}}),e,i,o.tagName))}})),sn.push([3,()=>[oa.TAB_MUSIC_PACKS,(()=>{const t=Gt(on()),e=le({class:"imageIcon",src:pT}),[i,o]=G(2);return Y({[`#${i},.${o}`]:{margin:0,"padding-left":0,"list-style":"none"},[`#${i}>li`]:{">span":{cursor:"pointer"},display:"grid","grid-template-columns":"1em auto 1em 1em 1em"},[`.${o} li`]:{">svg":{"margin-right":0,"margin-left":"0.5em"},display:"grid","grid-template-columns":"auto 10em 5em 2em"}}),DT().then(Jn.musicPackList).then((s=>{class a extends yT{[Ki];#bt;#jt;#zt;cleanup;constructor(t,e){super(t,e),this[Ki]=he([this.#bt=Be(e.name??[oa.MUSIC_TRACK," ",e.id+""]),this.#jt=Me({type:"range",max:255,value:this.volume=e.volume,onchange:()=>{Jn.musicPackTrackVolume(t.id,t.tracks.findIndex((t=>t===this)),this.volume=Ti(parseInt(this.#jt.value),0,255,255)),this.updateVolume()}}),this.#zt=Me({type:"number",min:-1,value:this.repeat=e.repeat,onchange:()=>Jn.musicPackTrackRepeat(t.id,t.tracks.findIndex((t=>t===this)),this.repeat=Ti(parseInt(this.#zt.value),-1))}),pa({class:Us,title:oa.MUSIC_TRACK_REMOVE,onclick:()=>t.window.confirm(oa.MUSIC_TRACK_REMOVE,oa.MUSIC_TRACK_REMOVE_LONG).then((e=>{e&&Jn.musicPackTrackRemove(t.id,this.remove())}))})]),this.cleanup=e.name?()=>{}:td(e.id,(t=>N(this.#bt,t)))}setVolume(t){super.setVolume(t),this.#jt.value=t+""}setRepeat(t){super.setRepeat(t),this.#zt.value=t+""}remove(){return this.cleanup(),super.remove()}}class n extends NT{tracks;id;name;[Ki];#bt;#Yt;#jt;#_t=Lo(d);#Pt=Lo(h);#Gt;#Rt;#Ut;#Wt=0;window;#Et;#Qt;constructor(t,i){super(i),this.id=t,this.name=i.name,this.tracks=new Io(gi({class:o}),Ji);for(const t of i.tracks)this.tracks.push(new a(this,t));this.#Rt=Ds(0===this.playTime?oa.MUSIC_PLAY:oa.MUSIC_PAUSE),this.#Et=xT.register(this),this.#Qt=Gc.register((()=>t=>`[musicpack=${this.id}]${t||this.name}[/musicpack]`));const s=t=>{xT.set(t,this.#Et,e),Gc.set(t,this.#Qt)};this.window=kn({"window-icon":pT,"window-title":oa.MUSIC_WINDOW_TITLE,"hide-minimise":!1,ondragover:t=>{0===this.currentTime&&T(t)},ondrop:t=>{if(nd.is(t)){const{id:e,name:i}=nd.get(t);this.tracks.push(new a(this,{id:e,volume:255,repeat:0,name:i})),Jn.musicPackTrackAdd(this.id,[e])}else ad.is(t)&&od(ad.asForm(t,"asset"),this.window).then((t=>{const e=[];for(const{id:i,name:o}of t)this.tracks.push(new a(this,{id:i,volume:255,repeat:0,name:o})),e.push(i);Jn.musicPackTrackAdd(this.id,e)})).catch(er)}},[this.#Yt=Vt({draggable:"true",ondragstart:s},this.name),As({style:"width: 2em",viewBox:"0 0 90 90"},[this.#Rt,this.#Gt=rs({d:0===this.playTime?g:c,fill:"currentColor",stroke:"none","fill-rule":"evenodd"},[this.#_t,this.#Pt]),ds({width:"100%",height:"100%","fill-opacity":0,onclick:()=>{this.playTime?this.pause(!0):this.play(fT()-this.#Wt,!0)}})]),Ca({style:"width: 2em; height: 2em",title:oa.MUSIC_STOP,onclick:()=>this.stop(!0)}),Et(),this.#jt=Me({type:"range",max:255,value:i.volume,onchange:()=>{Jn.musicPackSetVolume(this.id,this.volume=Ti(parseInt(this.#jt.value),0,255,255)),this.updateVolume()}}),this.tracks[Ki],Gt({style:"text-align: center"},oa.MUSIC_DROP)]),this[Ki]=he({class:Rs,draggable:"true",ondragstart:s},[this.#Ut=ma({style:"width: 1em; height: 1em; visibility: hidden"}),this.#bt=Be({onclick:()=>vn.addWindow(this.window),onauxclick:t=>{1===t.button&&(this.playTime?this.stop(!0):this.play(fT()-this.#Wt,!0))}},this.name),wa({title:oa.MUSIC_RENAME,class:Us,onclick:()=>vn.prompt(oa.MUSIC_RENAME,oa.MUSIC_RENAME_LONG,this.name).then((t=>{t&&t!==this.name&&Jn.musicPackRename(this.id,t).then((t=>{t!==this.name&&(this.setName(t),M.sort())}))}))}),Ia({title:oa.MUSIC_COPY,class:Us,onclick:()=>vn.prompt(oa.MUSIC_COPY,oa.MUSIC_COPY_LONG,this.name).then((t=>{t&&Jn.musicPackCopy(this.id,t).then((({id:t,name:e})=>M.set(t,new n(t,ET(t,e,this.tracks.map((t=>({id:t.id,volume:t.volume,repeat:t.repeat}))),this.volume)))))}))}),pa({title:oa.MUSIC_REMOVE,class:Us,onclick:()=>vn.confirm(oa.MUSIC_REMOVE,oa.MUSIC_REMOVE_LONG).then((t=>{t&&(this.remove(),Jn.musicPackRemove(this.id))}))})])}transfer(){return{id:this.id,name:this.name}}setName(t){N(this.#Yt,t),N(this.#bt,this.name=t),M.sort()}setVolume(t){super.setVolume(t),this.#jt.value=t+""}play(t,e=!1){super.play(t),document.body.contains(this.#Pt)?this.#Pt.beginElement():I(this.#Gt,{d:c}),I(this.#Ut,{style:{visibility:void 0}}),N(this.#Rt,oa.MUSIC_PAUSE),e&&Jn.musicPackPlay(this.id,Math.round(t)).then((t=>this.playTime=t)),M.sort()}pause(t=!1){const e=fT()-this.playTime;this.stop(t),this.#Wt=e}stop(t=!1){super.stop(),this.#Wt=0,document.body.contains(this.#_t)?this.#_t.beginElement():I(this.#Gt,{d:g}),I(this.#Ut,{style:{visibility:"hidden"}}),N(this.#Rt,oa.MUSIC_PLAY),t&&Jn.musicPackStop(this.id),M.sort()}remove(){super.remove(),this.window.remove();for(const t of this.tracks)t.cleanup();M.delete(this.id),xT.deregister(this.#Et),Gc.deregister(this.#Qt)}}const r=(t,e)=>Xi(t.name,e.name),l=(t,e)=>e.playTime-t.playTime||r(t,e),M=new ho(gi({id:i})),g="M75,15 c-15,-15 -45,-15 -60,0 c-15,15 -15,45 0,60 c15,15 45,15 60,0 c15,-15 15,-45 0,-60 z M35,25 v40 l30,-20 l0,0 z",c="M35,15 c0,0 -20,0 -20,0 c0,0 0,60 0,60 c0,0 20,0 20,0 c0,0 0,-60 0,-60 z M55,15 v60 l20,0 l0,-60 z",d={attributeName:"d",to:g,dur:"0.2s",begin:"click",fill:"freeze"},h={attributeName:"d",to:c,dur:"0.2s",begin:"click",fill:"freeze"},T=vi({link:[nd],copy:[ad]});xg.wait((t=>M.sort(t?l:r)));for(const t of s)M.set(t.id,new n(t.id,t));N(t,[wt({onclick:()=>vn.prompt(oa.MUSIC_ADD,oa.MUSIC_ADD_NAME).then((t=>{t&&Jn.musicPackAdd(t).then((({id:t,name:e})=>M.set(t,new n(t,ET(t,e)))))}))},oa.MUSIC_ADD),M[Ki]]),Jn.waitMusicPackAdd().when((({id:t,name:e})=>M.set(t,new n(t,ET(t,e))))),Jn.waitMusicPackRename().when((t=>M.get(t.id)?.setName(t.name))),Jn.waitMusicPackRemove().when((t=>{const e=M.get(t);e&&(e.remove(),M.delete(t))})),Jn.waitMusicPackCopy().when((({id:t,name:e})=>{const i=M.get(t);i&&M.set(t,new n(t,ET(t,e,i.tracks.map((t=>({id:t.id,volume:t.volume,repeat:t.repeat}))),i.volume)))})),Jn.waitMusicPackTrackAdd().when((t=>{const e=M.get(t.id);if(e)for(const i of t.tracks)e.tracks.push(new a(e,{id:i,volume:255,repeat:0}))})),wT(M),ST=t=>{const e=M.get(t);e&&vn.addWindow(e.window)}})),t})(),!0,pT]])):(DT().then(Jn.musicPackList).then((t=>{const e=new Map;for(const i of t)e.set(i.id,new NT(i));Jn.waitMusicPackAdd().when((({id:t})=>e.set(t,new NT(ET(t))))),Jn.waitMusicPackRemove().when((t=>{const i=e.get(t);i&&(i.remove(),e.delete(t))})),Jn.waitMusicPackCopy().when((({id:t,newID:i})=>{const o=e.get(t);if(o){const t=[];for(const e in o.tracks)t.push({id:o.tracks[e].id,volume:o.tracks[e].volume,repeat:o.tracks[e].repeat});e.set(i,new NT({id:i,name:"",tracks:t,volume:o.volume,playTime:0}))}})),Jn.waitMusicPackTrackAdd().when((t=>{const i=e.get(t.id);if(i)for(const e of t.tracks)i.tracks.push(new yT(i,{id:e,volume:255,repeat:0}))})),wT(e)})),_c("musicpack",bc))})),ir.then((()=>{if(!Hn)return;let t=Pn,e=new zn(0,0,0,255),i=null;const[o,s,a]=Array.from({length:3},((t,e)=>Me({name:"drawShape",type:"radio",checked:!e,class:Os}))),n=Me({type:"checkbox",class:Os}),r=()=>n.click(),[l,M]=nt("Shift",r,r),g=Me({style:"width: 5em",type:"number",min:0,max:100,value:1}),[c,d]=lt(0,(t=>{if(!i)return void d();const[e,o]=yI(t.clientX,t.clientY,n.checked);I(i,{x:Math.min(E[0],e),y:Math.min(E[1],o),width:Math.abs(E[0]-e),height:Math.abs(E[1]-o)})}),(o=>{if(o.isTrusted){const[i,s]=yI(o.clientX,o.clientY,n.checked),{layer:a}=HM;a?sh(a.path,{id:0,x:Math.min(E[0],i),y:Math.min(E[1],s),width:Math.abs(E[0]-i),height:Math.abs(E[1]-s),rotation:0,snap:n.checked,fill:t,stroke:e,strokeWidth:Ti(parseInt(g.value),0,100),tokenType:1,lightColours:[],lightStages:[],lightTimings:[],tokenData:{}}):vn.alert(oa.ERROR,oa.TOOL_DRAW_ERROR)}i?.remove(),i=null,m()})),[h,T]=lt(0,(t=>{if(!i)return void T();const[e,o]=yI(t.clientX,t.clientY,n.checked);I(i,{rx:Math.abs(E[0]-e),ry:Math.abs(E[1]-o)})}),(o=>{if(o.isTrusted){const[i,s]=yI(o.clientX,o.clientY,n.checked),{layer:a}=HM;if(a){const o=Math.abs(E[0]-i),r=Math.abs(E[1]-s);sh(a.path,{id:0,x:E[0]-o,y:E[1]-r,width:2*o,height:2*r,rotation:0,snap:n.checked,fill:t,stroke:e,strokeWidth:Ti(parseInt(g.value),0,100),tokenType:1,isEllipse:!0,lightColours:[],lightStages:[],lightTimings:[],tokenData:{}})}else vn.alert(oa.ERROR,oa.TOOL_DRAW_ERROR)}i?.remove(),i=null,m()})),[u,A]=rt((t=>{if(!i)return void A();const[e,o]=yI(t.clientX,t.clientY,n.checked);I(i,{points:E.reduce(((t,e,i)=>i%2==0?`${t} ${E[i]},${E[i+1]}`:t),"")+` ${e},${o}`})})),[L,m]=nt("Escape",(()=>{d(),T()})),[y,N]=nt("Escape",(()=>{i&&(2===E.length?(i.remove(),i=null,A()):(E.pop(),E.pop(),I(i,{points:E.reduce(((t,e,i)=>i%2==0?`${t} ${E[i]},${E[i+1]}`:t),"")})))})),[D,p]=rt((t=>{const[e,i]=yI(t.clientX,t.clientY,n.checked);I(bd,{transform:`translate(${e-10/mI.zoom}, ${i-10/mI.zoom}) scale(${1/mI.zoom})`})})),E=[0,0],w=As({viewBox:"0 0 70 70",fill:"none",stroke:"currentColor"},[Ds(oa.TOOL_DRAW),gs({points:"51,7 58,0 69,11 62,18 51,7 7,52 18,63 62,18","stroke-width":2}),rs({d:"M7,52 L1,68 L18,63 M53,12 L14,51 M57,16 L18,55"})]),f=uo(w);kd({name:oa.TOOL_DRAW,id:"tool_draw",icon:w,options:Gt([Zt([Ie(oa.TOOL_DRAW_SHAPE),Ka(o,[oa.TOOL_DRAW_RECT,": "]),Et(),Ka(s,[oa.TOOL_DRAW_ELLIPSE,": "]),Et(),Ka(a,[oa.TOOL_DRAW_POLYGON,": "])]),Ka(n,[oa.TOOL_DRAW_SNAP,": "]),Et(),Ka([oa.TOOL_DRAW_STROKE_WIDTH,": "],g),Et(),Ka([oa.TOOL_DRAW_STROKE_COLOUR,": "],Rn(Rd,oa.TOOL_DRAW_STROKE_COLOUR,(()=>e),(t=>e=t),f)),Et(),Ka([oa.TOOL_DRAW_FILL_COLOUR,": "],Rn(Rd,oa.TOOL_DRAW_FILL_COLOUR,(()=>t),(e=>t=e),f))]),mapMouseOver:()=>(D(),!1),mapMouse0:r=>{const{layer:l}=HM,[M,d]=yI(r.clientX,r.clientY,n.checked),T=Ti(parseInt(g.value),0,100);return l&&(o.checked?(E[0]=M,E[1]=d,i?.remove(),I(l[Ki],i=ds({x:M,y:d,fill:t,stroke:e,"stroke-width":T})),c(),L()):s.checked?(E[0]=M,E[1]=d,i?.remove(),I(l[Ki],i=wo({cx:M,cy:d,fill:t,stroke:e,"stroke-width":T})),h(),L()):a.checked&&(i instanceof SVGPolygonElement?(E.push(M,d),I(i,{points:E.reduce(((t,e,i)=>i%2==0?`${t} ${E[i]},${E[i+1]}`:t),"")})):(E.splice(0,E.length,M,d),i?.remove(),I(l[Ki],i=Ms({stroke:e,fill:t,"stroke-width":T})),u(),y()))),!1},mapMouse2:o=>{const{layer:s}=HM;if(s&&i instanceof SVGPolygonElement&&E.length>=4){const[a,r]=yI(o.clientX,o.clientY,n.checked);E.push(a,r);let l=1/0,M=1/0,c=-1/0,d=-1/0;const I=E.reduce(((t,e,i)=>{if(i%2==0){const e=E[i],o=E[i+1];t.push([e,o]),e<l&&(l=e),o<M&&(M=o),e>c&&(c=e),o>d&&(d=o)}return t}),[]).map((([t,e])=>({x:t-l,y:e-M})));sh(s.path,{id:0,x:l,y:M,width:c-l,height:d-M,rotation:0,snap:n.checked,fill:t,stroke:e,strokeWidth:Ti(parseInt(g.value),0,100),tokenType:2,points:I,lightColours:[],lightStages:[],lightTimings:[],tokenData:{}}),A(),N(),i.remove(),i=null}return!1},set:()=>{VM(),I(n,{checked:Lg.value}),l(),I(Bd,{style:{cursor:"none"}},bd)},unset:()=>{M(),d(),T(),A(),m(),N(),p(),bd.remove(),I(Bd,{style:{cursor:void 0}})}})})),ir.then((()=>{if(!Hn)return;const t=Me({name:"maskColour",type:"radio",class:Os,checked:!0}),[e,i,o,s]=Array.from({length:4},((t,e)=>Me({name:"maskShape",type:"radio",class:Os,checked:!e}))),a=Me({type:"checkbox",class:Os}),n=()=>a.click(),[r,l]=nt("Shift",n,n),[M,g]=lt(0,(t=>{if(!f)return void g();const[e,i]=yI(t.clientX,t.clientY,a.checked);I(f,{x:Math.min(p[0],e),y:Math.min(p[1],i),width:Math.abs(p[0]-e),height:Math.abs(p[1]-i)})}),(t=>{if(t.isTrusted){const[e,i]=yI(t.clientX,t.clientY,a.checked);uh([w?0:1,Math.min(p[0],e),Math.min(p[1],i),Math.abs(p[0]-e),Math.abs(p[1]-i)])}f?.remove(),f=null,A()})),[c,d]=lt(0,(t=>{if(!f)return void d();const[e,i]=yI(t.clientX,t.clientY,a.checked);I(f,{rx:Math.abs(p[0]-e),ry:Math.abs(p[1]-i)})}),(t=>{if(t.isTrusted){const[e,i]=yI(t.clientX,t.clientY,a.checked);uh([w?2:3,p[0],p[1],Math.abs(p[0]-e),Math.abs(p[1]-i)])}f?.remove(),f=null,A()})),[h,T]=rt((t=>{if(!f)return void T();const[e,i]=yI(t.clientX,t.clientY,a.checked);I(f,{points:p.reduce(((t,e,i)=>i%2==0?`${t} ${p[i]},${p[i+1]}`:t),"")+` ${e},${i}`})})),[u,A]=nt("Escape",(()=>{g(),d()})),[L,m]=nt("Escape",(()=>{f&&(2===p.length?(f.remove(),f=null,T()):(p.pop(),p.pop(),I(f,{points:p.reduce(((t,e,i)=>i%2==0?`${t} ${p[i]},${p[i+1]}`:t),""),stroke:2===p.length?w?"#fff":"#000":void 0})))})),y=(t,e)=>{const[i]=KM.at(t,e);if(i!==x)if(S?.remove(),i){switch(x=i,i[0]){case 0:case 1:S=ds({x:i[1],y:i[2],width:i[3],height:i[4]});break;case 2:case 3:S=wo({cx:i[1],cy:i[2],rx:i[3],ry:i[4]});break;case 4:case 5:S=Ms({points:i.reduce(((t,e,o)=>o%2==1?`${t} ${i[o]},${i[o+1]}`:t),"")})}I(Bd,I(S,{fill:"none",stroke:"#f00"}))}else S=x=null},[N,D]=rt((t=>{const[e,i]=yI(t.clientX,t.clientY,a.checked);I(bd,{transform:`translate(${e-10/mI.zoom}, ${i-10/mI.zoom}) scale(${1/mI.zoom})`}),s.checked?y(e,i):(S?.remove(),x=null)})),p=[0,0],E=new Ci("maskOpacity",1,(t=>"number"==typeof t&&t>=0&&t<=1));let w=!1,f=null,x=null,S=null;E.wait((t=>I(document.body,{style:{"--maskOpacity":t}}))),kd({name:oa.TOOL_MASK,id:"tool_mask",icon:As({viewBox:"0 0 60 50"},[Ds(oa.TOOL_MASK),rs({d:"M0,0 Q30,15 60,0 Q30,100 0,0 M32,20 q9,-10 18,0 q-9,-3 -18,0 M10,20 q9,-10 18,0 q-9,-3 -18,0 M20,35 q10,5 20,0 q-10,10 -20,0",stroke:"none",fill:"currentColor","fill-rule":"evenodd"})]),options:Gt([Ka([oa.TOOL_MASK_OPACITY,": "],Me({type:"range",min:0,max:1,step:.05,value:E.value,oninput:function(){E.set(parseFloat(this.value))}})),Zt([Ie(oa.TOOL_MASK_DRAW_TYPE),Ka(t,[oa.TOOL_MASK_OPAQUE,": "]),Et(),Ka(Me({name:"maskColour",type:"radio",class:Os}),[oa.TOOL_MASK_TRANSPARENT,": "])]),Zt([Ie(oa.TOOL_MASK_DRAW_SHAPE),Ka(e,[oa.TOOL_DRAW_RECT,": "]),Et(),Ka(i,[oa.TOOL_DRAW_ELLIPSE,": "]),Et(),Ka(o,[oa.TOOL_DRAW_POLYGON,": "]),Et()]),Ka(s,[oa.TOOL_MASK_REMOVE,": "]),Et(),Ka(a,[oa.TOOL_DRAW_SNAP,": "]),Et(),wt({onclick:()=>vn.confirm(oa.ARE_YOU_SURE,oa.TOOL_MASK_CLEAR_CONFIRM).then((e=>{e&&Lh({baseOpaque:t.checked,masks:[]})}))},oa.TOOL_MASK_CLEAR)]),mapMouseOver:()=>(N(),!1),mapMouse0:n=>{const[r,l]=yI(n.clientX,n.clientY,a.checked);if(s.checked){const[,t]=KM.at(r,l);-1!==t&&(Ah(t),y(r,l))}else if(e.checked)p[0]=r,p[1]=l,f?.remove(),I(KM[Ki],f=ds({x:r,y:l,fill:(w=t.checked)?"#fff":"#000"})),M(),u();else if(i.checked)p[0]=r,p[1]=l,f?.remove(),I(KM[Ki],f=wo({cx:r,cy:l,fill:(w=t.checked)?"#fff":"#000"})),c(),u();else if(o.checked)if(f instanceof SVGPolygonElement)p.push(r,l),I(f,{points:p.reduce(((t,e,i)=>i%2==0?`${t} ${p[i]},${p[i+1]}`:t),""),stroke:void 0});else{p.splice(0,p.length,r,l),f?.remove();const e=(w=t.checked)?"#fff":"#000";I(KM[Ki],f=Ms({fill:e,stroke:e})),h(),L()}return!1},mapMouse2:t=>{if(f instanceof SVGPolygonElement&&p.length>=4){const[e,i]=yI(t.clientX,t.clientY,a.checked);p.push(e,i),uh([w?4:5,...p]),T(),m(),f.remove(),f=null}return!1},set:()=>{VM(),I(a,{checked:Lg.value}),r(),I(Bd,{style:{cursor:"none"}},bd)},unset:()=>{l(),g(),d(),T(),A(),m(),D(),bd.remove(),I(Bd,{style:{cursor:void 0}})}})})),ir.then((()=>{if(!Hn)return;let t=0,e=0,i=!1,o=0,s=0,a=!1;const[n,r]=lt(0,(n=>{const[r,l]=yI(n.clientX,n.clientY,i!==n.shiftKey);t=r-o,e=l-s,I(HM.layer[Ki],{transform:`translate(${t}, ${e})`}),a&&Qh(r,l)}),(()=>{l(),Mh(HM.layer.path,t,e)})),l=()=>{r(!1),g(),I(HM.layer?.[Ki],{transform:void 0}),a&&Zh()},[M,g]=nt("Escape",l);kd({name:oa.TOOL_MOVE,id:"tool_move",icon:As({viewBox:"0 0 22 22",style:"fill: currentColor"},[Ds(oa.TOOL_MOVE),qo({"stroke-width":1,style:"stroke: currentColor","stroke-linecap":"round"},[es({x1:11,y1:6,x2:11,y2:16}),es({x1:6,y1:11,x2:16,y2:11})]),rs({d:"M11,0 L6,5 L16,5 Z M0,11 L5,6 L 5,16 Z M11,22 L6,17 L16,17 Z M22,11 L17,16 L17,6 Z"})]),mapMouse0:function(r){const{layer:l}=HM;return l&&(t=e=0,i=l.tokens.some((t=>t.snap)),[o,s]=yI(r.clientX,r.clientY,Lg.value),M(),(a=wg.value)&&Wh(o,s),VM(),n()),!1},mapMouse2:Od,mapMouseOver:Od,tokenMouseOver:Od,tokenMouse0:Od,tokenMouse2:vd,set:()=>I(Bd,{style:{cursor:"move"}}),unset:()=>{I(Bd,{style:{cursor:void 0}}),l()}})})),ir.then((()=>{if(!Hn)return;const t=Me({type:"checkbox",class:Os,onchange:function(){this.checked?n():(VM(),a(),Cd.unset?.())}}),e=()=>I((M=new hg(l=r()))[Ki],{opacity:.5}),i=t=>Object.assign({id:0,src:0,x:0,y:0,width:Zd.gridSize,height:Zd.gridSize,patternWidth:0,patternHeight:0,stroke:Pn,strokeWidth:0,rotation:0,flip:!1,flop:!1,tokenData:{},tokenType:0,snap:Lg.value,lightColours:[],lightStages:[],lightTimings:[]},t),[o,s]=rt((t=>{[M.x,M.y]=yI(t.clientX-M.width/2,t.clientY-M.height/2,l.snap),M.updateNode()})),a=()=>{const{layer:e}=HM;!t.checked&&M&&l&&e&&(I(e[Ki],M[Ki]),I(Bd,{style:{cursor:"none"}}),o())},n=()=>{s(),M?.[Ki].remove(),M?.cleanup(),I(Bd,{style:{cursor:void 0}})};let r=null,l=null,M=null;kd({name:oa.TOOL_MULTIPLACE,id:"tool_multiplace",icon:As({viewBox:"0 0 100 100",stroke:"currentColor",fill:"none"},[Ds(oa.TOOL_MULTIPLACE),No({cx:15,cy:15,r:10,"stroke-dasharray":"50 40","stroke-dashoffset":75}),No({cx:28,cy:28,r:10,"stroke-dasharray":"50 40","stroke-dashoffset":75}),No({cx:42,cy:42,r:10}),rs({d:"M28,77 l26,-26 a3,2 0,0,1 4,0 l40,40 M74,67 l10,-10 a3,2 0,0,1 5,0 l9,9 M14,63 l15,-15 M1,50 l15,-15"}),rs({d:"M98,39 s0,-10 -10,-10 h-49 s-10,0 -10,10 v49 s0,10 10,10 h49 s10,0 10,-10 z M84,28 v-3 s0,-10 -10,-10 h-49 s-10,0 -10,10 v49 s0,10 10,10 h3 M71,15 v-3 s0,-10 -10,-10 h-49 s-10,0 -10,10 v49 s0,10 10,10 h3","stroke-width":4})]),options:Gt({style:"overflow: hidden"},[Ka(t,[oa.TOOL_MULTIPLACE_MODE,": "]),Et(),de([oa.TOKEN,": "]),Gt({class:zs},[wt({onclick:function(){const o=zI();o&&(r=()=>i(Ja(o)),I(this,{style:`background-image: url(${ld(o.src)})`}),e(),t.checked||VM())},ondragover:vi({link:[ph,rd]}),ondrop:function(t){if(ph.is(t)){const o=ph.get(t),s=Xa.get(o.id);s&&(r=()=>{const t=qa(s);return i(t||{src:s["store-image-icon"].data})},I(this,{style:`background-image: url(${ld(s["store-image-icon"].data)})`}),e())}else if(rd.is(t)){const{id:o,width:s,height:a}=rd.get(t);r=()=>i({src:o,width:s||Zd.gridSize,height:a||Zd.gridSize}),I(this,{style:`background-image: url(${ld(o)})`}),e()}}},oa.TOKEN_USE_SELECTED)]),wt({onclick:()=>M&&e()},oa.TOKEN_NEXT)]),mapMouse0:function(i){const{layer:o}=HM;return!(!t.checked&&l&&M&&o&&(i.preventDefault(),M[Ki].remove(),l.x=M.x,l.y=M.y,sh(o.path,l),e(),I(HM.layer[Ki],M[Ki]),1))},mapMouse2:Od,mapMouseOver:()=>(a(),!t.checked),tokenMouse2:vd,set:()=>{!t.checked&&l&&VM()},unset:()=>{n(),t.checked||Cd.unset?.()}}),yh.waitLayerSelect().when((()=>{const{layer:t}=HM;M&&M[Ki].parentNode&&t&&I(t[Ki],M[Ki])}))})),ir.then((()=>{if(!Hn)return;let t=_n("#000"),e=!1,i=0,o=null,s=0,a=null;const[n,r,l,M]=G(4),g=()=>{h.checked?(I(Bd,{style:{cursor:"none"},class:{[r]:!1}},bd),w()):(I(Bd,{class:[r]}),f())},c=new ki("scattering"),d=Me({type:"radio",name:"wallTool",class:Os,checked:!0,onchange:g}),h=Me({type:"radio",name:"wallTool",class:Os,onchange:()=>{g(),at()}}),T=Me({type:"range",min:0,max:255,value:0,ondragover:vi({copy:[c]}),ondrop:t=>{c.is(t)&&(T.value=c.get(t)+"")}}),u=Me({type:"checkbox",class:Os}),A=c.register((()=>Ti(parseInt(T.value),0,255,0))),L=c.register((()=>en.get(i)?.wall.scattering??0)),m=Un.register((()=>en.get(i)?.wall.colour??Pn)),y=Me({type:"checkbox",class:Os}),D=()=>y.click(),[p,E]=nt("Shift",D,D),[w,f]=rt((t=>{const[e,i]=yI(t.clientX,t.clientY,y.checked);I(bd,{transform:`translate(${e-10/mI.zoom}, ${i-10/mI.zoom}) scale(${1/mI.zoom})`})}),(()=>{I(Bd,{style:{cursor:void 0}}),bd.remove()})),[x,S]=nt("Delete",(()=>{i&&(ch(i),at())})),C=[0,0],k=ds({height:10,fill:"#000",stroke:"#000","stroke-width":2}),O=t=>{const[e,i]=yI(t.clientX,t.clientY,y.checked);I(k,{width:Math.hypot(e-C[0],i-C[1]),transform:`rotate(${180*Math.atan2(i-C[1],e-C[0])/Math.PI}, ${C[0]}, ${C[1]})`})},v=e=>{if(e.isTrusted&&HM.layer){const[i,o]=yI(e.clientX,e.clientY,y.checked);gh({path:HM.layer.path,wall:{id:0,x1:C[0],y1:C[1],x2:i,y2:o,colour:t,scattering:Ti(parseInt(T.value),0,255,0)}})}k.remove()},[b,j]=lt(0,O,v),[z,_]=rt(O,(()=>k.remove())),P=ds({width:"100%",height:"100%"}),R=new Yn("underlayColour",new zn(255,255,255,63)).wait((t=>I(P,{fill:t}))),U=qo(P),W=new Map,Q=vi({copy:[Un,c]}),Z=(t,e)=>{const i=en.get(e);if(i){const e={colour:i.wall.colour};if(Un.is(t))e.colour=Un.get(t);else{if(!c.is(t))return;e.scattering=c.get(t)}t.preventDefault(),dh(Object.assign(Ja(i.wall),e))}},B=(t,e="",i=Qd)=>i.children.map((i=>i.id<0?[]:iI(i)?Vi([$i(i.name),Fi(B(t,e,i))]):$i(i.name===e?{disabled:!0}:{onselect:()=>t(i)},i.name))),H=Gt({style:"position: absolute; height: 10px",draggable:"true",ondragstart:t=>{en.has(i)&&(Un.set(t,m,tt),c.set(t,L))},ondragover:Q,ondrop:t=>Z(t,i),oncontextmenu:e=>{if(e.stopPropagation(),e.preventDefault(),o){const s=i;I(document.body,Fi({x:e.clientX,y:e.clientY},[$i({onselect:()=>{if(i===s){const e=en.get(s);e&&(e.wall.colour=t,dh(Ja(e.wall)))}}},oa.TOOL_WALL_COLOUR_SET),$i({onselect:()=>{if(i===s){const t=en.get(s);t&&(t.wall.scattering=Ti(parseInt(T.value),0,255,0),dh(Ja(t.wall)))}}},oa.TOOL_WALL_SCATTER_SET),Vi([$i(oa.CONTEXT_MOVE_LAYER),Fi(B((t=>{i===s&&Ih(s,t.path)}),o.name))]),$i({onselect:()=>{i===s&&(ch(s),at())}},oa.CONTEXT_DELETE)]))}}}),F=Xo({height:10},H),$=(t,e,i,o)=>{const s=Math.round(Math.hypot(t-i,e-o));I(H,{style:{width:s+"px"}}),I(Bd,[I(F,{width:s,x:t,y:e-5,transform:`rotate(${180*Math.atan2(o-e,i-t)/Math.PI}, ${t}, ${e})`}),I(et,{transform:`translate(${t-10}, ${e-10})`}),I(it,{transform:`translate(${i-10}, ${o-10})`})])},V=()=>{N(U,P),W.clear();let t=!1;for(const{layer:e,wall:s}of en.values())if(!e.hidden&&!e.locked){const{id:a,x1:r,y1:l,x2:M,y2:g,colour:c,scattering:h}=s;a===i&&($(r,l,M,g),t=!0),I(U,Ai(W,a,ds({x:r,y:l-5,width:Math.hypot(r-M,l-g),class:n,transform:`rotate(${180*Math.atan2(g-l,M-r)/Math.PI}, ${r}, ${l})`,fill:c,stroke:c.toHexString(),ondragover:Q,ondrop:t=>Z(t,a),onmousedown:t=>{d.checked&&s&&0===t.button&&($(r,l,M,g),i=a,o=e,x(),Mt(),t.stopPropagation())}},Ds([oa.TOOL_WALL_LAYER,`: ${e.path}\n`,oa.TOOL_WALL_COLOUR,`: ${c}\n`,oa.TOOL_WALL_SCATTER,`: ${h}`]))))}t||at()},[K,J]=nt("Escape",(()=>{j(),st(),_()})),X=As({viewBox:"0 0 90 60"},[Ds(oa.TOOL_WALL),po(ls({id:M,patternUnits:"userSpaceOnUse",width:30,height:30},rs({d:"M15,30 V15 H0 V0 H30 V15 H15 M0,30 H30",fill:"none",style:"stroke: currentColor","stroke-width":3}))),rs({d:"M60,15 V0.5 H0.5 V59.5 H89.5 V15 Z",fill:`url(#${M})`,style:"stroke: currentColor","stroke-width":2})]),q=uo(X),tt=le({src:q}),[et,it]=Array.from({length:2},((t,e)=>rs({d:"M8,0 h4 v8 h8 v4 h-8 v8 h-4 v-8 h-8 v-4 h8 z",class:l,onmousedown:t=>{0===t.button&&(s=e,ot(),t.stopPropagation())}}))),[ot,st]=lt(0,(t=>{const e=en.get(i);if(e){const{x1:o,y1:a,x2:n,y2:r}=e.wall,l=W.get(i),[M,g]=yI(t.clientX,t.clientY,y.checked),[c,d]=0===s?[M,g]:[o,a],[h,T]=1===s?[M,g]:[n,r];I(l,{x:c,y:d-5,width:Math.hypot(c-h,d-T),transform:`rotate(${180*Math.atan2(T-d,h-c)/Math.PI}, ${c}, ${d})`}),I(s?it:et,{transform:`translate(${M-10}, ${g-10})`})}else at()}),(t=>{const e=en.get(i);if(e){const{x1:o,y1:a,x2:n,y2:r}=e.wall,l=W.get(i);if(t.isTrusted){const{colour:l,scattering:M}=e.wall,[g,c]=yI(t.clientX,t.clientY,y.checked),[d,h]=0===s?[g,c]:[o,a],[T,u]=1===s?[g,c]:[n,r];I(s?it:et,{transform:`translate(${g-10}, ${c-10})`}),dh({id:i,x1:d,y1:h,x2:T,y2:u,colour:l,scattering:M})}else I(l,{x:o,y:a-5,width:Math.hypot(o-n,a-r),transform:`rotate(${180*Math.atan2(r-a,n-o)/Math.PI}, ${o}, ${a})`}),I(et,{transform:`translate(${o-10}, ${a-10})`}),I(it,{transform:`translate(${n-10}, ${r-10})`})}})),at=()=>{i=0,o=null,F.remove(),et.remove(),it.remove(),st(),S(),gt()},[Mt,gt]=nt("Escape",at),ct=()=>{e&&setTimeout(V)};Y({[`.${n}`]:{height:"10px","stroke-width":2},[`.${r} .${n}`]:{cursor:"pointer"},[`.${l}`]:{fill:"#000",stroke:"#fff",cursor:"move"}}),kd({name:oa.TOOL_WALL,id:"tool_wall",icon:X,options:Gt([Zt([Ie(oa.TOOL_WALL_MODE),Ka(d,[oa.TOOL_WALL_SELECT,": "]),Et(),Ka(h,[oa.TOOL_WALL_PLACE,": "])]),Ka(y,[oa.TOOL_WALL_SNAP,": "]),Et(),Ka(u,[oa.TOOL_WALL_CONTINUOUS,": "]),Et(),Ka([oa.TOOL_WALL_COLOUR,": "],Rn(Rd,oa.TOOL_WALL_COLOUR,(()=>t),(e=>I(k,{fill:t=e,stroke:e.toHexString()})),q)),Et(),Ka([oa.TOOL_WALL_SCATTER,": "],T,{draggable:"true",ondragstart:t=>c.set(t,A,tt)}),Et(),Ka([oa.TOOL_WALL_UNDERLAY,": "],Rn(Rd,oa.TOOL_WALL_UNDERLAY,(()=>R.value),(t=>R.set(t)),q))]),mapMouse0:t=>{if(t.ctrlKey&&!t.shiftKey)return!0;if(h.checked){u.checked?(k.parentNode&&v(t),z()):b();const[e,i]=yI(t.clientX,t.clientY,y.checked);I(Bd,I(k,{width:0,x:C[0]=e,y:(C[1]=i)-5,transform:void 0}))}else at();return!1},mapMouse2:()=>(_(),!1),mapMouseOver:()=>(g(),!1),set:()=>{e=!0,VM(),I(y,{checked:Lg.value}),V(),I(Bd,{style:{cursor:h.checked?"none":void 0}},[U,h.checked?bd:[]]),p(),K()},unset:()=>{e=!1,E(),f(),j(),_(),J(),U.remove(),a&&(a.remove(),a=null),at()}});for(const t of["waitWallAdded","waitWallRemoved","waitWallModified","waitWallMoved","waitLayerMove","waitLayerRemove","waitLayerShift","waitLayerShow","waitLayerHide","waitLayerLock","waitLayerUnlock"])Kn[t]().when(ct)})),N(document.getElementsByTagName("title")[0],oa.TITLE);const[CT,kT,OT,vT,bT,jT,zT,YT,_T,PT]=G(10),GT=new Si("lastTab"),RT=(()=>{let t=0,e=!1;const i=new wi("panelShow"),o=new Ci("windowData",{},(t=>{if(!(t instanceof Object))return!1;for(const e in t){const i=t[e];if("object"!=typeof i||"boolean"!=typeof i.out||!jn(i.data))return!1}return!0})),s=t=>{t.clientX>0&&(h.set(document.body.clientWidth-t.clientX),e=!0)},[a]=lt(0,s),[n]=lt(1,s),r=Me({id:jT,type:"checkbox",checked:i.value,onchange:()=>i.set(r.checked)}),l=Gt({id:bT}),M=Gt({id:OT}),g=de({title:oa.PANEL_GRABBER,for:jT,class:mg.value?_T:void 0,id:zT,onmousedown:t=>{r.checked||(0===t.button?a():1===t.button&&n(),e=!1)},onclick:t=>{e&&t.preventDefault()}}),c=Gt({id:kT},[l,M]),d=Gt({id:CT},[g,c]),h=new fi("panelWidth",300,0).wait((t=>I(d,{style:`--panel-width: ${t}px`}))),T=o.value,u=()=>o.save(),A=function(){T[this.getAttribute("window-title")||""]={out:!0,data:bn(this)},u()},L=[],m=()=>{for(const[,t]of L)if("none"!==t.style.getPropertyValue("display"))return void(t.control??t).click()};return mg.wait((t=>I(g,{class:{[_T]:t}}))),vM("helpKey",oa.KEY_HELP,"F1",(t=>{CM(),t.preventDefault()}))[0](),vM("togglePanel",oa.KEY_PANEL_TOGGLE,"F9",(t=>{i.set(r.checked=!r.checked),t.preventDefault()}))[0](),Object.freeze({add:([e,i,o,s])=>{I(M,i);const a=t++,n=o?Na({class:YT,title:S`${oa.POPOUT} ${e}`,onclick:t=>{t.preventDefault();const o=Gt();i.replaceWith(o),T[e+""]?T[e+""].out=!0:T[e+""]={out:!0,data:[20,20,0,0]},u();const[a,n,l,M]=T[e+""].data,c=kn({"window-icon":s,"window-title":e,resizable:"true",style:{"min-width":"45px","--window-left":a+"px","--window-top":n+"px","--window-width":0===l?void 0:l+"px","--window-height":0===M?void 0:M+"px"},onremove:()=>{o.replaceWith(i),I(r,{style:{display:void 0}}),T[e+""].out=!1,u(),i.dispatchEvent(new CustomEvent("popin",{cancelable:!1}))},onmoved:A,onresized:A},i);I(vn,c),I(r,{style:{display:"none"}}),g.checked&&m(),i.dispatchEvent(new CustomEvent("popout",{cancelable:!1,detail:c}))}}):null,[r,g]=Ka([le({src:s}),Be(e),n||[]],c.insertBefore(Me({name:"tabSelector",type:"radio"}),l),{title:e,tabindex:-1,onkeyup:t=>{t.stopPropagation();let e=a,i=1;switch(t.key){case"ArrowLeft":i=-1;case"ArrowRight":do{e=ui(e+i,L.length)}while(e!==a&&"none"===L[e][1].style.getPropertyValue("display"));break;case"Enter":r.click();default:return}L[e][1].focus()},onclick:()=>GT.set(e+"")});return I(l,r),L.push([e+"",r]),n&&T[e+""]&&T[e+""].out&&setTimeout((()=>n.dispatchEvent(new MouseEvent("click")))),i},css(){const e=Array.from({length:t},((t,e)=>e+1));Y({[e.map((t=>`#${kT}>input:nth-child(${t}):checked~#${OT}>div:nth-child(${t})`)).join(",")]:{display:"block"},[e.map((t=>`#${kT}>input:nth-child(${t}):checked~#${bT}>label:nth-child(${t})`)).join(",")]:{"border-bottom-color":"var(--c)","z-index":2,background:"var(--c) !important",cursor:"default !important",":before":{"box-shadow":"2px 2px 0 var(--c)"},":after":{"box-shadow":"-2px 2px 0 var(--c)"}}})},setTab(t){for(const[e,i]of L)if(e===t&&"none"!==i.style.getPropertyValue("display"))return void(i.control??i).click();m()},html:()=>[r,d]})})(),UT={"background-color":"#000",color:"#fff",[` body, windows-window, #${CT}`]:{"background-color":"#000",color:"#fff","border-color":"#fff"},[` a, .${Ys}`]:{color:"#f00"}," windows-window::part(title)":{color:"#000"},[` #${bT}`]:{":after":{"border-color":"#fff"},">label":{"--c":"#000",background:"linear-gradient(to bottom, #777 30%, #111 100%)","box-shadow":"0 3px 3px rgba(255, 255, 255, 0.4), inset 0 1px 0 #000","text-shadow":"0 1px #000","border-color":"#fff",":hover,:focus":{background:"linear-gradient(to bottom, #f22 5%, #a77 40%, #111 100%)"},":before,:after":{"border-color":"#fff"},":before":{"box-shadow":"2px 2px 0 #2e2e2e"},":after":{"box-shadow":"-2px 2px 0 #2e2e2e"}}}," menu-menu":{"background-color":"#222",color:"#fff"}," menu-submenu[open]>menu-item, menu-item:focus":{"background-color":"#000"}," menu-item[disabled],menu-submenu[disabled]":{color:"#888"}};Y({"html, body":{color:"#000","background-color":"#fff",margin:0,padding:0,"user-select":"none",height:"100%",width:"100%"},[`.${Ys}`]:{cursor:"pointer"},[`a, .${Ys}`]:{color:"#00f","text-decoration":"none",":hover":{"text-decoration":"underline"}},[`#${CT}`]:{position:"fixed",top:0,right:0,bottom:0,width:"var(--panel-width, 300px)","border-left":"1px solid #000",transition:"right 1s, border-color 1s","background-color":"#fff"},[`.${vT} #${CT}`]:{"z-index":1},[`#${kT}>input,#${OT}>div`]:{display:"none"},[`#${bT}`]:{"padding-left":0,"margin-top":"-24px","line-height":"24px",position:"relative",width:"100%",overflow:"hidden",padding:"0 0 0 20px","white-space":"nowrap","--c":"#fff",":after":{position:"absolute",content:'""',width:"100%",bottom:0,left:0,"border-bottom":"1px solid #000","z-index":1,overflow:"hidden","text-align":"center",transform:"translateX(-20px)"},">label":{border:"1px solid #000",display:"inline-block",position:"relative","z-index":1,margin:"0 -5px",padding:"0 20px","border-top-right-radius":"6px","border-top-left-radius":"6px",background:"linear-gradient(to bottom, #ececec 50%, #d1d1d1 100%)","box-shadow":"0 3px 3px rgba(0, 0, 0, 0.4), inset 0 1px 0 #fff","text-shadow":"0 1px #fff",":hover,:focus":{background:"linear-gradient(to bottom, #faa 1%, #ffecec 50%, #d1d1d1 100%)",cursor:"pointer",outline:"none"},":before,:after":{position:"absolute",bottom:"-1px",width:"6px",height:"6px",content:'" "',border:"1px solid #000"},":before":{left:"-7px","border-bottom-right-radius":"6px","border-width":"0 1px 1px 0","box-shadow":"2px 2px 0 #d1d1d1"},":after":{right:"-7px","border-bottom-left-radius":"6px","border-width":"0 0 1px 1px","box-shadow":"-2px 2px 0 #d1d1d1"}}},[`#${jT}`]:{display:"none",[`:checked~#${CT}`]:{right:"calc(-1 * var(--panel-width) - 1px)",[`>#${zT}`]:{"background-color":"#000",[`.${_T}:not(:hover)`]:{opacity:0,transition:"background 1s, opacity 2s 10s"}}}},[`#${zT}`]:{background:"#fff",border:"2px solid #f00","border-radius":"20px",position:"relative",left:"-12px",display:"block",width:"20px",height:"20px",transition:"background 1s","z-index":9,cursor:"pointer"},"windows-shell-taskmanager":{position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"clip"},"windows-window":{"--window-left":"20px","--window-top":"20px","max-width":"100%","max-height":"100%",outline:"none",">*":{padding:"0 1px"}},[`.${YT}`]:{display:"inline-block","margin-left":"5px","margin-right":"-10px",cursor:"pointer",width:"1em",height:"1em"},[`#${OT}>div`]:{height:"calc(100vh - 30px)",overflow:"auto"},'input[type="number"]':{width:"5em"},"windows-desktop":{"background-color":"#000"},[`#${bT} img`]:{"padding-top":"5px",width:"1.5em",height:"1.5em",display:"none","pointer-events":"none"},[`.${PT}`]:{[` #${bT}`]:{" img":{display:"inline"}," span":{display:"none"}},[` #${OT}>div`]:{height:"calc(100vh - 40px)"}},"menu-menu":{border:"2px outset #000",padding:"0.25em 0","box-sizing":"border-box","column-gap":"1em","background-color":"#aaa",color:"#000"},"menu-submenu[open]>menu-item,menu-item:focus":{"background-color":"#eee"},"menu-submenu>menu-item:after":{display:"block",float:"right",content:'"\xbb"'},"menu-item":{outline:"none",padding:"0 0.25em"},"menu-item[disabled],menu-submenu[disabled]":{color:"#444","font-style":"italic"}}),_("@media (prefers-color-scheme: light)",{[`:root.${vs}`]:UT}),_("@media (prefers-color-scheme: dark)",{[`:root:not(.${vs})`]:UT}),N(document.body,[ca,vn]),yg.wait((t=>I(document.documentElement,{class:{[vs]:t}}))),Dg.wait((t=>I(document.documentElement,{class:{[PT]:t}}))),Eg.wait((t=>I(document.documentElement,{class:{[vT]:t}}))),ir.then((()=>{const t=[...sn].sort((([t],[e])=>t-e)),e=Hn?t.pop()[1]:null;return sn.splice(0,sn.length),Object.freeze(sn),Ag().then((()=>{I(document.body,{oncontextmenu:t=>{t.target instanceof HTMLInputElement||t.target instanceof HTMLTextAreaElement||t.preventDefault()}});for(const[,e]of t){const t=e();t&&RT.add(t)}for(const t of gg())RT.add(t);(Hn?Vh:EI)(On.appendChild(Gt())),e&&RT.add(e()),RT.css(),I(document.head,R()),I(On,RT.html()),setTimeout((()=>RT.setTab(GT.value))),vn.realignWindows(),I(window,{onresize:m((()=>vn.realignWindows()),A)}),Jn.ready()}))})).catch(er);</script></head><body><h1>Loading...</h1></body></html>