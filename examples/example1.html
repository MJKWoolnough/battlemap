<!doctype html><html lang="en"><head><title>Battlemap</title><link rel="shortcut icon" sizes="any" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 90'%3E%3Cg stroke='%23000' stroke-linejoin='round' stroke-linecap='round'%3E%3Cpath d='M94,84 l-5,5 -5,-5 2,-2 -75,-75 0,-6' fill='%23840' /%3E%3Cpath d='M94,84 l5,-5 -5,-5 -2,2 -75,-75 -6,0' fill='%23c84' /%3E%3Cpath d='M7,20 h-5 q5,30 30,25 l-6,-15 z' fill='%23aad' /%3E%3Cpath d='M20,10 q-10,10 -15,10 10,20 25,20 -2,-8 5,-15 l1,-1' fill='%2388b' /%3E%3Cpath d='M20,10 l5,-5 15,15 -5,5' fill='%23aad' /%3E%3Cpath d='M2,88 a1,1 0,1,1 3,-5 l13,-15 -5,-5 3,-3 7,7' fill='%23f80' /%3E%3Cpath d='M2,88 a1,1 0,1,0 5,-3 l15,-13 5,5 3,-3 -7,-7' fill='%23fa0' /%3E%3Cpath d='M1.75,87.80 l0.4,0.4' /%3E%3Cpath d='M26,70 l55,-50 5,-16' fill='%2388f' /%3E%3Cpath d='M86,4 l-5,16 -55,50 -3,-3' fill='%23bbf' /%3E%3Cpath d='M86,4 l-16,5 -50,55 3,3' fill='%23669' /%3E%3C/g%3E%3C/svg%3E" /><script type="module">const e={admin:"?admin"===window.location.search,currentMap:1,currentUserMap:1,urls:{images:["",'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 570 520"><path id="bush" d="M180,460a69,69,0,1,1,-100,-200a69,69,0,1,1,0,-150a69,69,0,1,1,150,-50a69,69,0,1,1,150,50a69,69,0,1,1,150,150a69,69,0,1,1,-100,100a69,69,0,1,1,-100,50a69,69,0,1,1,-150,50z" /><use href="%23bush" fill="%2320580d" /><use href="%23bush" fill="%23638d05" transform="translate(70 70) scale(0.75 0.75) rotate(185 285 260)" /><use href="%23bush" fill="%23b3bf35" transform="translate(150 150) scale(0.5 0.5) rotate(275 285 260)" /></svg>','data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision" text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd" clip-rule="evenodd" viewBox="0 0 240 240"><path fill="%230d0c0b" d="M117 10c26 0 38 14 37 41 5 2 9 5 12 9 0 6 2 12 5 18 7 2 7 5 1 9l8 10v10l-7 17 2 4c-3 3-4 6-4 10l-1 1-11 2c-2 1-4 3-4 6 2 9 3 19 3 30-3 1-4 4-4 7l5 12v6l-14 4c-6-3-11-7-15-11-1-2 0-4 1-5-4-3-4-7-1-10l-2-4c-2 3-5 5-9 7-4-2-6-4-8-7-2 2-2 5 1 8-3 3-4 7-4 12l-14 10-12-3c-2-2-3-5-2-8 3-4 5-8 6-13-4-2-6-5-6-9 0-9 2-18 5-26l-4-5-13-4c0-4-1-8-3-10l2-3-9-24c1-6 5-10 10-14-7-3-7-6 0-9 3-6 4-11 4-17 3-4 7-7 11-9 1-4 3-6 7-6-1-8 1-16 4-23 3-4 6-5 11-5 2-5 6-8 12-8ZM91 96l3 7v5c-3 4-5 9-6 14-1-1-3-2-4-1v-18l7-7Zm57 1 9 8c-1 5-2 10-1 16-2-1-4 0-5 1-1-5-3-10-6-13-1-5 0-9 3-12Z"/><path fill="%233a3a3a" d="M112 87c-11 1-15-4-11-13l1-1c5 5 11 9 18 11l13-7c0 3 2 6 4 8l-1 1c-7-1-12 1-16 6l-8-5Z"/><path fill="%233a3a38" d="M166 83h-5l2-1-10-7c-1-1 0-2 1-2 4-1 7-3 9-6l6 13-5 2 2 1ZM80 81l-5 3-3-1 5-1-7-2 6-13 3 4c3 0 5 1 8 3l-8 6 1 1Z"/><path fill="%23786659" d="M100 57c3 3 5 8 7 13-5-4-7-8-7-13Z"/><path fill="%23221e1b" d="M132 52h2c-2 0-3 1-3 2l4 3h-3v3h-7c-1-2-2-3-3-2v-3l10-3Z"/><path fill="%233a3a3a" d="M151 74c-5 0-6-2-4-5l2-3 4-11h3l7 6v3l-4 5c-4 0-7 1-8 5Z"/><path fill="%23181817" d="M148 44v1l1 13-3 9 1 2c-2 3-1 5 4 5l2 1 10 7-2 1c-5-6-11-8-17-8 4 2 9 5 13 9h-2l3 4a74532 74532 0 0 1 4 13h-2l-9-19-5-2a311 311 0 0 0-8 8c1 1 2 4 1 7 0-5-3-7-7-6-5-1-9 1-12 5-6-5-12-7-18-5l-2 6-1-2c0-3 1-5 3-6h10l8 5c4-5 9-7 16-6l1-1c-2-2-4-5-4-8l-13 7c-7-2-13-6-18-11l-1 1 1-6c4 6 10 10 18 13 7-3 13-7 17-13 1 3 0 7-1 10l1 2c0-2 1-3 2-3l5-12 4-21Z"/><path fill="%235c5851" d="m148 44-4 21-5 12 2-9 2-4 3-24 2 4Z"/><path fill="%233a3a3a" d="m86 54 2 1 2 10c2 1 4 4 5 7l-5 2c-3-3-6-5-10-4-1-4-3-6-5-8l11-8Z"/><path fill="%23746356" d="M132 71c0-3 1-5 3-7v-7l-4-3c0-1 1-2 3-2h-2c0-1 1-2 3-1 0-7-4-11-10-11 7-4 11-1 12 8 3 9 2 16-5 23Z"/><path fill="%23ceb09a" d="m93 46 4 2v11c-3-4-4-9-4-13Z"/><path fill="%2346433e" d="m149 33 2 15-2 10-1-13 1-12Z"/><path fill="%23d6b7a0" d="M125 40c6 0 10 4 10 11-2-1-3 0-3 1l-10 3v3c1-1 2 0 3 2h7v-3h3v7c-2 2-3 4-3 7l-12 8c-6-2-10-5-13-9-2-5-4-10-7-13-2-6 0-10 4-12l4-9c5 5 10 6 17 4Z"/><path fill="%233f362f" d="M116 70c3-1 6 0 9 2l-1 1-9-2 1-1Z"/><path fill="%2327221e" d="m115 64 5 3c1-2 2-2 4-2-4 4-7 4-9-1Z"/><path fill="%23241f1c" d="m104 52 1-1 10 4c2-2 3-2 2 2l-9 3v-3l-4-1 5-2-5-2Z"/><path fill="%234e4a45" d="M96 30h1c-1 1 0 2 1 4v12l-2-4c-2 2-3 2-3-2s1-7 3-10Z"/><path fill="%23979085" d="M98 46V34c2-2 4-3 8-3 0 6-2 11-7 16l-1-1Z"/><path fill="%234f4c46" d="M109 17c-1 4 0 7 2 11-1 1-2 2-1 4l-1 2c-3-6-3-12 0-17Z"/><path fill="%23888278" d="M98 34c-1-2-2-3-1-4 1-4 4-5 7-4l1 4c-4-1-6 0-7 4Z"/><path fill="%2344413c" d="M96 30c-1-3 0-6 3-8 2-1 4-1 6 1-5 0-8 2-9 7Z"/><path fill="%23242320" d="M111 32h-1c-1-2 0-3 1-4 2-9 8-13 18-11l7 5-7-3c-10-2-16 3-18 13Z"/><path fill="%23958e84" d="m149 33-1 12v-1l-2-4-3 24-2 4-1-18c-1-13-8-17-19-15-1 2-2 2-3 2 1-4 4-7 8-8s8 0 13 1c-5-3-9-4-14-3-5 3-8 6-11 11-3-1-4-3-3-6 2-10 8-15 18-13l7 3-7-5c-10-2-16 2-18 11-2-4-3-7-2-11 13-8 25-5 36 7 2 2 3 5 4 9Z"/><path fill="%23aca96d" d="M161 83h5l7-1c-6 5-11 5-16 2-4-4-9-7-13-9 6 0 12 2 17 8Z"/><path fill="%23343434" d="M84 93c3-2 4-5 4-8s1-5 4-5c1 10-3 17-13 20 1-3 2-5 5-7Z"/><path fill="%23393939" d="m146 80 5 2 9 19c-10-4-15-11-14-21Z"/><path fill="%23333" d="M99 85c-3 7-1 13 5 18l6 1c-10 2-15-2-16-11l2-11 3 3Z"/><path fill="%23323232" d="m144 81 1 12c0 6-2 10-8 11h-7c3 0 6-1 8-3 3-5 4-11 3-16l3-4Z"/><path fill="%23aeab6e" d="m72 83 3 1 5-3c5-4 11-7 18-8l-6-9c0-6-1-10-4-14h4l2 10 5 1v15c-8 1-15 4-20 10-5 1-9 0-12-3h5Z"/><path fill="%23616161" d="M88 85c0 3-1 6-4 8 0-3 2-6 4-8Z"/><path fill="%23686868" d="m99 85 3 2c-2 1-3 3-3 6l1 2 2-6c6-2 12 0 18 5 3-4 7-6 12-5 4-1 7 1 7 6 1-3 0-6-1-8 0-1 1-2 3-2 1 5 0 11-3 16-2 2-5 3-8 3-4 1-7 3-10 6l-7-6h-3l-6-1c-6-5-8-11-5-18Z"/><path fill="%235c5c5c" d="m70 88 14 1-8 12-8-11 2-2Z"/><path fill="%235d5d5d" d="M158 88h9c2 0 3 1 4 3l-6 9-3 1a74532 74532 0 0 0-4-13Z"/><path fill="%233a3a39" d="m70 102-8 4v-9c1-2 2-3 4-1l4 6Z"/><path fill="%233b3b3a" d="M174 95c4 2 5 6 2 11l-6-4 4-7Z"/><path fill="%239b9862" d="m70 102-3-9 7 10-10 7c-1-1-2-2-1-3l7-3v-2Z"/><path fill="%235b5a39" d="M77 104h3v18l-2 3-1-3c2-6 2-11 0-16v-2Z"/><path fill="%233a3a3a" d="M77 104v2l-1 13-6 6-5-13 12-8Z"/><path fill="%233b3b3b" d="m164 106 10 7-5 12-6-5c-1-5 0-10 1-14Z"/><path fill="%23a19f66" d="m172 93 1 1c-3 2-4 6-5 9 2 2 5 4 9 5l-2 2c-4-2-7-5-9-8l6-9Z"/><path fill="%235c5b3a" d="m99 114 1 1-3 5-4-2 3-5 3 1Z"/><path fill="%235b5a39" d="M142 121c0-3-2-5-4-5l2-2 4-1 3 6-5 2Z"/><path fill="%23b4b172" d="m100 115 13 5c-1 2-2 4-1 7l-15-7 3-5Z"/><path fill="%23b2af71" d="M138 116c2 0 4 2 4 5-6 1-11 3-15 6v-8l11-3Z"/><path fill="%235a5938" d="M163 122c-1 0-2 1-1 3l-3-2v-20c2-1 3 0 4 2-3 6-3 11 0 17Z"/><path fill="%23bbb876" d="M114 129v-9h11c2 4 1 8-3 10-3 1-6 0-8-1Z"/><path fill="%23afac6f" d="m77 122 1 3c-3 2-7 3-10 2l9-5Z"/><path fill="%23676767" d="M95 123c4 0 9 2 13 5-3 7-5 13-5 21-8 0-14-3-18-8 3-3 5-7 5-12l5-6Z"/><path fill="%236f5f53" d="M88 128c-5-1-9 0-12 3l-5 1c1-3 3-4 6-4l6-4 5 1v3Z"/><path fill="%23686868" d="m147 147-10 1-6-20c3-3 7-5 12-5 2 1 4 2 5 5l3 11 4 2-8 6Z"/><path fill="%23aca96d" d="m163 122 8 5c-4 1-7 0-9-2-1-2 0-3 1-3Z"/><path fill="%231c1c18" d="m103 107-1 5c1 2 3 3 6 3l-3-8h1l3 10c7 1 14 1 21-1 2-8 3-8 2 0l5-3v-6l4-1c1 3 0 5-2 7l1 1-2 2-11 3v8c2 2 3 6 4 10l-5-6-6 3-7-3-3 3v-5h4c2 1 5 2 8 1 4-2 5-6 3-10h-11v8l-2-1c-1-3 0-5 1-7l-13-5-1-1 2-2c-3-1-4-4-2-6l4 1Z"/><path fill="%23636363" d="M103 107h2l3 8c-3 0-5-1-6-3l1-5Z"/><path fill="%23666" d="M137 107v6l-5 3c1-8 0-8-2 0-7 2-14 2-21 1l-3-10c1-2 3-2 6-1l7 6 9-6 9 1Z"/><path fill="%23cfb19b" d="m88 128-2 2c-3-2-5-1-4 3 1-1 3-2 5-1v5H71v-5l5-1c3-3 7-4 12-3Z"/><path fill="%23d2b49d" d="M168 136h-15c-1-2-2-3-1-4 2-1 4 0 5 2 1-5-1-7-5-4 0-2 1-2 3-2l13 4v4Z"/><path fill="%23726154" d="M168 136v-4l-13-4c-2 0-3 0-3 2-2-2-2-4 0-5l3-1 8 4 6 2-1 6Z"/><path fill="%233a3a3a" d="M131 137c1 3 0 6-3 8-9 5-16 3-21-5 0-3 1-5 3-6l3-3 7 3 6-3 5 6Z"/><path fill="%2328211c" d="M137 154c-3-1-5-3-5-5-4 3-8 4-13 4s-9-1-12-4c-1 2-3 4-5 4l-1-2c2-1 4-3 5-6 9 8 18 7 27-1l2 6 4 1-2 3Z"/><path fill="%2327201c" d="m103 166-7-12-9-4 1-3 11 4 3 9 1 6Z"/><path fill="%23241e1b" d="M147 147c2 0 3 1 5 3l-9 4c-3 4-5 9-6 14-2-2-2-4-1-6l4-11 4-2-7-1 10-1Z"/><path fill="%234c3e36" d="M137 154c-4 9-10 18-17 26-8-8-14-17-18-27 2 0 4-2 5-4 3 3 7 4 12 4s9-1 13-4c0 2 2 4 5 5ZM87 150l9 4 7 12c-2 5-2 11-2 17-14 0-20-7-17-20l3-13ZM152 150c3 8 4 16 3 26-5 5-10 7-16 7l-2-15c1-5 3-10 6-14l9-4Z"/><path fill="%23303030" d="m105 167 4 4c-3 4-3 9-1 14-2 3-5 3-7 0l4-18Z"/><path fill="%23313131" d="m133 167 1 1 4 17c-3 3-5 3-6 0 1-5 0-10-1-14l2-4Z"/><path fill="%23676767" d="M91 185c8 0 12 4 10 13l-4 2-14 1c0-7 3-12 8-16ZM144 185c3-1 5 0 7 3 3 3 5 8 6 13l-15-1c-6-3-7-7-3-12l5-3Z"/></svg>','data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 90"><rect width="100%" height="100%" fill="%23a6c950" /><path d="M28,2 l2,7 M33,1 l2,8 M70,11 l-1,7 M75,11 l-1,7 M48,31 l1,7 M52,31 l1,7 M15,42 l3,6 M19,42 l2,6 M24,42 l1,6 M88,38 l3,5 M92,36 l3,5 M12,72 l2,5 M16,70 l2,6 M42,61 l2,6 M80,62 l-1,6 M84,63 l-2,6 M61,83 l-1,6" stroke="%23688a1b" stroke-linecap="round" /></svg>','data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision" text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd" clip-rule="evenodd" viewBox="0 0 240 240"><path fill="%23050305" d="m145.5 110.5-2 3c.2-1-.2-1.7-1-2-.7-2.8-1.7-5.5-3-8 3-.9 4.8-2.9 5.5-6l1-17c.3.8.8 1.5 1.5 2l5.5-11c.7-1.2 1.2-1.2 1.5 0-2.9 5.4-4.9 11-6 17 .4 4.2-.2 8.2-2 12a18 18 0 0 1 2 8c3.9.3 7.5 0 11-1 3.7-.6 6.9-2.2 9.5-5 1.4-2.5 1.8-5.2 1-8a663.3 663.3 0 0 1-15-31c-1-1.2-2.2-2.2-3.5-3-.6-1.1-1.5-2.1-2.5-3-.8 3-.6 5.8.5 8.5a7.5 7.5 0 0 1-3 3.5c.2-4.3-.1-8.6-1-13 .4-13.3-2.1-26-7.5-38-8.5-9-18.4-11-29.5-6-6.2 3-10 8-11.5 15-3 13.6-4.2 27.3-3.5 41 0 .7-.3 1-1 1-1.3-.8-2.3-2-3-3.5 1.1-2.7 1.3-5.6.5-8.5a24.7 24.7 0 0 1-4.5 4 6.7 6.7 0 0 0-1.5 7c2.8 4.5 5.3 9.2 7.5 14 .7-.5 1.2-1.2 1.5-2 .1 6.7.8 13.4 2 20a6.9 6.9 0 0 0 4.5 3c-.4 1.6-1 3-2 4.5 1.6 1.8 3.6 3 6 3.5h1c.2.6.7 1 1.5 1 1-.6 1.8-1.2 2.5-2 4.2 2 8.9 2.6 14 2 .3 1.7-5.3 2-17 1h-2c-2.4-1.3-5-2-8-2 .2 1.3-.1 2.3-1 3 .2-1.3-.1-2.3-1-3 0-2.5-.7-2.7-2-.5l-7 1a6.1 6.1 0 0 1 3 5c-.8 5.2-3.5 9-8 11.5a47 47 0 0 1-12.5-7l-1-20c-.3-1.3-.8-2.4-1.5-3.5A1699 1699 0 0 1 81 62.5c2.7-3.5 5.5-6.8 8.5-10 1.4-9.7 3.3-19.4 5.5-29a25.5 25.5 0 0 1 24.5-17c15.8 1 24.6 9.3 26.5 25l3 22a29 29 0 0 1 9 9l15 32c-.1 9-.4 18-1 27-4 2.7-8 5-12.5 7a11 11 0 0 1-4.5-3c-1.6-3.1-3.1-6.3-4.5-9.5 5.3-4 4.3-5.6-3-5-.8-1.4-1.4-1.5-2-.5Z"/><path fill="%233d375b" d="M145.5 56.5c.2 3.5-.6 3.8-2.5 1-5.7-10-12.5-19.2-20.5-27.5-2-.7-4-.7-6 0-4.7 5.3-9 10.8-13 16.5-.6-.6-1-1.4-1-2.5a469 469 0 0 0 2.5-18.5 32 32 0 0 0 3.5-13c11.1-5 21-3 29.5 6 5.4 12 7.9 24.7 7.5 38Z"/><path fill="%231e1b2e" d="M108.5 12.5a32 32 0 0 1-3.5 13 469 469 0 0 1-2.5 18.5c0 1 .4 1.9 1 2.5a116 116 0 0 0-8.5 12 24.4 24.4 0 0 0-1.5 10c-.7-13.7.5-27.4 3.5-41 1.4-7 5.3-12 11.5-15Z"/><path fill="%23100a0d" d="M145.5 56.5c.9 4.4 1.2 8.7 1 13-.8 1.3-2 2.3-3.5 3a5 5 0 0 0-.5 3c-.1 4.3-1.6 8-4.5 11 .6 8.6-1.3 16.6-5.5 24 1.2 1 2.5 1.3 4 1-.5-3.3.5-6 3-8 1.3 2.5 2.3 5.2 3 8-2.6.2-4.9.9-7 2a118.6 118.6 0 0 1-30 0c11.7 1 17.3.7 17-1 2.4-1 5.1-1.3 8-1v-5c-2.7.2-5-.6-7-2.5 2.9-.7 5.7-.5 8.5.5 1-.4 1.6-1 2-2a43 43 0 0 0 0-22c-9.7 11.9-19.4 11.9-29 0-2 7.3-2 14.6 0 22 3.4.8 7 1.3 10.5 1.5a35.6 35.6 0 0 1-7 3.5v3c-.7.8-1.5 1.4-2.5 2-.8 0-1.3-.4-1.5-1 .9.1 1.5-.2 2-1a34.4 34.4 0 0 1-3-32.5c-.2-.9-.6-1.7-1-2.5-3.6-1.5-7-3.5-10-6 .7 0 1-.3 1-1-.2-3.2.3-6.5 1.5-10a116 116 0 0 1 8.5-12c4-5.7 8.3-11.2 13-16.5 2-.7 4-.7 6 0 8 8.3 14.8 17.5 20.5 27.5 2 2.8 2.7 2.5 2.5-1Z"/><path fill="%23272727" d="M116.5 32.5c6 4.1 11.1 9.1 15.5 15 .7.8.5 1.5-.5 2a7.3 7.3 0 0 1-5 1.5c-4.7-4.4-9-9-13-14a6.9 6.9 0 0 0 3-4.5Z"/><path fill="%236d5f58" d="M121.5 52.5a96.6 96.6 0 0 0-9-9 11 11 0 0 0-5 6 3 3 0 0 1-2-2 72 72 0 0 1 7-9c3.8 5 7.8 9.8 12 14.5-1 .5-2 .3-3-.5Z"/><path fill="%23796a61" d="M105.5 55.5c-.5 0-.9.4-1 1 .6 2.6 1.6 5 3 7-.2.6-.7 1-1.5 1-3.3-2.6-5-6-5-10a7 7 0 0 1 3.5-4c9.4 3.6 9 4.7-1 3.5 1 .3 1.6.8 2 1.5Z"/><path fill="%23232323" d="M133.5 50.5a4 4 0 0 1 3.5 2 38.3 38.3 0 0 1 2.5 24l-3.5-13c-1.9-2-3.4-4-4.5-6.5a7 7 0 0 1 4-3c-5.3.1-6-1-2-3.5Z"/><path fill="%23cfb5a7" d="M121.5 52.5a6.5 6.5 0 0 0 3 5h-1a17.4 17.4 0 0 0-16 6c-1.4-2-2.4-4.4-3-7 .1-.6.5-1 1-1l4.5 3 4.5-1.5-1-1c5.3-2.3 5.3-3.3 0-3-2.2-1-4.2-2-6-3.5a11 11 0 0 1 5-6c3.2 2.8 6.2 5.8 9 9Z"/><path fill="%235b5049" d="M123.5 57.5h1a6 6 0 0 1 6 3.5l-1 .5a33.2 33.2 0 0 1-6-4Z"/><path fill="%231e1b2d" d="M92.5 69.5c3 2.5 6.4 4.5 10 6-10 .2-15.6-4.4-17-14 1.6-1.1 3.1-2.4 4.5-4 .8 3 .6 5.8-.5 8.5a7.5 7.5 0 0 0 3 3.5Z"/><path fill="%231c192b" d="M98.5 57.5c2 3.7 2.4 7.7 1 12-2-1.3-3.7-3-5-5l4-7Z"/><path fill="%23bd4438" d="M126.5 75.5c-.4 0-.8.1-1 .5l2 1a14 14 0 0 0-3 4c2.5-.2 4.8-1 7-2.5-3.5 7.3-9.1 9.8-17 7.5-4.3-2.5-7.3-6-9-10.5l3 2a6 6 0 0 0 6 3.5 14 14 0 0 0-3-4l2-1-6-9c7.2-10.6 15-11 23.5-1.5.7 1 .7 2 0 3-2 2-3.5 4.4-4.5 7Z"/><path fill="%233c365a" d="M85.5 61.5c1.4 9.6 7 14.2 17 14 .4.8.8 1.6 1 2.5a34.4 34.4 0 0 0 3 32.5c-.5.8-1.1 1.1-2 1h-1c-.3-3.3-1.6-6-4-8a6.9 6.9 0 0 1-4.5-3c-1.2-6.6-1.9-13.3-2-20-.3.8-.8 1.5-1.5 2-2.2-4.8-4.7-9.5-7.5-14-.8-2.7-.3-5 1.5-7Z"/><path fill="%2361221c" d="m108.5 77.5-3-2c-2-3-3-6.3-2.5-10 3.3 3.6 5.2 7.6 5.5 12Z"/><path fill="%231e1b2e" d="m151.5 60.5-2 12c-2 1.8-4.3 2.8-7 3-.1-1 0-2 .5-3a7.5 7.5 0 0 0 3.5-3c1.3-.8 2.3-2 3-3.5a13.1 13.1 0 0 1-.5-8.5c1 .9 1.9 1.9 2.5 3Z"/><path fill="%233e385c" d="M90.5 90.5c-2.2 5.4-4.7 10.7-7.5 16-1 .8-2.2 1.2-3.5 1-6-.8-9.7-4.2-11-10 4.2-10.1 8.7-20.1 13.5-30l8 16c.5 2.3.7 4.6.5 7Z"/><path fill="%234e1c17" d="M115.5 62.5h3c.3 1.8 1 3.4 2 5-.4 1.7-.9 3.4-1.5 5a12.4 12.4 0 0 1-3.5-10Z"/><path fill="%23571f1a" d="M131.5 78.5a15.2 15.2 0 0 1-7 2.5 14 14 0 0 1 3-4l-2-1c.2-.4.6-.6 1-.5 1.3-1.5 2.2-1.1 2.5 1l5-8c1.9 4 1 7.3-2.5 10Z"/><path fill="%233c375b" d="M151.5 60.5c1.3.8 2.5 1.8 3.5 3 4.7 10.5 9.7 20.8 15 31 .8 2.8.4 5.5-1 8a15.9 15.9 0 0 1-9.5 5c-2 0-3.6-1-4.5-3-2.3-5.4-4.5-10.7-6.5-16 1.1-6 3.1-11.6 6-17-.3-1.2-.8-1.2-1.5 0l-5.5 11a4.5 4.5 0 0 1-1.5-2l-1 17a7.6 7.6 0 0 1-5.5 6 8.1 8.1 0 0 0-3 8c-1.5.3-2.8 0-4-1 4.2-7.4 6-15.4 5.5-24 2.9-3 4.4-6.7 4.5-11 2.7-.2 5-1.2 7-3l2-12Z"/><path fill="%233d375b" d="M122.5 112.5c-5.1.6-9.8 0-14-2v-3c2.4-.9 4.7-2 7-3.5a62 62 0 0 1-10.5-1.5c-2-7.4-2-14.7 0-22 9.6 11.9 19.3 11.9 29 0a43 43 0 0 1 0 22c-.4 1-1 1.6-2 2-2.8-1-5.6-1.2-8.5-.5 2 1.9 4.3 2.7 7 2.5v5c-2.9-.3-5.6 0-8 1Z"/><path fill="%231f1c2f" d="M148.5 88.5c2 5.3 4.2 10.6 6.5 16 1 2 2.4 3 4.5 3-3.5 1-7.1 1.3-11 1a18 18 0 0 0-2-8c1.8-3.8 2.4-7.8 2-12Z"/><path fill="%231f1c30" d="M90.5 90.5c1 6 1 12 0 18-3.9.3-7.5 0-11-1 1.3.2 2.5-.2 3.5-1 2.8-5.3 5.3-10.6 7.5-16Z"/><path fill="%231f1c2e" d="M99.5 103.5c2.4 2 3.7 4.7 4 8-2.4-.5-4.4-1.7-6-3.5 1-1.4 1.6-3 2-4.5Z"/><path fill="%23553e29" d="M74.5 113.5c-1-2-2.7-3.4-5-4-.2-1.4 0-2.7.5-4a21 21 0 0 0 8.5 4.5c1.3.7 1.3 1.3 0 2-1.2.8-2.6 1.3-4 1.5Z"/><path fill="%2358402a" d="M169.5 108.5c-2 1.4-3.7 3-5 5-1.8-.5-3.5-1.4-5-2.5 3.4-1.4 6.5-3.3 9.5-5.5.5 1 .6 2 .5 3Z"/><path fill="%23ac7e54" d="M69.5 109.5c2.3.6 4 2 5 4 .4 1 1.7 1.4 4 1a3 3 0 0 1 2 2l-2 3 4 1a15 15 0 0 1-3.5 4 29.7 29.7 0 0 1-9-5c-.5-3.3-.7-6.7-.5-10Z"/><path fill="%23ad7f55" d="M169.5 108.5c.3 4 0 7.8-1 11.5l-8.5 4.5c-1.8-.7-3-2-3.5-4 .9-1 1.9-1 3 0 1-1 1-2 0-3 1.4-1.4 3-2.4 5-3 1.3-.3 1.3-.7 0-1 1.3-2 3-3.6 5-5Z"/><path fill="%23090505" d="M145.5 110.5c4 11 8.8 21.6 14.5 32a52 52 0 0 1 4 28c-.4 1-1 1.6-2 2-2.4-2.5-4-5.5-5-9-1.4-1.8-2.9-2.5-4.5-2a80.8 80.8 0 0 0 5.5 15c1.4 3.6.2 5.8-3.5 6.5-7 .8-13.3-.9-19-5-2-2-2.4-4.1-1-6.5-.6-4.6-2.5-8.6-5.5-12 0-6.4-3-9.7-9.5-10-3.1.9-6 2.2-8.5 4a10 10 0 0 1-4 9 94 94 0 0 0-3.5 15.5 26 26 0 0 1-23 4.5c-.2-2 0-4 .5-6 2.4-5 4.3-10.2 5.5-15.5-1.9-.2-3.4.7-4.5 2.5-1 3.5-2.6 6.5-5 9-1-.4-1.6-1-2-2a58.2 58.2 0 0 1 5-31c5.4-9 9.9-18.4 13.5-28 .9.7 1.2 1.7 1 3-.3 3.7 1.4 6 5 7a29 29 0 0 0 20 5 28 28 0 0 0 21-6c3.9-1.1 4.9-3.4 3-7l2-3Z"/><path fill="%23503b26" d="M80.5 116.5a3 3 0 0 0-2-2c.5-1.6 1.5-2 3-1.5 4.3 4.5 4 5.6-1 3.5Z"/><path fill="%235c432d" d="M164.5 114.5c-2 .6-3.6 1.6-5 3-1.8-1.4-3.3-1-4.5 1-.7-1.9-.2-3.4 1.5-4.5 2.7-.2 5.3 0 8 .5Z"/><path fill="%235a201a" d="M103.5 113.5c-.8.3-1.2 1-1 2-1.2-1-2.6-1-4-.5a12 12 0 0 1 4 2.5c-.7 0-1 .3-1 1-7.5-2.7-7.9-2-1 2-.7 0-1 .3-1 1-3.6-1-5.3-3.3-5-7 .9-.7 1.2-1.7 1-3 3 0 5.6.7 8 2Z"/><path fill="%23c14539" d="M103.5 113.5h2c9.9 1.3 19.9 1.3 30 0 1-.2 1.7.2 2 1-5.9 2.2-12 3.9-18.5 5-5.6-.9-11.1-2.2-16.5-4-.2-1 .2-1.7 1-2Z"/><path fill="%23591f1a" d="M142.5 111.5c.8.3 1.2 1 1 2 1.9 3.6.9 5.9-3 7v-1l3-2.5c-1.8-.1-3.4.4-5 1.5v-2c4.2-2.7 3.9-3.4-1-2-.3-.8-1-1.2-2-1 2.1-1.1 4.4-1.8 7-2Z"/><path fill="%232c110e" d="M138.5 116.5c-4.5 1.2-8.8 2.5-13 4a25 25 0 0 1-14 0c.7.1 1.4 0 2-.5a132 132 0 0 1-11-2.5 12 12 0 0 0-4-2.5c1.4-.6 2.8-.4 4 .5 5.4 1.8 10.9 3.1 16.5 4 6.4-1.1 12.6-2.8 18.5-5 4.9-1.4 5.2-.7 1 2Z"/><path fill="%231f1c2f" d="M158.5 150.5a190.2 190.2 0 0 0-18-27c1.4-1.2 3.1-2.2 5-3 5.5 9.6 9.8 19.6 13 30Z"/><path fill="%231f1c30" d="M99.5 124.5a4 4 0 0 0-3.5 2 460.5 460.5 0 0 0-15.5 22c3.8-9.6 8.1-18.9 13-28l6 4Z"/><path fill="%231d0c08" d="M101.5 118.5a20 20 0 0 0 10 2 25 25 0 0 0 14 0c4.5 0 8.8-.6 13-2a7.5 7.5 0 0 1 5-1.5l-3 2.5a61.4 61.4 0 0 1-40 1c-6.9-4-6.5-4.7 1-2Z"/><path fill="%23ad3e33" d="M138.5 116.5v2c-4.2 1.4-8.5 2-13 2 4.2-1.5 8.5-2.8 13-4Z"/><path fill="%23ab3d32" d="M102.5 117.5c3.6 1 7.3 1.8 11 2.5-.6.5-1.3.6-2 .5-3.6.2-7-.5-10-2 0-.7.3-1 1-1Z"/><path fill="%23bb4337" d="M140.5 119.5v1a28 28 0 0 1-21 6c-7.4.8-14-1-20-5 0-.7.3-1 1-1a61.4 61.4 0 0 0 40-1Z"/><path fill="%233b3559" d="M99.5 124.5c2.4 1 4.7 2.2 7 3.5L84 152.5c-2.8 4-4.8 8.3-6 13a40 40 0 0 1 2.5-17c5-7.4 10-14.8 15.5-22a4 4 0 0 1 3.5-2Z"/><path fill="%233b3558" d="M140.5 123.5c6.7 8.4 12.7 17.4 18 27 2.4 5 3.2 10.3 2.5 16-1-5.2-3-9.8-6-14l-21-22-1.5-3 8-4Z"/><path fill="%232f1d1c" d="M124.5 129.5c4-1.8 6.5-.5 7.5 4 4.2 4.5 8.7 8.7 13.5 12.5-1.2 1-2.5 2-4 2.5-5-5.7-9.7-11.7-14-18a3 3 0 0 0-3-1Z"/><path fill="%235b3837" d="M109.5 128.5c5 .8 10 1.2 15 1a3 3 0 0 1 3 1c4.3 6.3 9 12.3 14 18a25 25 0 0 1-8 1c-9.4-18.6-18.8-18.6-28 0-2.8.2-5.4-.1-8-1a182 182 0 0 1 10.5-14c.8-2 1.3-4 1.5-6Z"/><path fill="%23301d1c" d="M109.5 128.5c-.2 2-.7 4-1.5 6a182 182 0 0 0-10.5 14c-1.5-.6-2.8-1.4-4-2.5a57 57 0 0 0 16-17.5ZM133.5 149.5c-1.4.2-2.7 0-4-.5-6.3-15-13-15.3-20-.5a4.9 4.9 0 0 1-4 1c9.2-18.6 18.6-18.6 28 0Z"/><path fill="%231c1a2b" d="M117.5 139.5c1.6-.2 3.1.1 4.5 1 1.5 2.8 2.9 5.4 4 8a11.9 11.9 0 0 0-13 0c1-3.2 2.4-6.2 4.5-9Z"/><path fill="%23513b27" d="M95.5 150.5a4.7 4.7 0 0 0-4 3c-2.6-2-2.5-4 .5-6 1.1 1.1 2.3 2.1 3.5 3Z"/><path fill="%2358402a" d="M147.5 153.5a4.7 4.7 0 0 0-4-3c4.4-4 5.7-3 4 3Z"/><path fill="%23b18257" d="M95.5 150.5c2.8 1.4 5.8 2 9 2v5h-6a7.8 7.8 0 0 1-7-4 4.7 4.7 0 0 1 4-3Z"/><path fill="%23b28257" d="M143.5 150.5c1.9.2 3.2 1.2 4 3a8.1 8.1 0 0 1-8 4h-5v-5c1.3.2 2.3-.1 3-1 2 0 4-.3 6-1Z"/><path fill="%2357402a" d="M137.5 151.5c-.7.9-1.7 1.2-3 1v5h5c-2.4 1-5.1 1.3-8 1v-7h6Z"/><path fill="%235b422c" d="M104.5 152.5h3a9 9 0 0 1-1 5.5c-2.9.8-5.5.6-8-.5h6v-5Z"/><path fill="%23ab7d54" d="M141.5 167.5c-2.1-2.4-2.5-5-1-8 2.8-.3 5.5-.8 8-1.5 1 2 1.3 4.2 1 6.5a10 10 0 0 0-8 3Z"/><path fill="%23ac7e54" d="M89.5 160.5c3.2 1.3 6.5 2 10 2l-1 6c-2.4-2.7-5.4-4-9-4v-4Z"/><path fill="%235b432c" d="M97.5 176.5v-6c2.2 0 2.5-.6 1-2l1-6c-3.5 0-6.8-.7-10-2 .4-1.1 1-2.1 2-3 4.3 1.4 8.6 2.8 13 4-2.6 4.3-3.6 9-3 14a7 7 0 0 0-4 1Z"/><path fill="%235e452e" d="M140.5 159.5c-1.5 3-1.1 5.6 1 8a7 7 0 0 1-2 2.5c.2.4.6.6 1 .5v6l-2-1c-.4-5-1.7-9.6-4-14 1.8-1.3 3.8-2 6-2Z"/><path fill="%23b08156" d="M97.5 170.5v6a13.1 13.1 0 0 1-14 2.5c1.8-3.8 3.5-7.6 5-11.5 3.6-1 6.6 0 9 3Z"/><path fill="%23b18257" d="M140.5 176.5v-6c2.8-2.8 6-4 10-4 1 4.4 2.6 8.6 5 12.5-5.4 1.8-10.4 1-15-2.5Z"/></svg>','data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 920 835"><defs><path id="a" d="M50 250a69 69 0 1 1 50-150 69 69 0 1 1 150 0 69 69 0 1 1 200 100 69 69 0 1 1 50 100 69 69 0 1 1-50 100 69 69 0 1 1-200-50A69 69 0 1 1 50 250z" transform="rotate(120 188 228.6) scale(.6 .4)"/><path id="b" d="M250 350a69 69 0 1 1 50-150 69 69 0 1 1 150 0 69 69 0 1 1 100 100 69 69 0 1 1-150 100 69 69 0 1 1-150-50z"/><g id="c"><use href="%23a"/><use href="%23a" transform="translate(260 200)"/><use href="%23a" transform="rotate(90 235 385)"/><use href="%23a" transform="rotate(90 430 380)"/></g><g id="d"><use href="%23b" fill="%23568b19" transform="scale(.5)"/><use href="%23b" fill="%236fa128" transform="matrix(.4 0 0 .4 40 30)"/><use href="%23b" fill="%238eba41" transform="matrix(.3 0 0 .3 80 60)"/></g></defs><use href="%23c" fill="%231c3808"/><use href="%23c" fill="%23254110" transform="rotate(180 570 480) scale(1.5)"/><g fill="%233b6211"><use href="%23a" transform="matrix(1.5 0 0 1.5 -220 -190)"/><use href="%23a" transform="matrix(0 1.5 -1.5 0 660 100)"/><use href="%23a" transform="rotate(45 194.6 640.6) scale(1.5)"/><use href="%23a" transform="rotate(170 597.2 430.1) scale(1.5)"/><use href="%23a" transform="rotate(-100 423.7 241) scale(1.5)"/></g><g fill="%234b731c"><use href="%23a" transform="translate(-140)"/><use href="%23a" transform="rotate(-45 473.6 563.8)"/><use href="%23a" transform="rotate(-90 530 470)"/><use href="%23a" transform="rotate(-135 507.8 434)"/><use href="%23a" transform="rotate(180 530 400)"/><use href="%23a" transform="rotate(180 530 400)"/><use href="%23a" transform="rotate(125 525.3 407)"/><use href="%23a" transform="rotate(90 505 355)"/><use href="%23a" transform="rotate(45 542.1 284.6)"/></g><g fill="%2361852b"><use href="%23a" transform="matrix(.6 0 0 .6 50 40)"/><use href="%23a" transform="rotate(60 394.3 523) scale(.6)"/><use href="%23a" transform="rotate(120 419.2 428.7) scale(.6)"/><use href="%23a" transform="matrix(-.6 0 0 -.6 800 800)"/><use href="%23a" transform="rotate(-120 459.8 334.5) scale(.6)"/><use href="%23a" transform="rotate(-60 393 319.3) scale(.6)"/></g><path fill="%23553d0e" d="M606 121c2 3 2 7 1 11l-1 20-2 23c0 5-2 10-1 15 3-4 9-4 12-9 10-1 18-10 27-13 3-1 6-3 8-6l4-4c2-1 4 0 5 1 2 2 1 3 0 5a47 47 0 0 1-21 16 83 83 0 0 0-18 10l-19 11c-1 1-3 1-3 3 1 4-2 7-4 12 9 2 17 3 25 0l21-4c10-1 21-2 31-6 2-1 3 0 4 2 2 2 1 4-1 5-6 4-12 5-19 5-10 0-20 3-30 4-11 1-21 4-32 6-3 0-5 2-7 5-4 8-7 17-16 22l-14 12-17 9c1 2 2 3 4 3 8 0 17 1 26-1 11-2 22-3 32-10l15-7c7-3 13-8 20-12l6-4c4-3 6 0 8 2 3 3 0 5-2 7-9 6-16 13-27 17-8 3-15 8-23 12-8 3-17 7-27 5h-7l-13 1c-8 1-16 0-24-2-7-2-13 1-17 6a106 106 0 0 0-18 21c-5 9-9 18-10 28 0 7 8 17 14 18l26 5 24 3 21 4 13 4c18 5 36 12 56 7a83 83 0 0 1 16-3c5 0 11-2 15-6 8-5 17-7 26-11 6-3 13-4 20-6a8 8 0 0 0 4-3c10-13 24-20 39-25l2 1c-10 7-21 11-29 21 11-1 22-6 34-6 0 2-1 4-3 4a599 599 0 0 0-53 17c-8 3-16 5-24 11 9-1 17 1 25 2l40 5 25 4 6 1v7l-15-1c-8-2-15-1-22-3h-4c1 6 5 10 9 13a65 65 0 0 0 17 15c2 1 4 2 3 5h-6a83 83 0 0 1-29-27c-4-6-8-10-16-9-6 1-11 0-17-1h-8c-14 1-28 3-41 7-5 1-9 3-15 3 2 4 7 6 10 8a73 73 0 0 0 28 12c2 0 5 0 5 3s-3 3-5 3c-12 1-23-3-33-9-6-4-13-6-18-12-2-3-6-2-9-1-8 1-16-2-23-4-9-1-16-6-24-8l-15-4-42-7a224 224 0 0 1-14-2c-5-1-11 0-13 4-3 4-1 8 2 12l25 35 4 7a39 39 0 0 0 24 21c9 2 18 0 26-2 12-3 24-8 36-9l20-2c11 0 23-2 34 2l5 1c2 1 6 0 4 4 0 2-3 4-6 3a99 99 0 0 0-32-2l-22 1-22 6c-11 3-21 6-33 7-3 0-5 2-9-1l3 5c7 4 11 11 16 17l14 18 9 11c4 5 8 7 14 5a67 67 0 0 1 20-2l14-1c10 0 19 3 26 12a121 121 0 0 0 29 26l5 1c2 0 3 1 3 3 1 2 0 4-2 5-4 1-7 1-10-1-8-6-18-11-25-19l-8-10c-4-5-9-7-16-7h-22c-3 1-5 3-8 3 0 3 1 6 4 7 2 0 2 1 2 2 9 12 18 26 31 32 10 5 16 13 25 19 2 2 4 5 2 8s-6 2-8 0a144 144 0 0 1-14-12c-4-5-11-6-16-11a129 129 0 0 1-27-27c-3-5-8-8-13-12 3 7 2 14 8 19-2 13 6 22 7 35l5 36 4 27c1 3-1 6-4 6-3 1-4-2-4-5l-8-36-2-16-4-15c-2-5-1-10-2-15l-9-27c-1-5-6-9-9-13-4-7-11-11-14-20-2 11-8 21-10 31-3 10 2 15 6 21 5 6 9 12 11 19 0 4 3 7 5 11v4l-1 3c-2 1-3 0-3-2l-6-14a90 90 0 0 0-13-19c-2 7 1 14 2 20a76 76 0 0 0 3 12l2 6c1 3 1 7-3 9-4-2-4-5-5-9a799 799 0 0 1-8-36v-11c3-15 6-30 11-45 3-12-3-21-12-28a62 62 0 0 1-12-12l-11-11c-8-6-12-16-16-25a240 240 0 0 0-20-28c-2-2-3-5-6-6l-2 3c-1 10-5 19-7 28-3 10-7 19-4 30 1 6-1 13 1 19l7 22 4 14 3 25v30l-4 26c-1 12 3 22 7 33l9 27c1 3 1 6-2 10-5-15-10-30-20-42-3 2-3 7-5 11-5 12-12 23-15 35-3 8-7 15-7 24h-5v-6a62 62 0 0 1 6-28l8-20c3-5 7-10 8-15 2-9 8-17 8-27a29 29 0 0 0-2-7c-1-3-2-6 1-9l1-4-1-41a57 57 0 0 0-6-25c-7 3-9 9-13 14l-1 2c-5 5-7 12-12 17a19 19 0 0 0-5 10c-3 17-7 34-17 48-6 9-13 18-25 21h-7c-2 0-3-1-3-3l2-4c14 0 19-11 25-20 8-12 12-26 15-40 2-12 7-22 16-31 6-7 13-13 18-21 3-5 0-8-1-11l-3-14c-1-2-2-3-4-1-6 4-13 6-19 9l-22 11-1 1c-3 7-8 14-6 22 1 4 1 8-1 12-6-9-7-18-3-27-17 5-32 12-49 18-7 2-13 7-20 10a289 289 0 0 0-25 12l-17 11-14 10c-1 2-3 4-5 1-1-2 1-3 3-4l34-26a58 58 0 0 1 18-8c8-3 14-9 20-13a102 102 0 0 1 33-13 85 85 0 0 0 32-16l14-7c10-5 20-11 29-18l3-4c-1-10 4-18 6-26l2-8c-1-8 1-15 2-23a33 33 0 0 0-5-25c-2-3-5-4-10-4l-14-1a26 26 0 0 0-20 6c-1 1-2 2-1 4 4 4 3 9 4 14a111 111 0 0 1 0 39c-1 6-2 13-9 16a10 10 0 0 1-1-9l3-12v-8c-2-10-3-20-7-30-1-3 0-6-2-8-9 3-17 8-26 12l-3 1c-6 0-11 3-15 5-13 8-24 19-33 31a94 94 0 0 1-41 32l-37 13a74 74 0 0 1-32 5c-2-1-4-1-4-3s1-3 3-4l5-1c8 0 16-3 24-4l1-1c15-7 32-10 47-18a71 71 0 0 0 28-23l14-17 17-14h-21c-15 2-28-3-42-6l-23-2-12-5c-9-5-19-6-29-5-3 0-4 1-5 4-4 10-7 21-13 31-4 8-10 15-20 18v-4c12-8 23-29 20-37-4 2-6 6-9 9l-5 5c-1 1-2 2-3 1-2-2-1-3 0-4a33 33 0 0 1 3-6c8-9 16-18 26-25 10-6 20-9 32-6l5 1a173 173 0 0 0-14-39 75 75 0 0 0-29-27c2-3 4-3 6-2a71 71 0 0 1 32 26c5 7 9 14 12 22 2 4 2 9 5 12 7 5 9 15 18 19 3 2 6 2 9 2 9 2 19 6 28 6a456 456 0 0 0 26-2c-6-4-10-10-14-16-3-5-5-10-9-14-2-1-2-3 0-4 2-2 3-1 5 0l21 24 8 7c6 5 13 1 19-1l14-6c6-2 10-7 16-10 7-3 15-5 22-6l15-2c6-1 8-4 4-9-6-9-14-16-23-21l-8-3c-10-4-17-10-22-20a74 74 0 0 0-30-31c-11-7-20-16-29-26l-3-2c-12-4-21-13-33-18-5-2-9-5-14-6-7-1-12-6-17-11l-14-12c-1-2-2-4 0-6s4-1 5 0c12 11 26 18 40 24 7 3 14 7 22 9l1-14 4-24c1-6 0-12 2-18a82 82 0 0 1 8-21c1-3 4-4 7-3 2 2 2 5 1 7l-7 15c-4 9-2 20-4 30l-1 9c0 8-1 16 1 24l2 3c4 1 6 4 10 6l18 16 11 7c6 3 13 7 16 12l12 18c5 8 12 15 21 19 2 1 4 1 4-2 3-10 10-19 13-29 1-5 4-10 2-15-2-2-1-5-1-8a66 66 0 0 0-9-32 24 24 0 0 0-9-8c-5-4-12-6-18-8l-18-8-3-3c-1-1-3-3-2-5 2-3 4-2 7-1 7 4 15 6 24 8 14 3 25 9 32 23a92 92 0 0 1 8 33c1 12-3 22-8 32l-6 15-1 12 5 4c7 0 11 5 16 8 9 7 19 5 26-5 8-11 15-23 24-34a89 89 0 0 1 31-23 191 191 0 0 0 20-12c3-2 4-6 5-10 1-10-2-20-7-29-6-10-8-21-10-32a8 8 0 0 1 0-5c3-5 3-11 5-16 1-2 2-5 5-4 2 0 2 4 1 5a52 52 0 0 0 1 34 62 62 0 0 0 11 19l2 8c0 6 2 11 1 16 5-1 6-5 8-8 5-9 10-17 13-26 4-9 8-19 10-29l5-25 1-13a54 54 0 0 1 3-19l5-1"/><use href="%23d" transform="translate(350 300)"/><use href="%23d" transform="rotate(-45 959.6 -97.5)"/><use href="%23d" transform="rotate(-100 322.7 283)"/><use href="%23d" transform="rotate(-150 309.9 356.4)"/><use href="%23d" transform="rotate(180 400 160)"/><use href="%23d" transform="rotate(120 236.5 283.2)"/><use href="%23d" transform="rotate(90 190 210)"/></svg>','data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" viewBox="0 0 128 142"><path fill="%23090809" d="M64.5-.5h7a278 278 0 0 0 16 8.5 39 39 0 0 1 10 28.5 36 36 0 0 1 14.5 4c2.7 8.6 5 17.3 7 26 2.6.9 4.4 2.5 5.5 5l-.5 8a18 18 0 0 0-3.5 6.5 90 90 0 0 1 7 21.5v8c-.8 3.3-2 6.7-3.5 10l-1-1c-1.2 1-2.5 1.6-4 2-18.1-9-36-8.5-53.5 1.5-4 6.2-9.4 10.7-16 13.5h-2c-1.2-.9-2.4-1.9-3.5-3-1.4-4.4-2.9-8.7-4.5-13-3.9-1.2-7.7-2.5-11.5-4-4.5.5-8.7 2-12.5 4.5-3.7 2.7-7 5.7-10 9-1 .7-2 .7-3 0-.9-1-1.9-1.9-3-2.5v-21c1.6-6.2 4.3-12 8-17.5-2.6-3-3.4-6.6-2.5-10.5 4-10.5 7.3-21.2 10-32 4.6-3.4 9.4-6.4 14.5-9 2-.6 2.4-1.6 1-3A42.5 42.5 0 0 1 48.5 3c5.4-1.3 10.8-2.5 16-3.5Z"/><path fill="%23282828" d="M54.5 3.5c1.4-.2 2.7 0 4 .5A43 43 0 0 0 55 29.5c-9.3-4.3-12.3-11.3-9-21a16 16 0 0 1 8.5-5Z"/><path fill="%23272727" d="M66.5 41.5c-1.3 1.3-2.7 1.3-4 0 1.3-1.2 2-2.9 2-5-1.6-8-1-15.9 2-23.5l-.5-1.5a20.5 20.5 0 0 0-3 8c-.5 6-.5 12 0 18a36.3 36.3 0 0 1-2-20c-1.7 5.6-2 11.3-1 17a32.4 32.4 0 0 1-1-27A14.4 14.4 0 0 1 75.5 5c1.2 1.4 2.5 2.5 4 3.5-1.1 9-4 17.3-8.5 25l-5 5c-.7 1.2-.6 2.2.5 3Z"/><path fill="%23282828" d="M82.5 9.5c1-.1 2 0 3 .5 1.4 2.2 3.1 4.2 5 6a30 30 0 0 0-7 9.5c-2.3.8-4.4 1.8-6.5 3a58 58 0 0 0 2.5-18c1.3.2 2.3-.1 3-1Z"/><path fill="%23ded5cc" d="M62.5 41.5c1.3 1.3 2.7 1.3 4 0 4-4.5 8.3-8.6 13-12.5 2.5-1 4.5-.4 6 1.5 1.4 7.6 2 15.3 2 23l-4 6a29.4 29.4 0 0 0-6 11c-1.7 6-5.7 9-12 9-6.7-.7-11.3-4-14-10a60 60 0 0 0-7-11 18 18 0 0 1-6-13c1.8-4.4 2.8-9 3-14 2.7-3.5 6-4 10-1.5a60 60 0 0 0 11 11.5Z"/><path fill="%23726d68" d="M41.5 31.5c-.2 5-1.2 9.6-3 14-2-5.4-1-10 3-14Z"/><path fill="%237a7570" d="M85.5 30.5c1.8 1.9 3 4.2 3.5 7 .7 4.3.7 8.7 0 13a5.5 5.5 0 0 1-1.5 3c0-7.7-.6-15.4-2-23Z"/><path fill="%23b4aea7" d="M30.5 39.5c1.4 1.4 1 2.4-1 3 .6-.9 1-1.9 1-3Z"/><path fill="%23353456" d="M100.5 40.5c2.3.6 4.6 1 7 1.5.5.4.8 1 1 1.5l-3 10c-2.2.3-4.5.3-7 0a178 178 0 0 0 2-13Z"/><path fill="%2368635f" d="M92.5 42.5c1.3 1 2 2.5 2 4.5-.2 2.5-1 4.6-2.5 6.5-.8-3.8-.6-7.4.5-11Z"/><path fill="%236e6964" d="M33.5 43.5a7 7 0 0 1 2.5 2c.3 2.9.8 5.7 1.5 8.5l-1 1.5a15.8 15.8 0 0 1-3-12Z"/><path fill="%237d7872" d="M56.5 43.5c2.2 2 4.5 3.8 7 5.5-3.6 0-6-1.9-7-5.5Z"/><path fill="%23121111" d="M84.5 51.5c-2.4.3-4.7.8-7 1.5-1.1.8-1.1 1.6 0 2.5.5 2.4-.3 4.1-2.5 5-1.9-.6-2.9-2-3-4-2.1 1.4-3.3.7-3.5-2l.5-2c1 1 2.2 1.2 3.5.5l6-4c-1.5-1.2-1.3-2 .5-2.5 1.9.7 3.7 1.5 5.5 2.5 1.3 1 1.3 1.8 0 2.5Z"/><path fill="%23353457" d="M27.5 47.5c1.1 3.7 2.8 7.2 5 10.5a88.6 88.6 0 0 1-7 3.5c-1.4-2-3-3.7-5-5-1.8-1.4-2.2-3.1-1-5 2.5-1.8 5.1-3.1 8-4ZM110.5 46.5a67.4 67.4 0 0 1 5.5 27 13 13 0 0 1-11.5 4c-.3-3.2-1-6.4-2-9.5 3.4-7 6-14.1 8-21.5Z"/><path fill="%237c7771" d="M45.5 50.5c2.4.3 4.8 1 7 2 1.3.8 1.3 1.4 0 2a7.8 7.8 0 0 1-7-4Z"/><path fill="%2376716c" d="M84.5 51.5c-1.8 2-4.2 3.4-7 4-1.1-.9-1.1-1.7 0-2.5 2.3-.7 4.6-1.2 7-1.5Z"/><path fill="%231b1b2d" d="M96.5 54.5a971.7 971.7 0 0 0-3.5 35c-.2 2.5-1.4 4.1-3.5 5-.4-3 .5-5.7 2.5-8 1-10.6 1.5-21.3 1.5-32h3Z"/><path fill="%23353457" d="M19.5 56.5c3.4 5.4 6.4 11.1 9 17-6.4-.1-10.2 2.9-11.5 9 2.1-2.8 4.8-4.8 8-6 1.6.3 2.8 1.1 3.5 2.5a18.7 18.7 0 0 0-11 12.5 22.3 22.3 0 0 1-8-10c2.7-8.7 5.6-17.3 8.5-26 .4.6.9.9 1.5 1Z"/><path fill="%23736e69" d="M44.5 58.5c2.7 3.4 5 7 7 11-4.7-2.4-8-6-10-11h3Z"/><path fill="%23595315" d="M90.5 64.5c.1-.7 0-1.4-.5-2a4.2 4.2 0 0 1-2.5 3c.9-3.4 2-6.7 3.5-10 .8 3.2.6 6.2-.5 9Z"/><path fill="%2375716b" d="M77.5 70.5c1.2-4.2 3.2-7.8 6-11 .8.8 1.7.5 2.5-1 .3 1.4 0 2.7-1 4a83.2 83.2 0 0 0-7.5 8Z"/><path fill="%23b1a429" d="M90.5 64.5c.2 6.7 0 13.3-.5 20a9.2 9.2 0 0 0-1.5 10v1a6.6 6.6 0 0 1-4-6l2.5-5c.5-5.7.7-11.3.5-17v-2a4.2 4.2 0 0 0 2.5-3c.5.6.6 1.3.5 2Z"/><path fill="%23151522" d="M37.5 78.5c-1.4.2-2.7 0-4-.5a35 35 0 0 1-5-4.5c-2.6-5.9-5.6-11.6-9-17h1c2 1.3 3.6 3 5 5 2.4-1 4.7-2.2 7-3.5a41.2 41.2 0 0 1-5-10.5 7 7 0 0 1 3-2c.4 4.4 2 8.3 5 11.5l-2 2c1.7.7 3.4.5 5-.5a90.5 90.5 0 0 1 2.5 23 7.5 7.5 0 0 1-3.5-3Z"/><path fill="%23353457" d="M37.5 78.5a68.9 68.9 0 0 0-7.5-6 41.4 41.4 0 0 0-4.5-9.5c3.1-1.7 6.3-2.2 9.5-1.5 3 4.3 4.5 9.1 4.5 14.5-.2 1.4-.9 2.2-2 2.5Z"/><path fill="%23575113" d="M44.5 68.5v2h-1a10.1 10.1 0 0 1-1.5-6c1.5 1 2.3 2.3 2.5 4Z"/><path fill="%231f1e1d" d="M70.5 63.5c1 6-1.7 8.2-8 6.5-.9-1-1.9-1.9-3-2.5 0-1.2-.7-2-2-2.5a32 32 0 0 1 4-2.5c-.7-2-.7-4 0-6-2.5.3-4.6 1.3-6.5 3-2.2-.9-3-2.6-2.5-5 1.3-.6 1.3-1.2 0-2a21 21 0 0 0-7-2c-1.3-.6-1.3-1.2 0-2 2.4-2 5.1-2.4 8-1-.2.6-.5 1-1 1.5l7.5 5.5c1.8-2.7 3-2.4 3.5 1a8.5 8.5 0 0 0 0 8l-.5 2c-.7-1.2-1.2-1.2-1.5 0 1.6 3 4 3.7 7 2l2-4Z"/><path fill="%23232236" d="M44.5 68.5c5.7 2.5 7.5 6.8 5.5 13-.5 2.1-1.4 4.1-2.5 6-.6-.1-1-.5-1-1-.2-5.5-.8-10.9-2-16v-2Z"/><path fill="%2377726d" d="M72.5 69.5c-2.3 1.5-5 2.1-8 2-1.9 0-3.5-.3-5-1 .6-.7.6-1.7 0-3 1.1.6 2.1 1.5 3 2.5 6.3 1.7 9-.5 8-6.5 1.6-1 2.9-.6 4 1.5a4.3 4.3 0 0 0-2 4.5Z"/>/<path fill="%23161514" d="M59.5 70.5c1.5.7 3.1 1 5 1 3 .1 5.7-.5 8-2a3 3 0 0 1 3 1c-2.1 5.5-5.6 6.5-10.5 3a86 86 0 0 1-7.5 1.5c-.9-2-2.2-3.7-4-5 2.1-.7 4.1-.5 6 .5Z"/><path fill="%23373658" d="M87.5 67.5c.2 5.7 0 11.3-.5 17l-2.5 5c-3.5-8-2.5-15.4 3-22Z"/><path fill="%2340190d" d="M78.5 74.5c1.4 4.1 1.9 8.5 1.5 13a43.4 43.4 0 0 0-4.5-9.5c1.2-1 2.2-2.2 3-3.5Z"/><path fill="%23ab9e2b" d="M43.5 70.5h1a83.6 83.6 0 0 1 2 16l-2.5-3a85 85 0 0 1-.5-13Z"/><path fill="%23787878" d="M55.5 83.5c.2-1.7-.5-2.7-2-3 .6-3.3 1.8-3.6 3.5-1 .3 1.6-.2 3-1.5 4Z"/><path fill="%23747474" d="M75.5 82.5c-1.6.8-2.3 2.1-2 4l-3-5.5c2.5-2.3 4.2-1.8 5 1.5Z"/><path fill="%23565016" d="M105.5 79.5v2c-3.6.6-6.2-.6-8-3.5l.5-1.5c2.1 1.9 4.6 2.9 7.5 3Z"/><path fill="%23c8c8c8" d="M53.5 80.5c1.5.3 2.2 1.3 2 3 .2 4.6-1.3 5.6-4.5 3 0-2.3.8-4.3 2.5-6Z"/><path fill="%236d6d6d" d="M70.5 84.5h-7v-3c3.1-.5 5.5.5 7 3Z"/><path fill="%233d3b56" d="M110.5 83.5h-5v-2c5 0 9.8-1.3 14-4l1 .5c-2.8 2.9-6 4.7-10 5.5Z"/><path fill="%23998e2c" d="M106.5 86.5a7 7 0 0 1 4-3c4-.8 7.3-2.6 10-5.5l-1-.5c-4.2 2.7-9 4-14 4v-2c7.3.9 12.1-2.1 14.5-9 3.5 7.2 1.3 12-6.5 14.5-2.2 1-4.6 1.5-7 1.5Z"/><path fill="%231b1b2d" d="M9.5 81.5c1.7 4.2 4.4 7.5 8 10-.7 2.2-1.2 4.6-1.5 7a19.2 19.2 0 0 1-6.5-17Z"/><path fill="%233b3957" d="M34.5 81.5c1.5.5 2.8 1.2 4 2-9.1 4-12.8 11-11 21l-6-5v-2c.7-8.4 5-13.7 13-16Z"/><path fill="%23e1e1e1" d="M58.5 83.5a6.6 6.6 0 0 1 0 7c-1.3 0-2.3-.5-3-1.5 1.1-1.8 2.1-3.6 3-5.5Z"/><path fill="%23d6d6d6" d="M75.5 82.5c1.2 1.8 1.9 3.8 2 6-2 .3-3.3-.3-4-2-.3-1.9.4-3.2 2-4Z"/>a<path fill="%2359521e" d="M105.5 83.5h5a7 7 0 0 0-4 3 10 10 0 0 1-8-3c2.2-.6 4.6-.6 7 0Z"/>a<path fill="%239b9b9b" d="M58.5 90.5a6.6 6.6 0 0 0 0-7c.7-2.9 2-3.4 4-1.5-1.3 3-2.3 6.2-3 9.5-.6-.1-1-.5-1-1Z"/>a<path fill="%23d8d8d8" d="M63.5 84.5h7c2.3 6.6 0 9.3-7 8v-8Z"/>a<path fill="%236b6b6b" d="M116.5 90.5c0-.5-.4-.9-1-1l-9 2c-1-2.2-2.5-2.2-4.5 0a5 5 0 0 1-.5-3c5.2.4 10.2-.3 15-2 1.3 1.5 1.3 2.8 0 4Z"/><path fill="%23e4e4e4" d="M46.5 104.5c-4.9-.8-9.5-2.1-14-4-.3-9.5 4-13.3 13-11.5-5.5 3.6-4.8 5.8 2 6.5.2-1.3-.2-2.5-1-3.5 1-1.6 2.2-1.8 3.5-.5 1.3 5.1.2 9.5-3.5 13Z"/><path fill="%23b2a52c" d="M34.5 81.5c-8 2.3-12.3 7.6-13 16-1.2-.8-2.2-1.8-3-3 1.2-9.5 6.5-13.8 16-13Z"/><path fill="%23582312" d="M79.5 88.5c2 1 2.4 2.6 1 4.5-4.7 2.6-9.7 4-15 4.5v-3a15 15 0 0 0 14-6Z"/><path fill="%23323153" d="M96.5 54.5c2.7 0 5.4.4 8 1a256 256 0 0 1-8.5 20c-5.6 13.1-1.4 19.8 12.5 20 5 1 8.4-.6 10.5-5 5 9.5 6.4 19.5 4 30a136.4 136.4 0 0 0-34.5-25v-1h1c2.1-.9 3.3-2.5 3.5-5 1-11.7 2.1-23.4 3.5-35Z"/><path fill="%23d5d5d5" d="M116.5 90.5c-.1.6-.4 1.1-1 1.5-3.8.8-6.8.6-9-.5l9-2c.6.1 1 .5 1 1Z"/><path fill="%23562212" d="M52.5 91.5c0-.5.4-.9 1-1 3 3.3 6.6 4.6 11 4v3c-5.7.8-9.7-1.2-12-6Z"/><path fill="%231b1b2d" d="m14.5 112.5-5.5-11c-.7-.8-1.5-1-2.5-1 .7-1.8 1.7-3.5 3-5a25 25 0 0 0 7.5 7c.8 2.4 2 4.6 3.5 6.5-2.2 1-4.2 2-6 3.5Z"/><path fill="%23b4a82b" d="M38.5 83.5c1.4.2 2.8.7 4 1.5-5.6 1-9.5 4.1-11.5 9.5a61 61 0 0 0-.5 11c-1.1 0-2.1-.4-3-1-1.8-10 1.9-17 11-21Z"/><path fill="%23461c0e" d="M85.5 105.5a11 11 0 0 0-6-5l5-4c6 2.2 6.2 5.2 1 9Z"/><path fill="%23722e17" d="M73.5 97.5c1.4-.2 2.7 0 4 .5a19 19 0 0 1-22 1.5c4.8 0 9.8-.1 15-.5 1.2-.2 2.2-.7 3-1.5Z"/><path fill="%23353457" d="M6.5 100.5c1 0 1.8.2 2.5 1l5.5 11a43 43 0 0 0-11.5 13c-1.2-8.7 0-17 3.5-25Z"/><path fill="%23717171" d="M32.5 100.5c4.5 1.9 9.1 3.2 14 4-1.1 2.6-3.1 3.5-6 2.5-2.3-.8-4.6-1.5-7-2a6.5 6.5 0 0 1-1-4.5Z"/><path fill="%2385351b" d="M79.5 100.5a11 11 0 0 1 6 5c-3.8 5-8.8 7-15 6-1-2.4-2.3-4.6-4-6.5 4.4-1.4 8.8-2.9 13-4.5Z"/><path fill="%23565016" d="M18.5 94.5c.8 1.2 1.8 2.2 3 3v2c.5 2.7.7 5.3.5 8-2.9-3.8-4-8.1-3.5-13Z"/><path fill="%23421a0d" d="m54.5 102.5-6 9c-1.6-.5-2-1.5-1.5-3 1.7-1.8 3.2-3.8 4.5-6 1.1-1.3 2.1-1.3 3 0Z"/><path fill="%2381341a" d="m54.5 102.5 8.5 2c-.8 2.9-1.4 5.9-2 9a17 17 0 0 1-12.5-2l6-9Z"/><path fill="%235e5716" d="M27.5 104.5c.9.6 1.9 1 3 1a17 17 0 0 0 4 6c-4.4.3-6.7-2-7-7Z"/><path fill="%23282828" d="M49.5 119.5c3 .8 6 1.1 9 1-1.2 6.6-4.6 12-10 16-.5-4-.5-8 0-12 2.1.7 4.1.7 6 0-1.2-.9-2.6-1.5-4-2a3 3 0 0 1-1-3Z"/></svg>','data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision" text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd" clip-rule="evenodd" viewBox="0 0 240 240"><path fill="%23070503" d="M69 17h20c4 1 8 2 11 5 1-2 2-2 4-2 4 1 8 3 12 7l3-1c5 5 10 11 14 18 2 6 3 12 2 19 8 3 16 7 23 14l20-3c3-1 5 0 8 3l-4 1c7 2 13 5 18 11l11 22 1 1c2-2 4-3 7-3 11 11 15 24 12 40l-14 23c-1 8 0 16 3 24-1 11-7 17-17 20l-9-6 3-3c-3 0-4-2-4-4 1-2 2-2 3 0l1-4 7-7c-1-4-4-7-7-8l-1 2c0 2 1 5 3 7l-2 3c-2-2-3-2-4 0 1 4-1 6-6 4-1 6-4 7-8 3-2 0-4 0-5 2-6-5-9-10-9-17l-7-16-14-12-5 22c-4 1-8 2-11 5l-15-6-5-22c-4-2-7-2-9 0l-5 8c-4 0-6 2-8 5-2-2-3-3-2-5l-8 3c0-6-1-7-5-4l-2-1-1-6c-3 0-3 2-1 5v14l-3 3-2-6c-4-1-6-2-8-5-4-1-7 0-8 4-3 5-3 10 0 16l-5 7 1 4c-4-1-6-3-8-5-3 1-3 4 0 7h-4c-4-4-7-9-9-14-1 3-3 5-6 7-2 2-2 5-2 7-3 1-5 0-6-2-2-12 1-21 11-27l5-14-2-9-9-20c-2-14 1-26 10-36 6 1 12 0 19-3 2-9 6-16 13-22 11-5 24-6 36-1l11-6v-2L82 36l2-2c-5-5-9-10-15-14v-3ZM48 124h23l4 4c-7 5-8 11-3 18l-4 4-4 8-2-2-11-1c-5-2-8-5-7-10l4-21Zm130 8 15 4-1 9 1 25-7 4c-3-2-4-5-4-7 3-7 4-13 3-20-2-6-4-11-7-15Z" opacity="1"/><path fill="%2316100a" d="m75 22 1-1 17 9c1-2 0-3-1-4 6 1 12 3 17 7l11 4 8 12 1 14-6 1-6-2-11 2-12-17v-2h2c-6-10-13-17-21-23Z"/><path fill="%23100b07" d="M207 110c-8 2-14 6-19 11l-2 1-1-1c3-3 6-6 11-8l-14-1-9-11c-5-2-10-3-14-2l-1-9-2-2c-7 1-13 4-18 8-3 2-4 4-4 7l3-2c-5 6-8 14-9 23l-3 1c-2-9-6-16-13-22-1-5-4-9-8-10l-3 17c-1 3 0 6 2 9l-1 1-4-5-2 2c-2 5-2 11 0 18-2 0-3 0-3 2-1 2-1 4 1 6 5 3 9 7 13 12-9-3-15-8-21-14l-10-17 13 12c-1-3-2-6-1-9h-4v-3c3-1 6-3 8-6-3-4-4-7-4-10l4 7-2-14-4 2-8-2-7 4c-2 1-3 3-2 5l-4-2-1 2c-4-4-7-5-11-5l-8-9c2-6 6-12 11-16l-3-1c9-3 8-4-1-3 0-1 1-2 3-2 9-3 19-2 28 4l15-9v3c5-4 11-6 17-7l-5 4 13-2c2-1 3 0 5 2l4-1c15 5 28 13 39 24l-1-5c10-3 19-1 28 5l-4 1 9 7-4 1c3 2 6 5 8 9Z"/><path fill="%23281f16" d="M137 101c0-2 1-3 3-4l7-3c2 8 2 16 0 24 5 0 8 3 8 10l-2 1 1 4 1-3-3 12c-4 2-7 5-9 9l1-8c2-5 4-9 4-14l-1-1c-4 2-6 5-8 8-5 2-9 2-13 2-1 2-2 2-3 0l-1-3h-2c-4-6-9-9-15-9l8 5c-1 1-2 3-1 5 1-4 2-4 4-1-2 0-3 2-1 3-4 2-6 4-6 9v6l-13-18c-2-7-2-13 0-18l2-2 4 5 1-1c-2-3-3-6-2-9l3-17c4 1 7 5 8 10 7 6 11 13 13 22l3-1c1-9 4-17 9-23Z"/><path fill="%23292017" d="M45 96a4217 4217 0 0 1 11 11c-9-2-15 0-20 7 3 2 6 3 11 3h13l2-2-3-6 12 12c-9 1-17 0-25-1-5-1-6 1-6 5 1-2 3-3 5-2l-4 20c0 12 7 18 20 16l3 8c-3 0-5 1-5 4-6-7-11-7-16 1-3 4-3 10-1 15l-2 7c-1-4-3-6-6-4-3-5-3-9 0-12v-8c-3 1-3 3-1 5-4 5-4 10-1 16l-1 2c-5-1-7-4-7-8l4-11c-2-2-2-3 0-5h-3l-1 8-7 14-3 2c-4-4-4-8-1-11l7-6c1-6 3-11 6-15v-10l-6-20c2-3 2-6 1-8 1-8 3-16 6-23l14-5 3 2 1-1Z"/><path fill="%232a2118" d="M159 99c4-1 9 0 14 2l9 11 14 1c-5 2-8 5-11 8-2 0-4 1-5 3l-22 24-5 2 6-5 1-10 4 1c0-6-2-12-5-16l9-13-1-1-10 12-1-2 3-17Z"/><path fill="%23291f15" d="m84 124-17-11-3-3 1-2 4 2c-1-2 0-4 2-5l7-4 8 2 4-2 2 14-4-7c0 3 1 6 4 10-2 3-5 5-8 6Z"/><path fill="%23453d34" d="m56 107 3 2 3 6-2 2H47c-5 0-8-1-11-3 5-7 11-9 20-7Z"/><path fill="%23291f15" d="M207 110c1 5 4 9 9 13l6 14c-2 12-5 23-9 34l2 23c-1-2-2-2-2 1 0 2 1 5 3 7-2 5-5 7-9 7 2-7 2-14 0-21-8-9-15-9-21 2l-3 1-2-8 2-4c4-3 8-5 13-6l3-8a485 485 0 0 1 6-32c1-2 0-3-2-2-2-5-5-8-9-10h-6c5-5 11-9 19-11Z"/><path fill="%23433b32" d="m67 113 17 11v3h4c-1 3 0 6 1 9l-13-12-9-11Z"/><path fill="%23443c33" d="M188 121h6c4 2 7 5 9 10-8 0-14-2-19-6 0-2 1-3 2-3l2-1Z"/><path fill="%23292017" d="M76 132c6 8 14 16 24 23-10 3-17 0-24-6a6678 6678 0 0 0-2-14l2-3Z"/><path fill="%232eb900" d="M115 133c3-1 3 0 1 2l-1-2ZM137 133c3-1 3 0 1 2l-1-2Z"/><path fill="%23443c34" d="M144 143c-4-5-9-6-13-1-1 1-2 3-1 5 1-5 4-7 9-6 3 2 3 5 1 8-2-1-4-2-5-1-3 2-5 5-6 9h2l4-7c1-1 3-1 4 1 1 6 0 12-2 18-3-1-5 0-8 2l-2-1c1-3 3-5 6-6l1-3-14-1c-2 1-3 2-2 5 6 3 5 5 0 4-2 2-4 2-5 0-2-6-2-12 0-18 1-2 2-2 4-1l4 7h3l-7-9c-2-1-4 0-5 1-2-6 0-8 6-8 2 2 4 4 5 8 0-4-2-8-4-10 1-1 2-2 4-1 1 2 2 2 3 0 4 0 8 0 13-2 2-3 4-6 8-8l1 1c0 5-2 9-4 14Z"/><path fill="%232a2117" d="m176 137 6 9-2 2v15l-4 5-5-1-3 2c-8-2-15-6-21-11l9-5 2 4c8-5 14-12 18-20Z"/><path fill="%23433b32" d="m205 133 1 2a485 485 0 0 0-10 38l1-23c1-7 4-12 8-17Z"/><path fill="%23cab69d" d="m118 172 1 4c-1-2-2-3-1-4Z"/><path fill="%239f8f7b" d="M122 173h7c-6 1-6 1 0 2l-7 1v-3Z"/><path fill="%238d806e" d="M134 172h3c1 2 0 5-1 8l-1-5h-3c0-2 1-3 2-3Z"/><path fill="%23e0cbae" d="M114 173c1 1 2 3 1 6l-1-6Z"/><path fill="%23281e15" d="m181 174 1 1c-4 6-6 13-7 20l-2-3-5-15 11-2 2-1Z"/></svg>','data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision" text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd" clip-rule="evenodd" viewBox="0 0 240 240"><path fill="%23050407" d="m138 54-10-6-3-12v-9l-1-1c-1-2-3-3-4-2l-12 8-2 6-8 9 2 5c-4 7-6 15-5 24-1 5 0 11 2 16l4 3-7 1-4-6-2-19-18 17a396 396 0 0 0 4 23l-2-1-1-1c-1 1-2 2-1 4 0 4 2 8 4 13l5 7 1 1-9 2-1 1c-3 0-3 2-2 4-2-1-3 0-4 1v3a1049 1049 0 0 1 28 19l1-4 1 8h-3l-2-1c-2 2-2 4-1 7l10 17-6-2c-2 1-2 3 0 5l-2 1c-2 0-3 0-4 2l-1 1-3 4c-2-2-3-3-2-5l8-11-6-9c-14-4-20-12-19-26-3-2-4-5-5-8v-2l9-10-3-19c0-3 1-6 3-8l-3-15c6-12 14-21 25-27 4-6 5-12 3-18 2-4 5-6 8-7-1-6 1-9 6-12l15-5c5 0 8 3 10 8l1 14 6 12Z"/><path fill="%235f5aa6" d="M108 32c1-1 2 0 3 1-4 10-7 20-7 31 5 4 9 8 12 14l-1 1c4 2 5 4 5 9l4 9-7-5v4c-7-3-14-5-20-4-2-5-3-11-2-16-1-9 1-17 5-24l-2-5 8-9 2-6Z"/><path fill="%230f0d0f" d="M110 45c5-1 7 1 5 7l-3 1c-3-3-4-5-2-8Z"/><path fill="%23aba34b" d="M111 47h3c-1 3-2 3-3 0Z"/><path fill="%23483d76" d="m124 26 1 1v9l3 12c3 10 9 20 17 30v10l-6 8-3 2v-4l-9-3c5 0 6-3 4-7h-3l4-2c-1-2-2-4-1-5-4-2-7-4-9-7l-4-1c6 0 7-2 3-7-2 0-4 0-4 2l-2-8-3-3 3-1c2-6 0-8-5-7l6-2 9-14-1-3Z"/><path fill="%230a080d" d="M128 48a5083 5083 0 0 1 13 10c13 6 22 16 26 31l-1 7 3 11-2 20 14 16-7 9c1 14-5 22-19 25l-5 9 8 14-4 3c0-3-1-4-2-5l-3-3-7 4h-4l9-8-2-2c-2 0-3 2-4 3h-2l9-17c2-8 0-9-6-4l-2 10v-9h-3l-1 7-9 16v4l-2 1c0-8 3-15 8-20l2-6h-10l-4 4-2 1-5-2-2-3-9-1 1-2-6-4c1-2 2-2 3 0 3-2 3-3 1-3l-6 2 1-9 2-1h4v4h-5l4 2a3619 3619 0 0 0 11-3l-7 7 11 8c2 1 4 0 5-2l2-6h3v3l5-4-7-5c-1-1-1-2 1-2 3 3 8 4 14 4l-1-10c-1-5 1-8 7-9 3 5 4 4 3-3 3-5 5-11 3-17-1-2-2-3-1-4h-3l-3 2-4-1v3l-4 2 7 2-8 5c2 2 2 4 0 6l-5 1-2-1c-2-3-3-5-3-8l-9-1-1-2 10-2a109 109 0 0 0 28-15c4-6 6-12 6-20l-2-14-14-9-1 1 6 14c0 7-2 13-7 19v-3l-12 6h-11c-5-2-5-3 0-3 5 1 11 0 17-3l3-2 6-8V78c-8-10-14-20-17-30Z"/><path fill="%23564f94" d="m124 26 1 3-9 14-6 2c-2 3-1 5 2 8l3 3 2 8c-1 1 0 3 1 5l4 1c2 3 5 5 9 7-1 1 0 3 1 5l-4 2c-3 0-4 1-3 3-1 2 0 3 2 4l9 3v4c-6 3-12 4-17 3l5-1v-3l-4-9c0-5-1-7-5-9l1-1c-3-6-7-10-12-14 0-11 3-21 7-31-1-1-2-2-3-1l12-8c1-1 3 0 4 2Z"/><path fill="%23181517" d="M118 69c-1-2-2-4-1-5 0-2 2-2 4-2 4 5 3 7-3 7Z"/><path fill="%23161318" d="M129 72h4v4c-3 0-5-1-4-4Z"/><path fill="%2317151d" d="M108 76c7 5 6 7-2 7-1-3 0-6 2-7Z"/><path fill="%23938f3c" d="M108 79c1-1 2 0 3 2-2 1-3 0-3-2Z"/><path fill="%23121013" d="M128 84h3c2 4 1 7-4 7-2-1-3-2-2-4-1-2 0-3 3-3Z"/><path fill="%239c9546" d="M127 86h4v3h-4v-3Z"/><path fill="%23453b71" d="M144 117c0-10-5-15-14-13l12-6v3c5-6 7-12 7-19l-6-14 1-1 14 9 2 14c0 8-2 14-6 20l-10 7Z"/><path fill="%23201c29" d="M153 85c4-1 6 2 4 6h-4v-6Z"/><path fill="%236e673e" d="M154 86c3 0 3 1 1 4-1-2-2-3-1-4Z"/><path fill="%236460a9" d="m94 96 10 4-2-2h4a715 715 0 0 1-9-6c6-1 13 1 20 4v-4l7 5v3l-5 1c-5 0-5 1 0 3h11c9-2 14 3 14 13l-18 8h-11c-1-3 0-6 1-8-1 3 0 5 4 4 2-2 2-4 0-6l2-1c-8-11-17-14-29-9l-3 4-1-3c-2-1-4-2-5-1-1 2 0 4 3 5l-3 5 2 2c-6-1-9-4-11-8l-5-21 18-17 2 19 4 6Z"/><path fill="%232b2a48" d="m101 95 5 3h-4l2 2-10-4 7-1Z"/><path fill="%231b1921" d="M82 88c1-2 2-2 3 0 2 5 0 6-5 5-1-3 0-4 2-5Z"/><path fill="%2398953e" d="M82 88c2 0 3 1 3 4h-3v-4Z"/><path fill="%236d6cb2" d="M120 115c-2 0-2 0-2 2h-2c-1 2-2 5-1 8-11-2-20-4-29-8l-2-2 3-5 3-1 3-4c12-5 21-2 29 9l-2 1Z"/><path fill="%231f1b1d" d="M145 102h5c0 3-2 5-5 4v-4Z"/><path fill="%23302e32" d="m89 106 1 3-3 1c-3-1-4-3-3-5 1-1 3 0 5 1Z"/><path fill="%23afad53" d="M89 106c-1 1-1 2-2 1 0-1 1-2 2-1Z"/><path fill="%23e1df6f" d="M104 106c1-1 2 0 3 1v3h-3v-4Z"/><path fill="%2324232e" d="M104 106v4h3v-3c2 1 2 2 0 4-4 1-6 0-6-3 0-2 1-3 3-2Z"/><path fill="%23181717" d="M128 110h4c-2 6-4 6-4 0Z"/><path fill="%234d3d51" d="m72 110 1 5-1 1-2-3c-1-2 0-3 1-4l1 1Z"/><path fill="%23534556" d="m79 133-5-7c-1-4 0-7 3-8l1 1v7c-1 2 0 4 2 6l-1 1Z"/><path fill="%23121215" d="M120 115c2 2 2 4 0 6-4 1-5-1-4-4h2c0-2 0-2 2-2Z"/><path fill="%23dedc67" d="M118 117c1 0 2 1 1 3-3-1-3-2-1-3Z"/><path fill="%234a3b4e" d="M160 108c3 0 4 2 4 5l-3 14c-4 4-5 3-2-1 2-6 2-10-1-15l2-3Z"/><path fill="%23857678" d="M134 148c0-2 1-3 2-3l1-5-6-1 5-1c2-2 2-4 0-6l8-5c1-2 2-2 3 0l-6 11c0 5-2 8-7 10Z"/><path fill="%23514055" d="M148 119h3c-1 1 0 2 1 4 2 6 0 12-3 17 1 7 0 8-3 3l-2-3c7-6 8-13 4-21Z"/><path fill="%23dfd8c2" d="m96 129 7 3c-3 2-3 4-1 6h7l1-3a255 255 0 0 1 17 3l-3 6c-3 2-6 2-9 1-1-1-2-2-3-1s0 3 1 5l-4 1c-5-1-9-4-12-7l1-4c-2-3-4-6-4-9 0-1 1-2 2-1Z"/><path fill="%2385787b" d="m117 129 9 1c0 3 1 5 3 8-2-1-4-2-5-1l-14-2-1 3v-4c4 0 5-2 2-5h6Z"/><path fill="%238a7e7f" d="M96 129c-1-1-2 0-2 1 0 3 2 6 4 9l-1 4-2-1-1-6c-3-3-4-7-2-10l4 3Z"/><path fill="%2349386d" d="m161 132 10 8-19 15-1-1c3-5 3-9 1-14 2-4 5-7 9-8Z"/><path fill="%23473868" d="m70 137 1-1c3-1 6 0 9 1-2 2-3 5-2 8-2-3-3-5-2-7l-6-1Z"/><path fill="%2364569b" d="m70 137 6 1c-1 2 0 4 2 7 1 2 3 4 7 5l4 1v3h-3l-18-13c-1-2-1-4 2-4Z"/><path fill="%23ab9f97" d="M124 137c1-1 3 0 5 1l2 1 6 1-1 5c-1 0-2 1-2 3-9 5-17 6-25 2l4-1c-1-2-2-4-1-5s2 0 3 1c-3 0-3 1-1 3h9c3-1 3-3 1-4l3-6-3-1Z"/><path fill="%23d1cb52" d="m64 142 23 15v3c-9-4-16-9-23-15v-3Z"/><path fill="%231f1b1e" d="M148 119c4 8 3 15-4 21l2 3c-6 1-8 4-7 9-5 0-6 1-2 3 1 3 0 4-3 3-1-1-2-2-1-3-12 2-23 1-34-3 0-2 0-3 2-3l-6-7 2 1c3 3 7 6 12 7 8 4 16 3 25-2 5-2 7-5 7-10l6-11c-1-2-2-2-3 0l-7-2 4-2v-3l4 1 3-2Z"/><path fill="%23242221" d="M124 144c2 1 2 3-1 4h-9c-2-2-2-3 1-3 3 1 6 1 9-1Z"/><path fill="%237e7343" d="M173 142c1 0 2 1 1 3l-29 19c-1-2 0-4 1-5 10-4 19-10 27-17Z"/><path fill="%23625860" d="M167 155c0 3 0 6-2 9l-9 7c-2-3-2-6-2-8l13-8Z"/><path fill="%23827747" d="m87 157 6 3-1 4-5-4v-3Z"/><path fill="%23413767" d="M99 152c11 4 22 5 34 3-1 1 0 2 1 3 3 1 4 0 3-3-4-2-3-3 2-3l1 10c-6 0-11-1-14-4-2 0-2 1-1 2l7 5-5 4v-3h-3l-3-4-1-4c-1-2-2-2-2 0-2-2-4-1-5 1l-2-1-9 4-4-2h5v-4h-4v-4Z"/><path fill="%231b1820" d="M121 162c-4 0-5-2-3-4 0-2 1-2 2 0l1 4Z"/><path fill="%236d6567" d="m70 155 13 8-1 8c-8-3-12-9-12-16Z"/><path fill="%23585399" d="M118 158c-2 2-1 4 3 4l3 4-2 6c-1 2-3 3-5 2l-11-8 7-7c1-2 3-3 5-1Z"/><path fill="%23181721" d="M114 162c3 0 4 2 3 5l-5 1c-1-3 0-5 2-6Z"/><path fill="%23948f65" d="M114 164c1 0 2 0 1 2l-1-2Z"/><path fill="%23463669" d="m138 199-7 1v-4l9-15 2-10c6-5 8-4 6 4l-9 17h2c1-1 2-3 4-3l2 2-9 8Z"/><path fill="%235f4f96" d="m91 168 3 2c2 9 6 18 12 26l1 4-6-1-9-5c-2-2-2-4 0-5l6 2-10-17c-1-3-1-5 1-7l2 1Z"/><path fill="%23453669" d="m103 173 9 1 2 3h-10c-1-2-2-3-1-4Z"/><path fill="%23564584" d="M125 200h-13v-4l1 3 5-1c3-7 6-13 7-20h-4l4-4h10l-2 6c-5 5-8 12-8 20Z"/><path fill="%23100e10" d="M75 109c2 4 5 7 11 8 9 4 18 6 29 8h11l-10 2 1 2h-6c3 3 2 5-2 5v4h-7c-2-2-2-4 1-6l-7-3-4-3c-2 3-1 7 2 10l1 6 6 7c-2 0-2 1-2 3v4l-2 1-1 9 6-2c2 0 2 1-1 3-1-2-2-2-3 0l6 4-1 2c-1 1 0 2 1 4a104806 104806 0 0 0 8 19v4h13l2-1 1 1 2-8 10-16v5l-9 15v4l7-1h4c-2 0-4 1-5 3l2 2 8-1 1-3 4 1v-3c1 1 2 2 2 5l-3 3c-4 0-8 1-11 3l-7-4h-30l-7 4c-6-1-11-3-14-7l3-4c0 2 1 3 4 2l1 4c3-2 6-2 9 0v-3l-9-6 2-1 9 5 6 1-1-4c-6-8-10-17-12-26l-3-2h3l-1-8-6-3-23-15c1-1 2-2 4-1l18 13c7 6 10 4 9-6l-5-4-2 1v5h-3c-4-1-6-3-7-5-1-3 0-6 2-8-3-1-6-2-9-1l9-2-1-1 1-1c-2-2-3-4-2-6v-7l-1-1c-3 1-4 4-3 8-2-5-4-9-4-13l2 3 1-1-1-5 2 1 1-2Z"/><path fill="%236756a1" d="M104 177h10l5 2 2-1h4c-1 7-4 13-7 20l-5 1-1-3-1-4-7-15Z"/><path fill="%23786e3d" d="M101 176c-2-2-3-2-2 1-1-2-2-4-1-5h3v4Z"/><path fill="%234b3b6e" d="M86 154h3v-3l-4-1h3v-5l2-1 5 4c1 10-2 12-9 6Z"/><path fill="%236c5d6d" d="M83 122c2 0 4 0 6 2-4 5-3 10 3 14-4 1-7 3-9 7-2-1-2-2-2-3l5-7-4-10 1-3Z"/><path fill="%236d643a" d="m140 176-10 16-2 8-1-1v-4l9-16 1-7h3v4Z"/><path fill="%23b8b446" d="M101 176c1 6 4 11 8 17v7l-3-9c-3-5-6-9-7-14-1-3 0-3 2-1Z"/><path fill="%23857778" d="m90 195 9 6v3l-4-4-9-3c1-2 2-2 4-2Z"/><path fill="%23827275" d="M152 198v3l-4-1-1 3-8 1-2-2c1-2 3-3 5-3l7-4 3 3Z"/><path fill="%23bbb1a1" d="m86 197 9 3 4 4c-3-2-6-2-9 0l-1-4c-3 1-4 0-4-2l1-1Z"/></svg>','data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision" text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd" clip-rule="evenodd" viewBox="0 0 212 226"><path fill="%23030303" d="m115 29-1 1-5 4-11 2-7-3-7 6-27 10-7-4-12 21-9 5-16-9c-4-10-2-18 7-25 4-3 9-6 15-7l6 2c0-6 1-11 3-16 3-4 7-7 12-8 6-1 13-3 20-3l9 2 5 8c2-3 4-4 7-5 5-1 10-1 16 1 3 5 3 11 2 18Z"/><path fill="%23747474" d="M84 16c-4-3-7-4-11-4-8 0-15 2-21 8-2 4-3 9-3 14l-1-1c-1-6 0-11 1-15 5-5 10-7 17-8h15l3 6Z"/><path fill="%23767676" d="m109 16-6 2-3 3c-2-2-4-3-6-2 1-5 4-6 9-5 2 0 4 0 6 2Z"/><path fill="%23060505" d="m156 63-1-1-8-6-3-6-1 1-15-3c-5-2-9-5-10-10l-4-8 1-1 11-10c6-5 12-5 19 0l10 11 1 5c4-2 8-2 13-2 1 5 4 9 8 12l1 5c-5 6-10 11-17 14l-5-1Z"/><path fill="%23515151" d="m84 16 4 8-5 11-2-13c-4 3-7 3-11 1l-6 5c2 1 2 2 0 4l-4-2c-1-12-3-12-5 0l6 7c-2 5-4 6-7 2v1l-6-7 1 1c0-5 1-10 3-14 6-6 13-8 21-8 4 0 7 1 11 4Z"/><path fill="%23545454" d="M109 16c4 10 0 15-11 16-5-4-6-8-4-13 2-1 4 0 6 2l3-3 6-2Z"/><path fill="%23949494" d="m144 27-1 1-4-3c-3-2-5-2-7-1l-9 6h-2c3-5 8-8 14-9 4 0 7 2 9 6Z"/><path fill="%236c6c6c" d="M139 25a495 495 0 0 1 5 2c5 3 6 7 4 12-2-2-4-3-6-2l-1 8-3-1c-1-7 0-13 1-19Z"/><path fill="%23545454" d="M139 25c-1 6-2 12-1 19-5 0-9-1-13-3l-5-10 1-1h2l9-6c2-1 4-1 7 1Z"/><path fill="%235c5c5c" d="m83 35-25 9-4-4v-1c3 4 5 3 7-2l-6-7c2-12 4-12 5 0l4 2c2-2 2-3 0-4l6-5c4 2 7 2 11-1l2 13Z"/><path fill="%238e8e8e" d="M148 39c0 4-3 6-7 6l1-8c2-1 4 0 6 2Z"/><path fill="%23868686" d="M172 50c-3-5-7-7-11-8l-5 1c-2-1-3-2-2-3 3-3 7-3 12-1 1 3 4 6 7 9 1 1 0 1-1 2Z"/><path fill="%23646464" d="m42 39 2 4c-2 8-5 14-9 20-7 2-12 1-16-3l9-6c-2-1-4 0-5 2-2-5-1-9 1-13l9-5 9 1Z"/><path fill="%23626262" d="M154 40c-1 1 0 2 2 3l5-1c4 1 8 3 11 8l-11 10c-11-4-14-10-7-20Z"/><path fill="%23757575" d="m42 39-9-1-9 5c-2 4-3 8-1 13 1-2 3-3 5-2l-9 6c-3-8-1-15 5-20 4-3 8-5 14-5l4 4Z"/><path fill="%23050404" d="M176 113c-3-3-3-5-1-7l-2-9c-1-2 0-4 1-5l1-3c-1-1-2-2-3-1-5-4-8-9-7-15l-1-1c1-9 6-14 15-14l4 1 12 17-3 7 3 3 5 15c-5 10-13 14-24 12Z"/><path fill="%23d6854a" d="M116 71v1l-2 2c-1-4-3-7-5-9-1-5 1-8 5-11 3-1 6 0 7 4l-6 11 1 2Z"/><path fill="%236a3c28" d="m97 65-2 2-6-6h-4c-2 4-3 9-3 14l-4 3-5-3v-1l2-6c5 0 5-1 2-3l-1-3c2-3 5-5 9-6 5 1 9 4 12 9Z"/><path fill="%2397603a" d="m97 65 1 2-16 11h-4l4-3c0-5 1-10 3-14h4l6 6 2-2Z"/><path fill="%23331b13" d="M129 63c2 0 4 2 5 5v1l-8-1-2-4-3 5c-1-1-2-2-1-3 0-3 1-5 3-5l6 2Z"/><path fill="%23351c13" d="m76 62 1 3c3 2 3 3-2 3l-2 6c-3-2-4-4-4-7l3-3 4-2Z"/><path fill="%235c3726" d="m134 69-1 3c-4-2-7-1-9 2l-6-2-1-1c0-2 1-4 3-5-1 1 0 2 1 3l3-5 2 4 8 1Z"/><path fill="%23919191" d="m189 79-4-6c-2-1-4-2-5-1l1 7h-4v-8l2-5h-7c2-3 4-4 8-4 4 4 7 10 9 17Z"/><path fill="%23cc6540" d="m143 72-2 2-4 4-4-6 1-3v-1l3-1c2 0 4 2 6 5Z"/><path fill="%23040303" d="m33 74 2 2 1 1 5 13c-3 5-5 11-6 17 7 10 6 21-3 30l4 8c0 1 0 2 2 2 2-1 4 0 6 1l5 11 1 1 2 1c5 0 10 2 16 4l6 7 1 7 2-1c4 1 7 3 9 8l3-5c8-5 14-3 18 7 1-4 2-6 5-8l15-2c2-1 3 0 5 2 1-3 2-5 5-7 6-3 12-5 19-5 5-1 7-3 5-7-2-7 0-13 6-16a96461 96461 0 0 0 9-29c6-1 13 0 20 1 7 7 8 15 4 25l-10 10-3 15c-2 3-5 3-8 2l-7 2c4 5 5 10 0 16l-16 14c-6 1-11 0-16-2l-7 7c-9 2-17 0-23-6-3 10-10 15-20 16-5-3-9-7-12-11-7 2-12 0-15-5-4 1-7 0-10-2-7-5-12-12-15-19l-15-9c-6-6-7-12-3-19-3-5-4-9-4-14L6 126v-14l7-7c-3-1-4-4-4-6l4-22c6-4 13-5 20-3Zm136 64c2 2 2 5-2 7l2-7Zm-133 7 2 2c-2 0-2-1-2-2Zm125 16c2 4 0 6-5 7l5-7Z"/><path fill="%23a36b48" d="M116 71h1l1 1 6 2c2-3 5-4 9-2l-5 10-6-7-6-3v-1Z"/><path fill="%238e8e8e" d="M32 83c-1 1-2 0-2-1-5-1-10 0-13 3-1-4 1-7 5-7h8l2 5Z"/><path fill="%23e5bd86" d="m110 91 2 2-1 2c2 2 3 5 3 8-4 4-4 8 0 12-2 3-3 6-1 9l-5 5-4-4c-9 1-14-3-17-10-2-7-3-14-2-21 1-2 3-3 5-3l2-7c3 0 5-1 7-4 3-1 6-2 10-1l1 2-3 5 3 5Z"/><path fill="%23be7f52" d="M109 65c2 2 4 5 5 9l2-2 6 3 6 7 5-10 4 6c-1 1 0 2 1 4 2 0 4 2 6 5-2 0-3 2-3 4l-3 1c-1-8-5-11-12-9h-3l-4-5-13-3-2 1c-7-3-13-3-18 1-1 0-2 1-1 3-2-1-4 0-5 2l1 9c-3-1-6 0-8 2l-2 9c1 5 3 9 6 13-2 2-3 4-3 7-1-7-3-13-6-19l2-10c2-3 4-4 7-4v-6l-11-2h-1c1-4 3-6 8-6l5 3h4l16-11 2 1c2-2 5-3 9-3Z"/><path fill="%238a4d32" d="m141 74 2 7h3v9l-1 1h-4c0-2 1-4 3-4-2-3-4-5-6-5-1-2-2-3-1-4l4-4Z"/><path fill="%236d6d6d" d="M189 79c-2 1-3 2-3 4h-11l-4-3-2-12c0-2 1-3 3-2h7l-2 5v8h4l-1-7c1-1 3 0 5 1l4 6Z"/><path fill="%2346251a" d="M152 76c2 3 3 6 3 10-2 3-6 4-9 4v-9h-3l-2-7 2-2c4-3 7-2 9 4Z"/><path fill="%233c1f15" d="M60 81h4l-2 3-8 1v7h6l-3 5 5 1v3c-2-1-3 0-4 1v3l2 2-1 3-4-1v-8c-1-1-2-2-3-1 1-4 1-6-2-8-3-9 0-13 10-11Z"/><path fill="%23d9a466" d="m126 83-2 8 1 2h-13l-2-2-3-5 3-5-1-2c-4-1-7 0-10 1-2 3-4 4-7 4l-2 7c-2 0-4 1-5 3-1 7 0 14 2 21 3 7 8 11 17 10l4 4 1 1-2 6c2 3 2 5-3 6l-5-2-6-7 3-5-8-5c-3-1-5 0-7 2l-1-9c-1-2 0-4 2-6-2-1-4-2-6-1l-1-5c2-1 2-3 2-5 1-4 4-7 7-9-2-1-3-2-1-3l6-3 4-5 11-3 2-1 13 3 4 5h3Z"/><path fill="%23525252" d="M32 83c0 2 1 5 3 7l-6 12H19v-4l-3-6 1-7c3-3 8-4 13-3 0 1 1 2 2 1Z"/><path fill="%238b4b31" d="M65 81h1c-1 4 0 7 3 11-3 2-4 6-4 9 2 3 2 6 1 10l-1-4h-5c-1-3 0-4 2-5l2-10-3-1c3-3 4-6 4-10Z"/><path fill="%23653526" d="M64 81h1c0 4-1 7-4 10l3 1-2 10c-2 1-3 2-2 5l-2-2v-3c1-1 2-2 4-1v-3l-5-1 3-5h-6v-7l8-1 2-3Z"/><path fill="%235a5a5a" d="M188 88c2 6 2 12 1 19l-1 1-9 1V91c3-2 5-3 9-3Z"/><path fill="%23949494" d="M188 88c1 0 2 0 3 2 2 4 3 9 2 14l-4 3c1-7 1-13-1-19Z"/><path fill="%238e8e8e" d="m16 92 3 6v4l-4-1 1-9Z"/><path fill="%23090302" d="M52 100c1-1 2 0 3 1v8l-3-1v-8Z"/><path fill="%23150804" d="M150 101c1 3 1 6-2 8-1-3-2-6-1-8h3Z"/><path fill="%23693725" d="M147 96c2 0 3 1 3 4v1h-3c-1 2 0 5 1 8l-2 2h-6c-1-2 0-3 1-4l3-3v-8h3Z"/><path fill="%23545454" d="m20 109 9 2c-1-1-2 0-2 1l-4 8c-3 0-5 1-6 4-1-4-2-8-1-11l4-4Z"/><path fill="%23c05a37" d="M140 111h6l-1 6-3-1-2-2c-3-2-3-3 0-3Z"/><path fill="%236a6a6a" d="M29 111c7 5 8 12 2 20l-8 6a1834 1834 0 0 1-3-8l-3-5c1-3 3-4 6-4l4-8c0-1 1-2 2-1Z"/><path fill="%23090403" d="m149 121 5 2c1 7 0 14-3 22l-5 4-2-1v-4l1-1h3l3-14-1-4-2-3 1-1Z"/><path fill="%238a8a8a" d="m20 109-4 4c-1 3 0 7 1 11l3 5-2 2c-6-6-8-12-6-19 2-3 4-4 8-3Z"/><path fill="%230e0403" d="M54 116v8c6-3 6-2 1 2 2 2 2 4 0 7l-3-2-4-11c1-3 3-4 6-4Z"/><path fill="%23b3724d" d="M147 95v1h-3v8l-3 3c-1 1-2 2-1 4-3 0-3 1 0 3l-9 21c-4 0-7 1-8 5l-1 1-8 1c2-6 5-10 11-12 1-6 4-11 8-15l4-18c3-2 6-2 10-2Z"/><path fill="%233b2019" d="M56 114v7h4c-1 2 0 4 3 6-2 0-4 1-4 3l4 6-2 2-6-4v-1c2-3 2-5 0-7 5-4 5-5-1-2v-8l2-2Z"/><path fill="%23585858" d="M190 121h-1c3 1 4 4 5 7l-5 16c-2 0-3 1-3 3-9-2-12-7-11-15l4-11c3-2 7-2 11 0Z"/><path fill="%23c8744c" d="m75 135-4 4h-1c-1-2-2-4-4-4l3-4 6-5c0 2 1 5 3 7-2 0-3 1-3 2Z"/><path fill="%23a05539" d="m140 114 2 2c-1 8-4 16-9 23-3 0-5 2-7 4l-3-3c1-4 4-5 8-5l9-21Z"/><path fill="%2387543a" d="M65 112v10h4c-2 3-2 6 0 9l-3 4h-1c-1-5-2-10-4-13l1-2c-3 0-4-1-5-2 2-3 4-5 8-6Z"/><path fill="%23ae6f4b" d="m66 81 11 2v6c-3 0-5 1-7 4l-2 10c3 6 5 12 6 19l3 3 4 1c0 4 1 9 4 13h-5l-5-4c0-1 1-2 3-2-2-2-3-5-3-7l-6 5c-2-3-2-6 0-9h-4v-10l1-1c1-4 1-7-1-10 0-3 1-7 4-9-3-4-4-7-3-11Z"/><path fill="%23ce935a" d="m104 76-11 3-4 5-6 3c-2 1-1 2 1 3-3 2-6 5-7 9 0 2 0 4-2 5l1 5c2-1 4 0 6 1-2 2-3 4-2 6l1 9c2-2 4-3 7-2l8 5-3 5 6 7 5 2c5-1 5-3 3-6l2-6c4 0 8-2 12-5 2-9 5-17 9-25l-2-6c-1-1-2-2-3-1l-1-2 2-8c7-2 11 1 12 9l3-1h4l2 4c-4 0-7 0-10 2l-4 18c-4 4-7 9-8 15-6 2-9 6-11 12l-15 2c-5-3-10-4-14-5-3-4-4-9-4-13l-4-1-3-3c0-3 1-5 3-7-3-4-5-8-6-13l2-9c2-2 5-3 8-2l-1-9c1-2 3-3 5-2-1-2 0-3 1-3 5-4 11-4 18-1Z"/><path fill="%23dfb380" d="M125 93c1-1 2 0 3 1l2 6c-4 8-7 16-9 25-4 3-8 5-12 5l-1-1 5-5c-2-3-1-6 1-9-4-4-4-8 0-12 0-3-1-6-3-8l1-2h13Z"/><path fill="%23e9c897" d="M110 91c2 9 1 19-5 28-5 1-8 0-8-5l5-16c-2-7 0-10 8-7Z"/><path fill="%23898989" d="M190 121c4 1 6 5 7 10-1 8-4 13-11 16 0-2 1-3 3-3l5-16c-1-3-2-6-5-7h1Z"/><path fill="%235c3222" d="M60 107h5l1 4-1 1c-4 1-6 3-8 6 1 1 2 2 5 2l-1 2c2 3 3 8 4 13l-2 1-4-6c0-2 2-3 4-3-3-2-4-4-3-6h-4v-7l4-4h-1l1-3Z"/><path fill="%23552c21" d="m145 118 4 3-1 1 2 3c-3 5-4 11-6 17l-7-6 6-7c-1-4-2-8-1-11h3Z"/><path fill="%233a2018" d="m150 125 1 4-3 14h-3l-1 1v4l2 1-3 5-9-4v-3l9 2c-1-5-3-8-7-10-1-2-1-3 1-3l7 6c2-6 3-12 6-17Z"/><path fill="%23673424" d="m142 116 3 1v1h-3c-1 3 0 7 1 11l-6 7c-2 0-2 1-1 3 4 2 6 5 7 10l-9-2v3c-4-2-6-5-8-7 2-2 4-4 7-4 5-7 8-15 9-23Z"/><path fill="%236c6c6c" d="M27 139c3 2 4 4 3 8-7 1-9-1-7-7l4-1Z"/><path fill="%23432217" d="M70 139h1c1-1 2 0 3 1-7 5-7 6 2 2l1 1c-3 1-5 3-6 6l-2-3c-1-1-2-1-2 1l-1-2c0-3 2-5 4-6Z"/><path fill="%23b4603d" d="M80 139h5c4 1 9 2 14 5l15-2 8-1v1c-2-1-4 0-4 2l-5 1-2 4-7 2c-1-2-2-3-1-4h-4v4l-13-5-2 2v-7h-3l-1 4v-6Z"/><path fill="%231f100a" d="m71 149 2 1c1-2 3-3 5-3l1 2-6 4-6-6c0-2 1-2 2-1l2 3Z"/><path fill="%23bb4f2e" d="m123 140 3 3c2 2 4 5 8 7l9 4-4 12c-2-1-4 0-5 1l-9-6c-2-2-3-5-2-7v-8l-1-4v-1l1-1Z"/><path fill="%2388442d" d="m122 142 1 4c-2-1-3-2-4-1l-1 7c-1-3-3-3-5-1-2 1-3 3-4 6 0-2-1-3-2-3-1 1-2 3-1 5l-2-8 7-2 2-4 5-1c0-2 2-3 4-2Z"/><path fill="%23753c29" d="m75 135 5 4v6l1-4h3v7l2-2 13 5-1 14c-2-3-4-2-5 0h-3l-2-6-8-2v5c-1-2-2-4-1-6v-7l-1-2c-2 0-4 1-5 3l-2-1c1-3 3-5 6-6l-1-1c-9 4-9 3-2-2-1-1-2-2-3-1l4-4Z"/><path fill="%234e4e4e" d="m182 151-11 5-2 8c-6-8-4-15 4-19l9 6Z"/><path fill="%23656565" d="m41 171-12-6-3-13 9-1c9 4 11 11 6 20Z"/><path fill="%2352291d" d="M123 146v8l-2 4c-3-2-5-1-6 1l-7 1v3l-2-1v-3c-1-2 0-4 1-5 1 0 2 1 2 3 1-3 2-5 4-6 2-2 4-2 5 1l1-7c1-1 2 0 4 1Z"/><path fill="%23696969" d="m182 151-2 11-5 2 3 1-5 1-4-2 2-8 11-5Z"/><path fill="%23140905" d="M121 158c-4 4-8 6-13 5v-3l7-1c1-2 3-3 6-1Z"/><path fill="%23bb512f" d="m104 151 2 8v3l-4 7h-4v-4l1-14v-4h4c-1 1 0 2 1 4Z"/><path fill="%23828282" d="M182 151c1 0 2 0 2 2 1 4 0 7-1 11l-5 1-3-1 5-2 2-11Z"/><path fill="%23412217" d="M98 165v4l-9 2-6-2-3-7v-5l8 2 2 6h3c1-2 3-3 5 0Z"/><path fill="%23909090" d="m26 152 3 13 12 6v3l-16-8c-2-5-2-10 1-14Z"/><path fill="%235d5d5d" d="M164 173h-1c2 3 3 6 2 10l-5 7c-1-2-2-3-1-4l-4-1-3-7c-3 0-6 1-8 3a430 430 0 0 1-4 12c-2-5-2-10-1-15l3-3 18-4c1 0 3 0 4 2Z"/><path fill="%23727272" d="M164 173c2 0 4 2 6 6-3 6-7 11-13 15l-1 4-12-3-4-2a430 430 0 0 0 4-12c2-2 5-3 8-3l3 7 4 1c-1 1 0 2 1 4l5-7c1-4 0-7-2-10h1Z"/><path fill="%23545454" d="m65 193-1-1c-3 2-4 2-4-1-4 0-7-1-9-4-3-4-5-9-5-13 0-5 2-8 6-9l15 6 3 11-5 11Z"/><path fill="%234d4d4d" d="M132 200c-6 0-11-1-15-4v2l-2-2-1-11 12-3c2 0 3 1 5 3l5 11-4 4Z"/><path fill="%235f5f5f" d="m79 198-7 1v-5h-3c1-5 4-9 8-11 6 4 7 9 2 15Z"/><path fill="%23545454" d="m102 205-1-1c-6 4-9 3-8-4-3 0-5 1-7 3-1-2-2-2-2-1l-1-2c3-6 7-12 12-17 4 1 6 4 7 9 2 4 2 8 0 13Z"/><path fill="%237c7c7c" d="M46 174c0 4 2 9 5 13 2 3 5 4 9 4 0 3 1 3 4 1l1 1-6 3c-7-4-12-9-15-16-1-3 0-5 2-6Z"/><path fill="%23858585" d="M69 194h3v5l7-1-7 4c-3-2-4-5-3-8Z"/><path fill="%23818181" d="m132 200-1 1h-12l-2-3v-2c4 3 9 4 15 4Z"/><path fill="gray" d="M102 205c-5 7-10 7-15 1l-3-4c0-1 1-1 2 1 2-2 4-3 7-3-1 7 2 8 8 4l1 1Z"/></svg>'],audio:[""]},mapData:{1:{name:"Vampire Attack",width:3e3,height:3e3,gridType:0,gridSize:100,gridColour:{r:0,g:0,b:0,a:255},gridStroke:1,startX:2101,startY:1441,gridDistance:5,gridDiagonal:!1,lightColour:{r:0,g:0,b:0,a:228},baseOpaque:!1,masks:[],data:{},hidden:!1,locked:!1,tokens:[],walls:[],children:[{name:"Background",hidden:!1,locked:!0,tokens:[{x:1576,y:376,lightColours:[],lightStages:[],lightTimings:[],id:12,rotation:0,flip:!1,flop:!1,width:148,height:148,snap:!0,tokenData:{},tokenType:0,src:1,patternWidth:0,patternHeight:0},{x:0,y:0,lightColours:[],lightStages:[],lightTimings:[],id:1,rotation:0,flip:!1,flop:!1,width:3e3,height:3e3,snap:!0,tokenData:{},tokenType:0,src:3,patternWidth:100,patternHeight:88},{x:2676,y:876,lightColours:[],lightStages:[],lightTimings:[],id:10,rotation:0,flip:!1,flop:!1,width:148,height:148,snap:!0,tokenData:{},tokenType:0,src:1,patternWidth:0,patternHeight:0},{x:2352,y:1041,lightColours:[],lightStages:[],lightTimings:[],id:21,rotation:0,flip:!1,flop:!1,width:148,height:148,snap:!0,tokenData:{},tokenType:0,src:1,patternWidth:0,patternHeight:0},{x:2184,y:1060,lightColours:[],lightStages:[],lightTimings:[],id:7,rotation:0,flip:!1,flop:!1,width:148,height:148,snap:!0,tokenData:{},tokenType:0,src:1,patternWidth:0,patternHeight:0},{x:2476,y:1276,lightColours:[],lightStages:[],lightTimings:[],id:19,rotation:0,flip:!1,flop:!1,width:148,height:148,snap:!0,tokenData:{},tokenType:0,src:1,patternWidth:0,patternHeight:0},{x:2492,y:1528,lightColours:[],lightStages:[],lightTimings:[],id:20,rotation:0,flip:!1,flop:!1,width:148,height:148,snap:!0,tokenData:{},tokenType:0,src:1,patternWidth:0,patternHeight:0},{x:2376,y:1676,lightColours:[],lightStages:[],lightTimings:[],id:9,rotation:0,flip:!1,flop:!1,width:148,height:148,snap:!0,tokenData:{},tokenType:0,src:1,patternWidth:0,patternHeight:0},{x:2272,y:1832,lightColours:[],lightStages:[],lightTimings:[],id:23,rotation:0,flip:!1,flop:!1,width:148,height:148,snap:!0,tokenData:{},tokenType:0,src:1,patternWidth:0,patternHeight:0},{x:2040,y:1836,lightColours:[],lightStages:[],lightTimings:[],id:22,rotation:0,flip:!1,flop:!1,width:148,height:148,snap:!0,tokenData:{},tokenType:0,src:1,patternWidth:0,patternHeight:0},{x:876,y:2476,lightColours:[],lightStages:[],lightTimings:[],id:11,rotation:0,flip:!1,flop:!1,width:148,height:148,snap:!0,tokenData:{},tokenType:0,src:1,patternWidth:0,patternHeight:0},{x:576,y:1676,lightColours:[],lightStages:[],lightTimings:[],id:8,rotation:0,flip:!1,flop:!1,width:148,height:148,snap:!0,tokenData:{},tokenType:0,src:1,patternWidth:0,patternHeight:0},{x:776,y:476,lightColours:[],lightStages:[],lightTimings:[],id:2,rotation:0,flip:!1,flop:!1,width:148,height:148,snap:!0,tokenData:{},tokenType:0,src:1,patternWidth:0,patternHeight:0},{x:2200,y:1400,lightColours:[[{r:255,g:219,b:195,a:255}],[{r:255,g:219,b:195,a:255}],[{r:255,g:219,b:195,a:117}],[{r:255,g:219,b:195,a:117}]],lightStages:[15,1,15,1],lightTimings:[0],id:18,rotation:0,flip:!1,flop:!1,width:100,height:100,snap:!0,tokenData:{},tokenType:0,src:9,patternWidth:0,patternHeight:0}],walls:[]},{name:"Grid",hidden:!1,locked:!1,tokens:[],walls:[]},{name:"Chars",hidden:!1,locked:!1,tokens:[{x:1600,y:1100,lightColours:[],lightStages:[],lightTimings:[],id:14,rotation:224,flip:!1,flop:!1,width:200,height:200,snap:!0,tokenData:{"store-character-id":{user:!0,data:2}},tokenType:0,src:7,patternWidth:0,patternHeight:0},{x:1300,y:1200,lightColours:[],lightStages:[],lightTimings:[],id:13,rotation:224,flip:!1,flop:!1,width:100,height:100,snap:!0,tokenData:{"store-character-id":{user:!0,data:1}},tokenType:0,src:6,patternWidth:0,patternHeight:0},{x:2187,y:1587,lightColours:[],lightStages:[],lightTimings:[],id:15,rotation:64,flip:!1,flop:!1,width:125,height:125,snap:!0,tokenData:{"store-character-id":{user:!0,data:4}},tokenType:0,src:2,patternWidth:0,patternHeight:0},{x:2300,y:1500,lightColours:[],lightStages:[],lightTimings:[],id:16,rotation:64,flip:!1,flop:!1,width:100,height:100,snap:!0,tokenData:{"store-character-id":{user:!0,data:3}},tokenType:0,src:8,patternWidth:0,patternHeight:0},{x:2084,y:1184,lightColours:[],lightStages:[],lightTimings:[],id:17,rotation:64,flip:!1,flop:!1,width:131,height:131,snap:!0,tokenData:{"store-character-id":{user:!0,data:5}},tokenType:0,src:4,patternWidth:0,patternHeight:0}],walls:[]},{name:"Trees",hidden:!1,locked:!1,tokens:[{x:2e3,y:200,lightColours:[],lightStages:[],lightTimings:[],id:4,rotation:192,flip:!1,flop:!1,width:700,height:700,snap:!0,tokenData:{},tokenType:0,src:5,patternWidth:0,patternHeight:0},{x:1900,y:2e3,lightColours:[],lightStages:[],lightTimings:[],id:5,rotation:0,flip:!1,flop:!1,width:700,height:700,snap:!0,tokenData:{},tokenType:0,src:5,patternWidth:0,patternHeight:0},{x:200,y:800,lightColours:[],lightStages:[],lightTimings:[],id:3,rotation:128,flip:!1,flop:!1,width:700,height:700,snap:!0,tokenData:{},tokenType:0,src:5,patternWidth:0,patternHeight:0},{x:100,y:2e3,lightColours:[],lightStages:[],lightTimings:[],id:6,rotation:64,flip:!1,flop:!1,width:700,height:700,snap:!0,tokenData:{},tokenType:0,src:5,patternWidth:0,patternHeight:0}],walls:[{id:1,x1:2300,y1:550,x2:2323,y2:539,colour:{r:0,g:0,b:0,a:255},scattering:0},{id:2,x1:2323,y1:539,x2:2302,y2:529,colour:{r:0,g:0,b:0,a:255},scattering:0},{id:3,x1:2302,y1:529,x2:2288,y2:546,colour:{r:0,g:0,b:0,a:255},scattering:0},{id:4,x1:2288,y1:546,x2:2300,y2:550,colour:{r:0,g:0,b:0,a:255},scattering:0},{id:5,x1:2250,y1:2300,x2:2270,y2:2310,colour:{r:0,g:0,b:0,a:255},scattering:0},{id:6,x1:2270,y1:2310,x2:2251,y2:2324,colour:{r:0,g:0,b:0,a:255},scattering:0},{id:7,x1:2251,y1:2324,x2:2239,y2:2308,colour:{r:0,g:0,b:0,a:255},scattering:0},{id:8,x1:2239,y1:2308,x2:2250,y2:2300,colour:{r:0,g:0,b:0,a:255},scattering:0},{id:9,x1:500,y1:2350,x2:484,y2:2342,colour:{r:0,g:0,b:0,a:255},scattering:0},{id:10,x1:484,y1:2342,x2:489,y2:2365,colour:{r:0,g:0,b:0,a:255},scattering:0},{id:11,x1:489,y1:2365,x2:500,y2:2350,colour:{r:0,g:0,b:0,a:255},scattering:0},{id:12,x1:551,y1:1206,x2:551,y2:1177,colour:{r:0,g:0,b:0,a:255},scattering:0},{id:13,x1:551,y1:1177,x2:527,y2:1195,colour:{r:0,g:0,b:0,a:255},scattering:0},{id:14,x1:527,y1:1195,x2:550,y2:1200,colour:{r:0,g:0,b:0,a:255},scattering:0}]},{name:"Light",hidden:!1,locked:!1,tokens:[],walls:[]}]}},characterData:{1:{name:{user:!0,data:"Vampire"},"store-image-icon":{user:!1,data:6},"5e-initiative-mod":{user:!1,data:4},"5e-ac":{user:!1,data:16},"5e-hp-current":{user:!1,data:144},"5e-hp-max":{user:!1,data:144},"5e-darkvision":{user:!0,data:120},"5e-notes":{user:!1,data:"Shapechanger\nLegendary Resistance 3/day.\nMM: 297"},"store-image-data":{user:!1,data:[{src:6,width:100,height:100,patternWidth:0,patternHeight:0,rotation:0,flip:!1,flop:!1,snap:!0,lightColours:[],lightStages:[],lightTimings:[],tokenData:{"store-character-id":{user:!0,data:1}}}]}},2:{name:{user:!0,data:"Werewolf"},"store-image-icon":{user:!1,data:7},"5e-initiative-mod":{user:!1,data:1},"5e-ac":{user:!1,data:12},"5e-hp-current":{user:!1,data:58},"5e-hp-max":{user:!1,data:58},"5e-notes":{user:!1,data:"Shapechanger\nMM: 211"},"store-image-data":{user:!1,data:[{src:7,width:200,height:200,patternWidth:0,patternHeight:0,rotation:0,flip:!1,flop:!1,snap:!0,lightColours:[],lightStages:[],lightTimings:[],tokenData:{"store-character-id":{user:!0,data:2}}}]}},3:{name:{user:!0,data:"Svevdor"},"store-image-icon":{user:!1,data:8},"5e-player":{user:!0,data:!0},"store-image-data":{user:!1,data:[{src:8,width:100,height:100,patternWidth:0,patternHeight:0,rotation:0,flip:!1,flop:!1,snap:!0,lightColours:[],lightStages:[],lightTimings:[],tokenData:{"store-character-id":{user:!0,data:3}}}]}},4:{name:{user:!0,data:"Opal"},"store-image-icon":{user:!1,data:2},"5e-player":{user:!0,data:!0},"store-image-data":{user:!1,data:[{src:2,width:125,height:125,patternWidth:0,patternHeight:0,rotation:0,flip:!1,flop:!1,snap:!0,lightColours:[],lightStages:[],lightTimings:[],tokenData:{"store-character-id":{user:!0,data:4}}}]}},5:{name:{user:!0,data:"Vax"},"store-image-icon":{user:!1,data:4},"5e-player":{user:!0,data:!0},"5e-darkvision":{user:!0,data:60},"store-image-data":{user:!1,data:[{src:4,width:131,height:131,patternWidth:0,patternHeight:0,rotation:0,flip:!1,flop:!1,snap:!0,lightColours:[],lightStages:[],lightTimings:[],tokenData:{"store-character-id":{user:!0,data:5}}}]}}},images:{folders:{Terrain:{folders:{},items:{Tree:5,Grass:3,Bush:1}},Characters:{folders:{},items:{Wizard:8,Rogue:4,Fighter:2}},Monsters:{folders:{},items:{Werewolf:7,Vampire:6}}},items:{Campfire:9}},audio:{folders:{},items:{}},maps:{folders:{},items:{"Vampire Attack":1}},characters:{folders:{Players:{folders:{},items:{Vax:5,Opal:4,Svevdor:3}}},items:{Vampire:1,Werewolf:2}},music:{},plugins:{"5e.js":{enabled:!0,data:{}},"notes.js":{enabled:!0,data:{}},"spells.js":{enabled:!0,data:{}}},localStorage:{panelWidth:"485",lastTab:"Settings",tabIcons:"",panelOnTop:"",menuHide:"",zoomSlider:"",miniTools:"",musicSort:"",hiddenLayerOpacity:"0",measureTokenMove:"",autosnap:"","5e-show-selected-hp":"","5e-show-selected-ac":"","5e-show-selected-names":"","5e-desaturate-token-conditions":"",windowData:'{"Tools":{"out":true,"data":[0,0,48,412]},"Layers":{"out":true,"data":[48,0,153,227]}}',selectedMap:"1",keys:'{"centreMap":"c","helpKey":"F1","togglePanel":"F9","5e-health-key":"h","5e-initiative-key":"i","5e-CONDITION_BANE":"","5e-CONDITION_BLESSED":"","5e-CONDITION_BLINDED":"","5e-CONDITION_BLINK":"","5e-CONDITION_BLUR":"","5e-CONDITION_BURNING":"","5e-CONDITION_CHARMED":"","5e-CONDITION_CONCENTRATING":"Shift+C","5e-CONDITION_CONFUSED":"","5e-CONDITION_DEAD":"Shift+D","5e-CONDITION_DEAFENED":"","5e-CONDITION_DYING":"d","5e-CONDITION_EXHAUSTED":"","5e-CONDITION_FLYING":"","5e-CONDITION_FRIGHTENED":"","5e-CONDITION_GRAPPLED":"","5e-CONDITION_GUIDANCE":"","5e-CONDITION_HASTE":"","5e-CONDITION_HEXED":"","5e-CONDITION_HIDEOUS_LAUGHTER":"","5e-CONDITION_HUNTERS_MARK":"","5e-CONDITION_INCAPACITATED":"","5e-CONDITION_INSPIRED":"","5e-CONDITION_INVISIBLE":"Shift+I","5e-CONDITION_LEVITATE":"","5e-CONDITION_MIRROR_IMAGE":"","5e-CONDITION_PARALYZED":"","5e-CONDITION_PETRIFIED":"","5e-CONDITION_POISONED":"","5e-CONDITION_PRONE":"p","5e-CONDITION_RAGE":"","5e-CONDITION_RECKLESS":"","5e-CONDITION_RESTRAINED":"","5e-CONDITION_SANCTUARY":"","5e-CONDITION_SLOW":"","5e-CONDITION_STUNNED":"","5e-CONDITION_UNCONSCIOUS":"","spells-create":"Enter","tool_default":"1","tool_draw":"2","tool_mask":"3","tool_measure":"4","tool_move":"5","tool_multiplace":"6","tool_spells":"7","tool_wall":"8","toolPrev":"Shift+(","toolNext":"Shift+)","tokenEdit":"e","tokenLight":"","nextToken":"Tab","prevToken":"Shift+Tab","layerPrev":"[","layerNext":"]"}',"5e-show-token-hp":"","5e-show-token-ac":"","5e-show-token-names":"",panelShow:""}};{const t=Symbol("lastTokenID"),i=Symbol("tokenList"),a=Symbol("lastWallID"),o=Symbol("wallList"),s=Symbol("lastMapID"),n=Symbol("lastCharacterID"),r=Symbol("lastMusicPackID"),l=(e,t)=>{if(t(e))return e;for(let i=0;;i++){const a=e+"."+i;if(t(a))return a}},c=(e,t,i)=>l(t,(t=>!e[t]&&(e[t]=i,!0))),d=(e,t,i)=>l(t,(t=>!e[t]&&(e[t]=i,!0))),h=(e,t)=>{let i=e;for(const e of t.split("/")){if(!e)continue;const t=i.folders[e];if(!t)return null;i=t}return i},u=e=>{const t=e.lastIndexOf("/");return t>=0?[e.slice(0,t),e.slice(t+1)]:["",e]},p=(e,t)=>{for(;e.charAt(0)===t;)e=e.slice(1);return e},m=(e,t)=>{for(;e.charAt(e.length-1)===t;)e=e.slice(0,-1);return e},f=e=>{for(;e.includes("//");)e=e.replaceAll("//","/");return e},g=(e,t)=>{let i;const[a,o]=u(f(m(t,"/")));if(a){if(i=h(e,a),!i)return[null,"",null]}else i=e;return[i,o,i.folders[o]]},w=(e,t)=>{const[i,a]=u(t),o=h(e,f(i));return o?[o,a,o.items[a]]:[null,"",0]},v=(e,t)=>{const[i,a]=g(e,t);return i&&a?t.slice(0,t.length-a.length)+d(i.folders,a,{folders:{},items:{}}):""},y=(e,t,i)=>{const[a,o,s]=w(e,t);if(!a||!s)return"";let n,r;if(i.endsWith("/"))n=h(e,m(i,"/")),r=o;else{const[t,a]=u(i);r=a,i=m(t,"/"),n=h(e,i)}return delete a.items[o],i+"/"+c(n.items,r,s)},E=(e,t,i)=>{const[a,o,s]=g(e,t);if(!a||!s)return"";let n,r;if(i.endsWith("/"))n=h(e,m(i,"/")),r=o;else{const[t,a]=u(i);r=a,i=m(t,"/"),n=h(e,i)}return i.endsWith(t)?"":(delete a.folders[o],i+"/"+d(n.folders,r,s))},k=(e,t)=>{const[i,a,o]=w(e,t);return i&&o?(delete i.items[a],null):null},M=(e,t)=>{const[i,a,o]=g(e,t);return i&&o?(delete i.folders[a],null):null},T=(e,t,i)=>{let[a,o]=w(e,i);return a?(o||(o=t+""),{id:t,path:i.slice(0,o.length)+c(a.items,o,t)}):""},b=()=>e.mapData[e.currentMap],O=(e=b(),t={})=>{for(const i of e.children??[])t[i.name]=i,O(i,t);return t},_=e=>{const t=O();return l(e,(e=>!(e in t)))},N=e=>{let t=b();e:for(const i of m(p(e,"/"),"/").split("/"))if(i){for(const e of t.children??[])if(e.name===i){t=e;continue e}return null}return t},A=e=>{const[t,i]=u(m(e,"/")),a=N(t);if(a)for(const e of a.children??[])if(e.name===i)return[a,e];return[null,null]},x=e=>{const{token:t}=b()[i][e.id];if(e.tokenData&&(Object.assign(t.tokenData,e.tokenData),delete e.tokenData),e.removeTokenData){for(const i of e.removeTokenData)delete t.tokenData[i];delete e.removeTokenData}for(const i of Object.keys(e))t[i]=e[i]},L=(e,s)=>{for(const a of s.tokens??[])e[i][a.id]={layer:s,token:a},a.id>e[t]&&(e[t]=a.id);for(const t of s.walls??[])e[o][t.id]={layer:s,wall:t},t.id>e[a]&&(e[a]=t.id);for(const t of s.children??[])L(e,t)};e[n]=0,e[s]=0,e[r]=0;for(const t in e.characterData){const i=parseInt(t);i<e[n]&&(e[n]=i)}for(const n in e.mapData){const r=parseInt(n),l=e.mapData[r];r<e[s]&&(e[s]=r),l[t]=l[a]=0,l[i]={},l[o]={},L(l,l)}for(const t in e.music){const i=parseInt(t);i<e[r]&&(e[r]=i)}Object.defineProperties(window,{WebSocket:{value:class extends EventTarget{constructor(){super(),setTimeout((()=>this.dispatchEvent(new Event("open")))),setTimeout((()=>this.#e(-1,e.admin?2:1)))}send(e){const t=JSON.parse(e);this.#e(t.id,this.#t(t.method,t.params))}#t(d,h){switch(d){case"conn.ready":e.admin?this.#e(-2,e.currentMap):e.currentUserMap>0&&this.#e(-3,e.mapData[e.currentUserMap]);break;case"conn.currentTime":return Math.floor(Date.now()/1e3);case"maps.setCurrentMap":return e.currentMap=JSON.parse(h),null;case"maps.getUserMap":return e.currentUserMap;case"maps.setUserMap":return e.currentUserMap=JSON.parse(h),null;case"maps.getMapData":return e.mapData[h];case"maps.new":{const s=++e[r];return e.mapData[s]=Object.assign(h,{startX:0,startY:0,gridDistance:0,gridDiagonal:!1,lightColour:{r:0,g:0,b:0,a:0},baseOpaque:!1,masks:[],data:{},hidden:!1,locked:!1,tokens:[],walls:[],children:[{name:"Layer",hidden:!1,locked:!1,tokens:[],walls:[]},{name:"Light",hidden:!1,locked:!1,tokens:[],walls:[]},{name:"Grid",hidden:!1,locked:!1,tokens:[],walls:[]}],[t]:0,[a]:0,[i]:{},[o]:{}}),{id:s,name:c(e.maps.items,h.name,s)}}case"maps.setMapDetails":return Object.assign(b(),h),null;case"maps.setMapStart":{const e=h,t=b();return t.startX=e[0],t.startY=e[1],null}case"maps.setGridDistance":return b().gridDistance=h,null;case"maps.setGridDiagonal":return b().gridDiagonal=h,null;case"maps.setLightColour":return b().lightColour=h,null;case"maps.setData":return b().data[h.key]=h.data,null;case"maps.removeData":return delete b().data[h],null;case"maps.addLayer":{const e=_(h);return b().children?.push({name:e,hidden:!1,locked:!1,tokens:[],walls:[]}),e}case"maps.addLayerFolder":{const[e,t]=u(h),i=_(t);return N(e)?.children?.push({name:i,hidden:!1,locked:!1,children:[]}),e+"/"+i}case"maps.renameLayer":{const e=h;return e.name=(N(e.path)??{name:""}).name=_(e.name),e}case"maps.moveLayer":{const e=h,[t,i]=A(e.from),a=N(e.to);return t?.children&&i&&a?.children&&(t.children.splice(t.children.indexOf(i),1),a.children.splice(e.position,0,i)),null}case"maps.showLayer":{const e=N(h);return e&&(e.hidden=!1),null}case"maps.hideLayer":{const e=N(h);return e&&(e.hidden=!0),null}case"maps.lockLayer":{const e=N(h);return e&&(e.locked=!0),null}case"maps.unlockLayer":{const e=N(h);return e&&(e.locked=!1),null}case"maps.addToMask":return b().masks.push(h),null;case"maps.removeFromMask":return b().masks.splice(h,1),null;case"maps.setMask":{const e=b();return e.masks=h.masks,e.baseOpaque=h.baseOpaque,null}case"maps.removeLayer":{const[e,t]=A(h);return e&&t&&e.children?.splice(e.children.indexOf(t),1),null}case"maps.addToken":{const e=h,a=b(),o=N(e.path);return o&&(e.token.id&&!(e.token.id in a[i])||(e.token.id=++a[t]),o.tokens?.push(e.token),a[i][e.token.id]={layer:o,token:e.token}),e.token.id}case"maps.removeToken":{const e=b(),{layer:t,token:a}=e[i][h];return t.tokens?.splice(t.tokens.indexOf(a),1),delete e[i][h],null}case"maps.setToken":return x(h),null;case"maps.setTokenMulti":for(const e of h)x(e);return null;case"maps.setTokenLayerPos":{const e=b()[i][h.id],t=N(h.to);return t?.tokens&&e.layer.tokens&&(e.layer.tokens?.splice(e.layer.tokens.indexOf(e.token),1),t.tokens?.splice(h.newPos,0,e.token),e.layer=t),null}case"maps.shiftLayer":{const e=N(h.path),{dx:t,dy:i}=h;if(e){for(const a of e.tokens??[])a.x+=t,a.y+=i;for(const a of e.walls??[])a.x1+=t,a.y1+=i,a.x2+=t,a.y2+=i}return null}case"maps.addWall":{const e=h,t=b(),i=N(e.path);return i&&((e.wall.id in t.walls||!e.wall.id||e.wall.id>t[a])&&(e.wall.id=++t[a]),i.walls?.push(e.wall),t[o][e.wall.id]={layer:i,wall:e.wall}),e.wall.id}case"maps.removeWall":{const e=b(),{layer:t,wall:i}=e[o][h];return t.walls?.splice(t.walls.indexOf(i)),delete e[o][i.id],null}case"maps.modifyWall":{const e=h,{wall:t}=b()[o][e.id];return Object.assign(t,e),null}case"maps.moveWall":{const e=b()[o][h.id],t=N(h.path);return t?.walls&&e.layer.walls&&(e.layer.walls.splice(e.layer.walls.indexOf(e.wall),1),t.walls.push(e.wall),e.layer=t),null}case"music.list":return Object.values(e.music);case"music.new":{const t=l(h,(t=>!Object.values(e.music).some((e=>e.name===t)))),i=++e[r];return e.music[i]={name:t,tracks:[],volume:0,playTime:0},{id:i,name:t}}case"music.rename":return e.music[h.id].name=l(h.name,(t=>{for(const i in e.music)if(e.music[i].name===t)return!1;return!0}));case"music.remove":return delete e.music[h],null;case"music.copy":{const t=l(h.name,(t=>!Object.values(e.music).some((e=>e.name===t)))),i=++e[r],a=e.music[h.id];return e.music[i]={name:t,tracks:JSON.parse(JSON.stringify(a.tracks)),volume:a.volume,playTime:0},{id:i,name:t}}case"music.setVolume":return e.music[h.id].volume=h.volume,null;case"music.playPack":return e.music[h.id].playTime=h.playTime||Math.floor(Date.now()/1e3);case"music.stopPack":return e.music[h].playTime=0,null;case"music.stopAllPacks":for(const t in e.music)e.music[t].playTime=0;return null;case"music.addTracks":{const t=e.music[h.id];for(const e of h.tracks)t.tracks.push({id:e,volume:255,repeat:0});return null}case"music.removeTrack":return e.music[h.id].tracks.splice(h.track,1),null;case"music.setTrackVolume":return e.music[h.id].tracks[h.track].volume=h.volume,null;case"music.setTrackRepeat":return e.music[h.id].tracks[h.track].repeat=h.repeat,null;case"characters.create":{const t=h,i=++e[n];return e.characterData[i]=t.data,{id:i,path:c(e.characters.items,t.path,i)}}case"characters.modify":{const t=h,i=e.characterData[t.id];for(const[e,a]of Object.entries(t.setting))i[e]=a;for(const e of t.removing)delete i[e];return null}case"characters.get":{const t=e.characterData[h];if(!t)return null;if(e.admin)return t;const i={};for(const[e,a]of Object.entries(t))i[e]=a;return i}case"plugins.list":return e.plugins;case"plugins.enable":case"plugins.disable":break;case"plugins.set":{const t=h,i=e.plugins[t.id];for(const[e,a]of Object.entries(t.setting))i.data[e]=a;for(const e of t.removing)delete i.data[e];return null}case"imageAssets.list":return e.images;case"imageAssets.createFolder":return v(e.images,h);case"imageAssets.move":return y(e.images,h.from,h.to);case"imageAssets.moveFolder":return E(e.images,h.from,h.to);case"imageAssets.remove":return k(e.images,h);case"imageAssets.removeFolder":return M(e.images,h);case"imageAssets.copy":return T(e.images,h.id,h.path);case"audioAssets.list":return e.audio;case"audioAssets.createFolder":return v(e.audio,h);case"audioAssets.move":return y(e.audio,h.from,h.to);case"audioAssets.moveFolder":return E(e.audio,h.from,h.to);case"audioAssets.remove":return k(e.audio,h);case"imageAssets.removeFolder":return M(e.audio,h);case"imageAssets.copy":return T(e.audio,h.id,h.path);case"characters.list":return e.characters;case"characters.createFolder":return v(e.characters,h);case"characters.move":return y(e.characters,h.from,h.to);case"characters.moveFolder":return E(e.characters,h.from,h.to);case"characters.remove":return k(e.characters,h);case"characters.removeFolder":return M(e.characters,h);case"characters.copy":{const[t,i]=w(e.characters,h.path),a=e.characterData[h.id],o=++e[n];return t&&a?(e.characterData[o]=JSON.parse(JSON.stringify(a)),{id:o,path:h.path.slice(0,i.length)+c(t.items,i,o)}):null}case"maps.list":return e.maps;case"maps.createFolder":return v(e.maps,h);case"maps.move":return y(e.maps,h.from,h.to);case"maps.moveFolder":return E(e.maps,h.from,h.to);case"maps.remove":return k(e.maps,h);case"maps.removeFolder":return M(e.maps,h);case"maps.copy":{const[t,i]=w(e.maps,h.path),a=e.mapData[h.id],o=++e[s];return t&&a?(e.mapData[o]=JSON.parse(JSON.stringify(a)),{id:o,path:h.path.slice(0,i.length)+c(t.items,i,o)}):null}}return null}#e(e,t){setTimeout((()=>this.dispatchEvent(new MessageEvent("message",{data:JSON.stringify({id:e,result:t})}))))}close(){}}},XMLHttpRequest:{value:class extends EventTarget{#i={addEventListener:(e,t)=>{}};#a="";#o=-1;response;responseType="";readyState=4;responseText="Bad Upload";status=200;get upload(){return this.#i}abort(){this.#o>=0&&(clearTimeout(this.#o),this.#o=-1)}open(e,t){this.#a=t}setRequestHeader(e,t){}overrideMimeType(e){}send(t){this.#o=setTimeout((()=>{this.#o=-1;const i=new URL(this.#a,"file:///"),a=p(m(i.pathname,"/"),"/"),o=Array.from(i.searchParams).find((([e])=>"path"===e))?.[1]??"";if(("images"===a||"audio"===a)&&t instanceof FormData){const i=[],s=this.response=[];for(const n of t.getAll("asset"))if(n instanceof File){let t;const r=new FileReader;i.push(new Promise((e=>t=e))),r.addEventListener("load",(()=>{const i=e.urls[a].push(r.result)-1;s.push({id:i,name:c(h(e[a],o).items,n.name,i)}),t()})),r.readAsDataURL(n)}Promise.all(i).then((()=>this.dispatchEvent(new Event("readystatechange"))))}else this.status=400,this.dispatchEvent(new Event("readystatechange"))}))}}},localStorage:{value:new class{getItem(t){return e.localStorage[t]??null}setItem(t,i){e.localStorage[t]=i}removeItem(t){delete e.localStorage[t]}}},saveData:{value:()=>{for(let t=0;t<e.urls.images.length;t++){const i=e.urls.images[t];i.startsWith("data:image/svg+xml;base64,")&&(e.urls.images[t]="data:image/svg+xml,"+atob(i.slice(26)).replaceAll("#","%23").replaceAll("?","%3f").replaceAll(/\n[ \x09]*/g,""))}console.log(e)}}})}Object.defineProperty(globalThis,"include",{value:(()=>{const e=new Map([["/adminMap.js",["default",()=>Bm],["dragLighting",()=>Km],["mapLoadReceive",()=>zm],["mapLoadSend",()=>Fm],["selectToken",()=>Ym]],["/assets.js",["audioAssetName",()=>eu],["audioIDtoURL",()=>cu],["dragAudio",()=>nu],["dragAudioFiles",()=>su],["dragImage",()=>ru],["dragImageFiles",()=>ou],["imageAssetName",()=>tu],["imageIDtoURL",()=>lu],["uploadAudio",()=>au],["uploadImages",()=>iu]],["/characterList.js",["Character",()=>qm],["getCharacterName",()=>af]],["/characters.js",["characterIcon",()=>bm],["dragCharacter",()=>Tm],["edit",()=>Om]],["/colours.js",["Colour",()=>Rn],["ColourSetting",()=>Pn],["colourPicker",()=>Un],["dragColour",()=>Zn],["hex2Colour",()=>$n],["makeColourPicker",()=>Gn],["noColour",()=>Hn]],["/folders.js",["DragFolder",()=>zd],["DraggableItem",()=>Vd],["Folder",()=>Fd],["Item",()=>jd],["Root",()=>Kd]],["/help.js",["default",()=>xc]],["/ids.js",["adminHideLight",()=>Co],["cursors",()=>Jo],["dragOver",()=>Ho],["folderDragging",()=>$o],["folders",()=>Uo],["foldersItem",()=>Go],["gridPattern",()=>Qo],["hiddenLayer",()=>Fo],["hideZoomSlider",()=>Ko],["imageIcon",()=>Wo],["invertID",()=>Io],["itemControl",()=>Zo],["layerGrid",()=>Vo],["layerLight",()=>jo],["lighting",()=>qo],["mapID",()=>zo],["mapMask",()=>Xo],["psuedoLink",()=>Po],["selectedLayerID",()=>Do],["settingsTicker",()=>So],["tokenSelector",()=>Ro],["zoomSliderID",()=>Yo],["zooming",()=>Bo]],["/keys.js",["getKey",()=>Dc],["getKeyIDs",()=>Pc],["getKeyName",()=>Rc],["registerKeyEvent",()=>Ic],["setKey",()=>Cc]],["/language.js",["default",()=>as],["language",()=>es],["languages",()=>is],["makeLangPack",()=>ts]],["/layerList.js"],["/lib/bbcode.js",["default",()=>Jd],["isCloseTag",()=>qd],["isOpenTag",()=>Bd],["isString",()=>Xd],["process",()=>Qd],["text",()=>Yd]],["/lib/bbcode_tags.js",["all",()=>Ih],["audio",()=>Oh],["b",()=>ih],["center",()=>lh],["centre",()=>rh],["code",()=>Nh],["color",()=>mh],["colour",()=>ph],["font",()=>gh],["full",()=>hh],["h1",()=>wh],["h2",()=>vh],["h3",()=>yh],["h4",()=>Eh],["h5",()=>kh],["h6",()=>Mh],["highlight",()=>uh],["hr",()=>Th],["i",()=>ah],["img",()=>_h],["justify",()=>dh],["left",()=>nh],["list",()=>Lh],["none",()=>Ch],["quote",()=>xh],["right",()=>ch],["s",()=>sh],["size",()=>fh],["table",()=>Ah],["text",()=>Sh],["u",()=>oh],["url",()=>bh]],["/lib/bind.js",["Binding",()=>O],["Bound",()=>N],["default",()=>A]],["/lib/conn.js",["HTTPRequest",()=>Ao],["WS",()=>xo],["WSConn",()=>Lo]],["/lib/css.js",["add",()=>P],["at",()=>$],["default",()=>x],["id",()=>H],["ids",()=>U],["mixin",()=>Z],["render",()=>G]],["/lib/dom.js",["amendNode",()=>p],["attr",()=>d],["bindElement",()=>m],["child",()=>c],["clearNode",()=>k],["createDocumentFragment",()=>E],["event",()=>y],["eventCapture",()=>g],["eventOnce",()=>f],["eventPassive",()=>w],["eventRemove",()=>v],["isChildren",()=>u],["value",()=>h]],["/lib/drag.js",["DragFiles",()=>Si],["DragTransfer",()=>Li],["setDragEffect",()=>Ii]],["/lib/events.js",["hasKeyEvent",()=>ce],["keyEvent",()=>ne],["mouseDragEvent",()=>le],["mouseMoveEvent",()=>re],["mouseX",()=>oe],["mouseY",()=>se]],["/lib/fraction.js",["default",()=>uu]],["/lib/html.js",["a",()=>he],["abbr",()=>ue],["address",()=>pe],["area",()=>me],["article",()=>fe],["aside",()=>ge],["audio",()=>we],["b",()=>ve],["base",()=>ye],["bdi",()=>Ee],["bdo",()=>ke],["blockquote",()=>Me],["body",()=>Te],["br",()=>be],["button",()=>Oe],["canvas",()=>_e],["caption",()=>Ne],["cite",()=>Ae],["code",()=>xe],["col",()=>Le],["colgroup",()=>Se],["data",()=>Ie],["datalist",()=>Ce],["dd",()=>De],["del",()=>Re],["details",()=>Pe],["dfn",()=>$e],["dialog",()=>He],["div",()=>Ue],["dl",()=>Ge],["dt",()=>Ze],["em",()=>We],["embed",()=>je],["fieldset",()=>Ve],["figcaption",()=>Fe],["figure",()=>ze],["footer",()=>Ke],["form",()=>Ye],["h1",()=>Be],["h2",()=>qe],["h3",()=>Xe],["h4",()=>Qe],["h5",()=>Je],["h6",()=>et],["head",()=>tt],["header",()=>it],["hgroup",()=>at],["hr",()=>ot],["html",()=>st],["i",()=>nt],["iframe",()=>rt],["img",()=>lt],["input",()=>ct],["ins",()=>dt],["kbd",()=>ht],["label",()=>ut],["legend",()=>pt],["li",()=>mt],["link",()=>ft],["main",()=>gt],["map",()=>wt],["mark",()=>vt],["menu",()=>yt],["meta",()=>Et],["meter",()=>kt],["nav",()=>Mt],["noscript",()=>Tt],["ns",()=>de],["object",()=>bt],["ol",()=>Ot],["optgroup",()=>_t],["option",()=>Nt],["output",()=>At],["p",()=>xt],["picture",()=>Lt],["pre",()=>St],["progress",()=>It],["q",()=>Ct],["rp",()=>Dt],["rt",()=>Rt],["ruby",()=>Pt],["s",()=>$t],["samp",()=>Ht],["script",()=>Ut],["section",()=>Gt],["select",()=>Zt],["slot",()=>Wt],["small",()=>jt],["source",()=>Vt],["span",()=>Ft],["strong",()=>zt],["style",()=>Kt],["sub",()=>Yt],["summary",()=>Bt],["sup",()=>qt],["table",()=>Xt],["tbody",()=>Qt],["td",()=>Jt],["template",()=>ei],["textarea",()=>ti],["tfoot",()=>ii],["th",()=>ai],["thead",()=>oi],["time",()=>si],["title",()=>ni],["tr",()=>ri],["track",()=>li],["u",()=>ci],["ul",()=>di],["vare",()=>hi],["video",()=>ui],["wbr",()=>pi]],["/lib/inter.js",["Pickup",()=>$i],["Pipe",()=>Ci],["Requester",()=>Di],["Subscription",()=>Ri],["WaitGroup",()=>Pi]],["/lib/load.js",["default",()=>os]],["/lib/menu.js",["ItemElement",()=>Fi],["MenuElement",()=>Vi],["SubMenuElement",()=>zi],["item",()=>Yi],["menu",()=>Ki],["submenu",()=>Bi]],["/lib/misc.js",["addAndReturn",()=>yi],["autoFocus",()=>ki],["checkInt",()=>fi],["isInt",()=>mi],["mod",()=>gi],["pushAndReturn",()=>vi],["queue",()=>Ei],["setAndReturn",()=>wi],["text2DOM",()=>Mi]],["/lib/nodes.js",["NodeArray",()=>ua],["NodeMap",()=>pa],["addNodeRef",()=>Ji],["noSort",()=>Xi],["node",()=>qi],["stringSort",()=>Qi]],["/lib/rpc.js",["RPC",()=>cs],["RPCError",()=>ls]],["/lib/settings.js",["BoolSetting",()=>Oi],["IntSetting",()=>_i],["JSONSetting",()=>xi],["NumberSetting",()=>Ni],["StringSetting",()=>Ai]],["/lib/svg.js",["a",()=>ga],["animate",()=>wa],["animateMotion",()=>va],["animateTransform",()=>ya],["circle",()=>Ea],["clipPath",()=>ka],["defs",()=>Ma],["desc",()=>Ta],["ellipse",()=>ba],["feBlend",()=>Oa],["feColorMatrix",()=>_a],["feComponentTransfer",()=>Na],["feComposite",()=>Aa],["feConvolveMatrix",()=>xa],["feDiffuseLighting",()=>La],["feDisplacementMap",()=>Sa],["feDistantLight",()=>Ia],["feDropShadow",()=>Ca],["feFlood",()=>Da],["feFuncA",()=>Ra],["feFuncB",()=>Pa],["feFuncG",()=>$a],["feFuncR",()=>Ha],["feGaussianBlur",()=>Ua],["feImage",()=>Ga],["feMerge",()=>Za],["feMergeNode",()=>Wa],["feMorphology",()=>ja],["feOffset",()=>Va],["fePointLight",()=>Fa],["feSpecularLighting",()=>za],["feSpotLight",()=>Ka],["feTile",()=>Ya],["feTurbulence",()=>Ba],["filter",()=>qa],["foreignObject",()=>Xa],["g",()=>Qa],["image",()=>Ja],["line",()=>eo],["linearGradient",()=>to],["marker",()=>io],["mask",()=>ao],["metadata",()=>oo],["mpath",()=>so],["ns",()=>ma],["path",()=>no],["pattern",()=>ro],["polygon",()=>lo],["polyline",()=>co],["radialGradient",()=>ho],["rect",()=>uo],["script",()=>po],["set",()=>mo],["stop",()=>fo],["style",()=>go],["svg",()=>wo],["svgData",()=>fa],["switche",()=>vo],["symbol",()=>yo],["text",()=>Eo],["textPath",()=>ko],["title",()=>Mo],["tspan",()=>To],["use",()=>bo],["view",()=>Oo]],["/lib/windows.js",["DesktopElement",()=>pn],["ShellElement",()=>un],["WindowElement",()=>mn],["defaultIcon",()=>En],["desktop",()=>gn],["setDefaultIcon",()=>vn],["setLanguage",()=>yn],["shell",()=>fn],["windows",()=>wn]],["/lib/windows_taskmanager.js",["DesktopElement",()=>pn],["ShellElement",()=>bn],["WindowElement",()=>mn],["defaultIcon",()=>En],["desktop",()=>gn],["setDefaultIcon",()=>vn],["setLanguage",()=>yn],["shell",()=>On],["windows",()=>wn]],["/map.js",["addLayer",()=>dp],["addLayerFolder",()=>rp],["centreOnGrid",()=>Mp],["default",()=>bp],["getLayer",()=>op],["getParentLayer",()=>sp],["isSVGFolder",()=>ip],["isSVGLayer",()=>ap],["isTokenDrawing",()=>fp],["isTokenImage",()=>mp],["layerList",()=>ju],["mapData",()=>Vu],["mapView",()=>Tp],["moveLayer",()=>hp],["normaliseWall",()=>gp],["panZoom",()=>yp],["removeLayer",()=>cp],["renameLayer",()=>lp],["root",()=>Fu],["screen2Grid",()=>Ep],["setLayerVisibility",()=>np],["setLightColour",()=>pp],["setMapDetails",()=>up],["showSignal",()=>vp],["splitAfterLastSlash",()=>ep],["updateLight",()=>wp],["walkLayers",()=>tp],["wallList",()=>zu],["zoom",()=>kp]],["/mapList.js",["dragMap",()=>ff]],["/map_fns.js",["checkSelectedLayer",()=>Pp],["doLayerAdd",()=>em],["doLayerFolderAdd",()=>tm],["doLayerMove",()=>im],["doLayerRename",()=>am],["doLayerShift",()=>cm],["doLockUnlockLayer",()=>Jp],["doMapChange",()=>qp],["doMapDataRemove",()=>fm],["doMapDataSet",()=>mm],["doMaskAdd",()=>gm],["doMaskRemove",()=>wm],["doMaskSet",()=>vm],["doSetLightColour",()=>Xp],["doShowHideLayer",()=>Qp],["doTokenAdd",()=>om],["doTokenMoveLayerPos",()=>sm],["doTokenRemove",()=>lm],["doTokenSet",()=>nm],["doTokenSetMulti",()=>rm],["doWallAdd",()=>dm],["doWallModify",()=>um],["doWallMove",()=>pm],["doWallRemove",()=>hm],["getToken",()=>Rp],["layersRPC",()=>Em],["setLayer",()=>$p],["snapTokenToGrid",()=>ym],["tokenMousePos",()=>Hp],["waitAdded",()=>Up],["waitFolderAdded",()=>Zp],["waitFolderRemoved",()=>Wp],["waitLayerHide",()=>Vp],["waitLayerLock",()=>Fp],["waitLayerPositionChange",()=>Kp],["waitLayerRename",()=>Yp],["waitLayerSelect",()=>Bp],["waitLayerShow",()=>jp],["waitLayerUnlock",()=>zp],["waitRemoved",()=>Gp]],["/map_lighting.js",["intersection",()=>Ou],["makeLight",()=>_u]],["/map_tokens.js",["Lighting",()=>$c],["SQRT3",()=>Xc],["SVGDrawing",()=>Zc],["SVGShape",()=>Gc],["SVGToken",()=>Uc],["definitions",()=>Qc],["deselectToken",()=>Bc],["masks",()=>qc],["outline",()=>Kc],["outlineRotationClass",()=>Yc],["selected",()=>zc],["tokenSelected",()=>jc],["tokenSelectedReceive",()=>Vc],["tokens",()=>Fc]],["/messaging.js",["bbcodeDrag",()=>Uh],["parseBBCode",()=>Hh],["register",()=>Ph],["registerTag",()=>$h]],["/musicPacks.js",["dragMusicPack",()=>Af],["open",()=>xf]],["/plugins.js",["addLights",()=>ud],["addPlugin",()=>sd],["addWalls",()=>hd],["askReload",()=>rd],["characterEdit",()=>od],["default",()=>wd],["drawingClass",()=>gd],["getSettings",()=>nd],["handleWalls",()=>pd],["menuItems",()=>dd],["pluginName",()=>id],["settings",()=>ad],["shapeClass",()=>fd],["tokenClass",()=>md],["tokenContext",()=>ld],["tokenDataFilter",()=>cd]],["/rpc.js",["addCharacterDataChecker",()=>Jn],["addMapDataChecker",()=>Qn],["addTokenDataChecker",()=>er],["combined",()=>qn],["handleError",()=>tr],["inited",()=>ir],["internal",()=>Bn],["isAdmin",()=>zn],["isUser",()=>Kn],["rpc",()=>Xn],["timeShift",()=>Yn]],["/script.js"],["/settings.js",["autosnap",()=>vd],["enableAnimation",()=>_d],["hiddenLayerOpacity",()=>Ld],["hiddenLayerSelectedOpacity",()=>Sd],["hideMenu",()=>yd],["invert",()=>Ed],["measureTokenMove",()=>Od],["miniTools",()=>kd],["musicSort",()=>Nd],["panelOnTop",()=>bd],["scrollAmount",()=>Ad],["tabIcons",()=>Md],["undoLimit",()=>xd],["zoomSlider",()=>Td]],["/shared.js",["characterData",()=>Qs],["cloneObject",()=>Xs],["enterKey",()=>Ks],["getCharacterToken",()=>Js],["labels",()=>qs],["loading",()=>an],["mapLoadedReceive",()=>Bs],["mapLoadedSend",()=>Ys],["menuItems",()=>on],["resetCharacterTokens",()=>en],["walls",()=>tn]],["/symbols.js",["addSymbol",()=>us],["clearRight",()=>Fs],["clearRightStr",()=>zs],["copy",()=>ps],["copyStr",()=>ms],["folder",()=>fs],["folderStr",()=>gs],["lightGrid",()=>Us],["lightGridStr",()=>Gs],["lightOnOff",()=>$s],["lightOnOffStr",()=>Hs],["lock",()=>js],["lockStr",()=>Vs],["newFolder",()=>ws],["newFolderStr",()=>vs],["playStatus",()=>ys],["playStatusStr",()=>Es],["popout",()=>ks],["popoutStr",()=>Ms],["remove",()=>Ts],["removeStr",()=>bs],["rename",()=>Os],["renameStr",()=>_s],["share",()=>Zs],["shareStr",()=>Ws],["spinner",()=>Ns],["spinnerStr",()=>As],["stop",()=>xs],["stopStr",()=>Ls],["symbols",()=>hs],["userSelected",()=>Ss],["userSelectedStr",()=>Is],["userVisible",()=>Cs],["userVisibleStr",()=>Ds],["visibility",()=>Rs],["visibilityStr",()=>Ps]],["/tools.js",["addTool",()=>Lu],["defaultTool",()=>xu],["disable",()=>Iu],["ignore",()=>Su],["isDefaultTool",()=>Zu],["marker",()=>Cu],["optionsWindow",()=>Gu],["toolMapMouseDown",()=>$u],["toolMapMouseOver",()=>Uu],["toolMapWheel",()=>Hu],["toolTokenMouseDown",()=>Du],["toolTokenMouseOver",()=>Pu],["toolTokenWheel",()=>Ru]],["/tools_draw.js"],["/tools_mask.js"],["/tools_measure.js",["measureDistance",()=>jm],["startMeasurement",()=>Wm],["stopMeasurement",()=>Vm]],["/tools_move.js"],["/tools_multiplace.js"],["/tools_wall.js"],["/undo.js",["default",()=>Ap]],["/windows.js",["checkWindowData",()=>Dn],["desktop",()=>Sn],["getWindowData",()=>Cn],["loadingWindow",()=>xn],["shell",()=>In],["windows",()=>Ln]]].map((([e,...t])=>[e,Object.freeze(Object.defineProperties({},Object.fromEntries(t.map((([e,t])=>[e,{enumerable:!0,get:t}])))))]))),t=new Map([["/plugins/5e.js",async()=>{const[e,t,i,a,o,s,n,r,l,c,d,h,u,p,m,f,g,w,v,y,E,k,M,T,b]=await Promise.all(["/lib/bind.js","/lib/css.js","/lib/dom.js","/lib/html.js","/lib/menu.js","/lib/misc.js","/lib/nodes.js","/lib/settings.js","/lib/svg.js","/adminMap.js","/assets.js","/colours.js","/ids.js","/keys.js","/language.js","/map.js","/map_fns.js","/map_lighting.js","/map_tokens.js","/plugins.js","/rpc.js","/settings.js","/shared.js","/symbols.js","/windows.js"].map(include));class O extends v.Lighting{wallInteraction(e,t,i,a,o,s,n=!1){if(n&&s<=this.lightStages[0]){const{r:s,g:n,b:r,a:l}=o,c=255-Math.round((255-l)/255*(s+n+r)/765*(255-this.lightColours[0][0].r)),d=new h.Colour(c,c,c);return new O(e,t,i,a,[[d],[d]],this.lightStages,this.lightTimings)}return null}createLightPolygon(e){return l.polygon({points:e,fill:this.lightColours[0][0].toHexString()})}}let _;const N=Symbol("select"),A=Symbol("unselect"),x=Symbol("updateData"),L=m.makeLangPack({ARMOUR_CLASS:"Armour Class",CONDITION_BANE:"Bane",CONDITION_BLESSED:"Blessed",CONDITION_BLINDED:"Blinded",CONDITION_BLINK:"Blink",CONDITION_BLUR:"Blur",CONDITION_BURNING:"Burning",CONDITION_CHARMED:"Charmed",CONDITION_CONCENTRATING:"Concentrating",CONDITION_CONFUSED:"Confused",CONDITION_DEAD:"Dead",CONDITION_DEAFENED:"Deafened",CONDITION_DYING:"Dying",CONDITION_EXHAUSTED:"Exhausted",CONDITION_FLYING:"Flying",CONDITION_FRIGHTENED:"Frightened",CONDITION_GRAPPLED:"Grappled",CONDITION_GUIDANCE:"Guidance",CONDITION_HASTE:"Haste",CONDITION_HEXED:"Hex",CONDITION_HIDEOUS_LAUGHTER:"Hideous Laughter",CONDITION_HUNTERS_MARK:"Hunters' Mark",CONDITION_INCAPACITATED:"Incapacitated",CONDITION_INSPIRED:"Inspired",CONDITION_INVISIBLE:"Invisible",CONDITION_LEVITATE:"Levitating",CONDITION_MIRROR_IMAGE:"Mirror Image",CONDITION_PARALYZED:"Paralyzed",CONDITION_PETRIFIED:"Petrified",CONDITION_POISONED:"Poisoned",CONDITION_PRONE:"Prone",CONDITION_RAGE:"Rage",CONDITION_RECKLESS:"Reckless",CONDITION_RESTRAINED:"Restrained",CONDITION_SANCTUARY:"Sanctuary",CONDITION_SLOW:"Slow",CONDITION_STUNNED:"Stunned",CONDITION_UNCONSCIOUS:"Unconscious",CONDITIONS:"Conditions",DARKVISION:"Darkvision",DESATURATE_CONDITIONS:"Greyscale Conditions",HIDE_CONDITIONS:"Hide Token Conditions",HIGHLIGHT_COLOUR:"Token Highlight Colour",HP_CURRENT:"Current Hit Points",HP_CURRENT_ENTER:"Please enter current Hit Points",HP_MAX:"Maximum Hit Points",INITIATIVE:"Initiative",INITIATIVE_ADD:"Add Initiative",INITIATIVE_ADV:"Advantage",INITIATIVE_ASC:"Sort Initiative Ascending",INITIATIVE_CHANGE:"Change Initiative",INITIATIVE_DESC:"Sort Initiative Descending",INITIATIVE_ENTER:"Enter initiative",INITIATIVE_ENTER_LONG:"Please enter the initiative value for this token",INITIATIVE_MOD:"Initiative Mod",INITIATIVE_NEXT:"Next",INITIATIVE_PREV:"Previous",INITIATIVE_REMOVE:"Remove Initiative",IS_PLAYER:"Is Player",KEY_HEALTH:"Health Modification Key (5E)",KEY_INITIATIVE:"Initiative Key (5E)",NOTES:"Notes",SHAPECHANGE:"Shapechange",SHAPECHANGE_5E:"Shapechange (5E)",SHAPECHANGE_CHANGE:"Change to Selected Token",SHAPECHANGE_INITIAL_RESTORE:"Restore Initial Token",SHAPECHANGE_TITLE:"Shapechange Settings",SHAPECHANGE_TOKEN_ADD:"Add Token",SHAPECHANGE_TOKEN_CATEGORY:"Add Category",SHAPECHANGE_TOKEN_CATEGORY_LONG:"Please enter a name for this category of Shapechanges.",SHAPECHANGE_TOKEN_CATEGORY_REMOVE:"Remove Shapechange Category",SHAPECHANGE_TOKEN_CATEGORY_REMOVE_LONG:"Are you sure you wish to Remove this Shapechange Category?",SHAPECHANGE_TOKEN_CATEGORY_RENAME:"Rename Shapechange Category",SHAPECHANGE_TOKEN_CATEGORY_RENAME_LONG:"Please enter a new name for this Shapechange category.",SHAPECHANGE_TOKEN_NAME:"Enter Name",SHAPECHANGE_TOKEN_NAME_LONG:"Please enter a name for the selected token.",SHAPECHANGE_TOKEN_REMOVE:"Remove Shapechange Token",SHAPECHANGE_TOKEN_REMOVE_LONG:"Are you sure you wish to Remove this Shapechange Token?",SHAPECHANGE_TOKEN_RENAME:"Rename Shapechange Token",SHAPECHANGE_TOKEN_RENAME_LONG:"Please enter a new name for this token.",SHOW_AC:"Show Token Armour Class",SHOW_HP:"Show Token Hit Points",SHOW_NAMES:"Show Token Names",TOGGLE_CONDITION:"Toggle Condition",TOKEN_SELECTED:"Selected",TOKENS_UNSELECTED:"Unselected"},{"en-US":{ARMOUR_CLASS:"Armor Class",DESATURATE_CONDITIONS:"Grayscale Conditions",HIGHLIGHT_COLOUR:"Token Highlight Color",SHOW_AC:"Show Token Armor Class"}}),S=y.pluginName({url:"/plugins/5e.js"}),[I,C,D,R,P,$,H,U,G,Z,W,j,V,F,z,K,Y,B,q,X,Q,J,ee,te,ie,ae,oe,se,ne,re,le,ce,de,he,ue,pe,me,fe,ge,we,ve,ye,Ee,ke,Me,Te,be,Oe]=t.ids(48),_e=t.ids(37),Ne=l.svg({viewBox:"0 0 2 2"},l.polygon({points:"2,2 0,2 1,0",fill:"currentColor"})),Ae=l.svg({viewBox:"0 0 2 2"},l.polygon({points:"0,0 2,0 1,2",fill:"currentColor"})),xe=l.svg({viewBox:"0 0 2 2"},l.polygon({points:"0,0 2,1 0,2",fill:"currentColor"})),Le=l.svg({viewBox:"0 0 2 2"},l.polygon({points:"2,0 0,1 2,2",fill:"currentColor"})),Se=Object.keys(L).filter((e=>e.startsWith("CONDITION_"))),Ie=(e,t)=>e.initiative-t.initiative,Ce=(e,t)=>t.initiative-e.initiative,De=e=>e instanceof _&&!e.isPattern&&v.tokens.has(e.id),Re=new n.NodeArray(a.ul({id:C})),Pe=()=>{0===Re.length?g.doMapDataRemove("5e-initiative"):g.doMapDataSet("5e-initiative",Re.map((e=>({id:e.token.id,initiative:e.initiative}))))},$e=b.windows({"window-icon":`data:image/svg+xml,%3Csvg xmlns="${l.ns}" viewBox="0 0 100 100"%3E%3Cpath d="M92.5,7 l-30,30 h30 z" fill="%23000" stroke="%23fff" stroke-linejoin="round" /%3E%3Ccircle cx="50" cy="50" r="40" fill="none" stroke="%23fff" stroke-width="12" stroke-dasharray="191 1000" stroke-dashoffset="-29" /%3E%3Ccircle cx="50" cy="50" r="40" fill="none" stroke="%23000" stroke-width="10" stroke-dasharray="191 1000" stroke-dashoffset="-30" /%3E%3C/svg%3E`,"window-title":L.INITIATIVE,style:"--window-left: 0px; --window-top: calc(100% - 400px); --window-width: 200px; --window-height: 400px","window-data":"5e-window-data","hide-close":!0,"hide-maximise":!0,resizable:!0},a.div({id:I},[E.isAdmin?a.div([a.button({title:L.INITIATIVE_ASC,onclick:()=>{Re.sort(Ie),Re.sort(n.noSort),Pe()}},Ne),a.button({title:L.INITIATIVE_DESC,onclick:()=>{Re.sort(Ce),Re.sort(n.noSort),Pe()}},Ae),a.br(),a.button({title:L.INITIATIVE_PREV,onclick:()=>{const e=Re.pop();e&&(Re.unshift(e),Pe())}},Le),a.button({title:L.INITIATIVE_NEXT,onclick:()=>{const e=Re.shift();e&&(Re.push(e),Pe())}},xe)]):[],Re[n.node]])),He=new Set,Ue=(e,t,o)=>(He.add(e.id),Re.push({token:e,hidden:o,initiative:t,[n.node]:a.li({style:o&&!E.isAdmin?"display: none":void 0,onmouseover:()=>{e[n.node].parentNode&&(i.amendNode(We,{width:e.width,height:e.height,transform:e.transformString()}),e[n.node].parentNode.insertBefore(We,e[n.node]))},onmouseleave:()=>We.remove()},[a.img({src:d.imageIDtoURL(e.src),onclick:t=>{f.centreOnGrid(e.x+(e.width>>1),e.y+(e.height>>1)),E.isAdmin&&t.ctrlKey&&c.selectToken(e)}}),a.span(e.getData("name")??""),a.span(E.isAdmin?{class:J,onclick:()=>{Ge([e.id,null]),Pe(),We.remove()}}:{},t+"")])})),Ge=e=>{const{"5e-initiative":t}=f.mapData.data,a=new Set;if(Re.splice(0,Re.length),He.clear(),f.walkLayers(((e,t)=>{t&&a.add(e.path)})),t)for(const i of t){const t=v.tokens.get(i.id);if(t){const{layer:o,token:s}=t;if(s instanceof _){let t=i.initiative;const n=a.has(o.path);if(e&&e[0]===i.id){const i=e[1];if(e=void 0,null===i)continue;t=i}n&&!E.isAdmin||Ue(s,t,n)}}}if(e&&null!==e[1]){const{token:t,layer:i}=v.tokens.get(e[0]);t instanceof _&&Ue(t,e[1],a.has(i.path))}0===Re.length?$e.remove():$e.parentNode||i.amendNode(b.shell,$e),Ve()},Ze={SHOW_HP:[new r.BoolSetting("5e-show-token-hp").wait((e=>i.amendNode(document.body,{class:{[P]:!e}}))),new r.BoolSetting("5e-show-selected-hp").wait((e=>i.amendNode(document.body,{class:{[F]:!e}})))],SHOW_AC:[new r.BoolSetting("5e-show-token-ac").wait((e=>i.amendNode(document.body,{class:{[U]:!e}}))),new r.BoolSetting("5e-show-selected-ac").wait((e=>i.amendNode(document.body,{class:{[z]:!e}})))],SHOW_NAMES:[new r.BoolSetting("5e-show-token-names").wait((e=>i.amendNode(document.body,{class:{[Z]:!e}}))),new r.BoolSetting("5e-show-selected-names").wait((e=>i.amendNode(document.body,{class:{[K]:!e}})))],HIDE_CONDITIONS:[new r.BoolSetting("5e-hide-token-conditions").wait((e=>i.amendNode(document.body,{class:{[j]:e}}))),new r.BoolSetting("5e-hide-selected-conditions").wait((e=>i.amendNode(document.body,{class:{[Y]:e}})))],DESATURATE_CONDITIONS:[new r.BoolSetting("5e-desaturate-token-conditions").wait((e=>i.amendNode(document.body,{class:{[B]:e}}))),new r.BoolSetting("5e-desaturate-selected-conditions").wait((e=>i.amendNode(document.body,{class:{[q]:e}})))]},We=l.rect({"stroke-width":20}),je=new h.ColourSetting("5e-hightlight-colour",new h.Colour(255,255,0,127)).wait((e=>{const t=e.toHexString();i.amendNode(We,{fill:t,stroke:t,opacity:e.a/255})})),Ve=(()=>{const e=l.g({id:te,fill:"#000"}),t=[[new h.Colour(0,0,0)]],a=[0],o=l.filter({id:Te},l.feColorMatrix({type:"matrix",values:"0 0 0 0 0,0 0 0 0 0,0 0 0 0 0,-0.2125 -0.7154 -0.0721 1 0"})),s=l.filter({id:be},l.feColorMatrix({type:"matrix",values:"0.5 0 0 0 0.5,0 0.5 0 0 0.5,0 0 0.5 0 0.5,0 0 0 1 0"})),r=l.g(),c=l.clipPath({id:Oe}),d=[];v.masks[n.node].firstChild?.after(e),i.amendNode(v.definitions[n.node],[r,c,o,s]);let u=0,p=0,m=[],g=null;return()=>{if(g!==f.mapData)return void(g=f.mapData);u=0,i.clearNode(e),i.clearNode(r),i.clearNode(c);const o=[];Re[0]?.token.getData("5e-player")?o.push(Re[0].token):f.walkLayers(((e,t)=>{if(!t)for(const t of e.tokens)t.getData("5e-player")&&o.push(t)}));let s=f.wallList!==m||o.length!==d.length;if(m=f.wallList,o.length){const{gridSize:h,gridDistance:m,width:g,height:v}=f.mapData,y=h/(m||1),E=[Math.max(g,v)/y,0];s||=y!==p,p=y,i.amendNode(e,[l.rect({width:"100%",height:"100%",fill:"#fff"}),o.map(((e,o)=>{const[n,h]=e.getCentre();if(!s){const[e,t,a,s,l]=d[o];if(n===e&&h===t)return i.amendNode(r,s),i.amendNode(c,l),a}const p=w.makeLight(new O(n,h,n,h,t,E,a),f.wallList,y),m=(e.getData("5e-darkvision")??0)*y,g=[n,h,p,[],[]];if(d.splice(o,1,g),m){const t="DVC-5E_"+u++,[a,o]=e.getCentre();i.amendNode(r,g[3]=l.clipPath({id:t},l.circle({r:m,cx:a,cy:o}))),i.amendNode(c,g[4]=p.map((e=>i.amendNode(e.cloneNode(),{"clip-path":`url(#${t})`,fill:void 0}))))}return p})).flat().sort(((e,t)=>n.stringSort(t.getAttribute("fill")??"",e.getAttribute("fill")??"")))])}}})(),Fe={settings:{fn:a.div([M.labels([L.HIGHLIGHT_COLOUR,": "],h.makeColourPicker(null,L.HIGHLIGHT_COLOUR,(()=>je.value),(e=>je.set(e)))),a.table({id:ee},[a.thead(a.tr([a.td(),a.th(L.TOKENS_UNSELECTED),a.th(L.TOKEN_SELECTED)])),a.tbody(Object.entries(Ze).map((([e,t])=>a.tr([a.td([L[e],": "]),t.map((e=>a.td(M.labels(a.input({type:"checkbox",class:u.settingsTicker,checked:e.value,onchange:function(){e.set(this.checked)}}),""))))]))))])])},tokenClass:{fn:e=>_=class extends e{#s;#n;#r;#l;#c;#d;#h;#u;#p;#m;#f;constructor(e,t){super(e,t);const i=this.getData("5e-hp-max"),a=this.getData("5e-hp-current"),o=this.getData("5e-ac"),s=Math.min(this.width,this.height)/4;this[n.node]=l.g([this.#s=this[n.node],this.#n=l.g({class:$,transform:`translate(${this.x}, ${this.y})`,style:"color: #000"},[this.#r=l.g({class:H,style:null===a||null===i?"display: none":void 0},[this.#d=l.use({href:`#${se}`,width:s,height:s}),this.#c=l.use({href:`#${oe}`,width:s,height:s,"stroke-dasharray":19*Math.PI*.75*Math.min(a||0,i||0)/(i||1)+" 60",style:`color: rgba(${Math.round(255*Math.min(a||0,i||0)/(i||1))}, 0, 0, 1)`}),this.#l=l.text({x:this.width/8,y:"1.2em","text-anchor":"middle",fill:`rgba(${Math.round(255*Math.min(a||0,i||0)/(i||1))}, 0, 0, 1)`},a?.toString()??"")]),this.#h=l.text({class:W,style:"user-select: none",stroke:"#fff","stroke-width":1,fill:"#000",x:this.width/2,y:"1em","text-anchor":"middle"},this.getData("name")??""),this.#u=l.g({class:G,style:null===o?"display: none":void 0},[this.#m=l.use({href:`#${ae}`,width:s,height:s,x:3*this.width/4}),this.#p=l.text({x:7*this.width/8,y:"1.2em","text-anchor":"middle"},o?.toString()??"")]),this.#f=l.g({class:V})])]),setTimeout((()=>this.#g()),0),this.#w()}#g(){const e=this.width/2,t=this.#h.getComputedTextLength(),a=Math.min(this.width,this.height)/8,o=Math.min(e/t*16,this.height/8);i.amendNode(this.#h,{style:{"font-size":o+"px"},"stroke-width":o/100}),i.amendNode(this.#p,{style:{"font-size":`${a}px`}}),i.amendNode(this.#l,{style:{"font-size":`${a}px`}})}#v(e){const t=this[n.node];this[n.node]=this.#s;const i=e();return this.#s=this[n.node],this[n.node]=t,i}cleanup(){this.#v((()=>super.cleanup()))}uncleanup(){this.#v((()=>super.uncleanup()))}hasLight(){return super.hasLight()||this.getData("5e-player")}at(e,t){return this.#v((()=>super.at(e,t)))}[N](){v.outline.insertAdjacentElement("beforebegin",this.#n)}[A](){this.isPattern||i.amendNode(this[n.node],this.#n)}updateSource(e){this.#v((()=>super.updateSource(e)))}updateNode(){const e=this.#s instanceof SVGRectElement;this.#v((()=>super.updateNode())),this.isPattern?e||this.#n.remove():e&&(v.selected.token===this&&v.outline.insertAdjacentElement("beforebegin",this.#n),this[n.node].replaceWith(this[n.node]=l.g([this.#s,this.#n]))),i.amendNode(this.#s,{width:this.width,height:this.height,transform:this.transformString()}),i.amendNode(this.#n,{transform:`translate(${this.x}, ${this.y})`}),i.amendNode(this.#m,{x:3*this.width/4,width:this.width/4,height:Math.min(this.height,this.width)/4}),i.amendNode(this.#d,{width:this.width/4,height:Math.min(this.width,this.height)/4}),i.amendNode(this.#c,{width:this.width/4,height:Math.min(this.width,this.height)/4}),i.amendNode(this.#h,{x:this.width/2,style:{"font-size":void 0}}),i.amendNode(this.#l,{x:this.width/8}),i.amendNode(this.#p,{x:7*this.width/8}),this.#g(),this.#w()}[x](){const e=this.getData("5e-hp-max"),t=this.getData("5e-hp-current"),a=this.getData("5e-ac"),o=this.getData("name")||"";null===a?i.amendNode(this.#u,{style:"display: none"}):(i.amendNode(this.#u,{style:void 0}),i.clearNode(this.#p,a+"")),null===t||null===e?i.amendNode(this.#r,{style:"display: none"}):(i.amendNode(this.#r,{style:void 0}),i.clearNode(this.#l,{fill:`rgba(${Math.round(255*Math.min(t||0,e||0)/(e||1))}, 0, 0, 1)`},t+""),i.amendNode(this.#c,{"stroke-dasharray":19*Math.PI*.75*Math.min(t||0,e||0)/(e||1)+" 60"})),this.#h.innerHTML!==o&&(i.clearNode(this.#h,{style:{"font-size":void 0}},o),this.#g()),this.#w()}#w(){i.clearNode(this.#f);const e=this.getData("5e-conditions")??[],t=Math.min(this.width,this.height)/4,a=Math.floor(this.width/t);let o=-1,s=0;for(let n=0;n<e.length;n++)e[n]&&(i.amendNode(this.#f,l.use({href:`#${_e[n]}`,x:s*t,y:o*t,width:t,height:t})),s++,s===a&&(s=0,o--));i.amendNode(this.#f,{transform:`translate(0, ${this.height})`})}}},handleWalls:{fn:Ve}},ze=l.animate({attributeName:"stroke-dashoffset",values:"251.26;0",dur:"1s"}),Ke=l.animateMotion({dur:"1s",begin:-.6},l.mpath({href:"#5e-dying"})),Ye=l.circle({r:3,fill:"#fff",stroke:"#000"},Ke);if(t.add({[`#${I}`]:{" svg":{width:"1.5em"}," button":{height:"2em"}},[`#${C}`]:{"list-style":"none",padding:0," li":{display:"grid","grid-template-columns":"4.5em auto 3em","align-items":"center"," span":{"text-align":"center"}}," img":{height:"4em",width:"4em",cursor:"pointer"}},[`.${D}`]:{"padding-left":"1em","box-styling":"padding-box",">menu-item":{display:"list-item","list-style":"none"}},[`.${R}`]:{"list-style":"square !important"},[`.${P} g .${$} .${H},.${U} g .${$} .${G},.${Z} g .${$} .${W},.${j} g .${$} .${V},.${F} svg>.${$} .${H},.${z} svg>.${$} .${G},.${K} svg>.${$} .${W},.${Y} svg>.${$} .${V}`]:{visibility:"hidden"},[`.${B} g .${$} .${V},.${q} svg>.${$} .${V}`]:{filter:`url(#${ie})`},[`.${X},.${X}>button,.${X}>img`]:{width:"100px",height:"100px"},[`#${Q}`]:{"border-collapse":"collapse"," td":{"text-align":"center",label:{"font-size":"2em"}}," th, td:not(:first-child)":{border:"1px solid currentColor"}},[`.${J}:hover`]:{"background-color":"#800",cursor:"pointer"}}),k.enableAnimation.wait((e=>{const t={repeatCount:e?"indefinite":1};i.amendNode(ze,t),i.amendNode(Ke,t),i.amendNode(Ye,e?{cx:0,cy:0}:{cx:46,cy:38})})),i.amendNode(T.symbols,[l.filter({id:ie},l.feColorMatrix({type:"saturate",values:0})),l.symbol({id:ae,viewBox:"0 0 8 9"},l.path({d:"M0,1 q2,0 4,-1 q2,1 4,1 q0,5 -4,8 q-4,-3 -4,-8 z",fill:"#aaa"})),l.symbol({id:se,viewBox:"0 0 20 20"},l.circle({r:9.5,fill:"#eee",stroke:"#888","stroke-width":1,"stroke-linecap":"round","stroke-dasharray":`${19*Math.PI*.75} ${19*Math.PI*.25}`,transform:"translate(10, 10) rotate(135)"})),l.symbol({id:oe,viewBox:"0 0 20 20"},l.circle({r:9.5,fill:"transparent",stroke:"#f00","stroke-width":1,"stroke-linecap":"round",transform:"translate(10, 10) rotate(135)"})),[l.symbol({viewBox:"0 0 80 85"},l.g({stroke:"#000","stroke-width":3,"stroke-linecap":"round","stroke-linejoin":"round"},[l.path({d:"M5,37 a1,1 0,0,1 70,0 q4,-1 3,5 q-1,18 -6,10 q0,28 -15,30 q-17,3 -34,0 q-15,-2 -15,-30 q-5,8 -6,-10 q-1,-6 3,-5 z M40,2 v25 m-5,0 h10 m0,-6 h-10 m0,-6 h10 m0,-6 h-10",fill:"#444"}),l.path({d:"M57,82 q-17,3 -34,0 l10,-20 l-20,-18 l5,-20 l5,10 l17,5 l17,-5 l5,-10 l5,20 l-20,18 z",fill:"#fff"}),l.path({d:"M20,38 l15,5 a5,5 0,0,1 -15,-5 z M60,38 l-15,5 a5,5 0,0,0 15,-5 z",fill:"#f00"})])),l.symbol({viewBox:"0 0 11 10.5"},[l.ellipse({cx:5.5,cy:2,rx:5,ry:1.5,fill:"transparent",stroke:"#ff0","stroke-width":1}),l.circle({cx:5.5,cy:5.5,r:5,fill:"#fc8",stroke:"#000","stroke-width":.2}),l.ellipse({cx:5.5,cy:2,rx:5,ry:1.5,fill:"transparent",stroke:"#ff0","stroke-width":1,"stroke-dasharray":10}),l.path({d:"M2,5.5 q1,-1 2,0 m3,0 q1,-1 2,0 M3.5,8.5 q2,1 4,0",fill:"transparent",stroke:"#000","stroke-width":.1,"stroke-linecap":"round"})]),l.symbol({viewBox:"0 0 100 70"},[l.defs(l.mask({id:ne},[l.rect({width:100,height:70,fill:"#fff"}),l.line({x1:10,y1:67,x2:90,y2:3,stroke:"#000","stroke-width":9})])),l.g({mask:`url(#${ne})`},T.visibility()),l.line({x1:10,y1:67,x2:90,y2:3,stroke:"#000","stroke-width":5})]),l.symbol({viewBox:"0 0 100 80"},l.g({stroke:"#000","stroke-width":2},[l.ellipse({cx:50,cy:35,rx:49,ry:34,fill:"#fc8"}),l.path({d:"M10,55 l-8,9 M20,62 l-5,9 M30,66 l-3,10 M40,69 l-1,10 M50,70 v10 M60,69 l1,10 M70,66 l3,10 M80,62 l5,9 M90,55 l8,9","stroke-linecap":"round"})])),l.symbol({viewBox:"0 0 150 90"},[l.defs(l.g({id:re},[l.circle({cx:50,cy:50,r:48,fill:"#fc8",stroke:"#000"}),l.path({d:"M30,30 v10 a5,5 0,0,0 10,0 v-10 a5,5, 0,0,0 -10,0 M60,30 v10 a5,5 0,0,0 10,0 v-10 a5,5, 0,0,0 -10,0 M20,60 q30,20 60,0 q-30,40 -60,0 Z",fill:"#321"})])),l.use({href:`#${re}`,style:"opacity: 0.6"}),l.use({href:`#${re}`,style:"opacity: 0.6",transform:"translate(50, 0)"}),l.use({href:`#${re}`,style:"opacity: 0.8",transform:"translate(25, 0)"})]),l.symbol({viewBox:"0 0 100 100"},[l.defs(l.radialGradient({id:we,cy:.55,fy:1},[l.stop({offset:"0%","stop-color":"#fff"}),l.stop({offset:"20%","stop-color":"#ff0"}),l.stop({offset:"100%","stop-color":"#f00"})])),l.path({d:"M43,99 c-20,0 -60,-30 -30,-70 q0,20 10,30 c0,-20 25,-40 20,-58 q20,30 20,58 q10,-10 5,-30 q10,15 15,35 q5,-10 0,-25 c40,50 -10,62 -40,60 z M25,20 c-15,30 5,30 0,0 z M60,20 c0,20 10,20 0,0 z",stroke:"#000",fill:`url(#${we})`,"stroke-linejoin":"round"})]),l.symbol({viewBox:"0 0 8.2 8.23"},l.path({d:"M0.1,2.1 a2,2 0,0,1 4,0 a2,2 0,0,1 4,0 q0,3 -4,6 q-4,-3 -4,-6 Z",fill:"#f00",stroke:"#000","stroke-width":.2})),l.symbol({viewBox:"0 0 80 90"},[l.defs([l.path({id:le,d:"M1,7 v2 a1,1 0,0,1 -2,0 v-2 z",fill:"#000"}),l.g({id:ce},[l.circle({r:5.5,fill:"none",stroke:"#000","stroke-width":4.5}),Array.from({length:12},((e,t)=>30*t)).map((e=>l.use({href:`#${le}`,transform:`rotate(${e})`})))])]),l.path({d:"M64,88 c-15,-30 20,-30 15,-60 c-5,-35 -70,-40 -70,10 c-10,10 -10,10 -2,12 c-2,4 -2,4 2,5 c-4,4 -2,4 0,5 c-2,8 -1,10 20,12 q5,0 5,15 z",fill:"#fc8",stroke:"#000","stroke-linejoin":"round"}),l.use({href:`#${ce}`,transform:"translate(55, 15)"}),l.use({href:`#${ce}`,transform:"translate(30, 20) scale(1.2)"}),l.use({href:`#${ce}`,transform:"translate(50, 42) scale(1.8)"})]),l.symbol({viewBox:"0 0 58 100"},l.path({d:"M37,90 a8,8 0,1,0 0,0.1 z M25,70 h8 l1,-20 a11,8 -10,0,0 -30,-45 v15 h5 l2,-8 a9,6 -10,0,1 13,32 Z",stroke:"#000","stroke-width":2,fill:"#fff"})),l.symbol({viewBox:"0 0 84 110"},[l.rect({x:18,y:50,width:47,height:30,fill:"#ffe"}),l.path({d:"M12,52 q-9,-1 -10,-10 a35,35 0,1,1 80,0 q-1,9 -10,10 M32,83 c-10,-20 -27,0 -20,-30 c3,-4.5 -5,-13.5 0,-18 M72,35 c5,4.5 -3,13.5 0,18 c7,30 -10,10 -20,30 M17,72.2 c3,10 0,28 5,30 a40,40 0,0,0 40,0 c5,-2 2,-20 5,-30",fill:"#ffe",stroke:"#000","stroke-width":2,"stroke-linecap":"round"}),l.path({d:"M23,74 c3,5 0,15 5,20 a30,30 0,0,0 28,0 c5,-5 2,-15 5,-20 M32,96 v-13 a25,30 0,0,0 20,0 v13 M37,85 v12 M42,86 v12 M47,85 v12 M32,89.5 a27,30 0,0,0 20,0",fill:"none",stroke:"#000","stroke-width":1}),l.path({d:"M19,50 c0,20 18,10 18,5 c2,-15 -20,-10 -18,-5 M 65,50 c0,20 -18,10 -18,5 c-2,-15 20,-10 18,-5 M41,60 c-10,5 -5,25 0,15 Z M43,60 c10,5 5,25 0,15 Z",fill:"#000"})]),l.symbol({viewBox:"0 0 65 70"},[l.path({d:"M15,25 a20,20 0,1,1 40,10 c0,5 -10,5 -10,10 c-3,15 -10,30 -20,20 M20,25 a10,10 0,1,1 30,10",fill:"#fff",stroke:"#000","stroke-width":3,"stroke-linecap":"round"}),l.path({d:"M5,60 l20,-20 M50,15 l10,-10",stroke:"#000","stroke-width":8})]),l.symbol({viewBox:"0 0 100 54"},[l.defs(l.path({id:de,d:"M0,32 h20 l3,-10 l6,30 l10,-50 l8,40 l4,-10 l4,15 l6,-25 l3,10 h36",fill:"none","stroke-linejoin":"round","stroke-dasharray":"150 102"},ze)),l.use({href:`#${de}`,stroke:"#000","stroke-width":4}),l.use({href:`#${de}`,stroke:"#f00","stroke-width":2}),Ye]),l.symbol({viewBox:"0 0 82 107"},l.g({stroke:"#000",fill:"#fff","stroke-width":1},[l.circle({cx:41,cy:41,r:40,fill:"#fa6"}),l.circle({cx:41,cy:60,r:6,fill:"#000"}),l.path({d:"M11,30 a2,1 0,0,0 20,0 m20,0 a2,1 0,0,0 20,0",fill:"none"}),l.path({d:"M38,70 l-6,18 l1,11 h16 l1,-11 l-6,-18"}),l.path({d:"M36,90 a8,8 0,1,0 -3,10 M46,90 a8,8 0,1,1 3,10 M33,98 a8,8 0,1,0 16,0"})])),l.symbol({viewBox:"0 0 200 100"},[l.defs(l.path({id:he,d:"M100,99 c40,-20 30,-50 60,-40 q10,5 20,-10 h-40 c40,-10 45,-5 50,-20 l-45,5 c45,-20 50,-10 54,-33 c-120,20 -45,60 -99,98 z",fill:"#fff",stroke:"#000","stroke-width":2,"stroke-linejoin":"round"})),l.use({href:`#${he}`,transform:"translate(200, 0) scale(-1, 1)"}),l.use({href:`#${he}`})]),l.symbol({viewBox:"0 0 62 80"},[l.path({d:"M11,43 a25,26 0,1,1 40,0 a15,22 0,1,1 -40,0 z M11,79 q5,-5 5,-10 q0,-3.5 -1,-7 q-6,-9 -5,-18 q-4,-5 -5,-15 a1,1 0,0,0 -4,-1 q0,5 3,17 q-2,10 3,20 q-1,7 -5,14 z M51,79 q-5,-5 -5,-10 q0,-3.5 1,-7 q6,-9 5,-18 q4,-5 5,-15 a1,1 0,0,1 4,-1 q0,5 -3,17 q2,10 -3,20 q1,7 5,14 z",fill:"#fc8",stroke:"#000"}),l.ellipse({cx:31,cy:56,rx:5,ry:10,fill:"#000"}),l.g({fill:"#f80",stroke:"#fff","stroke-width":3},[l.circle({cx:21,cy:29,r:3}),l.circle({cx:41,cy:29,r:3})]),l.path({d:"M29,29 q-5,11 3,10",stroke:"#000","stroke-width":.5,fill:"none"})]),l.symbol({viewBox:"0 0 75 70"},l.g({fill:"#fc8",stroke:"#000","stroke-linejoin":"round","stroke-linecap":"round"},[l.path({d:"M11,44 l2,10 l5,5 l15,-5 l5,-3 q2,-12 9,-16 l21,-12 l-24,-11 l-26,-5 l-5,10 l-8,5 q0,5 -4,10"}),l.path({d:"M11,44 q1,5 -1,10 q3,10 6,15 q10,-6 20,-10 q-4,-12 -18,-3 M6,44 q10,-1 20,0 q1,-5 0,-10 q-12,-2 -25,-2 q2,6 5,12 M11,24 q7,2 15,5 q3,-5 4,-10 q-10,-4 -20,-7 q-2,5 -5,10 q0,5 -4,10 M26,9 q15,10 20,0 q-8,-5 -15,-8 q-6,1.5 -12,2 l-4,10 M56,24 q-5,2 -10,5 q1,6 2,10 q5,2 25,-5 q-2,-7 -5,-15 q-10,0 -24,-7"})])),l.symbol({viewBox:"0 0 100 100"},[l.defs(l.polygon({id:ue,points:"16,16 50,30 84,16 70,50 84,84 50,70 16,84 30,50"})),l.g({stroke:"#000","stroke-width":1},[l.use({href:`#${ue}`,fill:"#888"}),l.use({href:`#${ue}`,fill:"#ccc",transform:"rotate(45, 50, 50)"}),l.circle({cx:50,cy:50,r:20,fill:"#fff"})])]),l.symbol({viewBox:"0 0 100 80"},[l.defs(l.pattern({id:ve,width:100,height:80,patternUnits:"userSpaceOnUse"},[l.rect({width:100,height:80,fill:"#f84"}),l.path({d:"M11,58 a3,2 0,0,0 0,-10 M55,0 q23,10 17,20 M70,40 l21,5 v-6 l-14,-4 c-10,-5 0,-10 -10,-20 h-10 v5 c5,5 -5,20 13,20 M92,32 a1,1 0,0,1 0,-5",fill:"#ffc"})])),l.path({d:"M30,45 q3,5 -2,10 q-4,1 -8,5 c-8,5 0,20 -10,15 q-1,-1.5 0,-3 l1,-8 c2,-5 10,-10 5,-9 a4,2 0,1,1 1,-5 a4,1 330,0,1 55,-30 q0,-8 -10,-15 a2,5 320,0,1 3,0 q20,10 17,15 q8,0 10,10 q-5,5 -15,5 q6,3 12,5 a1,1 0,0,1 -1,3 q-10,-2 -20,-3 q-18,0 -37,11",fill:`url(#${ve})`,stroke:"#000","stroke-linecap":"round","stroke-linejoin":"round"}),l.circle({cx:82,cy:25,r:1.5,fill:"#000"})]),l.symbol({viewBox:"0 0 100 100"},[l.circle({cx:50,cy:50,r:49.5,fill:"#808",stroke:"#000","stroke-width":1}),l.path({d:"M3,35 L79,90 L50,1 L21,90 L97,35 Z",stroke:"#000",fill:"#fff","stroke-linejoin":"bevel","fill-rule":"evenodd"})]),l.symbol({viewBox:"0 0 100 100"},[l.defs(l.radialGradient({id:ye,cx:"50%",cy:"50%",fx:"15%",fy:"15%"},[l.stop({offset:"0%","stop-color":"#fff"}),l.stop({offset:"50%","stop-color":"#f00"}),l.stop({offset:"100%","stop-color":"#600"})])),l.g({stroke:"#000","stroke-linejoin":"round"},[l.path({d:"M1,10 q0,50 49,50 q49,0 49,-50 c-10,5 -30,-9 -49,-9 c-19,0 -39,14 -49,9 z",fill:"#a00"}),l.path({d:"M20,69 a1,1 0,0,0 60,0 v-30 q0,-20 -20,-20 c0,15 -20,15 -20,0 q-20,0 -20,20 z",fill:"#ffd"}),l.path({d:"M35,30 v20 c0,20 -15,10 -5,20 M65,30 v20 c0,20 15,10 5,20",stroke:"#a00","stroke-width":2,"stroke-linecap":"round",fill:"none"}),l.path({d:"M30,70 a10,9 0,0,0 40,0 z a2,1 0,0,0 40,0 M35,70 v12 M40,70 v15.5 M45,70 v17 M50,70 v18 M55,70 v17 M60,70 v15.5 M65,70 v12",fill:"#fff"}),l.circle({cx:50,cy:62,r:10,fill:`url(#${ye})`}),l.path({d:"M27,40 l20,10 a1,1 0,0,1 -20,-10 z M73,40 l-20,10 a1,1 0,0,0 20,-10 z",fill:"#ff0"}),l.circle({cx:35,cy:50,r:2,fill:"#000"}),l.circle({cx:65,cy:50,r:2,fill:"#000"})])]),l.symbol({viewBox:"0 0 100 100"},[l.defs(l.mask({id:pe},[l.rect({width:100,height:100,fill:"#fff"}),l.path({d:"M0,50 h100 M50,0 v100","stroke-width":10,stroke:"#000"})])),l.circle({cx:50,cy:50,r:47.5,fill:"#fff"}),l.g({mask:`url(#${pe})`},[l.circle({cx:50,cy:50,r:30,stroke:"#f00","stroke-width":2,fill:"none"}),l.circle({cx:50,cy:50,r:45,stroke:"#000","stroke-width":5,fill:"none"})]),l.path({d:"M0,50 h35 m30,0 h35 M50,0 v35 m0,30 v35",stroke:"#000","stroke-width":3}),l.path({d:"M35,50 h10 m10,0 h15 M50,35 v10 m0,10 v10",stroke:"#000","stroke-width":1}),l.circle({cx:50,cy:50,r:2,fill:"#f00"})]),l.symbol({viewBox:"0 0 100 100"},[l.circle({cx:50,cy:50,r:49.5,stroke:"#000",fill:"#fc8"}),l.path({d:"M20,30 l20,20 m-20,0 l20,-20 m20,0 l20,20 m-20,0 l20,-20 M30,75 h40 v5 a1,1 0,0,1 -15,0 v-5",stroke:"#000","stroke-width":2,fill:"#f00","stroke-linecap":"round"})]),l.symbol({viewBox:"0 0 24 100"},l.path({d:"M20,90 a8,8 0,1,0 0,0.1 z M8,70 h8 l4,-65 h-16 z",stroke:"#000","stroke-width":2,fill:"#fff"})),l.symbol({viewBox:"0 0 82 92"},l.g({stroke:"#000","stroke-width":1,fill:"rgba(255, 255, 255, 0.75)"},[l.path({d:"M81,91 v-50 a30,30 0,0,0 -80,0 v50 l10,-10 l10,10 l10,-10 l10,10 l10,-10 l10,10 l10,-10 z"}),l.circle({cx:20,cy:30,r:10}),l.circle({cx:60,cy:30,r:10})])),l.symbol({viewBox:"0 0 100 100"},[l.defs(l.g({id:me,transform:"rotate(10)",stroke:"#000","stroke-width":1},[l.path({d:"M30,65 q-0.5,-5, 0,-10 h16 q15,6 30,6 h18 q1,3 0,6 h-18 q-15,0 -30,-6 v4 z",fill:"#420"}),l.path({d:"M30,55 h16 q15,6 30,6 h18 q0.5,-10 -10,-10 q-30,-4 -28,-10 q1,-15 -0,-30 q-12,-1 -26,0 q-1,22 0,44",fill:"#840"})])),l.path({d:"M0,100 v-30 l20,-5 h60 l20,5 v30 z",fill:"#0a0"}),l.use({href:`#${me}`,transform:"translate(10,0) scale(0.9)"}),l.use({href:`#${me}`}),l.path({d:"M15,90 q-2,-2.5 5,-5 q-2,-2.5 5,-5 c3,0 40,2 58,5 q5,2.5 -5,5 q5,2.5 -5,5 c-15,2 -55,-5 -58,-5",fill:"#040"})]),l.symbol({viewBox:"0 0 70 90"},[l.rect({x:5,y:5,width:60,height:80,fill:"#4df",stroke:"#640","stroke-width":10,rx:1}),l.path({d:"M10,50 v10 L60,15 v-5 h-5 z",fill:"#8ff"})]),l.symbol({viewBox:"0 0 73 81"},l.path({d:"M10,32 a1,1 0,0,0 40,40 a1,1 0,0,0 -3,-3 a1,1 0,0,1 -34,-34 a1,1 0,0,0 -3,-3 z M60,77 l-20,-30 h-20 l-10,-35 a8,8 90,1,1 8,5 l7,24.5 h18 l18.5,28 l7,-4 l3,4 z",fill:"#00a",stroke:"#000","stroke-width":1})),l.symbol({viewBox:"0 0 100 90"},[l.path({d:"M5,90 a60,60 0,0,1 90,0 z",fill:"red",stroke:"#000"}),l.path({d:"M50,20 c20,0 20,10 20,30 c-2,15 -5,20 -18,30 q-2,1 -4,0 c-13,-10 -16,-15 -18,-30 c0,-20 0,-30 20,-30",fill:"#fc8",stroke:"#000"}),l.path({d:"M35,45 a10,10 0,0,1 10,0 a10,10 0,0,1 -10,0 M55,45 a10,10 0,0,1 10,0 a10,10 0,0,1 -10,0",fill:"red",stroke:"#000","stroke-width":.3}),l.path({d:"M40,65 c5,0 5,-5 10,-3 c5,-2 5,3 10,3 q-10,-0.5 -20,0 M41,65 q10,0.5 18,0 c-4,4 -14,4 -18,0",fill:"#080"}),l.g({"stroke-width":8,"stroke-linecap":"round",fill:"none"},[l.path({d:"M30,40 c-15,-5 -10,20 -25,10 M70,40 c15,-5 10,20 25,10",stroke:"#040"}),l.path({d:"M33,32 c-15,-10 -10,5 -25,-10 M67,32 c15,-10 10,5, 25,-10",stroke:"#060"}),l.path({d:"M38,25 c-5,-10 -10,5 -15,-20 M 62,25 c5,-10 10,5, 15,-20",stroke:"#080"}),l.path({d:"M50,22 v-18",stroke:"#0a0"})])]),l.symbol({viewBox:"0 0 6.2 9.3"},[l.defs(l.linearGradient({id:Ee},[l.stop({offset:"0%","stop-color":"#040"}),l.stop({offset:"100%","stop-color":"#0e0"})])),l.path({d:"M3.1,0.2 q-6,8 0,9 q6,-1 0,-9 Z",stroke:"#000","stroke-width":.2,fill:`url(#${Ee})`})]),l.symbol({viewBox:"0 0 100 60"},[l.defs(l.pattern({id:ke,width:100,height:60,patternUnits:"userSpaceOnUse"},[l.rect({width:100,height:60,fill:"#cca"}),l.path({d:"M100,60 h-53 l25,-60 h20 z",fill:"#888"}),l.circle({cx:15,cy:20,r:13,fill:"#840"}),l.path({d:"M85,59 h15 v-20 h-15 z M0,59 h50 v-15 h-50 z M0,25 l28,-10 l-5,20 h-10 z",fill:"#fc8"})])),l.g({stroke:"#000","stroke-linejoin":"round",fill:`url(#${ke})`},[l.path({d:"M40,33.5 l-3,14.5 h-3.5 l-2,8 h9 q4,0 5,-4 l5,-20.5 z M90,59 a1,1 0,0,0 0,-12 h-20 l10,-23 c10,-8 0,-20 -5,-18 l-40,5 q-5,0 -6,5 l-8,33 h-15 a1,1 0,0,0 0,10 h20 q5,0 6,-5 l5,-20 l27,-5 l-10,25 q0,5 5,5 z M64,29 l-4,1 l-8,20 q-1,4 2,4 z"}),l.circle({cx:15,cy:20,r:12})])]),l.symbol({viewBox:"0 0 100 100"},l.g({stroke:"#000","stroke-width":1,fill:"#fff"},[l.circle({cx:50,cy:50,r:49,fill:"#a00"}),l.circle({cx:30,cy:40,r:8}),l.circle({cx:70,cy:40,r:8}),l.path({d:"M22,25 l17,8 M61,33 l17,-8 M20,80 a3,2 0,0,1 60,0 z M30,80 v-15 M40,80 v-20 M50,80 v-20 M60,80 v-20 M70,80 v-15","stroke-width":3})])),l.symbol({viewBox:"0 0 100 90"},l.g({stroke:"#000","stroke-linejoin":"round","stroke-linecap":"round"},[l.path({d:"M94,84 l-5,5 l-5,-5 l2,-2 l-75,-75 l0,-6",fill:"#840"}),l.path({d:"M94,84 l5,-5 l-5,-5 l-2,2 l-75,-75 l-6,0",fill:"#c84"}),l.path({d:"M7,20 h-5 q5,30 30,25 l-6,-15 z",fill:"#aad"}),l.path({d:"M20,10 q-10,10 -15,10 q10,20 25,20 q-2,-8 5,-15 l1,-1",fill:"#88b"}),l.path({d:"M20,10 l5,-5 l15,15 l-5,5",fill:"#aad"}),l.path({d:"M2,88 a1,1 0,1,1 3,-5 l13,-15 l-5,-5 l3,-3 l7,7",fill:"#f80"}),l.path({d:"M2,88 a1,1 0,1,0 5,-3 l15,-13 l5,5 l3,-3 l-7,-7",fill:"#fa0"}),l.path({d:"M1.75,87.80 l0.4,0.4"}),l.path({d:"M26,70 l55,-50 l5,-16",fill:"#88f"}),l.path({d:"M86,4 l-5,16 l-55,50 l-3,-3",fill:"#bbf"}),l.path({d:"M86,4 l-16,5 l-50,55 l3,3",fill:"#669"})])),l.symbol({viewBox:"0 0 37 37"},l.g({stroke:"#000","stroke-width":.5,fill:"#ccc","stroke-linecap":"round","fill-rule":"evenodd"},[l.path({d:"M2,28 a1,1 0,0,0 5,5 l4,-4 a1,1 0,0,0 -5,-5 z m1,1 a1,1 0,0,0 3,3 l4,-4 a1,1 0,0,0 -3,-3 z m10,-12 a1,1 0,0,0 5,5 l4,-4 a1,1 0,0,0 -5,-5 z m1,1 a1,1 0,0,0 3,3 l4,-4 a1,1 0,0,0 -3,-3 z m10,-12 a1,1 0,0,0 5,5 l4,-4 a1,1 0,0,0 -5,-5 z m1,1 a1,1 0,0,0 3,3 l4,-4 a1,1 0,0,0 -3,-3 z"}),l.path({d:"M7.5,26.5 l8,-8 a1,1 0,0,1 1,1 l-8,8 a1,1 0,0,1 -1,-1 z m11,-11 l8,-8 a1,1 0,0,1 1,1 l-8,8 a1,1 0,0,1 -1,-1 z"})])),l.symbol({viewBox:"0 0 47 72"},[l.g({stroke:"#000",fill:"none"},[l.path({d:"M2.5,41.5 l21,-21 l21,21","stroke-width":6.5}),l.path({d:"M23.5,0.25 v21 M14.5,7 h18","stroke-width":3}),l.path({d:"M23.5,21 l20,20 v30 h-40 v-30 z",fill:"#efa"}),l.path({d:"M23.5,1 v20 M15.5,7 h16",stroke:"#fc4","stroke-width":1}),l.path({d:"M3.5,41 l20,-20 l20,20",stroke:"#e42","stroke-width":5}),l.circle({cx:23.5,cy:40,r:8,fill:"#88f","stroke-width":.5})]),l.path({d:"M13.5,70.5 v-10 a10,10 0,0,1 20,0 v10 z",fill:"#642"})]),l.symbol({viewBox:"0 0 100 65"},[l.defs(l.pattern({id:Me,x:15,y:12.5,width:22,height:12,patternUnits:"userSpaceOnUse"},[l.rect({width:22,height:12,fill:"#420"}),l.path({d:"M0,0 l3,6 h8 l3,-6 h8 l1,2 m0,8 l-1,2 h-8 l-3,-6 m-8,0 l-3,6",fill:"transparent",stroke:"#210","stroke-linecap":"square"})])),l.path({d:"M26,43 q-3,-10 -10,-20 q-30,0 0,-20 c30,-10 0,15 20,35 M30,43 q-5,20 0,20 q2.5,0.5 5,0 q5,0 5,-20 M80,43 q5,20 0,20 q-2.5,0.5 -5,0 q-5,0 -5,-20 M80,43 c40,-35 0,-10 -2,-3",fill:"#080",stroke:"#000","stroke-linejoin":"round"}),l.path({d:"M25,43 c20,-30 40,-30 60,0 c-20,5 -40,5 -60,0 Z",fill:`url(#${Me})`,stroke:"#210","stroke-linejoin":"round"}),l.circle({cx:20,cy:10,r:2.5,fill:"#000"})]),l.symbol({viewBox:"0 0 100 100"},l.g({stroke:"#000"},[l.circle({cx:50,cy:50,r:49,fill:"#fc8"}),l.path({id:fe,d:"M30,40 l3,8.5 h9 l-7,5.5 l2.5,8 l-7.5,-5 l-7.5,5 l2.5,-8.5 l-7,-5.5 h9 z",fill:"#ff0"}),l.use({href:`#${fe}`,transform:"translate(40, 0) scale(0.5)","stroke-width":1.5}),l.path({d:"M50,80 l-1,-8 l16,2 l-2,-16 l16,2 l-1,-8",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"})])),l.symbol({viewBox:"0 0 100 100"},[l.defs(l.path({id:ge,d:"M3,2 h20 v3 l-15,20 h15 l1,-3 h1 l-1,5 h-20 v-3 l15,-20 h-15 l-1,3 h-1 z","stroke-width":1,stroke:"#000",fill:"#fff"})),l.use({href:`#${ge}`,transform:"scale(1.2) translate(55, 0)"}),l.use({href:`#${ge}`,transform:"translate(45, 30)"}),l.use({href:`#${ge}`,transform:"scale(0.8) translate(35, 70)"}),l.use({href:`#${ge}`,transform:"scale(0.6) translate(25, 130)"})])].map(((e,t)=>i.amendNode(e,{id:_e[t]})))]),E.isAdmin){const r=e=>{if(!e["shapechange-categories"]||!e["store-image-shapechanges"])return null;if(!(e["shapechange-categories"].data instanceof Array))return console.log("shapechange-categories must be an Array"),null;if(!(e["store-image-shapechanges"].data instanceof Array))return console.log("store-image-shapechanges must be an Array"),null;const t=e["store-image-shapechanges"].data.length;for(const i of e["shapechange-categories"].data){if("object"!=typeof i)return console.log("entry of shapechange-categories is not an object"),null;if("string"!=typeof i.name)return console.log("shapechange-categories.name must be a string"),null;if(!(i.images instanceof Array))return console.log("shapechange-categories.images must be an array"),null;i.images.length>t&&i.images.splice(t);for(const e of i.images)if("boolean"!=typeof e)return console.log("entry of shapechange-categories.images must be boolean"),null;for(;i.images.length<t;)i.images.push(!1)}for(const t of e["store-image-shapechanges"].data){if("object"!=typeof t)return console.log("entry of store-image-shapechanges must be an object"),null;if(!s.isInt(t.src,0))return console.log("store-image-shapechanges.src must be a Uint"),null;if("string"!=typeof t["5e-shapechange-name"])return console.log("store-image-shapechanges.5e-shapechange-name must be a string"),null;if(!s.isInt(t.width,0)||!s.isInt(t.height,0))return console.log("store-image-shapechanges.width/height must be a Uint"),null;if("boolean"!=typeof t.flip||"boolean"!=typeof t.flop)return console.log("store-image-shapechanges.flip/flop must be a boolean"),null}return e},c=r(y.getSettings(S))??{"shapechange-categories":{user:!1,data:[]},"store-image-shapechanges":{user:!1,data:[]}},h=e=>{b.shell.prompt(L.INITIATIVE_ENTER,L.INITIATIVE_ENTER_LONG,"0").then((t=>{if(De(e)&&null!==t){const i=parseInt(t);s.isInt(i,-20,40)&&(Ge([e.id,i]),Pe())}}))},w=e=>{De(e)&&(Ge([e.id,null]),Pe())},k=(e,t,i)=>(null!==t?Promise.resolve(Math.floor(20*(i?Math.max(Math.random(),Math.random()):Math.random()))+1+t):b.shell.prompt(L.INITIATIVE_ENTER,L.INITIATIVE_ENTER_LONG,"0").then((e=>{if(!e)throw new Error("invalid initiative");return parseInt(e)}))).then((t=>{De(e)&&s.isInt(t,-20,40)&&(Ge([e.id,t]),Pe())})).catch((()=>{})),O=c["shapechange-categories"].data.map((e=>({name:e.name,images:e.images.slice()}))),I=c["store-image-shapechanges"].data.map(M.cloneObject),C=e=>{const t={name:null,"5e-ac":null,"5e-hp-max":null,"5e-hp-current":null},{name:i,"5e-ac":a,"5e-hp-max":o,"5e-hp-current":s}=e.tokenData;return i&&(t.name=M.cloneObject(i)),a&&(t["5e-ac"]=M.cloneObject(a)),o&&(t["5e-hp-max"]=M.cloneObject(o)),s&&(t["5e-hp-max"]=M.cloneObject(s)),{src:e.src,width:e.width,height:e.height,flip:e.flip,flop:e.flop,tokenData:t}},P=(e,t)=>{const i={id:e.id,tokenData:{},removeTokenData:[]};if(t)e.tokenData["store-image-5e-initial-token"]||(i.tokenData["store-image-5e-initial-token"]={user:!1,data:C(e)});else{if(!e.tokenData["store-image-5e-initial-token"])return;t=e.tokenData["store-image-5e-initial-token"].data,i.removeTokenData.push("store-image-5e-initial-token")}i.src=t.src,i.width=t.width,i.height=t.height,i.flip=t.flip,i.flop=t.flop;for(const e in i.tokenData){const t=i.tokenData[e];t?i.tokenData[e]=M.cloneObject(t):i.removeTokenData.push(e)}g.doTokenSet(i),e.updateNode(),He.has(i.id)&&Ge()},$=(e,t=O.length-1)=>{const o=a.span(e.name),s=a.th([o,T.rename({title:L.SHAPECHANGE_TOKEN_CATEGORY_RENAME,class:u.itemControl,onclick:()=>b.shell.prompt(L.SHAPECHANGE_TOKEN_CATEGORY_RENAME,L.SHAPECHANGE_TOKEN_CATEGORY_RENAME_LONG,e.name).then((t=>{t&&e.name!==t&&i.clearNode(o,e.name=t)}))}),T.remove({title:L.SHAPECHANGE_TOKEN_CATEGORY_REMOVE,class:u.itemControl,onclick:()=>b.shell.confirm(L.SHAPECHANGE_TOKEN_CATEGORY_REMOVE,L.SHAPECHANGE_TOKEN_CATEGORY_REMOVE_LONG,"").then((e=>{if(e){O[t].name="";for(const e of W)e[t].remove();s.remove()}}))})]);return s},H=(e,t,i=!1)=>{const o=a.td([M.labels(a.input({class:u.settingsTicker,type:"checkbox",checked:i,onchange:function(){O[t].images[e]=this.checked}}),"")]);return W[e].push(o),o},U=(e,t)=>{W.push([]);const o=a.span(e["5e-shapechange-name"]),s=a.img({src:d.imageIDtoURL(e.src)}),n=a.tr([a.th([a.div({class:[u.tokenSelector,X],style:"width: 100px; height: 100px"},[a.button({title:L.SHAPECHANGE_CHANGE,onclick:()=>{const t=g.getToken();if(t){const a=C(t);b.shell.confirm(m.default.TOKEN_REPLACE,m.default.TOKEN_REPLACE_CONFIRM).then((t=>{t&&(Object.assign(e,a),i.amendNode(s,{src:d.imageIDtoURL(e.src)}))}))}else b.shell.alert(m.default.TOKEN_SELECT,m.default.TOKEN_NONE_SELECTED)}}),s]),a.br(),o,T.rename({title:L.SHAPECHANGE_TOKEN_RENAME,class:u.itemControl,onclick:()=>b.shell.prompt(L.SHAPECHANGE_TOKEN_RENAME,L.SHAPECHANGE_TOKEN_RENAME_LONG,e["5e-shapechange-name"]).then((t=>{t&&e["5e-shapechange-name"]!==t&&i.clearNode(o,e["5e-shapechange-name"]=t)}))}),T.remove({title:L.SHAPECHANGE_TOKEN_REMOVE,class:u.itemControl,onclick:()=>b.shell.confirm(L.SHAPECHANGE_TOKEN_REMOVE,L.SHAPECHANGE_TOKEN_REMOVE_LONG).then((e=>{e&&(Z[t].remove(),I[t]["5e-shapechange-name"]="")}))})]),O.map(((e,i)=>H(t,i,e.images[t])))]);return Z.push(n),n},G=a.tr([a.td(),O.map($)]),Z=[],W=[],j=a.tbody(I.map(U)),V=b.windows({"window-icon":`data:image/svg+xml,%3Csvg xmlns="${l.ns}" viewBox="0 0 2 2"%3E%3Crect width="2" height="2" fill="%23f00"%3E%3Canimate attributeName="rx" values="0;0;1;1;0" dur="16s" repeatCount="indefinite" keyTimes="0;0.375;0.5;0.875;1" /%3E%3Canimate attributeName="fill" values="%23f00;%23f00;%2300f;%2300f;%23f00" dur="16s" repeatCount="indefinite" keyTimes="0;0.375;0.5;0.875;1" /%3E%3C/rect%3E%3C/svg%3E`,"window-title":L.SHAPECHANGE_TITLE,"window-data":"shapechange-5e",resizable:!0},a.div([a.h1(L.SHAPECHANGE_TITLE),a.button({onclick:()=>b.shell.prompt(L.SHAPECHANGE_TOKEN_CATEGORY,L.SHAPECHANGE_TOKEN_CATEGORY_LONG).then((e=>{if(e){const t={name:e,images:Array.from({length:I.length},(()=>!1))},a=O.push(t)-1;i.amendNode(G,$(t));for(let e=0;e<Z.length;e++)i.amendNode(Z[e],H(e,a))}}))},L.SHAPECHANGE_TOKEN_CATEGORY),a.button({onclick:()=>{const e=g.getToken();if(e){const t=C(e);b.shell.prompt(L.SHAPECHANGE_TOKEN_NAME,L.SHAPECHANGE_TOKEN_NAME_LONG).then((e=>{if(e){const a=Object.assign(t,{"5e-shapechange-name":e});i.amendNode(j,U(a,I.length)),I.push(a);for(const e of O)e.images.push(!1)}}))}else b.shell.alert(m.default.TOKEN_SELECT,m.default.TOKEN_NONE_SELECTED)}},L.SHAPECHANGE_TOKEN_ADD),a.table({id:Q},[a.thead(G),j]),a.button({onclick:()=>{const e=[],t=[],i=[];for(const e of I)e["5e-shapechange-name"]?(i.push(!0),t.push(M.cloneObject(e))):i.push(!1);for(const t of O)if(t.name){const a=[];for(let e=0;e<i.length;e++)i[e]&&a.push(t.images[e]);e.push({name:t.name,images:a})}c["shapechange-categories"]={user:!1,data:e},c["store-image-shapechanges"]={user:!1,data:t},E.rpc.pluginSetting(S,c,[])}},m.default.SAVE)])),[F,z]=p.registerKeyEvent("5e-health-key",L.KEY_HEALTH,"h",void 0,(()=>{const{token:e}=v.selected;if(e instanceof _){const t=e.getData("5e-hp-current");null!==t&&b.shell.prompt(L.HP_CURRENT,L.HP_CURRENT_ENTER,t).then((i=>{if(null!==i&&De(e)){const a=Math.max(0,parseInt(i)+(i.startsWith("+")||i.startsWith("-")?t:0));isNaN(a)||g.doTokenSet({id:e.id,tokenData:{"5e-hp-current":{user:!1,data:Math.max(0,(parseInt(i)||0)+(i.startsWith("+")||i.startsWith("-")?t:0))}}})}}))}})),[K,Y]=p.registerKeyEvent("5e-initiative-key",L.KEY_INITIATIVE,"i",void 0,(()=>{const{token:e}=v.selected;e instanceof _&&(f.mapData.data["5e-initiative"]&&f.mapData.data["5e-initiative"].some((t=>t.id===e.id))?h(e):k(e,e.getData("5e-initiative-mod"),e.getData("5e-initiative-adv")??!1))})),B=(e,t)=>{if(De(e)){const i=e.getData("5e-conditions")?.slice()??Array.from({length:Se.length},(e=>!1));i[t]=!i[t],g.doTokenSet({id:e.id,tokenData:{"5e-conditions":{user:!0,data:i}}})}},q=Se.map(((t,i)=>p.registerKeyEvent("5e-"+t,e.default`${L.TOGGLE_CONDITION}: ${L[t]}`,"",void 0,(()=>B(v.selected.token,i)))));t.add(`.${u.adminHideLight} #${te}`,{display:"none"}),i.amendNode(Fe.settings.fn,a.button({onclick:()=>i.amendNode(b.shell,V)},L.SHAPECHANGE_5E)),Fe.characterEdit={fn:(e,t,o,n,r,l)=>{const c=!n&&o["store-character-id"]&&M.characterData.has(o["store-character-id"].data)?(()=>{const e=M.characterData.get(o["store-character-id"].data);return t=>o[t]??e[t]??{}})():e=>o[e]??{};return i.amendNode(e,[M.labels([L.INITIATIVE_MOD,": "],a.input({type:"number",min:-20,max:20,step:1,value:c("5e-initiative-mod").data??"",onchange:function(){""===this.value?l.add("5e-initiative-mod"):(l.delete("5e-initiative-mod"),r["5e-initiative-mod"]={user:!1,data:s.checkInt(parseInt(this.value),-20,20,0)})}})),M.labels([L.INITIATIVE_ADV,": "],a.input({type:"checkbox",checked:c("5e-initiative-adv").data??!1,onchange:function(){r["5e-initiative-adv"]={user:!1,data:this.checked}}})),a.br(),M.labels([L.ARMOUR_CLASS,": "],a.input({type:"number",min:0,max:50,step:1,value:c("5e-ac").data??10,onchange:function(){r["5e-ac"]={user:!1,data:s.checkInt(parseInt(this.value),0,50,0)}}})),a.br(),M.labels([L.HP_CURRENT,": "],a.input({type:"number",min:0,step:1,value:c("5e-hp-current").data??10,onchange:function(){r["5e-hp-current"]={user:!1,data:s.checkInt(parseInt(this.value),0,1/0,0)}}})),a.br(),M.labels([L.HP_MAX,": "],a.input({type:"number",min:0,step:1,value:c("5e-hp-max").data??10,onchange:function(){r["5e-hp-max"]={user:!1,data:s.checkInt(parseInt(this.value),0,1/0,0)}}})),a.br(),M.labels(a.input({type:"checkbox",class:u.settingsTicker,checked:c("5e-player").data,onchange:function(){r["5e-player"]={user:!0,data:this.checked}}}),[L.IS_PLAYER,": "]),a.br(),M.labels([L.DARKVISION,": "],a.input({type:"number",min:0,step:1,value:c("5e-darkvision").data??0,onchange:function(){r["5e-darkvision"]={user:!0,data:s.checkInt(parseInt(this.value),0,1/0,0)}}})),a.br(),M.labels([L.NOTES,": "],a.textarea({rows:10,cols:30,style:"resize: none",onchange:function(){r["5e-notes"]={user:!1,data:this.value}}},c("5e-notes").data??""))]),()=>{let e=!1,i=!1;if(n)for(const[,{token:a}]of v.tokens)a instanceof _&&a.tokenData["store-character-id"]?.data===t&&(a[x](),He.has(a.id)&&(e=!0),(r["5e-player"]||r["5e-darkvision"])&&(i=!0));else v.tokens.get(t).token[x](),e=!!r.name&&He.has(t),i=!!r["5e-player"];e?Ge():i&&Ve()}}},Fe.tokenContext={fn:()=>{const{token:e}=v.selected;if(!(e instanceof _))return[];const t=e.getData("5e-initiative-mod"),i=e.getData("5e-conditions")??[],{"shapechange-categories":{data:a},"store-image-shapechanges":{data:s}}=c,r=[];return f.mapData.data["5e-initiative"]&&f.mapData.data["5e-initiative"].some((t=>t.id===e.id))?r.push(o.item({onselect:()=>De(e)&&h(e)},L.INITIATIVE_CHANGE),o.item({onselect:()=>De(e)&&w(e)},L.INITIATIVE_REMOVE)):r.push(o.item({onselect:()=>De(e)&&k(e,t,e.getData("5e-initiative-adv")??!1)},L.INITIATIVE_ADD)),r.push(o.submenu([o.item(L.CONDITIONS),o.menu({class:D},Se.map(((e,t)=>[e,t])).sort((([e],[t])=>n.stringSort(L[e]+"",L[t]+""))).map((([t,a])=>o.item({onselect:()=>B(e,a),class:{[R]:!!i[a]}},L[t]))))])),a&&a.length&&r.push(o.submenu([o.item(L.SHAPECHANGE),o.menu([e.tokenData["store-image-5e-initial-token"]?o.item({onselect:()=>{De(e)&&P(e)}},L.SHAPECHANGE_INITIAL_RESTORE):[],a.map((t=>o.submenu([o.item(t.name),o.menu(t.images.map(((t,i)=>{if(t){const t=s[i];return o.item({onselect:()=>{De(e)&&P(e,t)}},t["5e-shapechange-name"])}return[]})))])))])])),r}},E.rpc.waitPluginSetting().when((e=>{e.id===S&&r(e.setting)&&(c["shapechange-categories"]=e.setting["shapechange-categories"].data,c["store-image-shapechanges"]=e.setting["store-image-shapechanges"].data)})),v.tokenSelectedReceive((()=>{let e=null;return()=>{e?.[A]();const{token:t}=v.selected;if(t instanceof _&&!t.isPattern){F(),K();for(const[e]of q)e();e=t,t[N]()}else{z(),Y();for(const[,e]of q)e()}}})())}else t.add(`#${ee}`,{" thead, td:last-child":{display:"none"}});y.addPlugin("5e",Fe),M.mapLoadedReceive((()=>{$e.remove(),s.queue((async()=>{for(const[,e]of v.tokens)e instanceof _&&e[x]();i.clearNode(f.getLayer("/Light").l,[l.use({href:`#${u.lighting}`,style:"mix-blend-mode: saturation",filter:`url(#${Te})`,"clip-path":`url(#${Oe})`}),l.g({style:"mix-blend-mode: multiply"},[l.use({href:`#${u.lighting}`}),l.use({href:`#${u.lighting}`,filter:`url(#${be})`,"clip-path":`url(#${Oe})`})])]),Ge()}))})),E.combined.waitTokenSet().when((e=>{const{tokenData:t,removeTokenData:i}=e;if(t&&(t["5e-initiative"]||void 0!==t.name)||i&&(i.includes("5e-initiative")||i.includes("name")))setTimeout((()=>{He.has(e.id)&&Ge(),v.tokens.get(e.id).token[x]()}),0);else{if(t)for(const i in t)switch(i){case"5e-ac":case"5e-hp-max":case"5e-hp-current":case"5e-conditions":return void setTimeout((()=>v.tokens.get(e.id).token[x]()),0)}if(i)for(const t of i)switch(t){case"5e-ac":case"5e-hp-max":case"5e-hp-current":case"5e-conditions":return void setTimeout((()=>v.tokens.get(e.id).token[x]()),0)}}})),E.combined.waitMapDataSet().when((e=>{"5e-initiative"===e.key&&setTimeout(Ge,0)})),E.combined.waitMapDataRemove().when((e=>{"5e-initiative"===e&&$e.remove()})),E.combined.waitTokenRemove().when((e=>setTimeout(He.has(e)?Ge:Ve))),E.combined.waitTokenAdd().when((({token:{id:e}})=>setTimeout(He.has(e)?Ge:Ve))),E.combined.waitTokenMoveLayerPos().when((({id:e})=>setTimeout(He.has(e)?Ge:Ve))),E.combined.waitTokenSet().when((({id:e})=>setTimeout(He.has(e)?Ge:Ve))),E.combined.waitTokenSetMulti().when((e=>{for(const{id:t}of e)if(He.has(t))return void setTimeout(Ge);setTimeout(Ve)}));for(const e of["waitLayerShow","waitLayerHide","waitLayerRemove"])E.combined[e]().when((()=>setTimeout(Ge)));for(const e of["waitLayerShift","waitLayerMove","waitWallAdded","waitWallRemoved","waitWallModified","waitWallMoved"])E.combined[e]().when((()=>setTimeout(Ve)));return E.rpc.waitCharacterDataChange().when((({id:e})=>setTimeout((()=>{let t=!1;for(const[,{token:i}]of v.tokens)i instanceof _&&i.tokenData["store-character-id"]?.data===e&&(i[x](),!t&&He.has(i.id)&&(setTimeout(Ge),t=!0))})))),E.addMapDataChecker((e=>{for(const t in e){let i="";if("5e-initiative"===t){const a=e[t];if(a instanceof Array)for(const e of a){if(!(e instanceof Object)){i="Map Data value of 5e-initiative needs to be an array of Objects";break}if(!s.isInt(e.id,0)){i="Map Data value of IDInitiative.id needs to be a Uint";break}if(!s.isInt(e.initiative)){i="Map Data value of 5e-initiative needs to be an Int";break}}else i="Map Data value of 5e-initiative needs to be an array"}i&&(delete e[t],console.log(new TypeError(i)))}})),E.addCharacterDataChecker((e=>{for(const t in e){const i=e[t].data;let a="";switch(t){case"name":"string"!=typeof i&&(a="Character Data 'name' must be a string");break;case"5e-ac":s.isInt(i,0,50)||(a="Character Data '5e-ac' must be a Uint <= 50");break;case"5e-hp-max":s.isInt(i,0)||(a="Character Data '5e-hp-max' must be a Uint");break;case"5e-hp-current":s.isInt(i,0)||(a="Character Data '5e-hp-current' must be a Uint");break;case"5e-initiative-adv":"boolean"!=typeof i&&(a="Token Data '5e-initiative-adv' must be a boolean");break;case"5e-initiative-mod":s.isInt(i,-20,20)||(a="Character Data '5e-initiative-mod' must be an Int between -20 and 20");break;case"5e-notes":"string"!=typeof i&&(a="Character Data '5e-notes' must be a string");break;case"5e-player":"boolean"!=typeof i&&(a="Token Data '5e-player' must be a boolean");break;case"5e-darkvision":s.isInt(i,0)||(a="Token Data '5e-darkvision' must be a Uint")}a&&(delete e[t],console.log(new TypeError(a)))}})),E.addTokenDataChecker((e=>{for(const t in e){const i=e[t].data;let a="";switch(t){case"name":"string"!=typeof i&&(a="Token Data 'name' must be a string");break;case"5e-ac":s.isInt(i,0,50)||(a="Token Data '5e-ac' must be a Uint <= 50");break;case"5e-hp-max":s.isInt(i,0)||(a="Token Data '5e-hp-max' must be a Uint");break;case"5e-hp-current":s.isInt(i,0)||(a="Token Data '5e-hp-current' must be a Uint");break;case"5e-initiative-adv":"boolean"!=typeof i&&(a="Token Data '5e-initiative-adv' must be a boolean");break;case"5e-initiative-mod":s.isInt(i,-20,20)||(a="Token Data '5e-initiative-mod' must be an Int between -20 and 20");break;case"5e-conditions":i instanceof Array&&i.length===Se.length&&i.every((e=>"boolean"==typeof e))||(a="Token Data '5e-conditions' must be a boolean array of correct length");break;case"5e-player":"boolean"!=typeof i&&(a="Token Data '5e-player' must be a boolean");break;case"5e-darkvision":s.isInt(i,0)||(a="Token Data '5e-darkvision' must be a Uint");break;case"store-image-5e-initial-token":"object"!=typeof i?a="Token Data 'store-image-5e-initial-token' must be an object":s.isInt(i.src,0)?s.isInt(i.width,0)&&s.isInt(i.height,0)?"boolean"==typeof i.flip&&"boolean"==typeof i.flop||(a="Token Data 'store-image-5e-initial-token' flip & flop must be boolean"):a="Token Data 'store-image-5e-initial-token' width & height must be Uints":a="Token Data 'store-image-5e-initial-token' src must be a Uint";break;case"5e-notes":"string"!=typeof i&&(a="Token Data '5e-notes' must be a string")}a&&(delete e[t],console.log(new TypeError(a)))}})),{}}],["/plugins/notes.js",async()=>{const[e,t,i,a,o,s,n,r,l,c,d,h,u,p,m,f,g,w,v,y]=await Promise.all(["/lib/bbcode.js","/lib/bbcode_tags.js","/lib/bind.js","/lib/css.js","/lib/dom.js","/lib/drag.js","/lib/html.js","/lib/inter.js","/lib/misc.js","/lib/nodes.js","/lib/svg.js","/folders.js","/ids.js","/language.js","/messaging.js","/plugins.js","/rpc.js","/shared.js","/symbols.js","/windows.js"].map(include)),E=p.makeLangPack({ERROR_FOLDER_NOT_EMPTY:"Cannot remove a non-empty folder",ERROR_INVALID_FOLDER:"Invalid Folder",ERROR_INVALID_ITEM:"Invalid Item",ERROR_INVALID_PATH:"Invalid Path",MENU_TITLE:"Notes",NAME_EXISTS:"Note Exists",NAME_EXISTS_LONG:"A note with that name already exists",NAME_INVALID:"Invalid Name",NAME_INVALID_LONG:"Note names cannot contains the '/' (slash) character",NOTE:"Note",NOTE_EDIT:"Edit Note",NOTE_POPOUT:"Open in New Window",NOTE_SAVE:"Save Note",NOTE_SHARE:"Allow Note Sharing",NOTES_NEW:"New Note",NOTES_NEW_LONG:"Enter new note name",SHARE:"Share"}),k=`data:image/svg+xml,%3Csvg xmlns="${d.ns}" viewBox="0 0 84 96" width="84" height="96" %3E%3Crect x="60" y="6" width="24" height="90" fill="%23888" rx="10" /%3E%3Crect x="1" y="6" width="80" height="90" stroke="%23000" fill="%23fff" rx="10" /%3E%3Cg id="h"%3E%3Ccircle cx="16" cy="11" r="2" fill="%23333" /%3E%3Cellipse cx="15" cy="6" rx="3" ry="5" stroke="%23aaa" stroke-width="2" fill="none" stroke-dasharray="0 5 15" /%3E%3C/g%3E%3Cuse href="%23h" x="10" /%3E%3Cuse href="%23h" x="20" /%3E%3Cuse href="%23h" x="30" /%3E%3Cuse href="%23h" x="40" /%3E%3Cuse href="%23h" x="50" /%3E%3Cpath d="M11,25 h60 M11,40 h60 M11,55 h60 M11,70 h30" stroke="%23000" stroke-width="4" stroke-linecap="round" /%3E%3C/svg%3E`;if(m.register("plugin-notes",[k,E.NOTE]),g.isAdmin){class t extends h.DraggableItem{static#y=new Set;#E=null;#k=null;#M=null;#T;#b=!1;constructor(e,t,i){super(e,t,i,b),o.amendNode(this.image,{src:k}),L.set(t,this),this.#T=m.bbcodeDrag.register((()=>e=>`[note=${t}]${e||this.name}[/note]`)),o.amendNode(this.nameElem,{onauxclick:e=>{1===e.button&&(this.#k?this.#k.focus():this.#O())}})}static checkEditors(){for(const e of t.#y)if(e.#b)return!0;return!1}#_(e){this.#b&&(e.preventDefault(),this.#E?.confirm(p.default.ARE_YOU_SURE,p.default.UNSAVED_CHANGES,k).then((e=>{e&&(this.#b=!1,this.#E?.remove())})))}#O(){(this.#b?this.#E?.confirm(p.default.ARE_YOU_SURE,p.default.UNSAVED_CHANGES,k)??Promise.resolve(!0):Promise.resolve(!0)).then((e=>{if(e){this.#b=!1;const e=window.open("","","");e&&((this.#k=e).addEventListener("unload",(()=>this.#k=null)),e.document.head.append(n.title(this.name),a.render(),n.link({rel:"shortcut icon",sizes:"any",href:k})),e.document.body.classList.add(Y),e.document.body.append(m.parseBBCode(x.get(this.id)?.data.contents||"")),this.#E?.remove())}}))}show(){if(this.#E)this.#E.focus();else if(this.#k)this.#k.focus();else{const e=n.div({class:Y},m.parseBBCode(x.get(this.id)?.data.contents||""));o.amendNode(y.shell,this.#E=y.windows({"window-title":this.name,"window-icon":k,"hide-minimise":!1,resizable:!0,style:"--window-width: 50%; --window-height: 50%",onclose:e=>this.#_(e),onremove:()=>{this.#E=null,this.#M=null,t.#y.delete(this)}},e)),this.#E.addControlButton(A,(()=>this.#O()),E.NOTE_POPOUT),this.#E.addControlButton(N,(()=>{if(t.#y.has(this))this.#b?this.#E?.confirm(p.default.ARE_YOU_SURE,p.default.UNSAVED_CHANGES,k).then((i=>{i&&(this.#b=!1,o.clearNode(this.#E,{"window-title":this.name,class:void 0},e),t.#y.delete(this))})):(o.clearNode(this.#E,{"window-title":this.name,class:void 0},e),t.#y.delete(this));else{t.#y.add(this);const a=x.get(this.id)||{user:!1,data:{contents:"",share:!1}},r=i.default(""),l=()=>r.value=(this.#b=c.value!==a.data.contents||d.checked!==a.data.share)?"*":"",c=n.textarea({ondragover:s.setDragEffect({link:[m.bbcodeDrag]}),oninput:l,ondrop:e=>{if(m.bbcodeDrag.is(e)){const{selectionStart:t,selectionEnd:i}=c,a=m.bbcodeDrag.get(e);a&&c.setRangeText(a(c.value.slice(Math.min(t,i),Math.max(t,i))))}}},a.data.contents),d=n.input({type:"checkbox",class:u.settingsTicker,checked:a.data.share,onchange:l});o.clearNode(this.#E,{"window-title":i.default`${E.NOTE_EDIT}${r}: ${this.name}`,class:B},[w.labels([E.NOTE,": "],c),n.br(),w.labels(d,[E.NOTE_SHARE,": "]),n.br(),n.button({onclick:()=>{a.data={contents:c.value,share:d.checked},x.set(this.id,a),g.rpc.pluginSetting(_,{[this.id+""]:a},[]),o.clearNode(e,m.parseBBCode(c.value)),l(),this.#N()}},E.NOTE_SAVE)])}}),E.NOTE_EDIT),this.#N()}}ondragstart(e){super.ondragstart(e),e.defaultPrevented||m.bbcodeDrag.set(e,this.#T)}delete(){this.#E?.remove(),this.#k?.close(),m.bbcodeDrag.deregister(this.#T)}#N(){x.has(this.id)&&x.get(this.id).data.share?this.#M??=this.#E.addControlButton(v.shareStr,(()=>{const e=x.get(this.id);e&&g.rpc.broadcastWindow("plugin-notes",this.id,e.data.contents)}),E.SHARE):(this.#M?.(),this.#M=null)}filter(e){const t=x.get(this.id)?.data.contents.toLowerCase()||"";return super.filter(e.every((e=>t.includes(e)))?[]:e)}}o.amendNode(window,{onbeforeunload:e=>{t.checkEditors()&&e.preventDefault()}});class M extends h.DragFolder{constructor(e,t,i,a){super(e,t,i,a,b,O)}removeItem(e){const t=super.removeItem(e);return L.delete(t),t}}let T=0;const b=new s.DragTransfer("pluginnote"),O=new s.DragTransfer("pluginnotefolder"),_=f.pluginName({url:"/plugins/notes.js"}),N=`data:image/svg+xml,%3Csvg xmlns="${d.ns}" viewBox="0 0 70 70" fill="none" stroke="%23000"%3E%3Cpolyline points="51,7 58,0 69,11 62,18 51,7 7,52 18,63 62,18" stroke-width="2" /%3E%3Cpath d="M7,52 L1,68 L18,63 M53,12 L14,51 M57,16 L18,55" /%3E%3C/svg%3E`,A=`data:image/svg+xml,%3Csvg xmlns="${d.ns}" viewBox="0 0 15 15"%3E%3Cpath d="M7,1 H1 V14 H14 V8 M9,1 h5 v5 m0,-5 l-6,6" stroke-linejoin="round" fill="none" stroke="currentColor" /%3E%3C/svg%3E`,x=new Map,L=new Map,S={user:!1,data:{folders:{},items:{}}},I=e=>{if(!(e instanceof Object&&e.folders instanceof Object&&e.items instanceof Object))return!1;for(const t in e.items)if(!l.isInt(e.items[t],0))return!1;for(const t in e.folders)if(!I(e.folders[t]))return!1;return!0},C=e=>e instanceof Object&&"string"==typeof e.contents,D=e=>{if(!(e instanceof Object&&e[""]instanceof Object&&!1===e[""].user&&I(e[""].data)))return S;for(const t in e)if(""!==t){const i=parseInt(t);!isNaN(i)&&e[t]instanceof Object&&!e[t].user&&C(e[t].data)&&(x.set(i,e[t]),i>T&&(T=i))}return e[""]},R=r.Subscription.bind(1),P=r.Subscription.bind(1),$=r.Subscription.bind(1),H=r.Subscription.bind(1),U=r.Subscription.bind(1),G=r.Subscription.bind(1),Z=new r.Subscription((()=>{})),W=D(f.getSettings(_)),j=(e,t=W.data)=>{const i=e.split("/"),a=i.pop()??"";for(const e of i)if(e&&!(t=t.folders[e]))return[null,a];return[t,a]},V=e=>{const t=e.split("/");e="";for(const i of t)i&&(e+=`/${i}`);return e},F=new h.Root(W.data,E.MENU_TITLE,{list:()=>Promise.resolve(W.data),createFolder:e=>{const[t,i]=j(e);return t?t.folders[i]?(g.handleError(E.NAME_EXISTS_LONG),Promise.reject(E.NAME_EXISTS_LONG)):(t.folders[i]={folders:{},items:{}},g.rpc.pluginSetting(_,{"":W},[]),Promise.resolve(e)):(g.handleError(E.ERROR_INVALID_PATH),Promise.reject(E.ERROR_INVALID_PATH))},move:(e,t)=>{const[i,a]=j(e),[o,s]=j(t);if(!i||!o)return g.handleError(E.ERROR_INVALID_PATH),Promise.reject(E.ERROR_INVALID_PATH);const n=i.items[a];return void 0===n?(g.handleError(E.ERROR_INVALID_ITEM),Promise.reject(E.ERROR_INVALID_ITEM)):o.items[s]?(g.handleError(E.NAME_EXISTS_LONG),Promise.reject(E.NAME_EXISTS_LONG)):(delete i.items[a],o.items[s]=n,g.rpc.pluginSetting(_,{"":W},[]),Promise.resolve(t))},moveFolder:(e,t)=>{if(e=V(e),(t=V(t)).startsWith(e))return g.handleError(E.ERROR_INVALID_PATH),Promise.reject(E.ERROR_INVALID_PATH);const[i,a]=j(e),[o,s]=j(t);return i&&o?i.folders[a]?o.folders[s]?(g.handleError(E.NAME_EXISTS_LONG),Promise.reject(E.NAME_EXISTS_LONG)):(o.folders[s]=i.folders[a],delete i.folders[a],g.rpc.pluginSetting(_,{"":W},[]),Promise.resolve(t)):(g.handleError(E.ERROR_INVALID_FOLDER),Promise.reject(E.ERROR_INVALID_FOLDER)):(g.handleError(E.ERROR_INVALID_PATH),Promise.reject(E.ERROR_INVALID_PATH))},remove:e=>{const[t,i]=j(e);if(!t)return g.handleError(E.ERROR_INVALID_PATH),Promise.reject(E.ERROR_INVALID_PATH);const a=t.items[i];return void 0===a?(g.handleError(E.ERROR_INVALID_ITEM),Promise.reject(E.ERROR_INVALID_ITEM)):(x.delete(a),delete t.items[i],g.rpc.pluginSetting(_,{"":W},[a+""]),Promise.resolve())},removeFolder:e=>{const[t,i]=j(V(e));if(!t)return g.handleError(E.ERROR_INVALID_PATH),Promise.reject(E.ERROR_INVALID_PATH);const a=t.folders[i];return a?0!==Object.keys(a.folders).length||0!==Object.keys(a.items).length?(g.handleError(E.ERROR_FOLDER_NOT_EMPTY),Promise.reject(E.ERROR_FOLDER_NOT_EMPTY)):(delete t.folders[i],g.rpc.pluginSetting(_,{"":W},[]),Promise.resolve()):(g.handleError(E.ERROR_INVALID_FOLDER),Promise.reject(E.ERROR_INVALID_FOLDER))},copy:(e,t)=>{const[i,a]=j(t);if(!i)return g.handleError(E.ERROR_INVALID_PATH),Promise.reject(E.ERROR_INVALID_PATH);if(i.items[a])return g.handleError(E.NAME_EXISTS_LONG),Promise.reject(E.NAME_EXISTS_LONG);const o=++T,s=w.cloneObject(x.get(e));return i.items[a]=o,x.set(o,s),g.rpc.pluginSetting(_,{"":W,[o+""]:s},[]),Promise.resolve({id:o,path:t})},waitAdded:()=>R[0],waitMoved:()=>P[0],waitRemoved:()=>$[0],waitCopied:()=>Z,waitFolderAdded:()=>H[0],waitFolderMoved:()=>U[0],waitFolderRemoved:()=>G[0]},t,M),z=(e,t,i,a)=>{for(const o in e.folders){const s=i+o+"/";t.folders[o]?z(e.folders[o],t.folders[o],s,a):a[s]=-1}for(const o in t.folders)e.folders[o]||(a[i+o+"/"]=0);for(const o in e.items)t.items[o]?e.items[o]!==t.items[o]&&(a[""]=1):a[i+o]=-e.items[o];for(const o in t.items)e.items[o]?e.items[o]!==t.items[o]&&(a[""]=1):a[i+o]=t.items[o]},K=a.id(),Y=a.id(),B=a.id();a.add({[`#${K}`]:{" ul":{"padding-left":"1em","list-style":"none"},">div>ul":{padding:0}},[`.${B} textarea`]:{width:"calc(100% - 10em)",height:"calc(100% - 5em)"},[`.${Y}`]:{"user-select":"text","white-space":"pre-wrap","font-family":"'Andale Mono',monospace"}}),F.windowIcon=k,f.addPlugin("notes",{menuItem:{fn:[E.MENU_TITLE,n.div({id:K},[n.button({onclick:()=>y.shell.prompt(E.NOTES_NEW,[E.NOTES_NEW_LONG,": "],"").then((e=>{if(e)if(e.includes("/"))y.shell.alert(E.NAME_INVALID,E.NAME_INVALID_LONG);else if(F.getItem(`/${e}`))y.shell.alert(E.NAME_EXISTS,E.NAME_EXISTS_LONG);else{const t={user:!1,data:{contents:"",share:!1}};F.addItem(++T,e),x.set(W.data.items[e]=T,t),g.rpc.pluginSetting(_,{"":W,[T]:t},[])}}))},E.NOTES_NEW),F[c.node]]),!0,k]}}),g.rpc.waitPluginSetting().when((({id:e,setting:t,removing:i})=>{if(e===_){for(const e of i){const t=parseInt(e);isNaN(t)||x.delete(t)}for(const e in t)if(""===e){if(!I(t[""].data))continue;const e={};z(W.data,t[""].data,"/",e);const i=Object.keys(e);let a=!1;if(e[""]||i.length>2)a=!0;else if(1===i.length)e[i[0]]<0?i[0].endsWith("/")?G[1](i[0]):$[1](i[0]):i[0].endsWith("/")?H[1](i[0]):R[1]([{id:e[i[0]],name:i[0]}]);else if(2===i.length)if(i[0].endsWith("/")===i[1].endsWith("/"))if(i[0].endsWith("/")){const o={};e[i[0]]<0?z(j(i[0])[0],j(i[1],t[""].data)[0],"/",o):z(j(i[0],t[""].data)[0],j(i[1])[0],"/",o),0===Object.keys(o).length?U[1](e[i[0]]<0?{from:i[0],to:i[1]}:{from:i[1],to:i[0]}):a=!0}else e[i[0]]+e[i[1]]===0?P[1](e[i[0]]<0?{from:i[0],to:i[1]}:{from:i[1],to:i[0]}):a=!0;else a=!0;a&&F.setRoot(t[""].data),W.data=t[""].data}else{const i=parseInt(e),a=t[e];!isNaN(i)&&C(a.data)&&x.set(i,a)}}})),m.registerTag("note",((t,i,a)=>{const s=i.next(!0).value;if(s&&e.isOpenTag(s)&&s.attr){const r=parseInt(s.attr);isNaN(r)||o.amendNode(t,e.process(n.span({class:u.psuedoLink,onclick:()=>L.get(r)?.show()}),i,a,s.tagName))}}))}else m.registerTag("note",t.none);return{}}],["/plugins/spells.js",async()=>{const[e,t,i,a,o,s,n,r,l,c,d,h,u,p,m,f,g]=await Promise.all(["/lib/css.js","/lib/dom.js","/lib/events.js","/lib/html.js","/lib/misc.js","/lib/svg.js","/colours.js","/ids.js","/keys.js","/language.js","/map.js","/map_fns.js","/map_tokens.js","/rpc.js","/settings.js","/shared.js","/tools.js"].map(include)),w={stroke:"#f00",fill:"rgba(255, 0, 0, 0.5)",style:"clip-path: none; pointer-events: none;"},v=s.circle(),y=s.g(w,v),E=s.path(),k=s.g(w,E),M=s.rect(),T=s.g(w,M),b=s.rect(),O=s.g(w,b),_=s.rect(),N=s.g(w,_),A=[y,k,T,O,N],x=new Map([[k,E],[T,M],[O,b],[N,_]]),L=(e,i)=>{const{gridSize:a,gridDistance:o}=d.mapData,s=a*e/(o||1),n=s>>1,r=a*i/(o||1);t.amendNode(v,{r:s}),t.amendNode(E,{d:`M0,0 L${s},-${n} q${.425*s},${n} 0,${s} z`}),t.amendNode(M,{x:-n,y:-n,width:s,height:s}),t.amendNode(b,{x:0,y:-r/2,width:s,height:r}),t.amendNode(_,{x:-n,y:-r/2,width:s,height:r})},S=["#ff0000","#ddddff","#00ff00","#0000ff","#ffffff","#000000","#ffff00","#996622","#000000"].map(((e,t)=>[n.hex2Colour(e),n.hex2Colour(e,8===t?255:128)]));let I=20,C=5;if(p.isAdmin){let n=y,w=!1,v=0,E=0,M=0,b=0,_=!1,D=!1;const R=c.makeLangPack({ADD_SPELL:"Add Spell to Map",DAMAGE_TYPE:"Damage Type",SPELL_SIZE:"Spell Size",SPELL_TYPE:"Spell Shape",SPELL_TYPE_CIRCLE:"Circle Spell",SPELL_TYPE_CONE:"Cone Spell",SPELL_TYPE_CUBE:"Cube Spell",SPELL_TYPE_LINE:"Line Spell",SPELL_TYPE_WALL:"Wall Spell",SPELL_WIDTH:"Spell Width",TITLE:"Spell Effects",TYPE_0:"Fire",TYPE_1:"Ice",TYPE_2:"Acid",TYPE_3:"Water",TYPE_4:"Steam",TYPE_5:"Necrotic",TYPE_6:"Lightning",TYPE_7:"Earth",TYPE_8:"Darkness"}),P=e.id(),$=e=>{M=0,n!==e&&n.parentNode&&n.replaceWith(e),n=e,n!==k&&n!==O||G(),t.amendNode(ee,{style:{"--spell-display":n===O||n===N?"block":""}})},H=()=>p.rpc.broadcast({type:"plugin-spells",data:[A.indexOf(n)??0,I,C,v,E,M,b]}),U=()=>p.rpc.broadcast({type:"plugin-spells",data:null}),G=()=>{const{token:e}=u.selected;e?(t.amendNode(n,{transform:`translate(${v=Math.round(e.x+e.width/2)}, ${E=Math.round(e.y+e.height/2)})`}),n.parentNode||t.amendNode(d.root,n)):(k.remove(),O.remove())},Z=a.input({type:"checkbox",checked:m.autosnap.value,class:r.settingsTicker}),W=()=>Z.click(),[j,V]=i.keyEvent("Shift",W,W),[F,z]=i.mouseDragEvent(0,void 0,(()=>D=!1)),[K,Y]=i.mouseDragEvent(2,void 0,(()=>{_=!1,U()})),[B,q]=i.mouseMoveEvent((e=>{if(D||n===k||n===O){const[i,a]=d.screen2Grid(e.clientX,e.clientY,Z.checked);t.amendNode(x.get(n),{transform:`rotate(${M=o.mod(Math.round(180*Math.atan2(a-E,i-v)/Math.PI),360)})`})}else[v,E]=d.screen2Grid(e.clientX,e.clientY,Z.checked),t.amendNode(n,{transform:`translate(${v}, ${E})`});_&&H()}),(()=>w=!1)),X=()=>{if(n!==k&&n!==O){const{layer:e}=u.selected;if(e){const{gridSize:t,gridDistance:i}=d.mapData,a=(n===y?2:1)*t*I/i,s=n===N?t*C/i:a;h.doTokenAdd(e.path,{id:0,x:v-(a>>1),y:E-(s>>1),width:a,height:s,rotation:o.mod(Math.floor(256*M/360),256),snap:Z.checked,fill:S[b][1],stroke:S[b][0],strokeWidth:1,tokenType:1,isEllipse:n===y,lightColours:[],lightStages:[],lightTimings:[],tokenData:{}})}}},[Q,J]=l.registerKeyEvent("spells-create",R.ADD_SPELL,"Enter",X),ee=a.div([f.labels([R.DAMAGE_TYPE,": "],a.select({onchange:function(){b=o.checkInt(parseInt(this.value),0,S.length-1);for(const e of A)t.amendNode(e,{stroke:S[b][0],fill:S[b][1]})}},Array.from({length:S.length},((e,t)=>a.option({value:t},R["TYPE_"+t]))))),a.fieldset([a.legend(R.SPELL_TYPE),[[y,"SPELL_TYPE_CIRCLE"],[k,"SPELL_TYPE_CONE"],[T,"SPELL_TYPE_CUBE"],[O,"SPELL_TYPE_LINE"],[N,"SPELL_TYPE_WALL"]].map((([e,t],i)=>[i>0?a.br():[],f.labels(a.input({type:"radio",name:"plugin-spell-type",checked:!i,class:r.settingsTicker,onclick:()=>$(e)}),[R[t],": "])]))]),f.labels(Z,`${c.default.TOOL_MEASURE_SNAP}: `),a.br(),f.labels([R.SPELL_SIZE,": "],a.input({type:"number",min:1,value:I,onchange:function(){L(I=o.checkInt(parseInt(this.value),1,1e3,10),C)}})),a.div({style:"display: var(--spell-display, none)"},f.labels([R.SPELL_WIDTH,": "],a.input({type:"number",min:1,value:C,onchange:function(){L(I,C=o.checkInt(parseInt(this.value),1,1e3,10))}})))]),te=()=>{!w||n!==k&&n!==O||G()};g.addTool(Object.freeze({name:R.TITLE,id:"tool_spells",icon:s.svg({viewBox:"0 0 100 100"},[s.title(R.TITLE),s.g({fill:"currentColor",stroke:"currentColor"},[s.path({d:"M60,35 v70 h-20 v-100 h20 v30 h-20 v-30 h20","fill-rule":"evenodd",transform:"rotate(-45, 50, 50)"}),s.path({d:"M50,10 q0,10 10,10 q-10,0 -10,10 q0,-10 -10,-10 q10,0 10,-10",id:P}),s.use({href:`#${P}`,transform:"translate(5, 0) scale(1.5)"}),s.use({href:`#${P}`,transform:"translate(-45, 30) scale(1.2)"}),s.use({href:`#${P}`,transform:"translate(-30, -5) scale(0.8)"})])]),options:ee,mapMouseOver:function(e){return!w&&(w=!0,n===k||n===O?G():[v,E]=d.screen2Grid(e.clientX,e.clientY,Z.checked),t.amendNode(n,{transform:`translate(${v}, ${E})`}),n!==k&&n!==O&&t.amendNode(this,n),Q(),B(),!0)},mapMouse0:()=>n!==T&&n!==N||(D=!0,F(),!1),mapMouse2:()=>(_=!0,H(),K(),!1),tokenMouse0:function(e){return!this.previousSibling&&e.shiftKey},tokenMouse2:g.ignore,set:j,unset:()=>{_&&(U(),_=!1),q(),Y(),J(),z(),n?.remove(),V()}})),f.mapLoadedReceive((()=>L(I,C))),u.tokenSelectedReceive(te);for(const e of["waitTokenMoveLayerPos","waitTokenSet","waitTokenSetMulti","waitLayerShift"])p.combined[e]().when((()=>setTimeout(te)))}else{let e=null;p.rpc.waitBroadcast().when((({type:i,data:a})=>{if("plugin-spells"!==i)return;if(null===a)return e?.remove(),void(e=null);if(!(a instanceof Array)||7!==a.length)return void console.log("plugin spells: broadcast data must be an array with length 7");const[s,n,r,l,c,h,u]=a,p=A[s];for(const[e,t]of[[o.isInt(s,0,A.length-1),"invalid type"],[o.isInt(n,1,1e3),"invalid size"],[o.isInt(r,1,1e3),"invalid width"],[o.isInt(l)&&o.isInt(c),"invalid coords"],[o.isInt(h,0,360),"invalid rotation"],[o.isInt(u,0,S.length-1),"invalid damage type"]])if(!e)return void console.log("plugin spells: "+t);e!==p&&(e?.remove(),t.amendNode(d.root,p)),L(I=n,C=r),t.amendNode(x.get(t.amendNode(e=p,{transform:`translate(${l}, ${c})`,stroke:S[u][0],fill:S[u][1]})),{transform:`rotate(${h})`})}))}return p.combined.waitGridDistanceChange().when((()=>setTimeout(L,0,I,C))),{}}]]);return i=>Promise.resolve(e.get(i)??t.get(i)?.()??import(i))})()});const t=(e,i=[])=>{if(r(e))i.push(e[c]);else if("string"==typeof e||e instanceof Node)i.push(e);else if(Array.isArray(e))for(const a of e)t(a,i);else(e instanceof NodeList||e instanceof HTMLCollection)&&i.push(...e);return i},i=e=>e instanceof Function||(e=>e instanceof Object&&e.handleEvent instanceof Function)(e)&&(!(h in e)||i(e[h])),a=e=>i(e)||e instanceof Array&&3===e.length&&i(e[0])&&e[1]instanceof Object&&"boolean"==typeof e[2],o=e=>e instanceof Object&&!n(e),s=e=>e instanceof CSSStyleDeclaration||e instanceof Object&&!n(e),n=e=>e instanceof Object&&d in e,r=e=>e instanceof Object&&c in e,l=(e,t)=>{const i=document.createAttributeNS(null,e);return i.textContent=t,i},c=Symbol("child"),d=Symbol("attr"),h=Symbol("value"),u=e=>e instanceof Array||"string"==typeof e||e instanceof Element||e instanceof DocumentFragment||e instanceof Text||r(e)||e instanceof NodeList||e instanceof HTMLCollection,p=(e,i,r)=>{if(i&&u(i))r=i;else if(i instanceof NamedNodeMap&&e instanceof Element)for(const t of i)e.setAttributeNode(t.cloneNode());else if(e&&"object"==typeof i){const t=!!((c=e).style&&c.classList&&c.removeAttribute&&c.setAttributeNode&&c.toggleAttribute);for(const r in i){const c=i[r];if(a(c)&&r.startsWith("on")){const t=c instanceof Array;e[t&&c[2]?"removeEventListener":"addEventListener"](r.slice(2),t?c[0]:c,!!t&&c[1])}else if(t)if("boolean"==typeof c)e.toggleAttribute(r,c);else if(void 0===c)e.removeAttribute(r);else if(c instanceof Array||c instanceof DOMTokenList){if("class"===r&&c.length)for(const t of c){const i=t.slice(0,1),a="!"!==i&&("~"!==i||void 0);e.classList.toggle(a?t:t.slice(1),a)}}else if("class"===r&&o(c))for(const t in c)e.classList.toggle(t,c[t]??void 0);else if("style"===r&&s(c))for(const[t,i]of c instanceof CSSStyleDeclaration?Array.from(c,(e=>[e,c.getPropertyValue(e)])):Object.entries(c))void 0===i?e.style.removeProperty(t):e.style.setProperty(t,i.toString());else null!==c&&e.setAttributeNode(c instanceof Attr?c:Object.assign(n(c)?c[d](r):l(r,c),{realValue:c}))}}var c;return e instanceof Node&&("string"!=typeof r||e.firstChild?r&&(r instanceof Node?e.appendChild(r):e instanceof Element||e instanceof DocumentFragment?e.append(...t(r)):e.appendChild(E(r))):e.textContent=r),e},m=(e,t)=>Object.defineProperty(((i,a)=>p(document.createElementNS(e,t),i,a)),"name",{value:t}),f=1,g=2,w=4,v=8,y=(e,t,i)=>[e,{once:!!(t&f),capture:!!(t&g),passive:!!(t&w),signal:i},!!(t&v)],E=e=>{const i=document.createDocumentFragment();return"string"==typeof e?i.textContent=e:e instanceof Node?i.append(e):void 0!==e&&i.append(...t(e)),i},k=(e,i,a)=>{if(!e)return e;if(i&&u(i)&&(i=void(a=i)),"string"==typeof a)a=void(e.textContent=a);else if(a&&e instanceof Element)a=void e.replaceChildren(...t(a));else for(;e.lastChild;)e.lastChild.remove();return p(e,i,a)},M=Symbol("setNode"),T=Symbol("update"),b=Symbol("remove");class O{#A=new Set;#o;#x=-1;#L(e){e&&this.#A.delete(e);for(const t of Array.from(this.#A))if(t instanceof WeakRef){const i=t.deref();i&&i!==e?(t instanceof O&&t.#A.size||t instanceof Text&&t.parentNode||t instanceof Attr&&t.ownerElement)&&(this.#A.delete(t),this.#A.add(i)):this.#A.delete(t)}else(t instanceof O&&!t.#A.size||t instanceof Text&&!t.parentNode||t instanceof Attr&&!t.ownerElement)&&(this.#A.delete(t),this.#A.add(new WeakRef(t)));-1!==this.#x&&(clearTimeout(this.#x),this.#x=-1),this.#A.size&&(this.#x=setTimeout(this.#o??=()=>this.#L(),5e4+Math.floor(2e4*Math.random())))}[d](e){const t=document.createAttributeNS(null,e);return t.textContent=this+"",this[M](t)}get[c](){return this[M](new Text(this+""))}[M](e){return this.#L(),this.#A.add(e),e}[T](){const e=this+"";for(const t of this.#A){const i=t instanceof WeakRef?t.deref():t;i instanceof O?i[T]():i&&(i.textContent=e)}this.#L()}[b](e){this.#L(e)}}class _ extends O{#S;#I;constructor(e,...t){super(),this.#S=e,this.#I=t;for(const e of t)e instanceof O&&e[M](this)}toString(){let e="";for(let t=0;t<this.#S.length;t++)e+=this.#S[t]+(this.#I[t]??"");return e}}class N extends O{#C;constructor(e){super(),this.#C=e,e instanceof O&&e[M](this)}[h](){return this.value}get value(){return this.#C instanceof N?this.#C.value:this.#C}set value(e){this.#C!==e&&(this.#C instanceof O&&this.#C[b](this),this.#C=e,e instanceof O&&e[M](this)),this[T]()}handleEvent(e){const t=this.value;var i;t instanceof Function?t.call(e.currentTarget,e):(i=t)instanceof Object&&i.handleEvent instanceof Function&&t.handleEvent(e)}toString(){return this.value?.toString()??""}}const A=(e,t,...i)=>e instanceof Array&&t?new _(e,t,...i):new N(e);class x extends CSSStyleSheet{#D;#R;constructor(e="",t=0){super(),this.#D=C.test(e)?e:"_",this.#R=t}add(e,t={}){for(const[i,a]of"string"==typeof e?[[e,t]]:Object.entries(e))for(const e of D(i,a))this.insertRule(e,this.cssRules.length);return this}at(e,t){if(t){let i="";for(const e in t)for(const a of D(e,t[e]))i+=a;i&&this.insertRule(e+"{"+i+"}",this.cssRules.length)}else this.insertRule(e,this.cssRules.length);return this}id(){return this.#D+this.#R++}ids(e){return Array.from({length:e},(()=>this.id()))}toString(){let e="";for(const t of this.cssRules)e+=t.cssText;return e}render(){const e=document.createElement("style");return e.setAttribute("type","text/css"),e.textContent=this+"",e}}const L=e=>{const t=[],i=[];let a=0;for(let o=0;o<e.length;o++){const s=e.charAt(o);if('"'===s||"'"===s)for(o++;o<e.length;o++){const t=e.charAt(o);if("\\"===t)o++;else if(t===s)break}else","!==s||t.length?s===t.at(-1)?t.pop():"["===s?t.push("]"):"("===s&&t.push(")"):(i.push(e.slice(a,o)),a=o+1)}return i.push(e.slice(a,e.length)),i},S=(e,t)=>{const i=L(t);let a="";for(const t of L(e))for(const e of i)a+=(a.length?",":"")+t+e;return a},I=e=>Object.getPrototypeOf(e)===Object.prototype,C=/^\-?[_a-z\240-\377][_a-z0-9\-\240-\377]*$/i,D=(e,t)=>{const i=[];let a="";for(const o in t){const s=t[o];I(s)?i.push(...D(S(e,o),s)):a+=`${o}:${s};`}return a&&i.unshift(e+"{"+a+"}"),i},R=new x,P=R.add.bind(R),$=R.at.bind(R),H=R.id.bind(R),U=R.ids.bind(R),G=R.render.bind(R),Z=(e,t)=>{for(const i in t){const a=t[i];if(I(a)){const t=e[i]??={};I(t)&&Z(t,a)}else e[i]=a}return e};let W=0;const j={altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1},V=new Set,F=new Map,z=new Map,K=e=>Object.assign(e,j),Y=(e,t)=>new KeyboardEvent(`key${e}`,K({key:t})),B=e=>new MouseEvent("mouseup",K({button:e,clientX:oe,clientY:se,view:window})),q=new Map,X=new Map,Q=Array.from({length:16},(()=>new Map)),J=(e,t)=>{j.altKey=t.altKey,j.ctrlKey=t.ctrlKey,j.metaKey=t.metaKey,j.shiftKey=t.shiftKey;const{key:i,target:a}=t,o=te(K({key:i}));if(e)a instanceof HTMLInputElement||a instanceof HTMLTextAreaElement||a instanceof HTMLSelectElement||a instanceof HTMLButtonElement||V.has(o)||(ee(t,F.get(o)),V.add(o));else{const e=o.charAt(0);for(const a of V)a.startsWith(e)&&a.slice(1)!==i||(ee(t,z.get(a)),V.delete(a))}},ee=(e,t)=>{if(t)for(const i of t)i[0](e),i[1]&&t.delete(i)},te=e=>(+!e.altKey+2*+!e.ctrlKey+4*+!e.metaKey+8*+!e.shiftKey).toString(16)+(e.key??""),ie=e=>{const t=e.split("+").map((e=>e.trim())),i={altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1,key:t.at(-1)};for(const e of t)switch(e.toLowerCase()){case"alt":case"option":i.altKey=!0;break;case"control":case"ctrl":i.ctrlKey=!0;break;case"command":case"meta":case"super":case"windows":i.metaKey=!0;break;case"shift":i.shiftKey=!0}return te(i)},ae=(e,t)=>{let i=e.get(t);return i||e.set(t,i=new Set),i};let oe=0,se=0;const ne=(e,t,i,a=!1)=>{const o=[t,a],s=[i,a],n=("string"==typeof e?[e]:e).filter((e=>!!e)).map(ie),r=()=>{for(const e of n){if(t){const i=V.has(e),s=e.slice(1);i&&e===te(K({key:s}))&&t(Y("down",s)),i&&a||ae(F,e).add(o)}i&&ae(z,e).add(s)}c=!0},l=(e=!0)=>{for(const t of n){const i=e&&V.has(t)&&z.get(t)?.has(s)?s[0]:null;F.get(t)?.delete(o),z.get(t)?.delete(s),i?.(Y("up",t))}c=!1};let c=!1;return[r,l,(e,t=!0)=>{const i=c;i&&l(t),n.splice(0,n.length,...("string"==typeof e?[e]:e).filter((e=>!!e)).map(ie)),i&&r()}]},re=(e,t)=>{const i=W++;return[()=>{q.set(i,e),t&&X.set(i,t)},(e=!0)=>{const t=e?X.get(i):null;q.delete(i),X.delete(i),t?.()}]},le=(e,t,i=(()=>{}))=>{const a=W++;return[()=>{t&&q.set(a,t),Q[e].set(a,i)},(t=!0)=>{const i=t?Q[e].get(a):null;q.delete(a),Q[e].delete(a),i?.(B(e))}]},ce=e=>{const t=ie(e);for(const e of[F,z])if(e.get(t)?.size)return!0;return!1};for(const[e,t]of[["keydown",e=>J(!0,e)],["keyup",e=>J(!1,e)],["mousemove",e=>{oe=e.clientX,se=e.clientY;for(const[,t]of q)t(e)}],["mouseup",e=>{const{button:t}=e;if(!(t<0||t>=16)&&Number.isInteger(t)){for(const[i,a]of Q[t])a(e),q.delete(i);Q[t].clear()}}],["blur",()=>{for(const e of V)ee(Y("up",e),z.get(e)),V.delete(e);for(let e=0;e<16;e++)if(Q[e].size){const t=B(e);for(const[,i]of Q[e])i(t);Q[e].clear()}q.clear();for(const[e,t]of X)q.delete(e),t();X.clear()}]])window.addEventListener(e,t);const de="http://www.w3.org/1999/xhtml",[he,ue,pe,me,fe,ge,we,ve,ye,Ee,ke,Me,Te,be,Oe,_e,Ne,Ae,xe,Le,Se,Ie,Ce,De,Re,Pe,$e,He,Ue,Ge,Ze,We,je,Ve,Fe,ze,Ke,Ye,Be,qe,Xe,Qe,Je,et,tt,it,at,ot,st,nt,rt,lt,ct,dt,ht,ut,pt,mt,ft,gt,wt,vt,yt,Et,kt,Mt,Tt,bt,Ot,_t,Nt,At,xt,Lt,St,It,Ct,Dt,Rt,Pt,$t,Ht,Ut,Gt,Zt,Wt,jt,Vt,Ft,zt,Kt,Yt,Bt,qt,Xt,Qt,Jt,ei,ti,ii,ai,oi,si,ni,ri,li,ci,di,hi,ui,pi]="a abbr address area article aside audio b base bdi bdo blockquote body br button canvas caption cite code col colgroup data datalist dd del details dfn dialog div dl dt em embed fieldset figcaption figure footer form h1 h2 h3 h4 h5 h6 head header hgroup hr html i iframe img input ins kbd label legend li link main map mark menu meta meter nav noscript object ol optgroup option output p picture pre progress q rp rt ruby s samp script section select slot small source span strong style sub summary sup table tbody td template textarea tfoot th thead time title tr track u ul var video wbr".split(" ").map((e=>m(de,e))),mi=(e,t=-1/0,i=1/0)=>"number"==typeof e&&(0|e)===e&&e>=t&&e<=i,fi=(e,t=-1/0,i=1/0,a=0)=>mi(e,t,i)?e:a,gi=(e,t)=>(e%t+t)%t,wi=(e,t,i)=>(e.set(t,i),i),vi=(e,t)=>(e.push(t),t),yi=(e,t)=>(e.add(t),t),Ei=(()=>{let e=Promise.resolve();return t=>e=e.finally(t)})(),ki=(e,t=!0)=>(window.setTimeout((()=>{e.focus(),(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement)&&t&&e.select()}),0),e),Mi=e=>{const t=document.createElement("template");return t.innerHTML=e,t.content},Ti=Symbol("s");class bi{#h;#C;#P=[];constructor(e,t){this.#h=e,this.#C=t}get name(){return this.#h}get value(){return this.#C}[Ti](e){return e+""}set(e){const t=this.#C,i=this[Ti](this.#C=e);if(this.#C!==t||this.#C instanceof Object){null===i?window.localStorage.removeItem(this.#h):window.localStorage.setItem(this.#h,i);for(const t of this.#P)t(e)}return this}remove(){return window.localStorage.removeItem(this.#h),this}wait(e){return e(this.#C),this.#P.push(e),this}}class Oi extends bi{constructor(e){super(e,null!==window.localStorage.getItem(e))}[Ti](e){return e?"":null}}class _i extends bi{#$;#H;constructor(e,t=0,i=-1/0,a=1/0){const o=parseInt(window.localStorage.getItem(e)??"");super(e,isNaN(o)||o<i||o>a?t:o),this.#$=i,this.#H=a}set(e){return Number.isInteger(e)&&e>=this.#$&&e<=this.#H?super.set(e):this}}class Ni extends bi{#$;#H;constructor(e,t=0,i=-1/0,a=1/0){const o=parseFloat(window.localStorage.getItem(e)??"");super(e,isNaN(o)||o<i||o>a?t:o),this.#$=i,this.#H=a}set(e){return e>=this.#$&&e<=this.#H?super.set(e):this}}class Ai extends bi{constructor(e,t=""){super(e,window.localStorage.getItem(e)??t)}}class xi extends bi{constructor(e,t,i){const a=window.localStorage.getItem(e);let o=t;if(a)try{const e=JSON.parse(a);i(e)&&(o=e)}catch{}super(e,o)}save(){return this.set(this.value),this}[Ti](e){return JSON.stringify(e)}}class Li{#U=new Map;#G=0;#Z;#W="";constructor(e){this.#Z=e}register(e){const t=this.#G+++"";return this.#U.set(t,e),t}get(e){e.preventDefault();const t=this.#U.get(e.dataTransfer?.getData(this.#Z)||this.#W);return t instanceof Function?t():t?.transfer()}set(e,t,i,a=-5,o=-5){this.#W=t,e.dataTransfer?.setData(this.#Z,t),i&&e.dataTransfer?.setDragImage(i,a,o)}deregister(e){this.#U.delete(e),this.#W===e&&(this.#W="")}is(e){return e.dataTransfer?.types.includes(this.#Z)??!1}}class Si{#j;constructor(...e){this.#j=Object.freeze(e)}get mimes(){return this.#j}asForm(e,t){const i=new FormData;if(e.dataTransfer){e.preventDefault();for(const a of e.dataTransfer.files)i.append(t,a)}return i}is(e){if(e.dataTransfer?.types.includes("Files")){for(const t of e.dataTransfer.items)if("file"!==t.kind||!this.#j.includes(t.type))return!1;return!0}return!1}}const Ii=e=>t=>{if(t.dataTransfer)for(const i in e)for(const a of e[i]??[])if(a.is(t))return t.preventDefault(),t.dataTransfer.dropEffect=i,!0;return!1};class Ci{#V=[];get length(){return this.#V.length}send(e){for(const t of this.#V)t(e)}receive(e){if(e instanceof Function)this.#V.push(e);else if(null!=e)throw new TypeError("pipe.receive requires function type")}remove(e){for(const[t,i]of this.#V.entries())if(i===e)return void this.#V.splice(t,1)}bind(e=7){return[1&e?e=>this.send(e):void 0,2&e?e=>this.receive(e):void 0,4&e?e=>this.remove(e):void 0]}}class Di{#F;request(...e){const t=this.#F;if(void 0===t)throw new Error("no responder set");return t instanceof Function?t(...e):t}responder(e){this.#F=e}}class Ri{#z;#K;#Y;#B;constructor(e){const[t,i]=(new Ci).bind(3),a=new Ci,[,o]=a.bind(2);e(t,(e=>{if(!a.length)throw e;a.send(e)}),(e=>this.#Y=e)),this.#z=i,this.#K=o}when(e,t){const i=new Ri(((i,a)=>{this.#z(e instanceof Function?t=>{try{i(e(t))}catch(e){a(e)}}:i),this.#K(t instanceof Function?e=>{try{i(t(e))}catch(e){a(e)}}:a)}));return i.#B=i.#Y=this.#B??=()=>this.#Y?.(),i}cancel(){this.#Y?.()}catch(e){return this.when(void 0,e)}finally(e){return this.when((t=>(e(),t)),(t=>{throw e(),t}))}splitCancel(e=!1){const[t,i,a]=(new Ci).bind(),[o,s,n]=(new Ci).bind();let r=0;return this.when(t,o),()=>new Ri(((t,o,l)=>{i(t),s(o),r++,l((()=>{a(t),n(o),l((()=>{})),!--r&&e&&this.cancel()}))}))}static merge(...e){return new Ri(((t,i,a)=>{for(const a of e)a.when(t,i);a((()=>{for(const t of e)t.cancel()}))}))}static bind(e=7){let t,i,a;return[new Ri(((e,o,s)=>{t=e,i=o,a=s})),1&e?t:void 0,2&e?i:void 0,4&e?a:void 0]}}class Pi{#q=0;#X=0;#Q=0;#J=new Ci;#ee=new Ci;add(){this.#q++,this.#te()}done(){this.#X++,this.#te()}error(){this.#Q++,this.#te()}onUpdate(e){return this.#J.receive(e),()=>this.#J.remove(e)}onComplete(e){return this.#ee.receive(e),()=>this.#ee.remove(e)}#te(){const e={waits:this.#q,done:this.#X,errors:this.#Q};this.#J.send(e),this.#X+this.#Q===this.#q&&this.#ee.send(e)}}class $i{#U;set(e){return this.#U=e}get(){const e=this.#U;return this.#U=void 0,e}}const Hi=Symbol("blur"),Ui=Symbol("disconnect"),Gi=Symbol("itemElement"),Zi=Symbol("menuElement"),Wi=[(new x).add({":host":{outline:"none",display:"inline-flex","flex-flow":"column wrap"},"::slotted(menu-item),::slotted(menu-submenu)":{display:"block","user-select":"none"}})],ji=[(new x).add({":host":{position:"relative"},"::slotted(menu-item)":{display:"block"}})];class Vi extends HTMLElement{#ie;#ae;constructor(){super(),p(this.attachShadow({mode:"closed",slotAssignment:"manual"}),this.#ie=Wt()).adoptedStyleSheets=Wi,setTimeout(p,0,this,{tabindex:-1,onblur:()=>this[Hi](),onkeydown:e=>{const t=document.activeElement;switch(e.key){case"Escape":this.parentNode instanceof zi||t?.blur?.();case"ArrowLeft":this.parentNode instanceof zi&&this.parentNode[Gi]()?.focus();break;case"Enter":t instanceof Fi&&t.select();break;case"ArrowRight":const i=t?.parentNode;t instanceof Fi&&i instanceof zi&&(i.select(),setTimeout((()=>{const e=i[Zi]();e&&e.#ie.assignedNodes()[0]?.focus()})));break;case"Tab":e.preventDefault();case"ArrowDown":case"ArrowUp":const a=this.#ie.assignedNodes().filter((e=>!e.hasAttribute("disabled"))),o=a.findIndex((e=>e.contains(t)));a.at("ArrowUp"===e.key?o<0?o:o-1:(o+1)%a.length)?.focus();break;default:const s=this.#ie.assignedNodes().filter((t=>t.getAttribute("key")===e.key&&!t.hasAttribute("disabled")));s.at((s.findIndex((e=>e.contains(t)))+1)%s.length)?.focus(),1===s.length&&s[0]?.select()}e.stopPropagation()}}),new MutationObserver((()=>this.#ie.assign(...Array.from(this.children).filter((e=>e instanceof Fi||e instanceof zi))))).observe(this,{childList:!0})}[Hi](){setTimeout((()=>{this.contains(document.activeElement)||(this.parentNode instanceof zi?this.parentNode[Hi]():this.remove())}))}connectedCallback(){if(!(this.parentNode instanceof zi)){p(window,{onmousedown:y(this.#ae=e=>{this.contains(e.target)||this.remove()},g)});const{offsetParent:e}=this,t=parseInt(this.getAttribute("x")??"0")||0,i=parseInt(this.getAttribute("y")??"0")||0;p(this,{style:{position:"absolute",left:void 0,top:void 0,width:void 0,"max-height":e.clientHeight+"px",visibility:"hidden"}}),setTimeout((()=>{const a=2*Math.max(this.offsetWidth,this.scrollWidth)-this.clientWidth;p(this,{style:{visibility:void 0,position:"absolute",width:a+"px",left:Math.max(t+a<e.clientWidth?t:t-a,0)+"px",top:Math.max(i+this.offsetHeight<e.clientHeight?i:i-this.offsetHeight,0)+"px"}}),this.focus()}))}}disconnectedCallback(){this.#ae&&(p(window,{onmousedown:y(this.#ae,g|v)}),this.#ae=void 0);for(const e of this.children)e instanceof zi&&e[Ui]()}}class Fi extends HTMLElement{constructor(){super(),setTimeout(p,0,this,{tabindex:-1,onblur:()=>this.parentNode?.[Hi]?.(),onclick:()=>this.select(),onmouseover:()=>{document.activeElement!==this&&this.focus()}})}focus(){this.hasAttribute("disabled")||this.parentNode instanceof zi&&this.parentNode.hasAttribute("disabled")||super.focus()}select(){this.hasAttribute("disabled")||(this.parentNode instanceof zi?this.parentNode.select():this.dispatchEvent(new CustomEvent("select",{cancelable:!0}))&&this.blur())}}class zi extends HTMLElement{#ie;#oe;#se=null;#ne=null;#re=!1;constructor(){super(),p(this.attachShadow({mode:"closed",slotAssignment:"manual"}),[this.#ie=Wt(),this.#oe=Wt()]).adoptedStyleSheets=ji,new MutationObserver((()=>{this.#ne=null,this.#se=null;for(const e of this.children)if(!this.#ne&&e instanceof Fi){if(this.#ie.assign(this.#ne=e),this.#se)return}else if(!this.#se&&e instanceof Vi&&(this.#se=e,this.#ne))return;this.#ne||this.#ie.assign(),this.#se||this.#oe.assign()})).observe(this,{childList:!0})}select(){if(!this.hasAttribute("disabled")){const e=this.#se;if(e){let t=this,i=0,a=0;for(;t instanceof Vi||t instanceof zi;)i+=t.offsetLeft-t.clientWidth+t.offsetWidth,a+=t.offsetTop-t.clientHeight+t.offsetHeight,t=t.offsetParent;p(this,{open:!0}),this.#oe.assign(p(e,{style:{position:"absolute",left:void 0,top:void 0,width:void 0,"max-height":t.clientHeight+"px",visibility:"hidden"}})),setTimeout((()=>{const o=2*Math.max(e.offsetWidth,e.scrollWidth)-e.clientWidth;p(e,{style:{visibility:void 0,position:"absolute",width:o+"px",left:Math.max(i+o+this.offsetWidth<t.clientWidth?this.offsetWidth:-o,-i)+"px",top:Math.max(a+e.offsetHeight<t.clientHeight?0:this.offsetHeight-e.offsetHeight,-a)+"px"}}),this.#re=!0,e.focus()}))}}}[Gi](){return this.#ne}[Zi](){return this.#se}focus(){this.#ne?.focus()}[Hi](){this.#re?this.#re=!1:(p(this,{open:!1}),this.#oe.assign(),this.parentNode?.[Hi]?.())}[Ui](){for(const e of this.#se?.children??[])e instanceof zi&&e[Ui]();p(this,{open:!1}),this.#oe.assign()}}customElements.define("menu-menu",Vi),customElements.define("menu-item",Fi),customElements.define("menu-submenu",zi);const Ki=m(de,"menu-menu"),Yi=m(de,"menu-item"),Bi=m(de,"menu-submenu"),qi=Symbol("node"),Xi=()=>0,Qi=(new Intl.Collator).compare,Ji=e=>class extends e{[qi]=this},ea=(e,t)=>{for(;t.p.i&&e.s(t.i,t.p.i)*e.o<0;){t.n.p=t.p,t.p.n=t.n,t.n=t.p;const e=t.p.p;t.p.p=t,t.p=e,e.n=t}for(;t.n.i&&e.s(t.i,t.n.i)*e.o>0;){t.n.p=t.p,t.p.n=t.n,t.p=t.n;const e=t.n.n;t.n.n=t,t.n=e,e.p=t}return t.n.i?e.h.insertBefore(t.i[qi],t.n.i[qi]):e.h.appendChild(t.i[qi]),t},ta=(e,t)=>{const i=t;if(t<0){t++;for(let a=e.p;a.i;t++,a=a.p)if(!t)return[a,e.l+i]}else if(t<e.l)for(let a=e.n;a.i;t--,a=a.n)if(!t)return[a,i];return[e,-1]},ia=(e,t,i)=>(e.l++,ea(e,t.n=t.n.p={p:t,n:t.n,i})),aa=(e,t)=>{t.p.n=t.n,t.n.p=t.p,t.i[qi].parentNode===e.h&&e.h.removeChild(t.i[qi]),e.l--},oa=function*(e,t=0,i=1){for(let[a,o]=ta(e,t);a.i;o+=i,a=1===i?a.n:a.p)yield[o,a.i]},sa=e=>({[qi]:e}),na=(e,t)=>{if(t&&(e.s=t,e.o=1,t===Xi))return;let i=e.n;for(e.n=e.p=e;i.i;){const t=i.n;i.p=e.p,i.n=e,ea(e,e.p=e.p.n=i),i=t}},ra=e=>{[e.p,e.n]=[e.n,e.p],e.o*=-1;for(let t=e.n;t.i;t=t.n)[t.n,t.p]=[t.p,t.n],e.h.appendChild(t.i[qi])},la=(e,t,i,a)=>{const o=e.m.get(t);if(o){if(o.i===i&&o.p===a)return;aa(e,o)}e.m.set(t,Object.assign(ia(e,a,i),{k:t}))},ca=Symbol("realTarget"),da=(e,t)=>{if("number"==typeof e)return t(e);if("string"==typeof e){const i=parseInt(e);if(i.toString()===e)return t(i)}},ha={has:(e,t)=>da(t,(t=>t>=0&&t<=e.length))||t in e,get:(e,t)=>da(t,(t=>e.at(t)))||e[t],set:(e,t,i)=>da(t,(t=>!!e.splice(t,1,i)))||!1,deleteProperty:(e,t)=>da(t,(t=>e.splice(t,1).length>0))||delete e[t]};class ua{#le;[ca];constructor(e,t=Xi,i=[]){const a=this.#le={s:t,h:e,l:0,o:1};Object.defineProperty(this,ca,{value:this}),a.p=a.n=a;for(const e of i)ia(a,a.p,e);return new Proxy(this,ha)}get[qi](){return this[ca].#le.h}get length(){return this[ca].#le.l}at(e){const[t,i]=ta(this[ca].#le,e);return-1!==i?t.i:void 0}concat(...e){return Array.from(this.values()).concat(...e)}copyWithin(e,t,i){throw new Error("invalid")}*entries(){yield*oa(this[ca].#le)}every(e,t){for(const[i,a]of oa(this[ca].#le))if(!e.call(t,a,i,this))return!1;return!0}fill(e,t,i){throw new Error("invalid")}filter(e,t){const i=[];for(const[a,o]of oa(this[ca].#le))e.call(t,o,a,this)&&i.push(o);return i}filterRemove(e,t){const i=this[ca].#le,a=[];for(let o=i.n,s=0;o.i;o=o.n,s++)e.call(t,o.i,s,this)&&(aa(i,o),a.push(o.i));return a}find(e,t){for(const[i,a]of oa(this[ca].#le))if(e.call(t,a,i,this))return a}findIndex(e,t){for(const[i,a]of oa(this[ca].#le))if(e.call(t,a,i,this))return i;return-1}findLast(e,t){for(const[i,a]of oa(this[ca].#le,-1,-1))if(e.call(t,a,i,this))return a}findLastIndex(e,t){for(const[i,a]of oa(this[ca].#le,-1,-1))if(e.call(t,a,i,this))return i;return-1}flat(e){return Array.from(this.values()).flat(e)}flatMap(e,t){return this.map(e,t).flat()}forEach(e,t){for(const[i,a]of oa(this[ca].#le))e.call(t,a,i,this)}static from(e,t=sa){const i=new ua(e),a=i[ca].#le;for(const i of e.childNodes){const e=t(i);e&&(a.p=a.p.n={p:a.p,n:a,i:e},a.l++)}return i}includes(e,t=0){for(const[,i]of oa(this[ca].#le,t))if(e===i)return!0;return!1}indexOf(e,t=0){for(const[i,a]of oa(this[ca].#le,t))if(e===a)return i;return-1}join(e){return Array.from(this.values()).join(e)}*keys(){for(let e=0;e<this[ca].#le.l;e++)yield e}lastIndexOf(e,t=-1){for(const[i,a]of oa(this[ca].#le,t,-1))if(e===a)return i;return-1}map(e,t){const i=[];for(const[a,o]of oa(this[ca].#le))i.push(e.call(t,o,a,this));return i}pop(){const e=this[ca].#le,t=e.p;return t.i&&aa(e,t),t.i}push(e,...t){const i=this[ca].#le;ia(i,i.p,e);for(const e of t)ia(i,i.p,e);return i.l}reduce(e,t){for(const[i,a]of oa(this[ca].#le))t=void 0===t?a:e(t,a,i,this);return t}reduceRight(e,t){for(const[i,a]of oa(this[ca].#le,-1,-1))t=void 0===t?a:e(t,a,i,this);return t}reverse(){return ra(this[ca].#le),this}shift(){const e=this[ca].#le,t=e.n;return t.i&&aa(e,t),t.i}slice(e=0,t){const i=this[ca].#le,a=[];e<=-i.l&&(e=0),void 0===t?t=i.l:t<0&&(t+=i.l);for(const[o,s]of oa(i,e)){if(o>=t)break;a.push(s)}return a}some(e,t){for(const[i,a]of oa(this[ca].#le))if(e.call(t,a,i,this))return!0;return!1}sort(e){return na(this[ca].#le,e),this}splice(e,t=0,...i){const a=this[ca].#le,o=[];let[s]=ta(a,e),n=s.p;for(;s.i&&t>0;t--,s=s.n)o.push(s.i),aa(a,s);for(const e of i)n=ia(a,n,e);return o}unshift(e,...t){const i=this[ca].#le;let a=ia(i,i,e);for(const e of t)a=ia(i,a,e);return i.l}*values(){for(let e=this[ca].#le.n;e.i;e=e.n)yield e.i}*[Symbol.iterator](){yield*this.values()}get[Symbol.unscopables](){return{__proto__:null,at:!0,copyWithin:!0,entries:!0,fill:!0,find:!0,findIndex:!0,findLast:!0,findLastIndex:!0,flat:!0,flatMap:!0,includes:!0,keys:!0,toLocaleString:void 0,toString:void 0,values:!0}}}class pa{#le;constructor(e,t=Xi,i=[]){const a=this.#le={s:t,h:e,l:0,o:1,m:new Map};a.p=a.n=a;for(const[e,t]of i)la(a,e,t,a.p)}get[qi](){return this.#le.h}get size(){return this.#le.l}clear(){const e=this.#le;for(let t=e.n;t.i;t=t.n)aa(e,t);e.m.clear()}delete(e){const t=this.#le,i=t.m.get(e);return!!i&&(aa(t,i),t.m.delete(e))}*entries(){for(const[e,t]of this.#le.m)yield[e,t.i]}forEach(e,t=this){this.#le.m.forEach(((i,a)=>e.call(t,i.i,a,this)))}get(e){return this.#le.m.get(e)?.i}has(e){return this.#le.m.has(e)}insertAfter(e,t,i){const a=this.#le,o=a.m.get(i);return!!o&&(la(a,e,t,o),!0)}insertBefore(e,t,i){const a=this.#le,o=a.m.get(i);return!!o&&(la(a,e,t,o.p),!0)}keyAt(e){for(;e<0;)e+=this.#le.l;for(let t=this.#le.n;t.i;e--,t=t.n)if(0===e)return t.k}keys(){return this.#le.m.keys()}position(e){const t=this.#le;let i=-1,a=t.m.get(e)??t;for(;a!==t;)a=a.p,i++;return i}reSet(e,t){const i=this.#le,a=i.m.get(e);a&&(i.m.delete(e),a.k=t,i.m.set(t,a))}reverse(){return ra(this.#le),this}set(e,t){const i=this.#le;return la(i,e,t,i.p),this}sort(e){return na(this.#le,e),this}*values(){for(const e of this.#le.m.values())yield e.i}*[Symbol.iterator](){yield*this.entries()}get[Symbol.species](){return pa}get[Symbol.toStringTag](){return"[object NodeMap]"}}const ma="http://www.w3.org/2000/svg",fa=e=>"data:image/svg+xml,"+encodeURIComponent('<svg xmlns="'+ma+'"'+(e instanceof SVGSVGElement?e.outerHTML.slice(4):e.outerHTML.slice(7,-7)+"svg>")),[ga,wa,va,ya,Ea,ka,Ma,Ta,ba,Oa,_a,Na,Aa,xa,La,Sa,Ia,Ca,Da,Ra,Pa,$a,Ha,Ua,Ga,Za,Wa,ja,Va,Fa,za,Ka,Ya,Ba,qa,Xa,Qa,Ja,eo,to,io,ao,oo,so,no,ro,lo,co,ho,uo,po,mo,fo,go,wo,vo,yo,Eo,ko,Mo,To,bo,Oo]="a animate animateMotion animateTransform circle clipPath defs desc ellipse feBlend feColorMatrix feComponentTransfer feComposite feConvolveMatrix feDiffuseLighting feDisplacementMap feDistantLight feDropShadow feFlood feFuncA feFuncB feFuncG feFuncR feGaussianBlur feImage feMerge feMergeNode feMorphology feOffset fePointLight feSpecularLighting feSpotLight feTile feTurbulence filter foreignObject g image line linearGradient marker mask metadata mpath path pattern polygon polyline radialGradient rect script set stop style svg switch symbol text textPath title tspan use view".split(" ").map((e=>m(ma,e))),_o={once:!0},No=new URL(window.location+""),Ao=(e,t={})=>new Promise(((i,a)=>{const o=new XMLHttpRequest;if(o.open(t.method??"GET",e),t.hasOwnProperty("headers")&&"object"==typeof t.headers)for(const[e,i]of Object.entries(t.headers))o.setRequestHeader(e,i);switch(void 0!==t.type&&o.setRequestHeader("Content-Type",t.type),(t.user||t.password)&&o.setRequestHeader("Authorization","Basic "+btoa(`${t.user??""}:${t.password??""}`)),o.addEventListener("readystatechange",(()=>{4===o.readyState&&(200===o.status?"json"===t.response&&t.checker&&!t.checker(o.response)?a(new TypeError("received JSON does not match expected format")):i("xh"===t.response?o:o.response):a(new Error(o.responseText)))})),t.onuploadprogress&&o.upload.addEventListener("progress",t.onuploadprogress),t.ondownloadprogress&&o.addEventListener("progress",t.ondownloadprogress),t.response){case"text":o.overrideMimeType("text/plain");break;case"xml":o.overrideMimeType("text/xml"),o.responseType="document";break;case"json":o.overrideMimeType("application/json");case"document":case"blob":case"arraybuffer":o.responseType=t.response}if(t.signal){const e=t.signal;e.addEventListener("abort",(()=>{o.abort(),a(e.reason instanceof Error?e.reason:new Error(e.reason))}),_o)}o.send(t.data??null)})),xo=e=>new Promise(((t,i)=>{const a=new Lo(e);a.addEventListener("open",(()=>{a.removeEventListener("error",i),t(a)}),_o),a.addEventListener("error",i,_o)}));class Lo extends WebSocket{constructor(e,t){super(new URL(e,No),t)}when(e,t){return new Ri(((e,t,i)=>{const a=this,o=new AbortController,s={signal:o.signal};a.addEventListener("message",e,s),a.addEventListener("error",(e=>t(e.error)),s),a.addEventListener("close",(e=>{const i=new Error(e.reason);i.name="CloseError",t(i),o.abort()}),s),i((()=>o.abort()))})).when(e,t)}}No.protocol="https"===No.protocol?"wss":"ws";const[So,Io,Co,Do,Ro,Po,$o,Ho,Uo,Go,Zo,Wo,jo,Vo,Fo,zo,Ko,Yo,Bo,qo,Xo,Qo]=U(22),Jo=U(4),es=new Ai("language",navigator.language),ts=(e,t={})=>{const i={};for(const t in e)i[t]=A("");return es.wait((a=>{const o=t[a];for(const t in e)i[t].value=o?.[t]??e[t]})),Object.freeze(i)},is=["en-GB","en-US"],as=ts({ARE_YOU_SURE:"Are you sure?",CANCEL:"Cancel",CHARACTER:"Character",CHARACTERS:"Characters",CHARACTER_CREATE:"Create Character",CHARACTER_DRAG_ICON:"Drag icon here",CHARACTER_EDIT:"Edit Character",CHARACTER_IMAGE:"Character Image",CHARACTER_NAME:"Character Name",CHARACTER_NEED_ICON:"A character needs an icon",CHARACTER_NEED_NAME:"A character needs a name",CHARACTER_NEW:"New Character",CLOSE:"Close",COLOUR:"Colour",COLOUR_ALPHA:"Alpha",COLOUR_UPDATE:"Update Colour",CONTEXT_DELETE:"Delete",CONTEXT_EDIT_TOKEN:"Edit Token Data",CONTEXT_FLIP:"Flip",CONTEXT_FLOP:"Flop",CONTEXT_MOVE_BOTTOM:"Move to Bottom",CONTEXT_MOVE_DOWN:"Move Down",CONTEXT_MOVE_LAYER:"Move to Layer",CONTEXT_MOVE_TOP:"Move to Top",CONTEXT_MOVE_UP:"Move Up",CONTEXT_SET_IMAGE:"Set as Image",CONTEXT_SET_LIGHTING:"Set Lighting",CONTEXT_SET_PATTERN:"Set as Pattern",CONTEXT_SNAP:"Snap",CONTEXT_UNSNAP:"Unsnap",CURRENT_LOCATION:"Current Location",ERROR:"Error",ERROR_UNKNOWN:"Unknown error occurred, connection closed",FILTER:"Filter",FILTER_CLEAR:"Clear Filter",FOLDER_ADD:"Add Folder",FOLDER_MOVE:"Move Folder",FOLDER_NAME:"Folder Name",FOLDER_REMOVE:"Remove Folder",FOLDER_REMOVE_CONFIRM:"Remove the following folder? NB: This will remove all folders and items it contains.",HELP:"Help",HELP_DEMO_DRAG:"The map can be moved around by left-click dragging it.",HELP_DEMO_SCROLL:"The map can also be moved around with the scroll wheel. Up & Down on the scroll wheel will move the map Up & Down, and holding the Shift key while scrolling will move the map Left & Right accordingly.",HELP_DEMO_SIDEPANEL_OPEN:"The Red outlined (Semi-)Circle can be used to toggle the display of the Sidepanel, where settings for the map are stored.",HELP_DEMO_SIDEPANEL_RESIZE:"When the Sidepanel is open, left-click dragging it will adjust the width of the sidebar.",HELP_DEMO_SIGNAL:"Right clicking on the map will produce a signal, an expanding circle, that both you and the GM are able to see.",HELP_DEMO_ZOOM:"The map can be zoomed In & Out by holding the Ctrl key on the keyboard and scrolling the mouse's scroll wheel Up & Down.",HELP_MAP_DRAG:"Map Moving",HELP_MAP_SCROLL:"Map Scrolling",HELP_MAP_SIGNAL:"Signalling",HELP_MAP_ZOOM:"Map Zoom",HELP_OPEN:"Press F1 anytime, or click here, to open Help",HELP_PANEL_OPEN:"Opening/Closing Side Panel",HELP_PANEL_RESIZE:"Resizing Side Panel",INVALID_ACTION:"Invalid Action",INVALID_REMOVE:"Cannot remove active map",INVALID_REMOVE_CONTAIN:"Cannot remove while containing active map",INVALID_RENAME:"Cannot rename active map",INVALID_RENAME_CONTAIN:"Cannot rename while containing active map",ITEM_COPY:"Copy Item",ITEM_COPY_ADD:"Copy Item",ITEM_COPY_NEW:"Copy To",ITEM_MOVE:"Move Item",ITEM_REMOVE:"Remove Item",ITEM_REMOVE_CONFIRM:"Remove the following item?",KEY_CENTRE_MAP:"Centre Map",KEY_HELP:"Help Key",KEY_LAYER_NEXT:"Next Layer Key",KEY_LAYER_PREV:"Previous Layer Key",KEY_PANEL_TOGGLE:"Toggle Panel Key",KEY_TOOL_NEXT:"Next Tool Key",KEY_TOOL_PREV:"Previous Tool Key",LAYER_ADD:"Add Layer",LAYER_GRID:"Grid",LAYER_LIGHT:"Light",LAYER_LIGHT_COLOUR:"Change Light Colour",LAYER_LIGHT_TOGGLE:"Toggle Light Display",LAYER_NAME:"Name",LAYER_RENAME:"Rename Layer",LAYER_TOGGLE_LOCK:"Toggle Layer Lock",LAYER_TOGGLE_VISIBILITY:"Toggle Visibility",LIGHTING_ADD_STAGE:"Add Light Stage",LIGHTING_ADD_TIMING:"Add Timing",LIGHTING_DRAG:"Drag Light Settings",LIGHTING_REMOVE_STAGE:"Remove Light Stage",LIGHTING_REMOVE_TIMING:"Remove Timing",LIGHTING_SET_COLOUR:"Set Lighting Colour",LIGHTING_STAGES:"Stages",LIGHTING_TIMING:"Light Timing (ms)",LOADING:"Loading\u2026",LOADING_MAP:"Loading Map",LOGIN:"Login",LOGOUT:"Logout",MAP_ADD:"Add Map",MAP_CHANGED:"Map Changed",MAP_CHANGED_LONG:"An error occurred because the map was changed",MAP_EDIT:"Edit Map",MAP_NAME:"Map Name",MAP_NEW:"New Map",MAP_NONE_SELECTED:"No Map Selected",MAP_SET_USER:"Set User Map",MAP_SQUARE_COLOUR:"Tile Line Colour",MAP_SQUARE_HEIGHT:"Height in Tiles",MAP_SQUARE_LINE:"Tile Line Width",MAP_SQUARE_SIZE:"Tile Size",MAP_SQUARE_TYPE:"Tile Type",MAP_SQUARE_TYPE_HEX_H:"Hexagon Tiles - Horizontal",MAP_SQUARE_TYPE_HEX_V:"Hexagon Tiles - Vertical",MAP_SQUARE_TYPE_SQUARE:"Square Tiles",MAP_SQUARE_WIDTH:"Width in Tiles",MAXIMISE:"Maximise",MINIMISE:"Minimise",MUSIC_ADD:"Add Music Pack",MUSIC_ADD_NAME:"Please enter a name for this new music pack",MUSIC_COPY:"Copy Music Pack",MUSIC_COPY_LONG:"Please enter a name for this music pack copy",MUSIC_DROP:"To add a track, drag an Audio Asset here",MUSIC_ENABLE:"Autoplay is disabled, please click here to enable",MUSIC_PAUSE:"Pause",MUSIC_PLAY:"Play",MUSIC_REMOVE:"Remove Music Pack",MUSIC_REMOVE_LONG:"Are you sure you wish to remove this music pack",MUSIC_RENAME:"Rename Music Pack",MUSIC_RENAME_LONG:"Please enter a new name for this music pack",MUSIC_STOP:"Stop",MUSIC_TRACK:"Track",MUSIC_TRACK_REMOVE:"Remove Music Track",MUSIC_TRACK_REMOVE_LONG:"Are you sure you wish to remove this track?",MUSIC_WINDOW_TITLE:"Music Pack",NAME:"Name",NEW_LOCATION:"New Location",OK:"Ok",OLD_LOCATION:"Old Location",PANEL_GRABBER:"Click to Show/Hide - Drag to Resize",PLUGINS:"Plugins",PLUGIN_REFRESH:"Refresh Page?",PLUGIN_REFRESH_REQUEST:"Plugin settings have change and a page refresh is required to load changes. Refresh the page now?",POPOUT:"Popout",RESTORE:"Restore",SAVE:"Save",SETTINGS_AUTH:"Authentication",SETTINGS_AUTOSNAP:"Autosnap",SETTINGS_CLEAR:"Clear Settings",SETTINGS_INVERT:"Invert Colours",SETTINGS_ENABLE_ANIMATION:"Enable Animations",SETTINGS_HIDE_MENU:"Hide Menu Button?",SETTINGS_KEYS:"Key Bindings",SETTINGS_KEYS_DELETE:"Delete Key Binding",SETTINGS_KEYS_NEW:"Enter New Key",SETTINGS_LANGUAGE:"Language",SETTINGS_LANGUAGE_SELECT:"Select Language",SETTINGS_LAYER_HIDDEN_OPACITY:"Hidden Layer Opacity",SETTINGS_LAYER_HIDDEN_SELECTED_OPACITY:"Selected Hidden Layer Opacity",SETTINGS_MAP:"Map Settings",SETTINGS_MEASURE_TOKEN_MOVE:"Automatically Measure Token Moves",SETTINGS_MINI_TOOLS:"Mini Tools Windows",SETTINGS_MUSIC_SORT:"Move Active Music Packs to Top",SETTINGS_PANEL_ON_TOP:"Show Side Panel above Windows",SETTINGS_RESET:"Reset",SETTINGS_RESET_CONFIRM:"Are you sure that you wish to clear all settings? This cannot be undone",SETTINGS_SCROLL_AMOUNT:"Scroll (zero is square width)",SETTINGS_TAB_ICONS:"Show Tab Icons",SETTINGS_THEME:"Theme & Layout",SETTINGS_UNDO_LIMIT:"Undo Limit (-1 for infinite, 0 to disable)",SETTINGS_ZOOM_SLIDER_HIDE:"Hide Zoom Slider",SHARE:"Share",TAB_AUDIO:"Audio",TAB_CHARACTERS:"Characters",TAB_IMAGES:"Images",TAB_LAYERS:"Layers",TAB_MAPS:"Maps",TAB_MUSIC_PACKS:"Music",TAB_SETTINGS:"Settings",TAB_TOOLS:"Tools",TITLE:"Battlemap",TOKEN:"Token",TOKEN_ADD:"Add Token",TOKEN_NEXT:"Next Token",TOKEN_NONE_SELECTED:"No token selected",TOKEN_ORDER:"Token Order",TOKEN_ORDER_NORMAL:"Normal",TOKEN_ORDER_SHUFFLE:"Shuffle",TOKEN_PREV:"Previous Token",TOKEN_REMOVE:"Remove Token?",TOKEN_REMOVE_CONFIRM:"Are you sure that you wish to remove this token?",TOKEN_REPLACE:"Replace Token?",TOKEN_REPLACE_CONFIRM:"Are you sure that you wish to replace the current token with the currently selected token?",TOKEN_SELECT:"Select Token",TOKEN_USE_SELECTED:"Use currently selected token",TOOL:"Tool",TOOL_DEFAULT:"Default",TOOL_DRAW:"Draw",TOOL_DRAW_ELLIPSE:"Ellipse",TOOL_DRAW_ERROR:"No Layer Selected",TOOL_DRAW_FILL_COLOUR:"Fill Colour",TOOL_DRAW_POLYGON:"Polygon",TOOL_DRAW_RECT:"Rectangle",TOOL_DRAW_SHAPE:"Draw Shape",TOOL_DRAW_SNAP:"Snap to Grid",TOOL_DRAW_STROKE_COLOUR:"Stroke Colour",TOOL_DRAW_STROKE_WIDTH:"Stroke Width",TOOL_MASK:"Mask Tool",TOOL_MASK_CLEAR:"Clear Mask",TOOL_MASK_CLEAR_CONFIRM:"Are you sure you wish to clear the mask?",TOOL_MASK_DRAW_SHAPE:"Draw Shape",TOOL_MASK_DRAW_TYPE:"Draw Type",TOOL_MASK_OPACITY:"Mask Opacity",TOOL_MASK_OPAQUE:"Opaque",TOOL_MASK_REMOVE:"Remove",TOOL_MASK_TRANSPARENT:"Transparent",TOOL_MEASURE:"Measuring Tool",TOOL_MEASURE_CELL:"Cell Distance",TOOL_MEASURE_DIAGONALS:"Measure Diagonals",TOOL_MEASURE_MULTI:"Multiple Measuring Points",TOOL_MEASURE_SNAP:"Snap to Grid",TOOL_MOVE:"Move All",TOOL_MULTIPLACE:"Multi-Place",TOOL_MULTIPLACE_MODE:"Grab Mode",TOOL_OPTIONS:"Options",TOOL_WALL:"Wall Tool",TOOL_WALL_COLOUR:"Wall Colour",TOOL_WALL_COLOUR_SET:"Set Wall Colour",TOOL_WALL_CONTINUOUS:"Continuous Placement",TOOL_WALL_LAYER:"Wall Layer",TOOL_WALL_MODE:"Wall Mode",TOOL_WALL_PLACE:"Place Wall",TOOL_WALL_SCATTER:"Wall Light Scattering",TOOL_WALL_SCATTER_SET:"Set Wall Light Scattering",TOOL_WALL_SELECT:"Select Wall",TOOL_WALL_SNAP:"Snap to Grid",TOOL_WALL_UNDERLAY:"Underlay Colour",UNDO_CHARACTER:"Character change",UNDO_LAYER_ADD:"Add Layer",UNDO_LAYER_FOLDER_ADD:"Add Layer Folder",UNDO_LAYER_HIDE:"Hide Layer",UNDO_LAYER_LOCK:"Lock Layer",UNDO_LAYER_MOVE:"Move Layer",UNDO_LAYER_RENAME:"Rename Layer",UNDO_LAYER_SHIFT:"Layer Shift",UNDO_LAYER_SHOW:"Show Layer",UNDO_LAYER_UNLOCK:"Unlock Layer",UNDO_LIGHT_COLOUR:"Map Light Colour",UNDO_MAP_CHANGE:"Map Settings Change",UNDO_MAP_DATA_REMOVE:"Map Data Remove",UNDO_MAP_DATA_SET:"Map Data Set",UNDO_MAP_LOAD:"Map Loaded",UNDO_MASK_ADD:"Mask Added",UNDO_MASK_REMOVE:"Mask Removed",UNDO_MASK_SET:"Mask Set",UNDO_REDO:"Redo",UNDO_TOKEN_ADD:"Token Add",UNDO_TOKEN_MOVE:"Token Move Layer/Position",UNDO_TOKEN_REMOVE:"Token Remove",UNDO_TOKEN_SET:"Token Update",UNDO_TOKEN_SET_MULTI:"Multi-Token Update",UNDO_UNDO:"Undo",UNDO_WALL_ADD:"Wall Add",UNDO_WALL_MODIFY:"Wall Modified",UNDO_WALL_MOVE:"Wall Move",UNDO_WALL_REMOVE:"Wall Remove",UNDO_WINDOW_REDOS:"Redo List",UNDO_WINDOW_TITLE:"Undo Debug",UNDO_WINDOW_UNDOS:"Undo List",UNSAVED_CHANGES:"There are unsaved changes, are you sure you wish to close?",UPLOAD_AUDIO:"Upload Sound",UPLOAD_IMAGES:"Upload Image",UPLOADING:"Uploading Files..."},{"en-US":{COLOUR:"Color",COLOUR_UPDATE:"Update Color",KEY_CENTRE_MAP:"Center Map",LAYER_LIGHT_COLOUR:"Change Light Color",LIGHTING_SET_COLOUR:"Set Lighting Color",MAP_SQUARE_COLOUR:"Tile Line Color",MAXIMISE:"Maximize",MINIMISE:"Minimize",SETTINGS_INVERT:"Invert Colors",TOOL_DRAW_FILL_COLOUR:"Fill Color",TOOL_DRAW_STROKE_COLOUR:"Stroke Color",TOOL_WALL_COLOUR:"Wall Color",TOOL_WALL_COLOUR_SET:"Set Wall Color",TOOL_WALL_UNDERLAY:"Underlay Color",UNDO_LIGHT_COLOUR:"Map Light Color"}}),os="complete"===document.readyState?Promise.resolve():new Promise((e=>window.addEventListener("load",e,{once:!0}))),ss=()=>{},ns=[ss,ss],rs=(e,t)=>{const i=new Set;return e.set(t,i),i};class ls{code;message;data;constructor(e,t,i){this.code=e,this.message=t,this.data=i,Object.freeze(this)}get name(){return"RPCError"}toString(){return this.message}}class cs{#ae;#R=0;#ce=new Map;#de=new Map;constructor(e){this.#he(e)}#he(e){(this.#ae=e).when((({data:e})=>{const t=JSON.parse(e),i="string"==typeof t.id?parseInt(t.id):t.id,a=t.error,o=+!!a,s=a?new ls(a.code,a.message,a.data):t.result;if(i>=0)(this.#ce.get(i)??ns)[o](s),this.#ce.delete(i);else for(const e of this.#de.get(i)??[])e[o](s)}),(e=>{this.close();for(const[,t]of this.#ce)t[1](e);for(const[,t]of this.#de)for(const i of t)i[1](e)}))}reconnect(e){this.#ae?.close(),this.#he(e)}request(e,t,i){const a=this.#ae;return a?new Promise(((o,s)=>{i??=t instanceof Function?t:void 0;const n=this.#R++;this.#ce.set(n,[e=>!i||i(e)?o(e):s(new TypeError("invalid type")),s]),a.send(JSON.stringify({id:n,method:e,params:t instanceof Function?void 0:t}))})):Promise.reject("RPC Closed")}await(e,t){const i=[ss,ss],a=this.#de,o=a.get(e)??rs(a,e),s=new Promise(((e,a)=>{i[0]=i=>!t||t(i)?e(i):a(new TypeError("invalid type")),i[1]=a,o.add(i)}));return s.finally((()=>o.delete(i))).catch((()=>{})),s}subscribe(e,t){return new Ri(((i,a,o)=>{const s=[e=>!t||t(e)?i(e):a(new TypeError("invalid type")),a],n=this.#de,r=n.get(e)??rs(n,e);r.add(s),o((()=>r.delete(s)))}))}close(){this.#ae?.close(),this.#ae=null}}const ds=H(),hs=wo({style:"width: 0"}),us=e=>{const t=H();return p(hs,p(e,{id:t})),[(e={})=>wo(e,[e.title instanceof O?Mo(e.title):[],bo({href:`#${t}`})]),fa(e)]},[ps,ms]=us(yo({viewBox:"0 0 34 37"},no({d:"M14,6 h-13 v30 h21 v-22 z v8 h8 M12,6 v-5 h13 l8,8 v22 h-11 m11,-22 h-8 v-8 M6,20 h11 m-11,5 h11 m-11,5 h11",stroke:"currentColor",fill:"none"}))),[fs,gs]=us(yo({viewBox:"0 0 37 28"},Qa({"stroke-width":2,stroke:"currentColor",fill:"none","stroke-linejoin":"round"},[no({d:"M32,27 h-30 v-20 h2 l5,-5 h5 l5,5 h13 v3"}),no({d:"M31,27 h1 v-20 h-30",style:"display: var(--folder-closed, block)"}),no({d:"M31,27 h1 l5,-16 h-30 l-5,16",style:"display: var(--folder-open, none)"})]))),[ws,vs]=us(yo({viewBox:"0 0 24 20"},no({d:"M1,4 h22 v15 h-22 Z m2,0 l3,-3 h5 l3,3 m3,2 v12 m-6,-6 h12",stroke:"currentColor",fill:"none","stroke-linejoin":"round"}))),[ys,Es]=us(yo({viewBox:"0 0 10 10"},no({d:"M1,1 v8 l8,-4 z",fill:"currentColor"}))),[ks,Ms]=us(yo({viewBox:"0 0 15 15"},no({d:"M7,1 H1 V14 H14 V8 M9,1 h5 v5 m0,-5 l-6,6","stroke-linejoin":"round",fill:"none",stroke:"currentColor"}))),[Ts,bs]=us(yo({viewBox:"0 0 32 34"},no({d:"M10,5 v-3 q0,-1 1,-1 h10 q1,0 1,1 v3 m8,0 h-28 q-1,0 -1,1 v2 q0,1 1,1 h28 q1,0 1,-1 v-2 q0,-1 -1,-1 m-2,4 v22 q0,2 -2,2 h-20 q-2,0 -2,-2 v-22 m2,3 v18 q0,1 1,1 h3 q1,0 1,-1 v-18 q0,-1 -1,-1 h-3 q-1,0 -1,1 m7.5,0 v18 q0,1 1,1 h3 q1,0 1,-1 v-18 q0,-1 -1,-1 h-3 q-1,0 -1,1 m7.5,0 v18 q0,1 1,1 h3 q1,0 1,-1 v-18 q0,-1 -1,-1 h-3 q-1,0 -1,1",stroke:"currentColor",fill:"none"}))),[Os,_s]=us(yo({viewBox:"0 0 30 20"},no({d:"M1,5 v10 h28 v-10 Z M17,1 h10 m-5,0 V19 m-5,0 h10",stroke:"currentColor","stroke-linejoin":"round",fill:"none"}))),[Ns,As]=us(yo({viewBox:"0 0 10 10"},Ea({cx:5,cy:5,r:4,"stroke-width":2,stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-dasharray":"12 12"},ya({attributeName:"transform",type:"rotate",from:"0 5 5",to:"360 5 5",dur:"2s",repeatCount:"indefinite"})))),[xs,Ls]=us(yo({viewBox:"0 0 90 90"},no({d:"M75,15 c-15,-15 -45,-15 -60,0 c-15,15 -15,45 0,60 c15,15 45,15 60,0 c15,-15 15,-45 0,-60 z M25,25 v40 h40 v-40 z",fill:"currentColor",stroke:"none","fill-rule":"evenodd"}))),[Ss,Is]=us(yo({viewBox:"0 0 47 47"},[uo({width:47,height:47,fill:"#eee"}),Qa({style:"display: var(--map-selected, none)"},[uo({width:47,height:47,fill:"#cfc"}),no({d:"M3,17 H11 V27 H35 V17 H43 V40 H3 M14,6 H32 V24 H14"})])])),[Cs,Ds]=us(yo({viewBox:"0 0 47 47"},[no({d:"M3,17 H11 V27 H35 V17 H43 V40 H3 M14,6 H32 V24 H14",fill:"currentColor"}),Qa({"stroke-width":6},[no({d:"M10,30 L20,47 L47,0",stroke:"#0f0",fill:"none",style:"display: var(--check-on, block)"}),no({d:"M10,47 L47,0 M10,0 L47,47",stroke:"#f00",fill:"none",style:"display: var(--check-off, none)"})])])),[Rs,Ps]=us(yo({viewBox:"0 0 100 70"},[ba({cx:50,cy:35,rx:49,ry:34,"stroke-width":2,stroke:"#000",fill:"#fff"}),Qa({style:"display: var(--invisible, block)"},[Ea({cx:50,cy:35,r:27,stroke:"#888","stroke-width":10}),Ea({cx:59,cy:27,r:10,fill:"#fff"})])])),[$s,Hs]=us(yo({viewBox:"0 0 44 75",stroke:"currentColor",fill:"none","stroke-linejoin":"round","stroke-linecap":"round"},[no({d:"M12,61 c0,-20 -30,-58 10,-60 c40,2 10,40 10,60 q-10,3 -20,0 Z","stroke-width":2,style:"fill: var(--off, #fff)"}),no({id:ds,d:"M12,61 q-2,2 0,4 q10,3 20,0 q2,-2 0,-4"}),bo({href:`#${ds}`,y:4}),bo({href:`#${ds}`,y:8})])),[Us,Gs]=us(yo({viewBox:"0 0 33 33"},[no({d:"M11,0 V33 M22,0 V33 M0,11 H33 M0,22 H33",stroke:"#000"}),["#800","#880","#808","#880","#080","#088","#088","#808","#008"].map(((e,t)=>uo({x:11*(t/3|0)+2,y:t%3*11+2,width:7,height:7,fill:e})))])),[Zs,Ws]=us(yo({viewBox:"0 0 20 20"},[Ea({cx:3,cy:10,r:3}),Ea({cx:17,cy:3,r:3}),Ea({cx:17,cy:17,r:3}),no({d:"M17,3 L3,10 17,17",stroke:"#000",fill:"none"})])),[js,Vs]=us(yo({viewBox:"0 0 70 100",style:"stroke: currentColor","stroke-width":2,"stroke-linejoin":"round"},[no({d:"M15,45 v-20 a1,1 0,0,1 40,0 a1,1 0,0,1 -10,0 a1,1 0,0,0 -20,0 v20 z",fill:"#ccc",style:"display: var(--unlocked, block)"}),no({d:"M15,45 v-20 a1,1 0,0,1 40,0 v20 h-10 v-20 a1,1 0,0,0 -20,0 v20 z",fill:"#ccc",style:"display: var(--locked, none)"}),uo({x:5,y:45,width:60,height:50,fill:"#aaa","stroke-width":4,rx:10}),no({d:"M30,78 l2,-8 c-7,-12 13,-12 6,0 l2,8 z",fill:"#666",stroke:"#000","stroke-linejoin":"round"})])),[Fs,zs]=us(yo({viewBox:"0 0 73 50"},[no({d:"M5,0 H45 s5,0 10,5 L70,20 s5,5 0,10 L55,45 s-5,5 -10,5 H5 s-5,0 -5,-5 V5 s0,-5 5,-5 z",fill:"#000"}),no({d:"M15,10 l30,30 M15,40 l30,-30",stroke:"#fff","stroke-width":8,"stroke-linecap":"round"})])),Ks=function(e){if("Enter"===e.key)for(let e=this.nextSibling;e;e=e.nextSibling)if(e instanceof HTMLButtonElement){e.click();break}},[Ys,Bs]=(new Ci).bind(3),qs=(e,t,i={})=>{const a={id:i.for=H()};return e instanceof HTMLInputElement||e instanceof HTMLButtonElement||e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement?[p(e,a),ut(i,t)]:[ut(i,e),p(t,a)]},Xs=(()=>{const e=new Map,t=i=>{if(i instanceof Object&&!Object.isFrozen(i)){const a=e.get(i);if(a)return a;if(Array.isArray(i)){const a=[];e.set(i,a);for(const e of i)a.push(t(e));return a}const o={};e.set(i,o);for(const e in i)i.hasOwnProperty(e)&&(o[e]=t(i[e]));return o}return i};return i=>{const a=t(i);return e.clear(),a}})(),Qs=new Map,[Js,en]=(()=>{const e=Symbol("tokens");return[t=>{let i=t[e];if(void 0===i||0===i.length){const a=t["store-image-data"];if(a){if(!(a.data instanceof Array))return Xs(a.data);if(t[e]=i=Array.from(a.data),t?.tokens_order?.data)for(let e=i.length-1;e>=0;e--){const t=Math.floor(Math.random()*i.length);[i[e],i[t]]=[i[t],i[e]]}else i.reverse()}}const a=i?.pop();return a?Xs(a):null},t=>delete t[e]]})(),tn=new Map,an=()=>[qe(as.LOADING),Ns({style:"width: 64px"})],on=[],sn={CANCEL:"Cancel",CLOSE:"Close",MAXIMISE:"Maximise",MINIMISE:"Minimise",OK:"Ok",RESTORE:"Restore"},nn=[(new x).add({":host":{display:"block",position:"relative",overflow:"hidden",width:"var(--shell-width, 100%)",height:"var(--shell-height, 100%)"},"::slotted(windows-window)":{"--taskmanager-on":"none"},"::slotted(windows-window:last-of-type)":{"--overlay-on":"none"}})],rn=[(new x).add(":host",{position:"absolute",top:0,left:0,bottom:0,right:0})],ln=[(new x).add(":host",{position:"absolute",display:"block","background-color":"#fff",color:"#000",border:"1px solid #000",width:"var(--window-width, auto)",height:"var(--window-height, auto)","min-width":"100px","min-height":"100px",top:"var(--window-top, 0)",left:"var(--window-left, 0)","list-style":"none",padding:0,"z-index":0,"([maximised])":{left:0,right:0,top:0,bottom:0,width:"auto",height:"auto",">div:nth-child(2)>div>button:nth-of-type(2)":{"background-image":`url('data:image/svg+xml,%3Csvg viewBox="0 0 15 13" xmlns="${ma}"%3E%3Cpath d="M1,5 h8 v-1 h-8 v8 h8 v-8 m-3,0 v-3 h8 v8 h-5 m5,-7 h-8" stroke="%23000" fill="none" /%3E%3C/svg%3E')`}},"([resizable])":{"border-width":0,">div":{":nth-child(1)":{display:"block"},":nth-child(3)":{overflow:"auto",position:"absolute",bottom:0,left:0,right:0,top:"calc(1em + 6px)"},":nth-child(4)":{top:"var(calc(--window-resize), -2px)",left:"var(calc(--window-resize), -2px)",bottom:"var(calc(--window-resize), -2px)",right:"var(calc(--window-resize), -2px)"}}},">div":{":nth-child(1)>div":{position:"absolute","border-color":"currentColor","border-style":"solid","border-width":0,"z-index":-1,":nth-child(1)":{top:"-2px",left:"-2px",width:"10px",height:"10px",cursor:"nwse-resize","border-left-width":"3px","border-top-width":"3px"},":nth-child(2)":{top:"-2px",left:"8px",right:"8px","border-top-width":"3px",cursor:"ns-resize"},":nth-child(3)":{top:"-2px",right:"-2px",width:"10px",height:"10px","border-top-width":"3px","border-right-width":"3px",cursor:"nesw-resize"},":nth-child(4)":{top:"8px",right:"-2px",bottom:"8px","border-right-width":"3px",cursor:"ew-resize"},":nth-child(5)":{bottom:"-2px",right:"-2px",width:"10px",height:"10px","border-right-width":"3px","border-bottom-width":"3px",cursor:"nwse-resize"},":nth-child(6)":{bottom:"-2px",left:"8px",right:"8px","border-bottom-width":"3px",cursor:"ns-resize"},":nth-child(7)":{bottom:"-2px",left:"-2px",width:"10px",height:"10px","border-left-width":"3px","border-bottom-width":"3px",cursor:"nesw-resize"},":nth-child(8)":{top:"8px",left:"-2px",bottom:"8px","border-left-width":"3px",cursor:"ew-resize"}},":nth-child(2)":{"white-space":"nowrap",height:"calc(1em + 6px)","background-color":"#aaa",overflow:"hidden","user-select":"none",display:"flex","align-items":"center",">span":{"margin-right":"calc(3em + 24px)"},">img":{height:"1em","pointer-events":"none"},">div":{position:"absolute",right:0,top:0,">button":{":nth-of-type(1)":{"background-image":`url('data:image/svg+xml,%3Csvg viewBox="0 0 10 10" xmlns="${ma}"%3E%3Cpath d="M1,1 L9,9 M9,1 L1,9" stroke="black" /%3E%3C/svg%3E')`},":nth-of-type(2)":{"background-image":`url('data:image/svg+xml,%3Csvg viewBox="0 0 10 10" xmlns="${ma}"%3E%3Cpath d="M9,3 h-8 v-1 h8 v-1 h-8 v8 h8 v-8" stroke="black" fill="none" /%3E%3C/svg%3E')`},":nth-of-type(3)":{display:"var(--taskmanager-on, block)","background-image":`url('data:image/svg+xml,%3Csvg viewBox="0 0 10 10" xmlns="${ma}"%3E%3Cline x1="1" y1="9" x2="9" y2="9" stroke="black" /%3E%3C/svg%3E')`}}}," button":{padding:0,"border-width":"2px",float:"right","background-repeat":"no-repeat","background-position":"center","background-color":"#eee","background-size":"1em 1em",width:"calc(1em + 8px)",height:"calc(1em + 8px)"}},":nth-child(3)":{"user-select":"contain",":not(.hasChild)+div:nth-child(5)":{"pointer-events":"none"}},":nth-child(4)":{display:"var(--overlay-on, block)",position:"absolute","background-color":"RGBA(0, 0, 0, 0.1)",top:0,left:0,bottom:0,right:0,"pointer-events":"none"}},"([minimised]),>div:nth-child(1),([hide-titlebar])>div:nth-child(2),([hide-close])>div:nth-child(2)>div>button:nth-of-type(1),([hide-maximise])>div:nth-child(2)>div>button:nth-of-type(2),([hide-minimise])>div:nth-child(2)>div>button:nth-of-type(3),([window-hide])>div:nth-child(2)>div>button:nth-of-type(3)":{display:"none"}})];let cn=null,dn=!1;class hn extends HTMLElement{alert(e,t,i){return new Promise(((a,o)=>{const s=wn({"window-hide":!0,"window-icon":i,"window-title":e,"hide-maximise":!0,onremove:()=>a(!1)},[Ue(t),Ue({style:"text-align: center"},ki(Oe({onclick:()=>{a(!0),s.remove()}},sn.OK)))]);this.addWindow(s)||o(new Error("invalid target"))}))}confirm(e,t,i){return new Promise(((a,o)=>{const s=wn({"window-hide":!0,"window-icon":i,"window-title":e,"hide-maximise":!0,onremove:()=>a(!1)},[Ue(t),Ue({style:"text-align: center"},[ki(Oe({onclick:()=>{a(!0),s.remove()}},sn.OK)),Oe({onclick:()=>s.remove()},sn.CANCEL)])]);this.addWindow(s)||o(new Error("invalid target"))}))}prompt(e,t,i="",a){return new Promise(((o,s)=>{const n=()=>{o(r.value),l.remove()},r=ki(ct({value:i,onkeydown:e=>{switch(e.key){case"Enter":n();break;case"Escape":l.remove()}}})),l=wn({"window-hide":!0,"window-icon":a,"window-title":e,"hide-maximise":!0,onremove:()=>o(null)},[Ue(t),r,Ue({style:"text-align: center"},Oe({onclick:n},sn.OK))]);this.addWindow(l)||s(new Error("invalid target"))}))}}class un extends hn{constructor(){super(),new.target===un&&(p(this.attachShadow({mode:"closed"}),[Wt({name:"desktop"}),Ue(Wt())]).adoptedStyleSheets=nn)}addWindow(e){return e.parentNode!==this?p(this,e):e.nextElementSibling&&e.focus(),!0}realignWindows(){const{offsetWidth:e,offsetHeight:t}=this;for(const i of this.childNodes)if(i instanceof mn){const{offsetLeft:a,offsetTop:o,offsetWidth:s,offsetHeight:n}=i;a+s>e?p(i,{style:{"--window-left":Math.max(e-s,0)+"px"}}):a<0&&p(i,{style:{"--window-left":"0px"}}),o+n>t?p(i,{style:{"--window-top":Math.max(t-n)+"px"}}):o<0&&p(i,{style:{"--window-top":"0px"}})}}}class pn extends HTMLElement{constructor(){super(),setTimeout(p,0,this,{slot:"desktop"}),p(this.attachShadow({mode:"closed"}),Wt({slot:"desktop"})).adoptedStyleSheets=rn}attributeChangedCallback(e,t,i){"slot"===e&&"desktop"!==i&&p(this,{slot:"desktop"})}static get observedAttributes(){return["slot"]}}class mn extends hn{#ue;#pe;#n;#me;#fe=null;#ge=null;#we;constructor(){super();const e=()=>this.focus();p(this.attachShadow({mode:"closed"}),{onclick:y(e,g)},[Ue(Array.from({length:8},((e,t)=>Ue({onmousedown:e=>((e,t,i)=>{const a=e.parentNode;if(dn||!(a instanceof un)||0!==i.button)return;dn=!0,p(a,{style:{"user-select":"none"}});const o=e.offsetLeft,s=e.offsetTop,n=e.offsetWidth,r=e.offsetHeight,l=i.clientX,c=i.clientY,d=new AbortController,{signal:h}=d;p(a,{onmousemove:y((i=>{const a=i.clientX-l,d=i.clientY-c;switch(t){case 0:case 1:case 2:{const t=r-d;t>(parseInt(e.style.getPropertyValue("min-height")||"")||100)&&p(e,{style:{"--window-top":`${s+d}px`,"--window-height":`${t}px`}})}break;case 4:case 5:case 6:{const t=r+d;t>(parseInt(e.style.getPropertyValue("min-height")||"")||100)&&p(e,{style:{"--window-height":`${t}px`}})}}switch(t){case 2:case 3:case 4:{const t=n+a;t>(parseInt(e.style.getPropertyValue("min-width")||"")||100)&&p(e,{style:{"--window-width":`${t}px`}})}break;case 0:case 7:case 6:{const t=n-a;t>(parseInt(e.style.getPropertyValue("min-width")||"")||100)&&p(e,{style:{"--window-left":`${o+a}px`,"--window-width":`${t}px`}})}}}),0,h),onmouseup:y((t=>{0===t.button&&(p(a,{style:{"user-select":void 0}}),d.abort(),dn=!1,e.dispatchEvent(new CustomEvent("resized")))}),0,h)})})(this,t,e)})))),Ue({part:"titlebar",onmousedown:e=>((e,t)=>{if(t.target instanceof HTMLButtonElement)return;const i=e.parentNode;if(dn||!(i instanceof un)||0!==t.button)return;dn=!0,p(i,{style:{"user-select":"none"}});const a=t.clientX-e.offsetLeft,o=t.clientY-e.offsetTop,s=new AbortController,{signal:n}=s;p(i,{onmousemove:y((t=>{const s=parseInt(i.getAttribute("snap")||"0"),{offsetLeft:n,offsetTop:r,offsetWidth:l,offsetHeight:c}=e,d=n+l,h=r+c,u=t.clientX-a,m=t.clientY-o,f=u+l,g=m+c;let w=0,v=0;if(s>0){n>=0&&u<0&&u>=-s?w=-u:d<=i.offsetWidth&&f>i.offsetWidth&&f<=i.offsetWidth+s&&(w=i.offsetWidth-f),r>=0&&m<0&&m>=-s?v=-m:h<=i.offsetHeight&&g>i.offsetHeight&&g<=i.offsetHeight+s&&(v=i.offsetHeight-g);for(const t of i.childNodes)if(t instanceof mn&&t!==e){const e=t.offsetLeft,i=t.offsetTop,a=e+t.offsetWidth,o=i+t.offsetHeight;m<=o&&g>=i&&(d<=e&&f>=e&&f<=e+s?w=e-f:n>=a&&u<=a&&u>=a-s&&(w=a-u)),u<=a&&f>=e&&(h<=i&&g>=i&&g<=i+s?v=i-g:r>=o&&m<=o&&m>=o-s&&(v=o-m))}}p(e,{style:{"--window-left":u+w+"px","--window-top":m+v+"px"}})}),0,n),onmouseup:y((t=>{0===t.button&&(p(i,{style:{"user-select":void 0}}),s.abort(),dn=!1,e.dispatchEvent(new CustomEvent("moved")))}),0,n)})})(this,e),ondblclick:e=>{e.target instanceof HTMLButtonElement||this.hasAttribute("hide-maximise")||this.toggleAttribute("maximised")}},[this.#pe=lt({part:"icon",src:En}),this.#ue=Ft({part:"title"}),Ue({part:"controls"},[Oe({part:"close",title:sn.CLOSE,onclick:()=>this.close()}),this.#we=Oe({part:"maximise",title:sn.MAXIMISE,onclick:()=>this.toggleAttribute("maximised")}),Oe({part:"minimise",title:sn.MINIMISE,onclick:()=>this.toggleAttribute("minimised")}),this.#n=Ft()])]),this.#me=Ue(Wt()),Ue()]).adoptedStyleSheets=ln,setTimeout(p,0,this,{onmousedown:y(e,g)})}connectedCallback(){cn===this&&(cn=null)}disconnectedCallback(){if(cn===this)return;const e=this.#ge,t=this.#fe;e&&(p(e.#me,{class:["!hasChild"]}),e.#fe=null,this.#ge=null),t&&(t.remove(),this.#fe=null),this.dispatchEvent(new CustomEvent("remove"))}attributeChangedCallback(e,t,i){switch(e){case"window-title":k(this.#ue,{title:i??""},i??"");break;case"window-icon":p(this.#pe,{src:i??En});break;case"maximised":p(this.#we,{title:null===i?sn.MAXIMISE:sn.RESTORE})}}static get observedAttributes(){return["maximised","window-icon","window-title"]}addWindow(e){return!!this.parentNode&&(this.#fe?(this.#fe.addWindow(e),!0):(this.#fe=e,e.#ge=this,p(this.#me,{class:["hasChild"]}),p(this.parentNode,e),!0))}addControlButton(e,t,i){const a=Oe({style:{"background-image":`url(${JSON.stringify(e)})`},onclick:()=>t.call(this),title:i});return p(this.#n,a),()=>a.remove()}focus(){this.toggleAttribute("minimised",!1);const e=this.#fe;if(e)e.focus();else{if(this.parentNode&&this.nextElementSibling){cn=this;const e=[],t=document.createNodeIterator(this,NodeFilter.SHOW_ELEMENT);for(let i=this.#me;i;i=t.nextNode()){const{scrollTop:t,scrollLeft:a}=i;(t||a)&&e.push([i,t,a])}p(this.parentNode,this);for(const[t,i,a]of e)t.scrollTop=i,t.scrollLeft=a}this.contains(document.activeElement)||super.focus()}}close(){if(this.#fe)this.#fe.focus();else if(this.dispatchEvent(new CustomEvent("close",{cancelable:!0})))return this.remove(),!0;return!1}}customElements.define("windows-shell",un),customElements.define("windows-desktop",pn),customElements.define("windows-window",mn);const fn=m(de,"windows-shell"),gn=m(de,"windows-desktop"),wn=m(de,"windows-window"),vn=e=>En=e,yn=e=>{Object.assign(sn,e)};let En=`data:image/svg+xml,%3Csvg viewBox="0 0 14 18" xmlns="${ma}"%3E%3Cpath d="M9,1 h-8 v16 h12 v-12 Z v4 h4" stroke="black" fill="none" /%3E%3Cpath d="M3,8 h8 m-8,3 h8 m-8,3 h8" stroke="gray" /%3E%3C/svg%3E`;const kn={attributeFilter:["window-icon","window-title","minimised"],attributes:!0},Mn={attributeFilter:["maximised"],attributes:!0},Tn=[(new x).add({":host":{display:"block",position:"relative",overflow:"hidden",width:"var(--shell-width, 100%)",height:"var(--shell-height, 100%)",">footer":{display:"flex",position:"absolute","grid-gap":"5px","flex-wrap":"wrap-reverse",width:"100%",bottom:0,left:0,"pointer-events":"none",">div":{width:"200px",position:"relative",">windows-window":{"min-height":"auto",position:"relative","pointer-events":"auto","--overlay-on":"none",":not([maximised])":{"pointer-events":"none",visibility:"hidden"}}}}},"::slotted(windows-window:last-of-type)":{"--overlay-on":"none"}})];class bn extends un{constructor(){super();let e=!1;const t=new Map,i=new Map,a=new MutationObserver((e=>e.forEach((({target:e,type:t,attributeName:a})=>{"attributes"===t&&"maximised"===a&&e instanceof mn&&!e.hasAttribute("maximised")&&p(i.get(e),{minimised:!1}).focus()})))),o=new MutationObserver((e=>e.forEach((({target:e,type:o,attributeName:n})=>{if("attributes"!==o||!(e instanceof mn))return;const r=t.get(e);switch(n){case"window-icon":r.item&&p(r.item.firstChild,{"window-icon":e.getAttribute("window-icon")??void 0});break;case"window-title":r.item&&p(r.item.firstChild,{"window-title":e.getAttribute("window-title")||""});break;case"minimised":if(!e.hasAttribute("minimised"))return void p(r.item?.firstChild,{maximised:!1});if(r.item)return void p(r.item.firstChild,{maximised:!0});for(const e of s.children)if(0===e.childElementCount&&e instanceof HTMLDivElement){r.item=e;break}r.item||p(s,r.item=Ue());const t=wn({"window-icon":e.getAttribute("window-icon")??void 0,"window-title":e.getAttribute("window-title")??void 0,"hide-minimise":!0,maximised:!0,exportparts:"close, minimise, maximise, titlebar, title, controls, icon",onclose:t=>{t.preventDefault(),e.close()},onremove:()=>i.delete(t)});i.set(t,e),p(r.item,t),a.observe(t,Mn),p(e,{onremove:y((()=>t.remove()),f)})}})))),s=Ke();p(this.attachShadow({mode:"closed"}),[Wt({name:"desktop"}),s,Ue(Wt({onslotchange:function(){e=!e;for(const i of this.assignedElements()){if(!(i instanceof mn))return;t.has(i)?t.get(i).state=e:i.hasAttribute("window-hide")||(o.observe(i,kn),t.set(i,{item:null,state:e}))}for(const[i,a]of t.entries())a.state!==e&&(a.item&&k(a.item),t.delete(i))}}))]).adoptedStyleSheets=Tn}}customElements.define("windows-shell-taskmanager",bn);const On=m(de,"windows-shell-taskmanager");yn(Object.fromEntries(["CANCEL","CLOSE","MAXIMISE","MINIMISE","OK","RESTORE"].map((e=>[e,as[e]])))),vn(document.getElementsByTagName("link")[0]?.getAttribute("href")??En);const _n={"hide-maximise":!0,"hide-minimise":!0,tabindex:-1,onkeydown:function(e){"Escape"!==e.key||this.hasAttribute("hide-close")||ce("Escape")||this.close()}},Nn={style:{visibility:"hidden"}},An={style:{visibility:void 0}},xn=(e,t,i=as.LOADING,a)=>{const o=wn({"window-title":i,"hide-minimise":!0},a||an());return t.addWindow(o),e.finally((()=>o.remove()))},Ln=(e,t)=>{const i=p(wn(_n),e,t),a=i.getAttribute("window-data");if(a){const e=new xi(a,Cn(i),Dn),t=()=>e.set(Cn(i));p(i,{style:{"--window-left":e.value[0]+"px","--window-top":e.value[1]+"px","--window-width":e.value[2]+"px","--window-height":e.value[3]+"px"},onmoved:t,onresized:t})}else i.style.getPropertyValue("--window-width")||i.style.getPropertyValue("--window-height")||(p(i,Nn),setTimeout((()=>{if(i.parentNode===In){const{offsetWidth:e,offsetHeight:t}=i,{offsetWidth:a,offsetHeight:o}=In;p(i,{style:{"--window-width":e+"px","--window-height":t+"px","--window-left":(a-e)/2+"px","--window-top":(o-t)/2+"px"}})}p(i,An),i.focus()})));return i},Sn=gn(),In=On({snap:50},Sn),Cn=e=>[parseInt(e.style.getPropertyValue("--window-left")||"0"),parseInt(e.style.getPropertyValue("--window-top")||"0"),parseInt(e.style.getPropertyValue("--window-width")||"200"),parseInt(e.style.getPropertyValue("--window-height")||"600")],Dn=e=>e instanceof Array&&4===e.length&&mi(e[0])&&mi(e[1])&&mi(e[2],0)&&mi(e[3],0);class Rn{r=0;g=0;b=0;a=255;constructor(e,t,i,a=255){return this.r=fi(e,0,255),this.g=fi(t,0,255),this.b=fi(i,0,255),this.a=fi(a,0,255),Object.freeze(this)}static from(e){return e instanceof Rn?e:Object.freeze(Object.setPrototypeOf(e,Rn.prototype))}toString(){return`rgba(${this.r}, ${this.g}, ${this.b}, ${this.a/255})`}toHexString(){return`#${Math.round(this.r).toString(16).padStart(2,"0")}${Math.round(this.g).toString(16).padStart(2,"0")}${Math.round(this.b).toString(16).padStart(2,"0")}`}}class Pn extends xi{constructor(e,t){super(e,t,(e=>!!(e instanceof Object&&mi(e.r,0,255)&&mi(e.g,0,255)&&mi(e.b,0,255)&&mi(e.a,0,255))&&(Rn.from(e),!0)))}}const $n=(e,t=255)=>new Rn(fi(parseInt(e.slice(1,3),16),0,255),fi(parseInt(e.slice(3,5),16),0,255),fi(parseInt(e.slice(5,7),16),0,255),t),Hn=new Rn(0,0,0,0),Un=(e,t,i=Hn,a)=>new Promise(((o,s)=>{const n=Zn.register((()=>$n(c.value,fi(parseInt(d.value),0,255,255)))),r=Ue({style:`background-color: ${i}`,draggable:"true",ondragstart:e=>Zn.set(e,n,Wn),ondragover:jn,ondrop:e=>{if(Zn.is(e)){const t=Zn.get(e);c.value=t.toHexString(),d.value=t.a+"",p(r,{style:{"background-color":t}})}}}),l=()=>p(r,{style:{"background-color":$n(c.value,fi(parseInt(d.value),0,255,255))}}),c=ct({type:"color",value:i.toHexString(),onchange:l}),d=ct({type:"range",min:0,max:255,step:1,value:i.a,oninput:l}),h=Ln({"window-icon":a,"window-title":t,onremove:()=>{Zn.deregister(n),s()}},[Be(t),Ue({class:Vn},r),qs([as.COLOUR,": "],c),be(),qs([as.COLOUR_ALPHA,": "],d),be(),Oe({onclick:function(){p(this,{disabled:!0}),o($n(c.value,fi(parseInt(d.value),0,255,255))),h.remove()}},as.COLOUR_UPDATE)]);(e.parentNode?e:In).addWindow(h)})),Gn=(()=>{const e=(e,t)=>(p(e,{style:{"background-color":t}}),t);return(t,i,a,o,s)=>{let n=!1;const r=Zn.register(a),l=Ue({draggable:"true",ondragstart:e=>Zn.set(e,r,Wn)}),c=Oe({class:[Vn,Fn],onclick:()=>{n||(n=!0,Un(t??In,i,a(),s).then((t=>o(e(l,t)))).finally((()=>n=!1)))},ondragover:jn,ondrop:t=>{Zn.is(t)&&o(e(l,Zn.get(t)))}},l);return e(l,a()),c}})(),Zn=new Li("colour"),Wn=lt({src:'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30"%3E%3Cstyle type="text/css"%3Esvg%7Bbackground-color:%23000%7Dcircle%7Bmix-blend-mode:screen%7D%3C/style%3E%3Ccircle r="10" cx="10" cy="10" fill="%23f00" /%3E%3Ccircle r="10" cx="20" cy="10" fill="%230f0" /%3E%3Ccircle r="10" cx="15" cy="20" fill="%2300f" /%3E%3C/svg%3E%0A'}),jn=Ii({copy:[Zn]}),[Vn,Fn]=U(2);P({[`.${Vn}`]:{"background-color":"#ccc","background-image":'url(\'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="20" height="20"%3E%3Cpath d="M0,0H10V20H20V10H0Z" fill="gray" /%3E%3C/svg%3E\')',width:"200px",height:"200px"," div":{width:"200px",height:"200px"}},[`.${Fn}`]:{display:"inline-block",width:"50px",height:"50px",padding:0," div":{width:"100%",height:"100%"}}});let zn,Kn,Yn=0;const Bn={images:{},audio:{},characters:{},maps:{}},qn={images:{},audio:{},characters:{},maps:{}},Xn={images:{},audio:{},characters:{},maps:{}},Qn=e=>ar.push(e),Jn=e=>sr.push(e),er=e=>or.push(e),tr=e=>{console.log(e),In.alert(as.ERROR,(e instanceof Error?e.message:Object.getPrototypeOf(e)===Object.prototype?JSON.stringify(e):e.toString())||as.ERROR_UNKNOWN)},ir=os.then((()=>xo("/socket").then((e=>{const t=new cs(e),i={"":()=>{},"!":e=>e[0],"*":(e,t)=>Object.fromEntries(t.map(((t,i)=>[t,e[i]])))},a={"":[["waitCurrentUserMap",-2,cr],["waitCurrentUserMapData",-3,pl],["waitMapDataSet",-4,Pr],["waitMapDataRemove",-5,ur],["waitCharacterDataChange",-36,jr],["waitMapChange",-35,Fr],["waitMapStartChange",-6,hl],["waitLayerAdd",-37,ur],["waitLayerFolderAdd",-38,ur],["waitLayerMove",-39,Lr],["waitLayerRename",-40,Ir],["waitLayerRemove",-41,ur],["waitGridDistanceChange",-42,cr],["waitGridDiagonalChange",-43,pr],["waitMapLightChange",-44,wr],["waitLayerShow",-45,ur],["waitLayerHide",-46,ur],["waitLayerLock",-47,ur],["waitLayerUnlock",-48,ur],["waitMaskAdd",-49,Vl],["waitMaskRemove",-50,cr],["waitMaskSet",-51,dl],["waitTokenAdd",-52,ol],["waitTokenRemove",-53,cr],["waitTokenMoveLayerPos",-54,Kr],["waitTokenSet",-55,Br],["waitTokenSetMulti",-56,qr],["waitLayerShift",-57,fl],["waitWallAdded",-58,yl],["waitWallRemoved",-59,cr],["waitWallModified",-60,wl],["waitWallMoved",-61,br],["waitMusicPackAdd",-62,kr],["waitMusicPackRename",-63,kr],["waitMusicPackRemove",-64,cr],["waitMusicPackCopy",-65,Hl],["waitMusicPackVolume",-66,_l],["waitMusicPackPlay",-67,Al],["waitMusicPackStop",-68,cr],["waitMusicPackStopAll",-69,nr],["waitMusicPackTrackAdd",-70,Ll],["waitMusicPackTrackRemove",-71,Il],["waitMusicPackTrackVolume",-72,Dl],["waitMusicPackTrackRepeat",-73,Pl],["waitPluginChange",-74,nr],["waitPluginSetting",-75,Zl],["waitSignalMeasure",-77,Wl],["waitSignalPosition",-78,jl],["waitSignalMovePosition",-79,jl],["waitBroadcastWindow",-76,zl],["waitBroadcast",-80,Kl]],images:[["waitAdded",-7,Mr],["waitMoved",-11,_r],["waitRemoved",-15,ur],["waitCopied",-19,Ar],["waitFolderAdded",-23,ur],["waitFolderMoved",-27,_r],["waitFolderRemoved",-31,ur]],audio:[["waitAdded",-8,Mr],["waitMoved",-12,_r],["waitRemoved",-16,ur],["waitCopied",-20,Ar],["waitFolderAdded",-24,ur],["waitFolderMoved",-28,_r],["waitFolderRemoved",-32,ur]],characters:[["waitAdded",-9,Mr],["waitMoved",-13,_r],["waitRemoved",-17,ur],["waitCopied",-21,Ar],["waitFolderAdded",-25,ur],["waitFolderMoved",-29,_r],["waitFolderRemoved",-33,ur]],maps:[["waitAdded",-10,Mr],["waitMoved",-14,_r],["waitRemoved",-18,ur],["waitCopied",-22,Ar],["waitFolderAdded",-26,ur],["waitFolderMoved",-30,_r],["waitFolderRemoved",-34,ur]]},o={"":[["ready","conn.ready","",nr,"",""],["setCurrentMap","maps.setCurrentMap","!",nr,"",""],["getUserMap","maps.getUserMap","",cr,"",""],["setUserMap","maps.setUserMap","!",nr,"waitCurrentUserMap",""],["getMapData","maps.getMapData","!",pl,"",""],["newMap","maps.new","!",kr,"",""],["setMapDetails","maps.setMapDetails","!",nr,"waitMapChange",""],["setMapStart","maps.setMapStart","!",nr,"waitMapStartChange",""],["setGridDistance","maps.setGridDistance","!",nr,"waitGridDistanceChange",""],["setGridDiagonal","maps.setGridDiagonal","!",nr,"waitGridDiagonalChange",""],["setLightColour","maps.setLightColour","!",nr,"waitMapLightChange",""],["setMapKeyData","maps.setData",["key","data"],nr,"waitMapDataSet",""],["removeMapKeyData","maps.removeData","!",nr,"waitMapDataRemove",""],["signalMeasure","maps.signalMeasure","!",nr,"",""],["signalPosition","maps.signalPosition","!",nr,"",""],["signalMovePosition","maps.signalMovePosition","!",nr,"",""],["addLayer","maps.addLayer","!",ur,"waitLayerAdd","*"],["addLayerFolder","maps.addLayerFolder","!",ur,"waitLayerFolderAdd","*"],["renameLayer","maps.renameLayer",["path","name"],Ir,"waitLayerRename","*"],["moveLayer","maps.moveLayer",["from","to","position"],nr,"waitLayerMove",""],["showLayer","maps.showLayer","!",nr,"waitLayerShow",""],["hideLayer","maps.hideLayer","!",nr,"waitLayerHide",""],["lockLayer","maps.lockLayer","!",nr,"waitLayerLock",""],["unlockLayer","maps.unlockLayer","!",nr,"waitLayerUnlock",""],["addToMask","maps.addToMask","!",nr,"waitMaskAdd",""],["removeFromMask","maps.removeFromMask","!",nr,"waitMaskRemove",""],["setMask","maps.setMask",["baseOpaque","masks"],nr,"waitMaskSet",""],["removeLayer","maps.removeLayer","!",nr,"waitLayerRemove",""],["addToken","maps.addToken",["path","token","pos"],cr,"waitTokenAdd","token/id"],["removeToken","maps.removeToken","!",nr,"waitTokenRemove",""],["setToken","maps.setToken","!",nr,"waitTokenSet",""],["setTokenMulti","maps.setTokenMulti","!",nr,"waitTokenMultiSet",""],["setTokenLayerPos","maps.setTokenLayerPos",["id","to","newPos"],nr,"waitTokenMoveLayerPos",""],["shiftLayer","maps.shiftLayer",["path","dx","dy"],nr,"waitLayerShift",""],["addWall","maps.addWall",["path","wall"],cr,"waitWallAdded","wall/id"],["removeWall","maps.removeWall","!",nr,"waitWallRemoved",""],["modifyWall","maps.modifyWall","!",nr,"waitWallModified",""],["moveWall","maps.moveWall",["id","path"],nr,"waitWallMoved",""],["musicPackList","music.list","",bl,"",""],["musicPackAdd","music.new","!",kr,"waitMusicPackAdd","*"],["musicPackRename","music.rename",["id","name"],ur,"waitMusicPackRename","*"],["musicPackRemove","music.remove","!",nr,"waitMusicPackRemove",""],["musicPackCopy","music.copy",["id","name"],kr,"waitMusicPackCopy","name"],["musicPackSetVolume","music.setVolume",["id","volume"],nr,"waitMusicPackVolume",""],["musicPackPlay","music.playPack",["id","playTime"],cr,"waitMusicPackPlay","*"],["musicPackStop","music.stopPack","!",nr,"waitMusicPackStop",""],["musicPackStopAll","music.stopAllPacks","",nr,"waitMusicPackStopAll",""],["musicPackTrackAdd","music.addTracks",["id","tracks"],nr,"waitMusicPackTrackAdd",""],["musicPackTrackRemove","music.removeTrack",["id","track"],nr,"waitMusicPackTrackRemove",""],["musicPackTrackVolume","music.setTrackVolume",["id","track","volume"],nr,"waitMusicPackTrackVolume",""],["musicPackTrackRepeat","music.setTrackRepeat",["id","track","repeat"],nr,"waitMusicPackTrackRepeat",""],["characterCreate","characters.create",["path","data"],br,"",""],["characterModify","characters.modify",["id","setting","removing"],nr,"waitCharacterDataChange",""],["characterGet","characters.get","!",Zr,"",""],["listPlugins","plugins.list","",Ul,"",""],["enablePlugin","plugins.enable","!",nr,"",""],["disablePlugin","plugins.disable","!",nr,"",""],["pluginSetting","plugins.set",["id","setting","removing"],nr,"waitPluginSetting",""],["broadcastWindow","broadcastWindow",["module","id","contents"],nr,"waitBroadcastWindow",""],["broadcast","broadcast","!",nr,"waitBroadcast",""]],images:[["list","imageAssets.list","",Dr,"",""],["createFolder","imageAssets.createFolder","!",ur,"waitFolderAdded","*"],["move","imageAssets.move",["from","to"],ur,"waitMoved","to"],["moveFolder","imageAssets.moveFolder",["from","to"],ur,"waitFolderMoved","to"],["remove","imageAssets.remove","!",nr,"waitRemoved",""],["removeFolder","imageAssets.removeFolder","!",nr,"waitFolderRemoved",""],["copy","imageAssets.copy",["id","path"],br,"waitCopied","name"]],audio:[["list","audioAssets.list","",Dr,"",""],["createFolder","audioAssets.createFolder","!",ur,"waitFolderAdded",""],["move","audioAssets.move",["from","to"],ur,"waitMoved","to"],["moveFolder","audioAssets.moveFolder",["from","to"],ur,"waitFolderMoved","to"],["remove","audioAssets.remove","!",nr,"waitRemoved",""],["removeFolder","audioAssets.removeFolder","!",nr,"waitFolderRemoved",""],["copy","audioAssets.copy",["id","path"],br,"waitCopied","name"]],characters:[["list","characters.list","",Dr,"",""],["createFolder","characters.createFolder","!",ur,"waitFolderAdded",""],["move","characters.move",["from","to"],ur,"waitMoved","to"],["moveFolder","characters.moveFolder",["from","to"],ur,"waitFolderMoved","to"],["remove","characters.remove","!",nr,"waitRemoved",""],["removeFolder","characters.removeFolder","!",nr,"waitFolderRemoved",""],["copy","characters.copy",["id","path"],br,"waitCopied","name"]],maps:[["list","maps.list","",Dr,"",""],["createFolder","maps.createFolder","!",ur,"waitFolderAdded",""],["move","maps.move",["from","to"],ur,"waitMoved","to"],["moveFolder","maps.moveFolder",["from","to"],ur,"waitFolderMoved","to"],["remove","maps.remove","!",nr,"waitRemoved",""],["removeFolder","maps.removeFolder","!",nr,"waitFolderRemoved",""],["copy","maps.copy",["id","path"],br,"waitCopied","name"]]},s=()=>new Ri((()=>{}));for(const e in o){const a=""===e?Xn:Xn[e],s=""===e?Bn:Bn[e];for(const[n,r,l,c,d,h]of o[e]){const e=i["string"==typeof l?l:"*"];if(""===d)a[n]=(...i)=>t.request(r,e(i,l),c).catch(tr);else{const[i,o]=Ri.bind(1);s[d]=i.splitCancel(),a[n]=""===h?(...i)=>{const a=e(i,l);return o(a),t.request(r,a,c).catch(tr)}:"*"===h?(...i)=>t.request(r,e(i,l),c).catch(tr).then((e=>(o(e),e))):"token/id"===h?(...i)=>{const a=e(i,l);return t.request(r,a,c).catch(tr).then((e=>(a.token.id=e,o(a),e)))}:(...i)=>{const a=e(i,l);return t.request(r,a,c).catch(tr).then((e=>(o(Object.assign(a,{[h]:e})),e)))}}}}for(const e in a){const i=""===e?Xn:Xn[e],o=""===e?Bn:Bn[e],n=""===e?qn:qn[e];for(const[r,l,c]of a[e]){const[e,a]=Ri.bind(1);t.subscribe(l,c).when((e=>Ei((async()=>a(e))))).catch(tr),i[r]=()=>e,o[r]?n[r]=Ri.merge(i[r](),o[r]()).splitCancel():(o[r]=s,n[r]=i[r])}}return t.await(-999).catch(tr),Object.freeze(Xn),t.await(-1,cr).then((e=>(zn=2===e,Kn=1===e,t.request("conn.currentTime",(e=>cr(e,"currentTime")))))).then((e=>{Yn=e-Date.now()/1e3}))})))).catch(tr),ar=[],or=[],sr=[],nr=e=>!0,rr=e=>{throw new TypeError(e)},lr=(e,t="Int",i="")=>(mi(e)||rr(i?`invalid ${t} object, key '${i}' contains an invalid Int: ${JSON.stringify(e)}`:`expecting Int type, got ${JSON.stringify(e)}`),!0),cr=(e,t="Uint",i="",a=Number.MAX_SAFE_INTEGER)=>(mi(e,0,a)||rr(i?`invalid ${t} object, key '${i}' contains an invalid Uint: ${JSON.stringify(e)}`:`expecting Uint type, got ${JSON.stringify(e)}`),!0),dr=(e,t="Byte",i="")=>cr(e,t,i,255),hr=(e,t,i="")=>("object"!=typeof e&&rr(i?`invalid ${t} object, key '${i}' contains invalid data: ${JSON.stringify(e)}`:`expecting ${t} object, got ${JSON.stringify(e)}`),!0),ur=(e,t="String",i="")=>("string"!=typeof e&&rr(i?`invalid ${t} object, key '${i}' contains an invalid string: ${JSON.stringify(e)}`:`expecting ${t} type, got ${JSON.stringify(e)}`),!0),pr=(e,t="Boolean",i="")=>("boolean"!=typeof e&&rr(i?`invalid ${t} object, key '${i}' contains an invalid boolean: ${JSON.stringify(e)}`:`expecting ${t} type, got ${JSON.stringify(e)}`),!0),mr=(e,t,i="")=>(e instanceof Array||rr(`invalid ${t} object, key '${i}' contains an invalid Array: ${JSON.stringify(e)}`),!0),fr=(e,t,i)=>{for(let[a,o]of i)if(("?"!==o.charAt(0)||void 0!==e[o=o.slice(1)])&&!a(o?e[o]:e,t,o))return!1;return!0},gr=[[hr,""],[dr,"r"],[dr,"g"],[dr,"b"],[dr,"a"]],wr=(e,t="Colour")=>(fr(e,t,gr),Rn.from(e),!0),vr=[[hr,""],[cr,"id"]],yr=(e,t)=>fr(e,t,vr),Er=[[yr,""],[ur,"name"]],kr=e=>fr(e,"IDName",Er),Mr=e=>{mr(e,"added");for(const t of e)kr(t);return!0},Tr=[[yr,""],[ur,"path"]],br=e=>fr(e,"IDPath",Tr),Or=[[hr,""],[ur,"from"],[ur,"to"]],_r=(e,t="FromTo")=>fr(e,t,Or),Nr=[[hr,""],[cr,"oldID"],[cr,"newID"],[ur,"path"]],Ar=e=>fr(e,"Copied",Nr),xr=[[_r,""],[cr,"position"]],Lr=e=>fr(e,"LayerMove",xr),Sr=[[hr,""],[ur,"path"],[ur,"name"]],Ir=e=>fr(e,"LayerRename",Sr),Cr=[[hr,""],[hr,"folders"],[hr,"items"]],Dr=e=>{fr(e,"FolderItems",Cr);for(const t in e.folders)Dr(e.folders[t]);for(const t in e.items)cr(e.items[t],"FolderItems",t);return!0},Rr=[[hr,""],[ur,"key"]],Pr=e=>{fr(e,"KeyData",Rr);const t={[e.key]:e.data};for(const e of ar)e(t);if(!t[e.key]){for(const t of e)delete e[t];e[""]=""}return!0},$r=[[hr,""],[pr,"user"]],Hr=(e,t="KeystoreData")=>{hr(e,t);for(const i in e)fr(e[i],t,$r),void 0===e[i].data&&rr(`invalid KeystoreData object, key '${i}' contains no data`);return!0},Ur=[[hr,""],[Hr,"setting"],[mr,"removing"]],Gr=(e,t)=>{fr(e,t,Ur);for(const i of e.removing)ur(i,t,"removing");return!0},Zr=e=>{Hr(e,"Character");for(const t of sr)t(e);return!0},Wr=[[Gr,""],[cr,"id"]],jr=e=>{fr(e,"CharacterDataChange",Wr);for(const t of sr)t(e.setting);return!0},Vr=[[hr,""],[dr,"gridType"],[cr,"gridSize"],[cr,"gridStroke"],[wr,"gridColour"]],Fr=(e,t="MapDetails")=>fr(e,t,Vr),zr=[[yr,""],[ur,"to"],[cr,"newPos"]],Kr=e=>fr(e,"TokenMoveLayer",zr),Yr=[[yr,""],[lr,"?x"],[lr,"?y"],[cr,"?width"],[cr,"?height"],[dr,"?rotation"],[pr,"?snap"],[cr,"?src"],[cr,"?patternWidth"],[cr,"?patternHeight"],[pr,"?flip"],[pr,"?flop"],[Hr,"?tokenData"],[mr,"?removeTokenData"],[wr,"?fill"],[wr,"?stroke"],[cr,"?strokeWidth"],[mr,"?points"],[mr,"?lightColours"],[mr,"?lightStages"],[mr,"?lightTimings"]],Br=(e,t="TokenSet")=>{if(fr(e,t,Yr),e.lightColours)for(const i of e.lightColours){mr(i,t,"lightColours");for(const e of i)wr(e,`${t}->lightColours`)}if(e.lightStages)for(const i of e.lightStages)cr(i,t,"lightStages");if(e.lightTimings)for(const i of e.lightTimings)cr(i,t,"lightTimings");if(e.removeTokenData)for(const i of e.removeTokenData)ur(i,t,"removeTokenData");if(e.points)for(const i of e.points)fr(i,`${t}->Points`,el);return!0},qr=e=>{mr(e,"TokenSetMulti");for(const t of e)Br(t,"TokenSetMulti");return!0},Xr=[[yr,""],[lr,"x"],[lr,"y"],[cr,"width"],[cr,"height"],[dr,"rotation"],[pr,"snap"],[mr,"lightColours"],[mr,"lightStages"],[mr,"lightTimings"],[Hr,"tokenData"]],Qr=[[cr,"src"],[cr,"patternWidth"],[cr,"patternHeight"],[pr,"flip"],[pr,"flop"]],Jr=[[wr,"fill"],[wr,"stroke"],[cr,"strokeWidth"],[cr,"fillType"],[mr,"fills"]],el=[[hr,""],[lr,"x"],[lr,"y"]],tl=[[hr,""],[dr,"pos"],[wr,"colour"]],il=(e,t="Token")=>{fr(e,t,Xr);for(const t of e.lightColours){mr(t,"TokenSet","lightColours");for(const e of t)wr(e,"TokenSet->lightColours")}for(const t of e.lightStages)cr(t,"TokenSet","lightStages");for(const t of e.lightTimings)cr(t,"TokenSet","lightTimings");switch(e.tokenType){case void 0:case 0:fr(e,t,Qr);break;case 2:mr(e.points,t,"points");for(const t of e.points)fr(t,"Token->Points",el);case 1:fr(e,t,Jr),void 0!==e.isEllipse&&pr(e.isEllipse,"Token","isEllipse");for(const t of e.fills)fr(t,"Token->Fills",tl);break;default:throw new TypeError("invalid Token object, key 'tokenType' contains invalid data")}for(const t of or)t(e.tokenData);return!0},al=[[hr,""],[ur,"path"],[il,"token"],[cr,"?pos"]],ol=e=>fr(e,"TokenAdd",al),sl=[[ur,"name"],[pr,"hidden"],[mr,"children"]],nl=[[ur,"name"],[pr,"hidden"],[pr,"locked"],[mr,"tokens"],[mr,"walls"]],rl=[[pr,"hidden"]],ll=(e,t="LayerFolder")=>{"MapData"!==t&&fr(e,t,sl);for(const t of e.children)if(hr(t,"LayerFolder"),void 0!==t.children)ll(t);else if("Grid"===t.name||"Light"===t.name)fr(t,"LayerGrid",rl);else{fr(t,"LayerTokens",nl);for(const e of t.tokens)il(e);for(const e of t.walls)wl(e,"Layer->Wall")}return!0},cl=[[hr,""],[pr,"baseOpaque"],[mr,"masks"]],dl=e=>{fr(e,"MaskSet",cl);for(const t of e.masks)Vl(t);return!0},hl=e=>(mr(e,"MapStart"),2!==e.length&&rr("invalid number of coords for MapStart"),cr(e[0],"MapStart->startX"),cr(e[1],"MapStart->startY"),!0),ul=[[Fr,""],[cr,"startX"],[cr,"startY"],[cr,"gridDistance"],[pr,"gridDiagonal"],[wr,"lightColour"],[dl,""],[mr,"children"],[ll,""],[hr,"data"]],pl=e=>{fr(e,"MapData",ul);for(const t of ar)t(e.data);return!0},ml=[[hr,""],[ur,"path"],[lr,"dx"],[lr,"dy"]],fl=e=>fr(e,"LayerShift",ml),gl=[[hr,""],[cr,"id"],[lr,"x1"],[lr,"y1"],[lr,"x2"],[lr,"y2"],[wr,"colour"],[dr,"scattering"]],wl=(e,t="Wall")=>fr(e,t,gl),vl=[[wl,""],[ur,"path"]],yl=e=>fr(e,"WallPath",vl),El=[[yr,""],[cr,"volume"],[lr,"repeat"]],kl=e=>fr(e,"musicTrack",El),Ml=[[kr,""],[mr,"tracks"],[cr,"volume"],[cr,"playTime"]],Tl=e=>{fr(e,"musicPack",Ml);for(const t of e.tracks)kl(t);return!0},bl=e=>{mr(e,"musicPacks");for(const t of e)Tl(t);return!0},Ol=[[yr,""],[cr,"volume"]],_l=e=>fr(e,"MusicPackVolume",Ol),Nl=[[yr,""],[cr,"playTime"]],Al=e=>fr(e,"MusicPackPlay",Nl),xl=[[yr,""],[mr,"tracks"]],Ll=e=>{fr(e,"MusicPackTrackAdd",xl);for(const t of e.tracks)cr(t,"MusicPackTrackAdd->Track");return!0},Sl=[[yr,""],[cr,"track"]],Il=(e,t="MusicPackTrackRemove")=>fr(e,t,Sl),Cl=[[Il,""],[cr,"volume"]],Dl=e=>fr(e,"MusicPackTrackVolume",Cl),Rl=[[Il,""],[lr,"repeat"]],Pl=e=>fr(e,"MusicPackTrackRepeat",Rl),$l=[[kr,""],[cr,"newID"]],Hl=e=>fr($l,"MusicPackCopy",e),Ul=e=>{hr(e,"plugins");for(const t in e)hr(e,"plugins->plugin",t),pr(e[t].enabled,"plugin->enabled","enabled"),hr(e[t].data,"plugin->data","data");return!0},Gl=[[Gr,""],[ur,"id"]],Zl=e=>fr(e,"PluginSetting",Gl),Wl=e=>{if(null===e)return!0;if(mr(e,"SignalMeasure"),e.length<4||e.length%2==1)throw new TypeError("invalid SignalMeasure array, needs even length at least 4");for(let t=0;t<e.length;t++)cr(e[t],`SignalPosition.${t%2==0?"x":"y"}${1+(t>>1)}`);return!0},jl=e=>{if(mr(e,"SignalPosition"),2!==e.length)throw new TypeError("invalid SignalPosition array, needs length 2");return cr(e[0],"SignalPosition.x"),cr(e[1],"SignalPosition.y"),!0},Vl=e=>{switch(mr(e,"Mask"),0===e.length&&rr("invalid mask data"),e[0]){case 0:case 1:5!==e.length&&rr("invalid number of points for rect mask");break;case 2:case 3:5!==e.length&&rr("invalid number of points for ellipse mask");break;case 4:case 5:(e.length<7||0==(1&e.length))&&rr("invalid number of points for poly mask")}for(let t=1;t<e.length;t++)cr(e[t],"Mask",t+"");return!0},Fl=[[yr,""],[ur,"module"],[ur,"contents"]],zl=e=>fr(e,"BroadcastWindow",Fl),Kl=e=>(hr(e,"Broadcast"),void 0===e.type&&rr("invalid Broadcast object, missing 'type' key"),!0),Yl=no({stroke:"currentColor",fill:"none"}),Bl=Eo({x:22,y:17,fill:"currentColor"},as.TAB_SETTINGS),[ql,Xl,Ql,Jl,ec,tc,ic,ac,oc,sc,nc,rc,lc,cc,dc,hc,uc,pc,mc,fc,gc,wc,vc,yc,Ec]=U(25),[kc,Mc,Tc,bc,Oc,_c]=Array.from({length:6},((e,t)=>ct({type:"radio",name:ql,checked:!t}))),Nc=()=>{const e=()=>{for(const[e,t]of u)if(e.checked)return void t.beginElement()},t=()=>setTimeout((()=>(_c.checked?d:c).beginElement()),500),i=va({dur:"1s",fill:"freeze",path:"M0,0 L250,150",onendEvent:e}),a=wa({id:tc,attributeName:"fill",values:"#000",fill:"freeze",dur:"0.2s",begin:"indefinite"}),o=ya({id:ac,dur:"1s",attributeName:"transform",type:"scale",from:"1 1",to:"0.5 0.5",begin:"indefinite"}),s=va({id:nc,dur:"6s",path:"M0,0 h-300 v-300 h300 v300",begin:"indefinite",onendEvent:e}),n=va({id:rc,dur:"1s",fill:"freeze",path:"M250,150 L495,13",begin:"indefinite"}),r=va({id:lc,dur:"1s",fill:"freeze",path:"M253,13 C300,20 300,0 495,13",begin:"indefinite"}),l=va({dur:"0.5s",fill:"freeze",path:"M253,13 L250,150",begin:"indefinite",onendEvent:e}),c=wa({id:dc,attributeName:"fill",values:"#000",dur:"0.2s",begin:"indefinite"}),d=wa({id:mc,attributeName:"fill",values:"#000",fill:"freeze",dur:"0.5s",begin:"indefinite"}),h=wa({id:fc,attributeName:"fill",values:"#000",dur:"0.2s",begin:"indefinite"}),u=[[kc,a],[Mc,o],[Tc,s],[bc,h],[Oc,n],[_c,n]];return wo({id:Jl,viewBox:"0 0 500 300"},[Ma(ro({id:Ec,patternUnits:"userSpaceOnUse",width:100,height:100},no({d:"M0,100 V0 H100",stroke:"#000",fill:"none"}))),Qa([uo({width:1e3,height:600,fill:"#00f"}),no({d:"M50,150 C200,0 400,300 500,250 S600,300 700,200 S750,400 850,500 S400,600 300,550 S0,300 50,150 Z",fill:"#0f0"}),uo({width:1e3,height:600,fill:`url(#${Ec})`}),va({dur:"4s",path:"M0,0 C-50,150 -150,-150 -250,-150 C-150,150 250,150 0,0",begin:`${tc}.end`}),o,ya({id:oc,dur:"2s",attributeName:"transform",type:"scale",from:"0.5 0.5",to:"2 2",begin:`${ac}.end`}),ya({id:sc,dur:"1s",attributeName:"transform",type:"scale",from:"2 2",to:"1 1",begin:`${oc}.end`,onendEvent:e}),va({dur:"1s",path:"M0,0 L125,75",begin:`${ac}.begin`}),va({dur:"2s",path:"M125,75 L-250,-150",begin:`${oc}.begin`}),va({dur:"1s",path:"M-250,-150 L0,0",begin:`${sc}.begin`}),s]),Qa({transform:"translate(500, 0)"},[uo({id:Ql,width:500,height:301}),Yl,Ea({cy:11,r:10,stroke:"#f00","stroke-width":2,fill:"#000"},[wa({attributeName:"fill",dur:"1s",values:"#000;#fff",fill:"freeze",begin:`${cc}.end 0.1s`}),wa({attributeName:"fill",dur:"1s",values:"#fff;#000",fill:"freeze",begin:`${dc}.end 0.1s`})]),Bl,ya({attributeName:"transform",type:"translate",from:"500 0",to:"250 0",dur:"1s",fill:"freeze",begin:`${cc}.end 0.1s`}),ya({attributeName:"transform",type:"translate",from:"250 0",to:"500 0",dur:"1s",fill:"freeze",begin:`${dc}.end 0.1s`,onendEvent:()=>{Oc.checked?r.beginElement():l.beginElement()}}),ya({id:hc,attributeName:"transform",type:"translate",from:"250 0",to:"100 0",dur:"1s",begin:`${mc}.end`}),ya({id:uc,attributeName:"transform",type:"translate",from:"100 0",to:"400 0",dur:"2s",begin:`${hc}.end`}),ya({id:pc,attributeName:"transform",type:"translate",from:"400 0",to:"250 0",dur:"1s",begin:`${uc}.end`})]),Qa([Ea({cx:50,cy:50,stroke:"#f00","stroke-width":8,fill:"none"},wa({attributeName:"r",values:"4;46",dur:"1s",begin:`${fc}.end; ${gc}.end; ${wc}.end`})),Ea({cx:50,cy:50,stroke:"#00f","stroke-width":4,fill:"none"},wa({attributeName:"r",values:"4;46",dur:"1s",begin:`${fc}.end; ${gc}.end; ${wc}.end`})),ya({attributeName:"transform",type:"translate",from:"200 100",to:"200 100",fill:"freeze",dur:"0.1s",begin:`${fc}.end`}),ya({attributeName:"transform",type:"translate",from:"50 150",to:"50 150",fill:"freeze",dur:"0.1s",begin:`${gc}.end`}),ya({attributeName:"transform",type:"translate",from:"300 200",to:"300 200",fill:"freeze",dur:"0.1s",begin:`${wc}.end`})]),Qa({stroke:"#000",fill:"#fff"},[no({d:"M0,0 v12 l3,-1 l2,5 l2,-0.75 l-2,-5 l3,-1 z"}),uo({y:17,width:15,height:20,rx:2}),Qa({"stroke-width":.5},[uo({x:1,y:18,width:3,height:10,rx:1},[a,wa({attributeName:"fill",values:"#fff",fill:"freeze",dur:"1s",begin:`${ic}.end`,onendEvent:e}),wa({id:cc,attributeName:"fill",values:"#000",dur:"0.2s",begin:`${rc}.end 0.5s;${lc}.end 0.5s`}),c,d,wa({attributeName:"fill",values:"#fff",dur:"0.2s",fill:"freeze",begin:`${pc}.end 0.5s`,onendEvent:t})]),uo({x:11,y:18,width:3,height:10,rx:1},[h,wa({id:gc,attributeName:"fill",values:"#000",dur:"0.2s",begin:`${vc}.end`}),wa({id:wc,attributeName:"fill",values:"#000",dur:"0.2s",begin:`${yc}.end`})]),no({d:"M7.5,17.5 l-3,3 h2 v2 h2 v-2 h2 z"},[wa({attributeName:"fill",values:"#000",dur:"2s",begin:`${oc}.begin`}),wa({attributeName:"fill",values:"#000",dur:"3s",begin:`${nc}.begin 3s`})]),no({d:"M7.5,27.5 l-3,-3 h2 v-2 h2 v2 h2 z"},[wa({attributeName:"fill",values:"#000",dur:"1s",begin:`${ac}.begin`}),wa({attributeName:"fill",values:"#000",dur:"1s",begin:`${sc}.begin`}),wa({attributeName:"fill",values:"#000",dur:"3s",begin:`${nc}.begin`})])]),Qa([uo({y:37,width:15,height:7,rx:2}),Eo({x:2,y:42,textLength:11,style:"font:arial;font-size:5px","stroke-width":.3},"Shift"),wa({attributeName:"fill",values:"#000",dur:"1.5s",begin:`${nc}.begin; ${nc}.begin 3s`}),wa({attributeName:"stroke",values:"#fff",dur:"1.5s",begin:`${nc}.begin; ${nc}.begin 3s`})]),Qa([uo({y:44,width:15,height:7,rx:2}),Eo({x:2,y:49,style:"font:arial;font-size:5px","stroke-width":.3},"Ctrl"),wa({attributeName:"fill",values:"#000",dur:"4s",begin:`${ac}.begin`}),wa({attributeName:"stroke",values:"#fff",dur:"4s",begin:`${ac}.begin`})]),i,va({id:ic,dur:"4s",path:"M250,150 C200,300 100,0 0,0 C100,300 500,300 250,150",begin:`${tc}.end`}),n,va({dur:"1.5s",path:"M495,13 C200,300 150,100 253,13",fill:"freeze",begin:`${cc}.end 0.5s`,onendEvent:t}),r,l,va({dur:"4s",path:"M253,13 h-150 h300 h-150",fill:"freeze",begin:`${mc}.end`}),va({id:vc,dur:"1s",path:"M250,150 L100,200",fill:"freeze",begin:`${fc}.end`}),va({id:yc,dur:"1s",path:"M100,200 L350,250",fill:"freeze",begin:`${gc}.end`}),va({dur:"1s",path:"M350,250 L250,150",fill:"freeze",begin:`${wc}.end`,onendEvent:e})])])},Ac=Ln({"window-title":as.HELP,maximised:!0});P({[`#${Xl}`]:{height:"calc(100vh - 1em - 6px)","overflow-y":"scroll"},[`#${Ql}`]:{fill:"#fff"},[`#${Jl}`]:{cursor:"crosshair","max-width":"100%",height:"80vh"," input":{display:"none"}},[`#${ec}`]:{" label":{display:"inline-block",border:"5px solid transparent","border-radius":"0.5em",cursor:"pointer",padding:"5px","margin-right":"5px"}," input:checked+label":{"border-style":"inset","border-color":"#000"}," div":{display:"none"},[Array.from({length:6},((e,t)=>` input:nth-of-type(${t+1}):checked~div:nth-of-type(${t+1})`)).join(",")]:{display:"block"}}});const xc=()=>{Ac.parentNode?Ac.remove():(p(In,k(Ac,Ue({id:Xl},[Be(as.HELP),Nc(),Ue({id:ec},[qs(kc,as.HELP_MAP_DRAG),qs(Mc,as.HELP_MAP_ZOOM),qs(Tc,as.HELP_MAP_SCROLL),qs(bc,as.HELP_MAP_SIGNAL),qs(Oc,as.HELP_PANEL_OPEN),qs(_c,as.HELP_PANEL_RESIZE),Ue(as.HELP_DEMO_DRAG),Ue(as.HELP_DEMO_ZOOM),Ue(as.HELP_DEMO_SCROLL),Ue(as.HELP_DEMO_SIGNAL),Ue(as.HELP_DEMO_SIDEPANEL_OPEN),Ue(as.HELP_DEMO_SIDEPANEL_RESIZE)])]))),setTimeout((()=>{const e=Bl.getComputedTextLength()+5;p(Yl,{d:`M0,0 v300 M0,23 h10 q5,0 5,-5 v-10 q0,-5 5,-5 h${e} q5,0 5,5 v10 q0,5 5,5 h${470-e}`}),kc.click()})))},Lc=new xi("keys",{},(e=>{for(const t in e)if("string"!=typeof e[t])return!1;return!0})),Sc={},Ic=(e,t,i,a,o,s=!1)=>{const[n,r,l]=ne(Lc.value[e]??=i,a,o,s);return Sc[e]=[t,l],[n,r]},Cc=(e,t="")=>{Sc[e]?.[1](t),Lc.value[e]=t,Lc.save()},Dc=e=>Lc.value[e],Rc=e=>Sc[e][0],Pc=()=>Object.keys(Sc);class $c{x;y;#ve;#ye;lightColours;lightStages;lightTimings;constructor(e,t,i,a,o,s,n){this.x=e,this.y=t,this.#ve=i,this.#ye=a,this.lightColours=o,this.lightStages=s,this.lightTimings=n}getCentre(){return[this.x,this.y]}getLightPos(){return[this.#ve,this.#ye]}wallInteraction(e,t,i,a,o,s,n=!1){const r=[],l=[],{r:c,g:d,b:h,a:u}=o,p=n?1-u/255:u/255;let m=!1,f=0;for(let e=0;e<this.lightStages.length;e++){const t=this.lightStages[e],i=this.lightColours[e]??[];if(f+t<=s)l.push(t),r.push(i);else{l.push(f>s?Math.round(t*p):Math.round(s-f+(f+t-s)*p));const e=[];for(const{r:t,g:a,b:o,a:s}of i){const i=new Rn(Math.round(Math.sqrt(c*t)*p),Math.round(Math.sqrt(d*a)*p),Math.round(Math.sqrt(h*o)*p),Math.round(255*(1-(1-s/255)*p)));i.a&&(i.r||i.g||i.b)&&(m=!0),e.push(i)}r.push(e)}f+=t}return m?new $c(e,t,i,a,r,l,this.lightTimings):null}createLightPolygon(e,t){const i=lo({points:e});return Qc.addLighting(i,this,t),i}}class Hc extends $c{id;rotation=0;flip=!1;flop=!1;width;height;snap;tokenData;tokenType;constructor(e){super(e.x,e.y,0,0,e.lightColours,e.lightStages,e.lightTimings),this.id=e.id,this.width=e.width,this.height=e.height,this.rotation=e.rotation,this.snap=e.snap,this.tokenData=e.tokenData,this.tokenType=e.tokenType??0}at(e,t){const{x:i,y:a}=new DOMPoint(e,t).matrixTransform(this[qi].getScreenCTM().inverse());return i>=0&&i<this.width&&a>=0&&a<this.height}transformString(e=!0){let t="";const i=e&&(this.flip||this.flop);return(0!==this.x||0!==this.y||i)&&(t+=`translate(${this.x+(e&&this.flop?this.width:0)}, ${this.y+(e&&this.flip?this.height:0)}) `),i&&(t+=`scale(${this.flop?-1:1}, ${this.flip?-1:1}) `),0!==this.rotation&&(t+=`rotate(${(e&&this.flop?-1:1)*(e&&this.flip?-1:1)*360*this.rotation/256}, ${this.width/2}, ${this.height/2})`),t}getData(e){if(this.tokenData[e])return this.tokenData[e].data;if(this.tokenData["store-character-id"]){const t=Qs.get(this.tokenData["store-character-id"].data);if(t&&t[e])return t[e].data}return null}hasLight(){return!(!this.lightStages.length||!this.lightTimings.length)}getCentre(){return[this.x+(this.width>>1),this.y+(this.height>>1)]}getLightPos(){return this.getCentre()}cleanup(){}uncleanup(){}}class Uc extends Hc{[qi];src;patternWidth;patternHeight;constructor(e,t){super(e),t?.add(),this.src=e.src,this.flip=e.flip,this.flop=e.flop,this.patternWidth=e.patternWidth,this.patternHeight=e.patternWidth,this[qi]=Ja(Object.assign({class:"mapToken",href:lu(e.src),preserveAspectRatio:"none",width:e.patternWidth>0?e.patternWidth:e.width,height:e.patternHeight>0?e.patternHeight:e.height,transform:this.transformString()},t?{onload:()=>t.done(),onerror:()=>t.error()}:{})),e.patternWidth>0&&setTimeout((()=>this.updateNode()))}get isPattern(){return this.patternWidth>0}cleanup(){this.isPattern&&Qc.remove(this[qi].getAttribute("fill").slice(5,-1))}uncleanup(){this.isPattern&&p(this[qi],{fill:`url(#${Qc.add(this)})`})}updateSource(e){p(this[qi]instanceof SVGRectElement?Qc.list.get(this[qi].getAttribute("fill").slice(5,-1)).firstChild:this[qi],{href:`images/${this.src=e}`})}updateNode(){this[qi]instanceof SVGRectElement&&!this.isPattern?(Qc.remove(this[qi].getAttribute("fill").slice(5,-1)),this[qi].replaceWith(this[qi]=Ja({href:lu(this.src),preserveAspectRatio:"none"}))):this[qi]instanceof SVGImageElement&&this.isPattern&&this[qi].replaceWith(this[qi]=uo({class:"mapPattern",fill:`url(#${Qc.add(this)})`})),p(this[qi],{width:this.width,height:this.height,transform:this.transformString()})}}class Gc extends Hc{[qi];fill;stroke;strokeWidth;isEllipse;constructor(e){super(e),this.fill=e.fill,this.stroke=e.stroke,this.strokeWidth=e.strokeWidth,this.isEllipse=e.isEllipse??!1;const t=e.width/2,i=e.height/2;this[qi]=p(e.isEllipse?ba({cx:t,cy:i,rx:t,ry:i}):uo({width:e.width,height:e.height}),{class:"mapShape",fill:e.fill,stroke:e.stroke,"stroke-width":e.strokeWidth,transform:this.transformString()})}get isPattern(){return!1}updateNode(){if(this.isEllipse){const e=this.width/2,t=this.height/2;p(this[qi],{cx:e,cy:t,rx:e,ry:t,transform:this.transformString()})}else p(this[qi],{width:this.width,height:this.height,transform:this.transformString()})}}class Zc extends Hc{[qi];fill;stroke;strokeWidth;points;#Ee;#ke;isEllipse=!1;constructor(e){super(e),this.fill=e.fill,this.stroke=e.stroke,this.strokeWidth=e.strokeWidth,this.points=e.points;let t=0,i=0;for(const a of e.points)a.x>t&&(t=a.x),a.y>i&&(i=a.y);this.#Ee=t,this.#ke=i;const a=e.width/t,o=e.height/i;this[qi]=no({class:"mapDrawing",d:`M${e.points.map((e=>`${e.x*a},${e.y*o}`)).join(" L")}${0===e.fill.a?"":" Z"}`,fill:e.fill,stroke:e.stroke,"stroke-width":e.strokeWidth,transform:this.transformString()})}get isPattern(){return!1}updateNode(){const e=this.width/this.#Ee,t=this.height/this.#ke;p(this[qi],{d:`M${this.points.map((i=>`${i.x*e},${i.y*t}`)).join(" L")}${0===this.fill.a?"":" Z"}`,transform:this.transformString()})}}const Wc=Date.now()/1e3,[jc,Vc]=(new Ci).bind(3),Fc=new Map,zc={layer:null,token:null},Kc=Qa(),Yc=e=>Jo[(e+143>>5)%4],Bc=()=>{zc.token=null,p(Kc,{style:{display:"none"}}),jc()},qc=(()=>{const e=uo({width:"100%",height:"100%",fill:"#000"}),t=new ua(Qa()),i=ao({id:Xo},[e,t[qi]]);let a=!1;return{get[qi](){return i},get baseOpaque(){return a},get masks(){return Xs(t)},index:e=>t[e],at(e,i){let a=-1,o=null;for(const[s,n]of t.entries())switch(n[0]){case 0:case 1:{const[,t,r,l,c]=n;t<=e&&e<=t+l&&r<=i&&i<=r+c&&(a=s,o=n)}break;case 2:case 3:{const[,t,r,l,c]=n,d=l*l,h=c*c;h*Math.pow(e-t,2)+d*Math.pow(i-r,2)<=d*h&&(a=s,o=n)}break;case 4:case 5:{const t=n.reduce(((e,t,i)=>(i%2==1&&e.push([n[i],n[i+1]]),e)),[]);let r=t[t.length-1],l=!1;for(const a of t)i>Math.min(a[1],r[1])&&i<=Math.max(a[1],r[1])&&e<=(i-a[1])*(r[0]-a[0])/(r[1]-a[1])+a[0]&&(l=!l),r=a;l&&(a=s,o=n)}}return[o,a]},add(e){const i=1&e[0]?"#000":"#fff";let a;switch(e[0]){case 0:case 1:a=uo({x:e[1],y:e[2],width:e[3],height:e[4],fill:i});break;case 2:case 3:a=ba({cx:e[1],cy:e[2],rx:e[3],ry:e[4],fill:i});break;case 4:case 5:a=lo({points:e.reduce(((t,i,a)=>a%2==1?`${t} ${e[a]},${e[a+1]}`:t),""),fill:i});break;default:return-1}return t.push(Object.assign(e,{[qi]:a}))-1},remove(e){t.splice(e,1)},set(i,o){p(e,{fill:(a=i)?"#fff":"#000"}),t.splice(0,t.length);for(const e of o)this.add(e)}}})(),Xc=Math.sqrt(3),Qc=(()=>{let e=0,t=Qa(),i=Qa();const a=new Map,o=uo({width:"100%",height:"100%"}),s=Qa({id:qo},[o,t]),n=Ma([qc[qi],s,i]),r=new Map([["",[t,i]]]);return{get[qi](){return n},get list(){return a},add(e){let t=0;for(;a.has(`Pattern_${t}`);)t++;const i=`Pattern_${t}`;return p(n,wi(a,i,ro({id:i,patternUnits:"userSpaceOnUse",width:e.patternWidth,height:e.patternHeight},Ja({href:lu(e.src),width:e.patternWidth,height:e.patternHeight,preserveAspectRatio:"none"})))),i},remove(e){n.removeChild(a.get(e)),a.delete(e)},setGrid({gridSize:e,gridColour:t,gridStroke:i,gridType:o}){switch(a.get("grid")?.remove(),o){case 1:{const o=2*e/Xc,s=3*e/Xc;p(n,wi(a,"grid",ro({id:Qo,patternUnits:"userSpaceOnUse",width:e,height:s},no({d:`M${e/2},${s} V${o} l${e/2},-${o/4} V${o/4} L${e/2},0 L0,${o/4} v${o/2} L${e/2},${o}`,stroke:t,"stroke-width":i,fill:"transparent"}))))}break;case 2:{const o=2*e/Xc,s=3*e/Xc;p(n,wi(a,"grid",ro({id:Qo,patternUnits:"userSpaceOnUse",width:s,height:e},no({d:`M${s},${e/2} H${o} l-${o/4},${e/2} H${o/4} L0,${e/2} L${o/4},0 h${o/2} L${o},${e/2}`,stroke:t,"stroke-width":i,fill:"transparent"}))))}break;default:p(n,wi(a,"grid",ro({id:Qo,patternUnits:"userSpaceOnUse",width:e,height:e},no({d:`M0,${e} V0 H${e}`,stroke:t,"stroke-width":i,fill:"transparent"}))))}},setLight(e){p(o,{fill:e})},addLighting(a,o,s){const{lightTimings:n,lightStages:r,lightColours:l}=o;if(n.length&&r.length){let c=0,d=0;const h="LG_"+e++,[u,m]=o.getLightPos(),f=n.reduce(((e,t)=>e+t),0),g="0;"+n.map((e=>(d+=e)/f)).join(";"),w=r.reduce(((e,t)=>e+t),0),v=Yn-Wc+"s",y=ho({id:h,r:w*s,cx:u,cy:m,gradientUnits:"userSpaceOnUse"},[r.map(((e,t)=>{const i=fo({offset:100*c/w+"%","stop-color":1!==n.length?void 0:l[t]?.[0]??Hn},1!==n.length?wa({attributeName:"stop-color",begin:v,keyTimes:g,dur:f+"ms",repeatCount:"indefinite",values:n.map(((e,i)=>l[t]?.[i]??Hn)).join(";")+";"+l[t]?.[0]??Hn}):[]);return c+=e,i}))]);return p(i,p(y,p(y.lastChild?.cloneNode(!0),{offset:"100%","stop-opacity":0}))),p(t,p(a,{fill:`url(#${h})`})),y}return null},clearLighting(){k(s,[o,t=Qa()]);for(const[,[,e]]of r)e.remove();r.clear(),r.set("",[t,i=n.appendChild(Qa())]),e=0},setLightGroup(e){[t,i]=r.get(e)??wi(r,e,[s.appendChild(Qa()),n.appendChild(Qa())])},clearLightGroup(e){const t=r.get(e);t&&(k(t[0]),k(t[1]))},clear(){this.clearLighting();for(const e of a.values())e.remove();a.clear()}}})(),Jc=new Map,ed=new Map,td=e=>Array.from(Jc.entries()).filter((t=>t[1][e])).sort(((t,i)=>t[1][e].priority===i[1][e].priority?Qi(t[0],i[0]):(t[1][e].priority??0)-(i[1][e].priority??0))),id=({url:e})=>e.split("/").pop()??"",ad=()=>{if(0===ed.size)return[];const e=ct({type:"checkbox",class:So,disabled:!0}),t=Zt({onchange:function(){const t=ed.get(this.value),a={disabled:!t};p(e,a),p(i,a),e.checked=t?.enabled??!1}},[Nt({value:""}),Array.from(ed.keys()).sort().map((e=>Nt({value:e},e)))]),i=Oe({disabled:!0,onclick:()=>{const i=t.value,a=ed.get(i);a&&e.checked!==a.enabled&&((a.enabled=e.checked)?Xn.enablePlugin:Xn.disablePlugin)(i).then(rd).catch(tr)}},as.SAVE);return[zn?Pe([Bt(Be(as.PLUGINS)),qs([as.PLUGINS,": "],t),qs(e,""),be(),i]):[],td("settings").map((([e,{settings:{fn:t}}])=>Pe([Bt(Be(e.charAt(0).toUpperCase()+e.slice(1))),t])))]},od=(e,t,i,a,o,s,n)=>{const r=[];for(const[l,{characterEdit:{fn:c}}]of td("characterEdit")){const d=E(),h=c(d,t,i,a,o,s,n);h&&r.push(h),p(e,Ve([pt(l.charAt(0).toUpperCase()+l.slice(1)),d]))}return()=>{for(const e of r)e()}},sd=(e,t)=>{Jc.set(e,t)},nd=e=>ed.get(e)?.data,rd=()=>zn?In.confirm(as.PLUGIN_REFRESH,as.PLUGIN_REFRESH_REQUEST).then((e=>e&&window.location.reload())):window.location.reload(),ld=()=>{const e=[];for(const[,{tokenContext:{fn:t}}]of td("tokenContext")){const i=t();i&&e.push(i)}return e},cd=()=>{const e=[];for(const[,{tokenDataFilter:{fn:t}}]of td("tokenDataFilter"))e.push(...t);return e},dd=()=>td("menuItem").map((e=>e[1].menuItem.fn)),hd=e=>td("addWalls").reduce(((t,[,{addWalls:{fn:i}}])=>t.concat(i(e))),[]),ud=e=>td("addLights").reduce(((t,[,{addLights:{fn:i}}])=>t.concat(i(e))),[]),pd=e=>{for(const[,{handleWalls:{fn:t}}]of td("handleWalls"))t(e)};let md=Uc,fd=Gc,gd=Zc;const wd=()=>(Xn.waitPluginChange().when(rd),Xn.listPlugins().then((e=>{let t=Promise.resolve();for(const i of Object.keys(e).sort(Qi))wi(ed,i,e[i]).enabled&&(t=t.finally((()=>include(`/plugins/${i}`))));return t})).then((()=>{for(const[,{tokenClass:{fn:e}}]of td("tokenClass")){const t=e(md);t.prototype instanceof md&&(md=t)}for(const[,{shapeClass:{fn:e}}]of td("shapeClass")){const t=e(fd);t.prototype instanceof fd&&(fd=t)}for(const[,{drawingClass:{fn:e}}]of td("drawingClass")){const t=e(gd);t.prototype instanceof gd&&(gd=t)}}))),[vd,yd,Ed,kd,Md,Td,bd,Od,_d,Nd]=["autosnap","menuHide","invert","miniTools","tabIcons","zoomSlider","panelOnTop","measureTokenMove","enableAnimation","musicSort"].map((e=>new Oi(e))),Ad=new _i("scrollAmount"),xd=new _i("undoLimit",100,-1),[Ld,Sd]=["hiddenLayerOpacity","hiddenLayerSelectedOpacity"].map((e=>new _i(e,128,0,255))),Id=H();P({[`.${So}`]:{display:"none","[disabled]+label":{color:"#888",":after":{"background-image":"none !important"}},"+label:after":{width:"1.2em",height:"1em",display:"inline-block",content:'""',"background-repeat":"no-repeat","background-size":"1em","background-position":"bottom center","background-image":'url(\'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 10"%3E%3Cpath d="M2,1 q5,6 8,8 M2,9 q5,-3 8,-8" stroke="%23f00" stroke-linecap="round" stroke-linejoin="round" fill="none" stroke-width="2" /%3E%3C/svg%3E\')'},":checked+label:after":{"background-image":'url(\'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 10"%3E%3Cpath d="M1,6 l3,3 7,-8" stroke="%230f0" stroke-linecap="round" stroke-linejoin="round" fill="none" stroke-width="2" /%3E%3C/svg%3E\')'},"[type=radio]:checked+label:after":{"background-image":'url(\'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 10"%3E%3Cpath d="M1,6 l3,3 7,-8" stroke="%2300f" stroke-linecap="round" stroke-linejoin="round" fill="none" stroke-width="2" /%3E%3C/svg%3E\')'}},[`#${Id}`]:{" h1":{display:"inline-block"}," ul":{"list-style":"none",padding:0}}}),on.push([7,()=>[as.TAB_SETTINGS,Ue({id:Id},[Oe({onclick:xc},as.HELP_OPEN),be(),Be(as.SETTINGS_AUTH),Ye({action:zn?"?":"?admin",method:"post"},ct({type:"submit",value:as[zn?"LOGOUT":"LOGIN"]})),be(),Pe([Bt(Be(as.SETTINGS_LANGUAGE)),qs([as.SETTINGS_LANGUAGE_SELECT,": "],Zt({onchange:function(){es.set(this.value)}},is.map((e=>Nt({selected:e===es.value},e)))))]),Pe([Bt(Be(as.SETTINGS_THEME)),qs(ct({type:"checkbox",class:So,checked:Ed.value,onchange:function(){Ed.set(this.checked)}}),[as.SETTINGS_INVERT,": "]),be(),qs(ct({type:"checkbox",class:So,checked:Md.value,onchange:function(){Md.set(this.checked)}}),[as.SETTINGS_TAB_ICONS,": "]),be(),qs(ct({type:"checkbox",class:So,checked:bd.value,onchange:function(){bd.set(this.checked)}}),[as.SETTINGS_PANEL_ON_TOP,": "]),be(),qs(ct({type:"checkbox",class:So,checked:yd.value,onchange:function(){yd.set(this.checked)}}),[as.SETTINGS_HIDE_MENU,": "]),be(),qs(ct({type:"checkbox",class:So,checked:Td.value,onchange:function(){Td.set(this.checked)}}),[as.SETTINGS_ZOOM_SLIDER_HIDE,": "]),zn?[be(),qs(ct({type:"checkbox",class:So,checked:kd.value,onchange:function(){kd.set(this.checked)}}),[as.SETTINGS_MINI_TOOLS,": "]),be(),qs(ct({type:"checkbox",class:So,checked:Nd.value,onchange:function(){Nd.set(this.checked)}}),[as.SETTINGS_MUSIC_SORT,": "])]:[]]),Pe([Bt(Be(as.SETTINGS_MAP)),zn?[qs(ct({type:"checkbox",class:So,checked:vd.value,onchange:function(){vd.set(this.checked)}}),[as.SETTINGS_AUTOSNAP,": "]),be(),qs(ct({type:"checkbox",class:So,checked:Od.value,onchange:function(){Od.set(this.checked)}}),[as.SETTINGS_MEASURE_TOKEN_MOVE,": "]),be()]:[],qs([as.SETTINGS_SCROLL_AMOUNT,": "],ct({type:"number",value:Ad.value,step:1,onchange:function(){Ad.set(parseInt(this.value))}})),be(),zn?[qs([as.SETTINGS_UNDO_LIMIT,": "],ct({type:"number",value:xd.value,step:1,min:-1,onchange:function(){xd.set(parseInt(this.value))}})),be()]:[],qs(ct({type:"checkbox",class:So,checked:_d.value,onchange:function(){_d.set(this.checked)}}),[as.SETTINGS_ENABLE_ANIMATION,": "]),zn?[be(),qs([as.SETTINGS_LAYER_HIDDEN_OPACITY,": "],ct({type:"range",min:0,max:255,value:Ld.value,oninput:function(){Ld.set(parseInt(this.value))}})),be(),qs([as.SETTINGS_LAYER_HIDDEN_SELECTED_OPACITY,": "],ct({type:"range",min:0,max:255,value:Sd.value,oninput:function(){Sd.set(parseInt(this.value))}}))]:[]]),ad(),Pe([Bt(Be(as.SETTINGS_KEYS)),di(Pc().map((e=>mt(qs([Rc(e),": "],Oe({onclick:function(){let t="";const i=Ft(),a=e=>{k(i,t=(e.ctrlKey?"Ctrl+":"")+(e.altKey?"Alt+":"")+(e.shiftKey?"Shift+":"")+(e.metaKey?"Meta+":""))},o=Ln({"window-title":as.SETTINGS_KEYS_NEW,onkeydown:i=>{switch(i.key){default:i.stopPropagation(),Cc(e,t+i.key),k(this,t+i.key),o.close();case"OS":case"Meta":case"Shift":case"Control":case"Alt":a(i)}},onkeyup:a},[as.SETTINGS_KEYS_NEW,be(),i]);o.addControlButton(bs,(()=>{Cc(e),k(this,"\u202f"),o.close()}),as.SETTINGS_KEYS_DELETE),p(In,o)}},Dc(e)||"\u202f"))))))]),Pe([Bt(Be(as.SETTINGS_RESET)),Oe({onclick:()=>In.confirm(as.ARE_YOU_SURE,as.SETTINGS_RESET_CONFIRM).then((e=>{e&&(window.localStorage.clear(),window.location.reload())}))},as.SETTINGS_CLEAR)])]),!1,`data:image/svg+xml,%3Csvg xmlns="${ma}" viewBox="0 0 100 100"%3E%3Cg fill="none"%3E%3Ccircle cx="50" cy="50" r="35" stroke="%23ccc" stroke-width="10" /%3E%3Ccircle cx="50" cy="50" r="5" stroke="%23ccc" stroke-width="2" /%3E%3C/g%3E%3Cpath id="settings-spoke" d="M35,15 l5,-15 h20 l5,15" fill="%23ccc" /%3E%3Cuse href="%23settings-spoke" transform="rotate(60, 50, 50)" /%3E%3Cuse href="%23settings-spoke" transform="rotate(120, 50, 50)" /%3E%3Cuse href="%23settings-spoke" transform="rotate(180, 50, 50)" /%3E%3Cuse href="%23settings-spoke" transform="rotate(240, 50, 50)" /%3E%3Cuse href="%23settings-spoke" transform="rotate(300, 50, 50)" /%3E%3Cpath d="M21.5,33.5 L46,47.5 M50,81 L50,55 M78.5,33.5 L54,47.5" stroke="%23ccc" stroke-width="2" /%3E%3C/svg%3E`]]);const Cd=(e,t)=>Qi(e.name,t.name),Dd=(e,t)=>t.id-e.id,Rd=new WeakMap,Pd=(e,t)=>[t,...Array.from(e.children.values()).filter((e=>e instanceof Fd)).flatMap((e=>Pd(e,t+e.name+"/"))).sort(Qi)],$d=Ue({style:"transform: translateX(-9999px); display: inline-block"},fs({style:"width: 2em; height: 2em"})),Hd=({root:{[qi]:e}})=>{p(e,{class:{[$o]:!1}});for(const t of[...e.getElementsByClassName(Ho),e])p(t,{class:{[Ho]:!1}})},[Ud,Gd,Zd,Wd]=U(4);Ed.wait((e=>p($d,{style:{"background-color":e?"#000":"#fff"}})));class jd{id;name;parent;[qi];nameElem;renamer;copier;remover;constructor(e,t,i){this.id=t,this.name=i,this.parent=e,this[qi]=mt({class:Go},[this.nameElem=Ft({class:Ud,onclick:()=>this.show()},i),this.renamer=Os({title:as.ITEM_MOVE,class:Zo,onclick:()=>this.rename()}),this.copier=ps({title:as.ITEM_COPY_ADD,class:Zo,onclick:()=>this.copy()}),this.remover=Ts({title:as.ITEM_REMOVE,class:Zo,onclick:()=>this.remove()})])}rename(){const e=this,t=e.parent.root,i=this.parent.getPath()+"/",a=Zt(Pd(t.folder,"/").map((e=>Nt(e===i?{value:e,selected:!0}:{value:e},e)))),o=ct({type:"text",value:this.name,onkeypress:Ks}),s=Ln({"window-icon":t.windowIcon,"window-title":as.ITEM_MOVE},[Be(as.ITEM_MOVE),Ue([as.OLD_LOCATION,`: ${i}${this.name}`]),qs([as.NEW_LOCATION,": "],a),o,be(),Oe({onclick:function(){p(this,{disabled:!0}),xn(Ei((()=>t.rpcFuncs.move(i+e.name,a.value+o.value).then((a=>{t.moveItem(i+e.name,a),s.remove()})).finally((()=>p(this,{disabled:!1}))))),s)}},as.ITEM_MOVE)]);return p(In,s),ki(o),s}copy(){const e=this,t=e.parent.root,i=this.parent.getPath()+"/",a=Zt(Pd(t.folder,"/").map((e=>Nt(e===i?{value:e,selected:!0}:{value:e},e)))),o=ct({type:"text",value:this.name,onkeypress:Ks}),s=Ln({"window-icon":t.windowIcon,"window-title":as.ITEM_COPY_ADD},[Be(as.ITEM_COPY_ADD),Ue([as.CURRENT_LOCATION,`: ${i}${this.name}`]),qs([as.ITEM_COPY_NEW,": "],a),o,be(),Oe({onclick:function(){p(this,{disabled:!0}),xn(Ei((()=>t.rpcFuncs.copy(e.id,a.value+o.value).then((i=>{t.copyItem(e.id,i.id,i.path),s.remove()})).finally((()=>p(this,{disabled:!1}))))),s)}},as.ITEM_COPY_ADD)]);return p(In,s),ki(o),s}remove(){const e=this.parent.root,t=this.getPath(),i=Ue(t),a=Oe({onclick:function(){p(this,{disabled:!0}),xn(Ei((()=>e.rpcFuncs.remove(t).then((()=>{e.removeItem(t),o.remove()})).finally((()=>p(this,{disabled:!0}))))),o)}},as.ITEM_REMOVE),o=Ln({"window-icon":e.windowIcon,"window-title":as.ITEM_REMOVE},[Be(as.ITEM_REMOVE),Ue(as.ITEM_REMOVE_CONFIRM),i,a]);return p(In,o),ki(a),o}getPath(){return this.parent.getPath()+"/"+this.name}delete(){}filter(e){const t=this.name.toLowerCase();let i=!0;for(const a of e)if(!t.includes(a)){i=!1;break}return p(this[qi],{style:{display:i?void 0:"none"}}),i}}class Vd extends jd{image=lt({class:Wo,loading:"lazy",onload:()=>{this.#Me=this.image.naturalWidth,this.#Te=this.image.naturalHeight}});#pe=Ue(this.image);#Me=-1;#Te=-1;#be;#Oe;constructor(e,t,i,a,o=!1){super(e,t,i),this.#Oe=a,this.#be=a.register(this),p(this[qi].firstChild,{draggable:"true",onmouseover:()=>p(document.body,p(this.#pe,{style:o?void 0:{transform:"translateX(-9999px)"}})),onmousemove:o?e=>p(this.#pe,{style:{"--icon-top":e.clientY+5+"px","--icon-left":e.clientX+5+"px"}}):void 0,onmouseout:()=>this.removeIcon(),ondragstart:this,ondragend:this})}get width(){return this.#Me}get height(){return this.#Te}handleEvent(e){"dragend"===e.type?this.ondragend(e):"dragstart"===e.type&&this.ondragstart(e)}ondragstart(e){-1!==this.#Me&&-1!==this.#Te?(this.#Oe.set(e,this.#be,this.#pe),p(this.#pe.parentNode?null:document.body,p(this.#pe,{style:{transform:"translateX(-9999px)"}})),setTimeout(p,0,this.parent.root[qi],{class:[$o]})):e.preventDefault()}ondragend(e){this.parent instanceof zd&&Hd(this.parent)}transfer(){return this}delete(){this.removeIcon(),this.#Oe.deregister(this.#be)}removeIcon(){p(this.#pe,{style:{transform:void 0}}).remove()}}class Fd{parent;name;[qi];children;root;nameElem;renamer;newer;remover;constructor(e,t,i,a){this.root=e,this.parent=t,this.children=new pa(di({class:Uo}),this.sorter),this.nameElem=Ft(i),this.renamer=Os({title:as.FOLDER_MOVE,class:Zo,onclick:e=>this.rename(e)}),this.newer=ws({title:as.FOLDER_ADD,class:Zo,onclick:e=>this.newFolder(e)}),this.remover=Ts({title:as.FOLDER_REMOVE,class:Zo,onclick:e=>this.remove(e)}),this[qi]=(this.name=i)?mt({class:Zd},[Pe([Bt([fs({class:Gd}),this.nameElem,this.renamer,this.newer,this.remover]),this.children[qi]])]):Ue();for(const t in a.folders)this.children.set(t,new this.root.newFolder(e,this,t,a.folders[t]));for(const e in a.items)this.children.set(e,new this.root.newItem(this,a.items[e],e))}get folderSorter(){return Cd}get itemSorter(){return null===this.parent?Dd:Cd}get sorter(){const e=this.folderSorter,t=this.itemSorter,i=Rd.get(e);if(i){const e=i.get(t);if(e)return e}const a=(i,a)=>i instanceof Fd?a instanceof Fd?e(i,a):-1:a instanceof Fd?1:t(i,a);return i?i.set(t,a):Rd.set(e,new WeakMap([[t,a]])),a}rename(e){e.preventDefault();const t=this.root,i=this.getPath()+"/",a=this.parent?this.parent.getPath()+"/":"/",o=Zt(Pd(t.folder,"/").filter((e=>!e.startsWith(i))).map((e=>Nt(e===a?{value:e,selected:!0}:{value:e},e)))),s=ct({type:"text",value:this.name,onkeypress:Ks}),n=Ln({"window-icon":t.windowIcon,"window-title":as.FOLDER_MOVE},[Be(as.FOLDER_MOVE),Ue([as.OLD_LOCATION,`: ${i.slice(0,-1)}`]),qs([as.NEW_LOCATION,": "],o),s,be(),Oe({onclick:function(){p(this,{disabled:!0}),xn(Ei((()=>t.rpcFuncs.moveFolder(i,o.value+"/"+s.value).then((e=>{t.moveFolder(i.slice(0,-1),e),n.remove()})).finally((()=>p(this,{disabled:!0}))))),n)}},as.FOLDER_MOVE)]);return p(In,n),ki(s),n}remove(e){e.preventDefault();const t=this.root,i=this.getPath(),a=Ue(i),o=Oe({onclick:function(){p(this,{disabled:!0}),xn(Ei((()=>t.rpcFuncs.removeFolder(i).then((()=>{t.removeFolder(i),s.remove()})).finally((()=>p(this,{disabled:!0}))))),s)}},as.FOLDER_REMOVE),s=Ln({"window-icon":t.windowIcon,"window-title":as.FOLDER_REMOVE},[Be(as.FOLDER_REMOVE),Ue(as.FOLDER_REMOVE_CONFIRM),a,o]);return p(In,s),ki(o),s}newFolder(e){e.preventDefault();const t=this.root,i=this.getPath(),a=ct({onkeypress:Ks}),o=Ln({"window-icon":t.windowIcon,"window-title":as.FOLDER_ADD},[Be(as.FOLDER_ADD),qs([as.FOLDER_NAME,": "+i+"/"],a),be(),Oe({onclick:function(){p(this,{disabled:!0}),xn(Ei((()=>t.rpcFuncs.createFolder(i+"/"+a.value).then((e=>{t.addFolder(e),o.remove()})).finally((()=>p(this,{disabled:!0}))))),o)}},as.FOLDER_ADD)]);return p(In,o),ki(a),o}addItem(e,t){return this.getItem(t)??wi(this.children,t,new this.root.newItem(this,e,t))}getItem(e){return this.children.get(e)}removeItem(e){const t=this.children.get(e);return t?(this.children.delete(e),t.delete(),t.id):-1}addFolder(e){return""===e?this:this.getFolder(e)??wi(this.children,e,new this.root.newFolder(this.root,this,e,{folders:{},items:{}}))}getFolder(e){return this.children.get(e)}removeFolder(e){const t=this.children.get(e);return t&&this.children.delete(e),t}getPath(){const e=[];for(let t=this;t;t=t.parent)e.push(t.name);return e.reverse().join("/")}delete(){this.children.clear()}filter(e){const t=this.name.toLowerCase();let i=!0;for(const a of e)if(!t.includes(a)){i=!1;break}for(const[,t]of this.children)t.filter(e)&&(i=!0);return this.name&&p(this[qi],{style:{display:i?void 0:"none"}}),i}}class zd extends Fd{#Oe;#_e;#be;constructor(e,t,i,a,o,s){super(e,t,i,a),this.#Oe=o,this.#be=(this.#_e=s)?.register(this)??"",i&&s&&p(this.nameElem,{draggable:"true",ondragstart:this,ondragend:this}),p(this[qi],{ondragover:this,ondrop:this,ondragenter:this,ondragleave:this}),null===t&&p(this[qi],{onmouseover:()=>Hd(this)})}handleEvent(e){switch(e.type){case"dragover":return this.ondragover(e);case"drop":return this.ondrop(e);case"dragenter":return this.ondragenter(e);case"dragleave":return this.ondragleave(e);case"dragstart":$d.parentNode||p(document.body,$d),this.#_e?.set(e,this.#be,$d);break;case"dragend":Hd(this)}}ondragover(e){if(e.stopPropagation(),this.#_e?.is(e)){const t=this.#_e.get(e);for(let i=this;i;i=i.parent)if(i===t)return void(e.dataTransfer.dropEffect="none");e.preventDefault(),e.dataTransfer.dropEffect="move"}else this.#Oe.is(e)&&(e.preventDefault(),e.dataTransfer.dropEffect="move")}ondragenter(e){if(e.stopPropagation(),this.#_e?.is(e)){const t=this.#_e.get(e);for(let e=this;e;e=e.parent)if(e===t)return}else if(!this.#Oe.is(e))return;p(this[qi],{class:[Ho]}),p(this.root[qi],{class:[$o]})}ondragleave(e){p(this[qi],{class:{[Ho]:!1}}),e.stopPropagation()}ondrop(e){if(Hd(this),e.stopPropagation(),this.#Oe.is(e)){const{parent:t,name:i}=this.#Oe.get(e);if(t!==this){const e=t.getPath()+"/";Ei((()=>this.root.rpcFuncs.move(e+i,this.getPath()+"/"+i).then((t=>this.root.moveItem(e+i,t)))))}}else if(this.#_e?.is(e)){const t=this.#_e.get(e);if(t.parent!==this){for(let e=this;e;e=e.parent)if(e===t)return;const e=t.getPath();Ei((()=>this.root.rpcFuncs.moveFolder(e+"/",this.getPath()+"/"+t.name).then((t=>this.root.moveFolder(e,t)))))}}}transfer(){return this}}class Kd{#Ne;folder;rpcFuncs;newItem;newFolder;windowIcon;[qi];constructor(e,t,i,a,o=Fd){this.newItem=a,this.newFolder=o,this.#Ne=t,i&&(this.setRPCFuncs(i),Kd.prototype.setRoot.call(this,e))}setRoot(e){if(this.rpcFuncs){const t=this.folder=new this.newFolder(this,null,"",e);k(this[qi]??=this.folder[qi],[Ft({style:"margin-right: 0.5em"},this.#Ne),t.newer,this.filter?[qs(ct({class:Wd,placeholder:as.FILTER,oninput:function(){const e=this.value.toLowerCase().split(" ");for(let t=0;t<e.length;t++)if('"'===e[t].charAt(0)){for(;e.length>t+1&&'"'!==e[t].slice(-1);)e[t]+=" "+e.splice(t+1,1)[0];e[t]=e[t].slice(1,'"'===e[t].slice(-1)?-1:void 0)}t.filter(e)}}),Fs(),{title:as.FILTER_CLEAR,onclick:function(){const e=this.control;e.value="",e.dispatchEvent(new Event("input"))}}),be()]:[],t.children[qi]])}}setRPCFuncs(e){this.rpcFuncs||(this.rpcFuncs=e,e.waitAdded().when((e=>{for(const{id:t,name:i}of e)this.addItem(t,i)})),e.waitMoved().when((({from:e,to:t})=>this.moveItem(e,t))),e.waitRemoved().when((e=>this.removeItem(e))),e.waitCopied().when((({oldID:e,newID:t,path:i})=>this.copyItem(e,t,i))),e.waitFolderAdded().when((e=>this.addFolder(e))),e.waitFolderMoved().when((({from:e,to:t})=>this.moveFolder(e,t))),e.waitFolderRemoved().when((e=>this.removeFolder(e))))}get filter(){return!0}get root(){return this}resolvePath(e){const t=e.split("/"),i=t.pop()??"";let a=this.folder;for(const e of t)if(e){const t=a.getFolder(e);if(!t)return[null,i];a=t}return[a,i]}addItem(e,t){const[i,a]=this.resolvePath(t);return i?.addItem(e,a)}getItem(e){const[t,i]=this.resolvePath(e);return t?.getItem(i)}moveItem(e,t){this.addItem(this.removeItem(e),t)}copyItem(e,t,i){this.addItem(t,i)}removeItem(e){const[t,i]=this.resolvePath(e);return t?.removeItem(i)??-1}addFolder(e){const t=e.split("/");let i=this.folder.addFolder(t.shift());for(const e of t)i=i.addFolder(e);return i}moveFolder(e,t){const i=this.removeFolder(e);if(i){const e=this.addFolder(t);for(const[t,a]of i.children)a.parent=e,e.children.set(t,a);return i}}removeFolder(e){const[t,i]=this.resolvePath(e);return t?.removeFolder(i)}}ir.then((()=>{zn&&(P({[`.${Uo}`]:{margin:0," details summary":{"list-style":"none",outline:"none",cursor:"pointer","grid-template-columns":"1em auto 1em 1em 1em"},[` summary>.${Gd}`]:{width:"1em",height:"1em"},[` details[open]>summary>.${Gd}`]:{"--folder-closed":"none","--folder-open":"block"}},"summary::-webkit-details-marker":{display:"none"},[`.${Ud}`]:{cursor:"pointer"},[`.${Go}:hover,.${Zd}>details summary:hover`]:{"background-color":"#888"},[`.${Uo} summary,.${Go}`]:{display:"grid","grid-template-columns":"auto 1em 1em 1em"},[`.${Zo}`]:{"background-size":"1em","background-position":"bottom center","background-repeat":"no-repeat",width:"1em",height:"1em",display:"inline-block","margin-right":"0.2em",cursor:"pointer"},[`.${Wo}`]:{position:"absolute",top:"var(--icon-top, 0)",left:"var(--icon-left, 0)","max-width":"100px","max-height":"100px","z-index":2},[`.${Wd}`]:{float:"right","text-align":"right","border-width":"2px 2px 2px 0","border-color":"#000","border-style":"inset",background:"#fff",outline:"none",height:"1em","+br":{"border-width":"1px",clear:"right"},":placeholder-shown":{"padding-left":"calc(1em + 4px)","border-left-width":"2px","+label":{display:"none"}},"+label":{float:"right",display:"inline-block","font-size":"0.83333333em","border-width":"2px 0px 2px 2px","border-color":"#000","border-style":"inset",padding:"1px",background:"#fff",cursor:"pointer",height:"1em"," svg":{width:"1em",height:"1em"}}},[`.${Ho}`]:{"background-color":"#aaa",">details>summary,>span":{"background-color":"#888"}},[`.${$o}`]:{" *":{"pointer-events":"none"},[` .${Zd}`]:{"pointer-events":"auto"},">ul:after":{content:'" "',height:"1em",display:"block"}}}),$("@media (prefers-color-scheme: light)",{[`:root.${Io} .${Ho}`]:{"background-color":"#555"}}),$("@media (prefers-color-scheme: dark)",{[`:root:not(.${Io}) .${Ho}`]:{"background-color":"#555"}}))}));const Yd=Symbol("text"),Bd=e=>"object"==typeof e&&void 0!==e.attr,qd=e=>"object"==typeof e&&void 0===e.attr,Xd=e=>"string"==typeof e,Qd=(e,t,i,a)=>{for(;;){const o=t.next().value;if(!o)break;if(Bd(o)){const a=i[o.tagName];a?a(e,t,i):i[Yd](e,o.fullText)}else if(qd(o)){if(o.tagName===a)break;i[Yd](e,o.fullText)}else i[Yd](e,o)}return e},Jd=(e,t)=>Qd(document.createDocumentFragment(),function*(e){const t=[];let i=0;for(let a=0;a<e.length;a++)if("["===e.charAt(a)){const o=a,s="/"===e.charAt(a+1);s&&a++;e:for(a++;a<e.length;a++){let n=e.charCodeAt(a);if(!(n>=65&&n<=90||n>=97&&n<=122||n>=48&&n<=57)){if(a>o+ +s+1){const r=a;let l=null;if(61===n&&!s){if('"'===e.charAt(a+1)){l="",a++;t:for(a++;a<e.length;a++){const t=e.charAt(a);switch(t){case'"':if("]"===e.charAt(a+1)){a++;break t}a=r;break e;case"\\":a++;const i=e.charAt(a);switch(i){case'"':case"'":case"\\":l+=i}break;default:l+=t}}}else{for(a++;a<e.length&&"]"!==e.charAt(a);a++);l=e.slice(r+1,a)}n=e.charCodeAt(a)}if(93===n){if(i!==o){const t=e.slice(i,o);for(;yield t;);}i=a+1;const n=Object.freeze(s?{tagName:e.slice(o+2,a).toLowerCase(),fullText:e.slice(o,a+1)}:{tagName:e.slice(o+1,r).toLowerCase(),attr:l,fullText:e.slice(o,a+1)});if(s){if(t[0]===n.tagName)for(t.shift();1!==(yield););for(;yield n;);}else t:for(;;)switch(yield n){default:break t;case 1:t.unshift(n.tagName);case!0:}}}break}}}if(i<e.length){const t=e.slice(i);for(;yield t;);}}(t),e),eh=(e,t)=>(i,a,o)=>{const s=a.next(!0).value;s&&Bd(s)&&p(i,Qd(e({style:t}),a,o,s.tagName))},th=(e,t)=>{let i="";for(;;){const a=e.next().value;if(!a||qd(a)&&a.tagName===t)return i;i+=Xd(a)?a:a.fullText}},ih=eh(Ft,"font-weight: bold"),ah=eh(Ft,"font-style: italic"),oh=eh(Ft,"text-decoration: underline"),sh=eh(Ft,"text-decoration: line-through"),nh=eh(Ue,"text-align: left"),rh=eh(Ue,"text-align: center"),lh=rh,ch=eh(Ue,"text-align: right"),dh=eh(Ue,"text-align: justify"),hh=dh,uh=eh(vt),ph=(e,t,i)=>{const a=t.next(!0).value;a&&Bd(a)&&(a.attr?p(e,Qd(Ft({style:{color:a.attr}}),t,i,a.tagName)):i[Yd](e,a.fullText))},mh=ph,fh=(e,t,i)=>{const a=t.next(!0).value;if(a&&Bd(a)){const o=a.attr?parseInt(a.attr):0;o>0&&o<=100?p(e,Qd(Ft({style:{"font-size":o/10+"em"}}),t,i,a.tagName)):i[Yd](e,a.fullText)}},gh=(e,t,i)=>{const a=t.next(!0).value;a&&Bd(a)&&(a.attr?p(e,Qd(Ft({style:{"font-family":a.attr}}),t,i,a.tagName)):i[Yd](e,a.fullText))},wh=eh(Be),vh=eh(qe),yh=eh(Xe),Eh=eh(Qe),kh=eh(Je),Mh=eh(et),Th=e=>p(e,ot()),bh=(e,t,i)=>{const a=t.next(!0).value;if(a&&Bd(a))if(a.attr)try{p(e,Qd(he({href:new URL(a.attr,window.location.href).href}),t,i,a.tagName))}catch{i[Yd](e,a.fullText)}else{const o=th(t,a.tagName),s=t.next(!0).value;if(o&&s&&qd(s))try{return void p(e,he({href:new URL(o,window.location.href).href},o))}catch{}i[Yd](e,a.fullText),i[Yd](e,o),s&&qd(s)&&i[Yd](e,s.fullText)}},Oh=(e,t,i)=>{const a=t.next(!0).value;if(a&&Bd(a)){const o=th(t,a.tagName),s=t.next(!0).value;if(s&&qd(s))if(o)try{p(e,we({src:new URL(o,window.location.href).href,controls:!0}))}catch{i[Yd](e,a.fullText),i[Yd](e,o),i[Yd](e,s.fullText)}else i[Yd](e,a.fullText),s&&qd(s)&&i[Yd](e,s.fullText);else i[Yd](e,a.fullText),i[Yd](e,o)}},_h=(e,t,i)=>{const a=t.next(!0).value;if(a&&Bd(a)){let o=th(t,a.tagName);const s=t.next(!0).value;if(!s||!qd(s))return i[Yd](e,a.fullText),void i[Yd](e,o);if(!o)return i[Yd](e,a.fullText),void(s&&qd(s)&&i[Yd](e,s.fullText));try{o=new URL(o,window.location.href).href}catch{return i[Yd](e,a.fullText),i[Yd](e,o),void i[Yd](e,s.fullText)}const n={src:o};if(a.attr){const[e,t]=a.attr.split("x");if(e){const t=e.endsWith("%")?"%":"",i=parseInt(t?e.slice(0,-1):e);isNaN(i)||(n.width=i+t)}if(t){const e=t.endsWith("%")?"%":"",i=parseInt(e?t.slice(0,-1):t);isNaN(i)||(n.height=i+e)}}p(e,lt(n))}},Nh=(e,t)=>{const i=t.next(!0).value;i&&Bd(i)&&p(e,St(th(t,i.tagName)))},Ah=(e,t,i)=>{const a=t.next(!0).value;if(a&&Bd(a)){const o=[],s=[],n=[],{tagName:r}=a;let l=0,c=!1,d=!1,h=!1,u=null;for(;;){const a=t.next().value;if(!a)break;if(Bd(a))switch(a.tagName){case"thead":c||(c=!0,l=2);break;case"tbody":d||(d=!0,l=4);break;case"tfoot":h||(h=!0,l=8);break;case"tr":if(1==(1&l))break;switch(0===l&&(d=!0,l=4),u=ri(),l){case 2:o.push(u);break;case 4:s.push(u);break;case 8:n.push(u)}break;case"th":case"td":u&&p(u,Qd("th"===a.tagName?ai():Jt(),t,i,a.tagName))}else if(qd(a)){if(a.tagName===r)return void((c||d||h)&&p(e,Xt([c?oi(o):[],d?Qt(s):[],h?ii(n):[]])));if(1==(1&l)&&"tr"===a.tagName)l^=1,u=null;else switch(-2&l){case 2:"thead"===a.tagName&&(l=0);break;case 4:"tbody"===a.tagName&&(l=0);break;case 8:"tfoot"===a.tagName&&(l=0)}}}}},xh=(e,t,i)=>{const a=t.next(1).value;a&&Bd(a)&&(p(e,Ve([a.attr?pt(a.attr):[],Qd(Me(),t,i,a.tagName)])),t.next(1))},Lh=(e,t,i)=>{const a=t.next(!0).value;if(a&&Bd(a)){let o="";switch(a.attr){case"a":case"A":case"i":case"I":case"1":o=a.attr}const s=""===o?di():Ot({type:o}),{tagName:n}=a;let r=null;for(;;){const e=t.next().value;if(!e||qd(e)&&e.tagName===n)break;if(Xd(e)){let t=0;for(;t<e.length;){const a=e.indexOf("[*]",t),o=e.indexOf("[/*]",t);if(a<o&&-1!==a||-1===o&&-1!==a)r&&i[Yd](r,e.slice(t,a)),p(s,r=mt()),t=a+3;else{if(!(o<a&&-1!==o||-1===a&&-1!==o)){r&&i[Yd](r,e.slice(t));break}r&&(i[Yd](r,e.slice(t,o)),r=null),t=o+4}}}else r&&(Bd(e)&&i[e.tagName]?i[e.tagName](r,t,i):i[Yd](r,e.fullText))}p(e,s)}},Sh=(e,t)=>p(e,t.split("\n").map(((e,t)=>[t>0?be():[],e]))),Ih=Object.freeze({b:ih,i:ah,u:oh,s:sh,left:nh,centre:rh,center:lh,right:ch,justify:dh,full:hh,colour:ph,color:mh,size:fh,font:gh,h1:wh,h2:vh,h3:yh,h4:Eh,h5:kh,h6:Mh,highlight:uh,hr:Th,url:bh,audio:Oh,img:_h,code:Nh,table:Ah,quote:xh,list:Lh,[Yd]:Sh}),Ch=(e,t,i)=>{const a=t.next(!0).value;a&&Bd(a)&&Qd(e,t,i,a.tagName)},Dh=new Map,Rh=Object.assign({},Ih),Ph=(e,t)=>Dh.set(e,t),$h=(e,t)=>(Rh[e]??=t)===t,Hh=e=>Jd(Rh,e),Uh=new Li("bbcode");ir.then((()=>Xn.waitBroadcastWindow().when((e=>{const t=Dh.get(e.module);if(t){const[i,a]=t instanceof Array?t:t(e.id);p(In,Ln({"window-title":a,"window-icon":i,resizable:!0,style:"--window-width: 50%; --window-height: 50%"},Hh(e.contents)))}}))));class Gh extends zd{#Ae;#i;constructor(e,t,i,a,o,s,n,r){super(e,t,i,a,o,s),this.#Ae=n,this.#i=r;for(const e in a.items)this.#xe(a.items[e],e)}#xe(e,t){const i=this.assetMap(),a=i.get(e);a?a[0].send(a[1]=t):i.set(e,[new Ci,t])}addItem(e,t){return this.#xe(e,t),super.addItem(e,t)}ondragenter(e){super.ondragenter(e),this.#Ae.is(e)&&(p(this[qi],{class:[Ho]}),p(this.root[qi],{class:[$o]}))}ondragover(e){super.ondragover(e),this.#Ae.is(e)&&(e.preventDefault(),e.dataTransfer.dropEffect="copy")}ondrop(e){super.ondrop(e),this.#Ae.is(e)&&this.#i(this.#Ae.asForm(e,"asset"),In,this.getPath())}}const Zh=new Kd({folders:{},items:{}},as.TAB_IMAGES,null,class extends Vd{#T;constructor(e,t,i){super(e,t,i,ru,!0),p(this.image,{src:lu(t)}),this.#T=Uh.register((()=>()=>`[img]${lu(t)}[/img]`))}show(){const e=Ln({"window-icon":jh,"window-title":this.name,"hide-minimise":!1,class:Jh},lt({src:lu(this.id),draggable:"true",ondragstart:this}));return e.addControlButton(Ws,(()=>Xn.broadcastWindow("imageAsset",0,`[img=100%]${lu(this.id)}[/img]`)),as.SHARE),p(In,e),e}ondragstart(e){super.ondragstart(e),e.defaultPrevented||Uh.set(e,this.#T)}delete(){super.delete(),Uh.deregister(this.#T)}},class extends Gh{constructor(e,t,i,a){super(e,t,i,a,ru,qh,ou,iu)}assetMap(){return zh}}),Wh=new Kd({folders:{},items:{}},as.TAB_AUDIO,null,class extends Vd{#T;constructor(e,t,i){super(e,t,i,nu),p(this.image,{src:Vh}),this.#T=Uh.register((()=>()=>`[audio]${cu(t)}[/audio]`))}show(){const e=Ln({"window-icon":Vh,"window-title":this.name,"hide-minimise":!1,class:Jh},we({src:cu(this.id),controls:"controls",draggable:"true",ondragstart:this}));return e.addControlButton(Ws,(()=>Xn.broadcastWindow("audioAsset",0,`[audio]${cu(this.id)}[/audio]`)),as.SHARE),p(In,e),e}ondragstart(e){super.ondragstart(e),e.defaultPrevented||Uh.set(e,this.#T)}delete(){super.delete(),Uh.deregister(this.#T)}},class extends Gh{constructor(e,t,i,a){super(e,t,i,a,nu,Xh,su,au)}assetMap(){return Fh}}),jh=`data:image/svg+xml,%3Csvg xmlns="${ma}" viewBox="0 0 100 100"%3E%3Crect x="4" y="4" width="92" height="92" fill="%2344f" /%3E%3Ccircle cx="20" cy="20" r="12" fill="%23ff0" /%3E%3Cpath d="M50,65 l20,-20 a3,2 0,0,1 5,0 l20,20 v30 h-20 z" fill="%2305b" /%3E%3Cpath d="M3,70 l30,-30 a3,2 0,0,1 5,0 l55,55 h-90 z" fill="%23039" /%3E%3Crect x="3" y="3" width="94" height="94" stroke-width="6" rx="8" stroke="%23840" fill="none" /%3E%3C/svg%3E`,Vh=`data:image/svg+xml,%3Csvg xmlns="${ma}" viewBox="0 0 53 71"%3E%3Cpath d="M12,56 s-5,-2 -10,5 s7,15 15,0 v-30 l30,-10 v30 s-5,-2 -10,5 s7,15 15,0 v-55 l-40,13 z m5,-29 l30,-10 v-5 l-30,10 v5 z" fill="%23000" stroke="%23fff" stroke-linejoin="round" fill-rule="evenodd" /%3E%3C/svg%3E`,Fh=new Map,zh=new Map,Kh=(e,t,i)=>{const a=i.get(e)??wi(i,e,[new Ci,""]);return t(a[1]),a[0].receive(t),()=>a[0].remove(t)},Yh=(e,t,i,a=In,o="/")=>{const s=It({style:"width: 100%"});return xn(Ao(`/${t}/?path=${encodeURIComponent(o)}`,{data:i,method:"POST",response:"json",checker:e=>e instanceof Array&&e.every((e=>e instanceof Object&&"id"in e&&mi(e.id,0)&&"name"in e&&"string"==typeof e.name)),onuploadprogress:e=>{e.lengthComputable&&k(s,{value:e.loaded,max:e.total},Math.floor(100*e.loaded/e.total)+"%")}}).then((t=>{for(const{id:i,name:a}of t)e.addItem(i,a);return t})),a,as.UPLOADING,Ue([Ue(as.UPLOADING),s]))},Bh=(e,t,i,a,o,s)=>{const n=Ue(an()),r=s.mimes.join(", ");return e.list().then((s=>{t.setRPCFuncs(e),t.setRoot(s),t.windowIcon=i,k(n,{class:`${Qh} ${Uo}`},[Oe({onclick:()=>{const e=ct({accept:r,multiple:!0,name:"asset",type:"file",onchange:()=>{Yh(t,a,new FormData(s),n).then((()=>n.remove())).catch(tr).finally((()=>p(e,{disabled:!1}))),p(e,{disabled:!0})}}),s=Ye({enctype:"multipart/form-data",method:"post"},qs(o,e)),n=Ln({"window-icon":i,"window-title":o},[Be(o),s]);p(In,n),ki(e)}},o),t[qi]])})),n},qh=new Li("imagefolder"),Xh=new Li("audiofolder"),[Qh,Jh]=U(2),eu=(e,t)=>Kh(e,t,Fh),tu=(e,t)=>Kh(e,t,zh),iu=Yh.bind(null,Zh,"images"),au=Yh.bind(null,Wh,"audio"),ou=new Si("image/gif","image/png","image/jpeg","image/webp","video/apng","image/svg+xml"),su=new Si("application/ogg","audio/mpeg"),nu=new Li("audioasset"),ru=new Li("imageasset"),lu=t=>e.urls.images[t],cu=t=>e.urls.audio[t];Ph("imageAsset",[jh,as.TAB_IMAGES]),Ph("audioAsset",[Vh,as.TAB_AUDIO]),on.push([0,()=>zn?[as.TAB_IMAGES,Bh(Xn.images,Zh,jh,"images",as.UPLOAD_IMAGES,ou),!0,jh]:null],[1,()=>zn?[as.TAB_AUDIO,Bh(Xn.audio,Wh,Vh,"audio",as.UPLOAD_AUDIO,su),!0,Vh]:null]),ir.then((()=>{zn&&P({[`.${Qh}`]:{" ul":{margin:0,"padding-left":"calc(1em + 4px)","list-style":"none"},">div>ul":{"padding-left":0}},[`.${Jh}`]:{"max-height":"100%","max-width":"100%","min-height":"10px",overflow:"clip"," img":{"max-height":"calc(100vh - 20px)","max-width":"calc(100vw - 1em - 6px)"}}})}));const du=(e,t)=>0n===t?e:du(t,e%t);class hu{#Le;#Se;static zero=new hu(0n);static one=new hu(1n);static NaN=new hu(0n,0n);constructor(e,t=1n){t<0n?(this.#Le=-e,this.#Se=-t):(this.#Le=e,this.#Se=t)}add(e){return this.#Se===e.#Se?new hu(this.#Le+e.#Le,this.#Se):new hu(this.#Le*e.#Se+this.#Se*e.#Le,this.#Se*e.#Se)}sub(e){return this.#Se===e.#Se?new hu(this.#Le-e.#Le,this.#Se):new hu(this.#Le*e.#Se-this.#Se*e.#Le,this.#Se*e.#Se)}mul(e){return new hu(this.#Le*e.#Le,this.#Se*e.#Se)}div(e){return new hu(this.#Le*e.#Se,this.#Se*e.#Le)}cmp(e){if(!this.#Se||!e.#Se)return NaN;const t=this.#Le*e.#Se-this.#Se*e.#Le;return t<0n?-1:t>0n?1:0}isNaN(){return!this.#Se}sign(){return this.#Se?this.#Le?this.#Le<0n?-1:1:0:NaN}simplify(){if(!this.#Se)return hu.NaN;if(!this.#Le)return hu.zero;if(this.#Le===this.#Se)return hu.one;const e=this.#Le<0n?-this.#Le:this.#Le,t=this.#Se,i=e>t?du(e,t):du(t,e);return new hu(this.#Le/i,t/i)}[Symbol.toPrimitive](e){return"number"===e?this.toFloat():this.toString()}toFloat(){return this.#Se?Number(10000n*this.#Le/this.#Se)/1e4:NaN}toString(){switch(this.#Se){case 0n:return"NaN";case 1n:return`${this.#Le}`;default:return`${this.#Le} / ${this.#Se}`}}static min(e,t){return-1===e.cmp(t)?e:t}static max(e,t){return 1===e.cmp(t)?e:t}}const uu=hu,pu=new uu(-1n),mu=new uu(2n),fu=new uu(3n),gu=new uu(4n),wu=new uu(5n),vu=new uu(6n),yu=new uu(7n),Eu=(e,t)=>{const i=t.div(e),a=t.cmp(uu.zero);switch(i.cmp(uu.one)){case-1:switch(i.cmp(pu)){case-1:switch(a){case-1:return fu.add(pu.div(i));case 1:return yu.add(pu.div(i))}case 0:switch(a){case-1:return gu;case 1:return uu.zero}case 1:switch(e.cmp(uu.zero)){case-1:return uu.one.add(i);case 1:return wu.add(i)}}case 0:switch(a){case-1:return mu;case 1:return vu}case 1:switch(a){case-1:return fu.sub(uu.one.div(i));case 1:return yu.sub(uu.one.div(i))}default:switch(a){case-1:return fu;case 1:return yu}}return uu.NaN},ku=(e,t,i,a)=>{for(const{x1:o,y1:s,a1:n,a2:r}of i){const[i,l]=(!o.cmp(e)&&!s.cmp(t))===a?[r,n]:[n,r];if(1===i.cmp(l)&&-1===i.cmp(l.add(gu))||-1===i.cmp(l.sub(gu)))return!0}return!1},Mu=(e,t,i)=>{for(const a of e)for(const e of t)if(a.id===e.id){if(!i)return a;for(const e of i)if(a.id===e.id)return a}return null},Tu=(e,t,i,a,o,s)=>{if(!e.cmp(i))return[e,new uu(BigInt(s))];const n=a.sub(t).div(i.sub(e)),r=new uu(BigInt(o)),l=r.sub(t.sub(new uu(BigInt(s))).sub(e.sub(r).mul(n)).div(n.add(uu.one.div(n))));return[l,n.mul(l).add(t.sub(e.mul(n)))]},bu=(e,t,i,a,o,s)=>{const[n,r]=Tu(e,t,i,a,o,s);if(-1===n.cmp(uu.min(e,i))||1===n.cmp(uu.max(e,i))||-1===r.cmp(uu.min(t,a))||1===r.cmp(uu.max(t,a))){const n=Math.hypot(+e-o,+t-s),r=Math.hypot(+i-o,+a-s);return n<r?[e,t,n]:[i,a,r]}return[n,r,Math.hypot(+n-o,+r-s)]},Ou=(e,t,i,a,o,s,n,r)=>{const l=e.sub(i),c=t.sub(a),d=o.sub(n),h=s.sub(r),u=d.mul(c).sub(h.mul(l));if(u.cmp(uu.zero)){const p=o.mul(r).sub(s.mul(n)),m=e.mul(a).sub(t.mul(i));return[l.mul(p).sub(d.mul(m)).div(u),c.mul(p).sub(h.mul(m)).div(u)]}return[uu.NaN,uu.NaN]},_u=(e,t,i,a,o=0)=>{const[s,n]=e.getLightPos(),[r,l]=e.getCentre(),c=e.lightStages.reduce(((e,t)=>e+t),0)*i,d=new uu(BigInt(s)),h=new uu(BigInt(n)),u=[],p=new Map,m=[],f=[],g=[];if(5===o)return g;if(a){const{x1:e,y1:i,x2:o,y2:s}=a;t.push({id:0,x1:e,y1:i,x2:e.add(e).sub(o),y2:i.add(i).sub(s),colour:Hn,scattering:0},{id:0,x1:o.add(o).sub(e),y1:s.add(s).sub(i),x2:o,y2:s,colour:Hn,scattering:0})}for(const e of t){if(e.id===a?.id)continue;const{id:t,x1:i,y1:o,x2:r,y2:l}=e,c=i.sub(d),m=r.sub(d),g=o.sub(h),w=l.sub(h);if(g.mul(m.sub(c)).cmp(c.mul(w.sub(g)))){const a=+c,d=+g,h=+m,v=+w,y=Eu(c,g),E=Eu(m,w),k=`${+i},${+o}`,M=`${+r},${+l}`,T=p.get(k)??wi(p,k,[]),b=p.get(M)??wi(p,M,[]),[O,_,N]=bu(i,o,r,l,s,n),A=Object.assign({cx:O,cy:_,cl:N,a1:y,a2:E},e);T.length||u.push({w:T,x:i,y:o,a:y,d:Math.hypot(a,d)}),b.length||u.push({w:b,x:r,y:l,a:E,d:Math.hypot(h,v)}),T.push(A),b.push(A),t&&f.push(A)}}a&&t.splice(t.length-2,2),f.sort((({cl:e},{cl:t})=>e-t));let w=uu.NaN;for(const e of Array.from(u.values()).sort((({a:e,d:t},{a:i,d:a})=>i.cmp(e)||t-a))){if(!w.isNaN()&&!w.cmp(e.a))continue;w=e.a;const{x:t,y:i,w:o}=e,s=t.sub(d),n=i.sub(h),r=ku(t,i,o,!0);let l=t,c=i,u=o,g=1/0,v=0;if(a){const{x1:o,y1:r,x2:l,y2:c}=a,[u,p]=Ou(o,r,l,c,d,h,t,i),m=d.sub(u),f=h.sub(p),g=Math.hypot(+m,+f)-1e-8;if(-1===u.cmp(uu.min(o,l))||1===u.cmp(uu.max(o,l))||-1===p.cmp(uu.min(r,c))||1===p.cmp(uu.max(r,c))||-s.sign()!==m.sign()||-n.sign()!==f.sign()||g>e.d)continue;v=g}for(const e of f){if(e.cl>g)break;const{id:a,x1:o,y1:m,x2:f,y2:w}=e,[y,E]=Ou(o,m,f,w,d,h,t,i);if(!y.isNaN()){const t=d.sub(y),i=h.sub(E),k=Math.hypot(+t,+i),M=p.get(`${+y},${+E}`),T=M?.some((({id:e})=>a===e));(T?ku(y,E,M,!r):y.cmp(uu.min(o,f))>-1&&y.cmp(uu.max(o,f))<1&&E.cmp(uu.min(m,w))>-1&&E.cmp(uu.max(m,w))<1)&&k<g&&k>v&&-s.sign()===t.sign()&&-n.sign()===i.sign()&&(l=y,c=E,g=k,u=T?M:[e,...M??[]])}}r&&g>e.d&&m.push({x:t,y:i,w:o}),m.push({x:l,y:c,w:u}),!r&&g>e.d&&m.push({x:t,y:i,w:o})}if(m.length<3)return g;for(;Mu(m[m.length-2].w,m[m.length-1].w,m[0].w);)m.splice(m.length-1,1);let v="";for(let a=0;a<m.length;a++){const{w:d,x:h,y:u}=m[a],p=m[0===a?m.length-1:a-1],f=m[a===m.length-1?0:a+1];if(Mu(p.w,d,f.w))m.splice(a--,1);else{p.y.sub(u).mul(h.sub(f.x)).cmp(u.sub(f.y).mul(p.x.sub(h)))&&(v+=`${+h},${+u} `);const a=Mu(p.w,d);if(a){const{id:d,colour:{r:m,g:f,b:w,a:v},x1:y,y1:E,x2:k,y2:M,scattering:T}=a;if(m||f||w){const[m,f,w]=bu(y,E,k,M,s,n);if(w<c){const c={id:d,x1:h,y1:u,x2:p.x,y2:p.y,colour:Hn,scattering:0},y=r+Math.round(T*(+m-r)/256),E=l+Math.round(T*(+f-l)/256);if(v<255){const r=e.wallInteraction(Math.round(y),Math.round(E),s,n,a.colour,w/i,!0);r&&g.push(..._u(r,t,i,c,o+1))}if(v>0){const[s,n]=Tu(h,u,p.x,p.y,y,E),d=+s.add(s),m=+n.add(n),f=e.wallInteraction(Math.round(d-y),Math.round(m-E),Math.round(d-r),Math.round(m-l),a.colour,w/i);f&&g.push(..._u(f,t,i,c,o+1))}}}}}}return g.push(e.createLightPolygon(v,i)),g},Nu=[],Au=`data:image/svg+xml,%3Csvg xmlns="${ma}" viewBox="0 0 100 100"%3E%3Cg stroke-width="3"%3E%3Cpath d="M45,1 a2,3 0,0,0 0,30 v38 a2,3 0,0,0 0,30 v-15 a1,1 0,0,1 10,0 v15 a2,3 0,0,0 0,-30 v-38 a2,3 0,0,0 0,-30 v15 a1,1 0,0,1 -10,0 z" fill="%23dde" stroke="%23000" transform="rotate(45, 50, 50)" /%3E%3Cg transform="rotate(315, 50, 50)"%3E%3Cpath d="M47.5,50 v-35 q-2,-3 -2,-5 l2,-8 h5 l2,8 q0,2 -2,5 v35 z" fill="%23eee" stroke="%23000" /%3E%3Cpath d="M40,90 a1,1 0,0,0 20,0 v-25 a1,2 0,0,1 0,-10 a1,1 0,0,0 0,-5 h-20 a1,1 0,0,0 0,5 a1,2 0,0,1 0,10 z" fill="%23dd0" stroke="%23000" stroke-linejoin="round" /%3E%3C/g%3E%3C/g%3E%3C/svg%3E`,xu={name:as.TOOL_DEFAULT,id:"tool_default",icon:wo({viewBox:"0 0 20 20"},[Mo(as.TOOL_DEFAULT),no({d:"M1,1 L20,20 M1,10 V1 H10",fill:"none",stroke:"currentColor","stroke-width":2})])},Lu=e=>Nu.push(e),Su=()=>!1,Iu=e=>(e.stopPropagation(),!1),Cu=Qa({fill:"#000",stroke:"#fff","stroke-width":.5},["5,0 16,0 10.5,5","0,5 0,16 5,10.5","5,21 16,21 10.5,16","21,16 21,5 16,10.5"].map((e=>lo({points:e})))),Du=function(e,t=0){e.preventDefault();const i="tokenMouse"+e.button;(Wu[i]?.call(this,e,t)??1)&&xu[i]?.call(this,e,t)},Ru=function(e){e.preventDefault(),(Wu.tokenMouseWheel?.call(this,e)??1)&&xu.tokenMouseWheel?.call(this,e)},Pu=function(e){e.preventDefault(),(Wu.tokenMouseOver?.call(this,e)??1)&&xu.tokenMouseOver?.call(this,e)},$u=function(e){e.preventDefault();const t="mapMouse"+e.button;(Wu[t]?.call(this,e)??1)&&xu[t]?.call(this,e)},Hu=function(e){e.preventDefault(),(Wu.mapMouseWheel?.call(this,e)??1)&&xu.mapMouseWheel?.call(this,e)},Uu=function(e){e.preventDefault(),(Wu.mapMouseOver?.call(this,e)??1)&&xu.mapMouseOver?.call(this,e)},Gu=Ln({"window-title":as.TOOL_OPTIONS,"window-icon":Au}),Zu=()=>Wu===xu;let Wu=xu;on.push([6,()=>zn?[as.TAB_TOOLS,(()=>{Nu.sort(((e,t)=>Qi(e.name+"",t.name+""))),Nu.unshift(xu);let e=!1,t=null,i=0;const a=Ue(),o=Ue(),s=Ue([qe(as.TOOL_OPTIONS),o]),n=Nu.map(((a,n)=>{const r=mt({onclick:function(){Wu.unset?.(),a.set?.(),Wu=a,i=n,a.options?(k(o,a.options),e&&kd.value?p(In,ki(Gu)):p(s,{style:{display:void 0}})):e&&kd.value?Gu.remove():p(s,{style:{display:"none"}}),p(t,{class:{[c]:!1}}),p(t=this,{class:[c]})}},[a.icon,Ft(a.name)]);return a.id&&Ic(a.id,A`${as.TOOL}: ${a.name}`,"",(()=>r.click()))[0](),r})),r=n[0],[l,c,d]=U(3);return P({[`#${l}`]:{">ul":{"list-style":"none",padding:0,"margin-top":0,">li":{cursor:"pointer",padding:"0.4em"," :is(img, svg)":{width:"2em",height:"2em","padding-right":"3px","background-color":"transparent"}}},[` li.${c}`]:{"background-color":"#888"}},[`.${d} #${l}>ul`]:{"margin-bottom":0,"padding-bottom":0," svg + span":{display:"none"}}}),p(a,{id:l,onpopout:()=>{e=!0,kd.value&&(p(Gu,o),Wu.options&&(p(s,{style:{display:"none"}}),p(In,ki(Gu))))},onpopin:()=>{e=!1,kd.value&&(p(s,o),Wu.options&&(p(s,{style:{display:void 0}}),Gu.remove()))}},[di(n),s]),r.click(),Bs((()=>r.click())),kd.wait((t=>{p(document.body,{class:{[d]:t}}),e&&(t?(p(Gu,o),Wu.options&&(p(s,{style:{display:"none"}}),p(In,ki(Gu)))):(p(s,o),Wu.options&&(p(s,{style:{display:void 0}}),Gu.remove())))})),Ic("toolPrev",as.KEY_TOOL_PREV,"Shift+(",(()=>n[gi(i-1,Nu.length)].click()))[0](),Ic("toolNext",as.KEY_TOOL_NEXT,"Shift+)",(()=>n[gi(i+1,Nu.length)].click()))[0](),a})(),!0,Au]:null]);let ju,Vu,Fu=wo(),zu=[];const Ku={"":0,Grid:-1,Light:-2},Yu=(e,t,i="")=>{i+="/"+t.name;const a=Qa(zn&&t.hidden?{class:Fo}:void 0);if(Bu(t)){const o=new ua(a);for(const a of t.children)o.push(Yu(e,a,i));return Object.assign(t,{[qi]:Kn&&t.hidden?Qa():a,l:a,children:o,path:i})}const o=new ua(a);if("Grid"!==t.name&&"Light"!==t.name)for(const i of t.tokens)o.push(mp(i)?new md(i,e):fp(i)?new gd(i):new fd(i));else p(a,{id:"Grid"===t.name?Vo:jo}),t.walls=[];return Object.assign(t,{id:Ku[t.name]??1,[qi]:Kn&&t.hidden?Qa():a,l:a,path:i,tokens:o})},Bu=e=>void 0!==e.children,qu=(e,t)=>e.children.some((e=>t(e)||ip(e)&&qu(e,t))),Xu=[],[Qu,Ju]=U(3),ep=e=>{const t=e.lastIndexOf("/");return[e.slice(0,t),e.slice(t+1)]},tp=(e,t=ju,i=!1)=>{for(const a of t.children)ap(a)?e(a,i||a.hidden):tp(e,a,i||a.hidden)},ip=e=>void 0!==e.children,ap=e=>void 0!==e.tokens,op=(e,t=ju)=>e.split("/").filter((e=>e)).every((e=>{if(ip(t)){const i=t.children.filter((t=>t.name===e)).pop();if(i)return t=i,!0}return!1}))?t:null,sp=e=>{const[t,i]=ep(e),a=op(t);return a&&ip(a)?[a,op(i,a)]:[null,null]},np=(e,t)=>{const i=op(e);Kn?i&&(t?i[qi]!==i.l&&i[qi].replaceWith(i[qi]=i.l):i[qi]===i.l&&i.l.replaceWith(i[qi]=Qa()),i.hidden=!t):i?.[qi].classList.toggle(Fo,i.hidden=!t),wp()},rp=e=>(ju.children.push(Yu(void 0,{id:0,name:ep(e)[1],hidden:!1,locked:!1,children:[],folders:{},items:{}})),e),lp=(e,t)=>{const i=op(e);return i.path=`${ep(e)[0]}/${t}`,i.name=t},cp=e=>{const[t,i]=sp(e);t.children.filterRemove((e=>Object.is(e,i))),wp()},dp=e=>(ju.children.push(Yu(void 0,{name:e,id:0,hidden:!1,locked:!1,tokens:[],walls:[]})),e),hp=(e,t,i)=>{const[a,o]=ep(e),s=op(a),n=op(t);if(ip(s)){const e=s.children.filterRemove((e=>e.name===o)).pop();e.path=t+"/"+e.name,n.children.splice(i,0,e)}wp()},up=e=>{Object.assign(Vu,e),p(Fu,{width:e.width,height:e.height}),Qc.setGrid(e),wp()},pp=e=>Qc.setLight(Vu.lightColour=e),mp=e=>void 0!==e.src,fp=e=>void 0!==e.points,gp=e=>((e.x1>e.x2||e.x1===e.x2&&e.y1>e.y2)&&([e.x1,e.x2,e.y1,e.y2]=[e.x2,e.x1,e.y2,e.y1]),e),wp=()=>{const{gridSize:e,gridDistance:t,width:i,height:a}=Vu,o=new uu(BigInt(i)),s=new uu(BigInt(a)),n=[{id:-1,x1:uu.zero,y1:uu.zero,x2:o,y2:uu.zero,colour:Hn,scattering:0},{id:-2,x1:o,y1:uu.zero,x2:o,y2:s,colour:Hn,scattering:0},{id:-3,x1:uu.zero,y1:s,x2:o,y2:s,colour:Hn,scattering:0},{id:-4,x1:uu.zero,y1:uu.zero,x2:uu.zero,y2:s,colour:Hn,scattering:0}],r=[],l=e=>{for(const{id:t,x1:i,y1:a,x2:o,y2:s,colour:r,scattering:l}of e){const e=n.length,c=new uu(BigInt(i)),d=new uu(BigInt(a)),h=new uu(BigInt(o)),u=new uu(BigInt(s)),p=[[c,d],[h,u]];for(let t=0;t<e;t++){const{id:e,x1:i,y1:a,x2:o,y2:s,colour:r,scattering:l}=n[t],[m,f]=Ou(c,d,h,u,i,a,o,s);1===m.cmp(uu.min(c,h))&&1===m.cmp(uu.min(i,o))&&-1===m.cmp(uu.max(c,h))&&-1===m.cmp(uu.max(i,o))&&1===f.cmp(uu.min(d,u))&&1===f.cmp(uu.min(a,s))&&-1===f.cmp(uu.max(d,u))&&-1===f.cmp(uu.max(a,s))&&(n[t].x2=m,n[t].y2=f,n.push({id:e,x1:m,y1:f,x2:o,y2:s,colour:r,scattering:l}),p.push([m,f]))}p.sort((([e,t],[i,a])=>e.cmp(i)||t.cmp(a)));for(let e=1;e<p.length;e++){const[i,a]=p[e-1],[o,s]=p[e];n.push({id:t,x1:i,y1:a,x2:o,y2:s,colour:r,scattering:l})}}},c=e=>{for(const t of e)if(t.lightTimings.length&&t.lightStages.reduce(((e,t)=>e+t),0))if(t.lightTimings.length>1&&!_d.value){const[e,i]=t.getCentre(),[a,o]=t.getLightPos();r.push(new $c(e,i,a,o,t.lightColours.map((e=>[e[0]??Hn])),t.lightStages,[0]))}else r.push(t)};let d=-5;tp(((e,t)=>{t||(l(hd(e.name).map((e=>(e.id=d--,e))).concat(...e.walls)),c(ud(e.name).concat(...e.tokens)))})),l(hd("").map((e=>(e.id=d--,e)))),c(ud(""));let h=n.length!==zu.length,u=0;for(let e=0;e<n.length;e++){const t=n[e];if(!h){const i=zu[e];h=!!(t.x1.cmp(i.x1)||t.x2.cmp(i.x2)||t.y1.cmp(i.y1)||t.y2.cmp(i.y2)||t.scattering!==i.scattering||t.colour.toString()!==i.colour.toString())}Object.freeze(t)}for(h&&Qc.clearLighting();u<r.length;u++){const i=r[u];if(!h&&Xu.length>u){const e=Xu[u],t=i.getCentre(),a=e.getCentre(),o=i.getLightPos(),s=e.getLightPos();let n=t[0]!==a[0]||t[1]!==a[1]||o[0]!==s[0]||o[1]!==s[1]||i.lightStages.length!==e.lightStages.length||i.lightTimings.length!==e.lightTimings.length;if(!n)for(let t=0;!n&&t<i.lightStages.length;t++)n=i.lightStages[t]!==e.lightStages[t];if(!n)for(let t=0;!n&&t<i.lightTimings.length;t++)n=i.lightTimings[t]!==e.lightTimings[t];if(!n)for(let t=0;!n&&t<i.lightColours.length;t++)for(let a=0;!n&&a<i.lightColours[0].length;a++)n=i.lightColours[t][a].toString()!==e.lightColours[t][a].toString();if(!n)continue;Qc.clearLightGroup("L"+u)}Qc.setLightGroup("L"+u),_u(i,n,e/(t||1));const[a,o]=i.getCentre(),[s,l]=i.getLightPos();Xu.splice(u,1,new $c(a,o,s,l,Xs(i.lightColours),Xs(i.lightStages),Xs(i.lightTimings)))}for(;u<Xu.length;u++)Qc.clearLightGroup("L"+u);Xu.length>r.length&&Xu.splice(r.length,Xu.length-r.length),h&&(zu=n,pd(n))},vp=(()=>{const e=wa({attributeName:"r",values:"4;46",dur:"1s"}),t=wa({attributeName:"r",values:"4;46",dur:"1s"}),i=Qa([Ea({cx:50,cy:50,stroke:"#f00","stroke-width":8,fill:"none"},e),Ea({cx:50,cy:50,stroke:"#00f","stroke-width":4,fill:"none"},t)]);return a=>{p(Fu,p(i,{transform:`translate(${a[0]-50}, ${a[1]-50})`})),e.beginElement(),t.beginElement()}})(),yp={x:0,y:0,zoom:1},Ep=(()=>{const e=[[0,1/6],[0,2/6],[0,.5],[0,5/6],[1/4,1/12],[1/4,7/12],[.5,0],[.5,1/3],[.5,2/3],[.5,5/6],[.5,1],[3/4,1/12],[3/4,7/12],[1,1/6],[1,2/6],[1,.5],[1,5/6]];return(t,i,a=!1)=>{const{width:o,height:s,gridType:n,gridSize:r}=Vu,{x:l,y:c,zoom:d}=yp,h=(t+(d-1)*o/2-l)/d,u=(i+(d-1)*s/2-c)/d;if(a)switch(n){case 1:case 2:{const t=2*Math.round(1.5*r/Xc),i=1===n?r:t,a=2===n?r:t,o=h/i,s=u/a,l=o%1,c=s%1,d=n-1,p=1-d;let m=[0,0],f=1/0;for(const t of e){const e=Math.hypot(t[d]-l,t[p]-c);e<f&&(f=e,m=t)}return[Math.round((Math.floor(o)+m[d])*i),Math.round((Math.floor(s)+m[p])*a)]}default:const t=r>>1;return[t*Math.round(h/t),t*Math.round(u/t)]}return[Math.round(h),Math.round(u)]}})(),kp=(()=>{const e=e=>{const t=Math.max(10,Math.min(110,e.clientY));p(a,{cy:t}),kp(Math.pow(1.4,(60-t)/10)/yp.zoom,window.innerWidth>>1,window.innerHeight>>1,!1)},[t]=le(0,e,(()=>p(document.body,{class:{[Bo]:!1}}))),i=e=>kp(.95*Math.sign(e.deltaY),window.innerWidth>>1,window.innerHeight>>1),a=Ea({cx:10,cy:60,r:10,stroke:"#000",onmousedown:e=>{0===e.button&&(t(),p(document.body,{class:[Bo]}))},onwheel:i}),o=Math.log(1.4);return ir.then((()=>p(Sn,wo({id:Yo,viewBox:"0 0 20 120"},[uo({width:20,height:120,rx:10,stroke:"#000",onclick:t=>{0===t.button&&e(t)},onwheel:i}),a])))),Td.wait((e=>p(Sn,{class:{[Ko]:e}}))),Bs((()=>p(a,{cy:"60"}))),(e,t,i,s=!0)=>{const n=fi(parseInt(Fu.getAttribute("width")||"0"),0)/2,r=fi(parseInt(Fu.getAttribute("height")||"0"),0)/2,l=yp.zoom;e<0?yp.zoom/=-e:e>0&&(yp.zoom*=e),yp.x+=t-(yp.zoom*(t+(l-1)*n-yp.x)/l+yp.x-(yp.zoom-1)*n),yp.y+=i-(yp.zoom*(i+(l-1)*r-yp.y)/l+yp.y-(yp.zoom-1)*r),p(Fu,{transform:`scale(${yp.zoom})`,style:{left:yp.x+"px",top:yp.y+"px","--zoom":yp.zoom}}),s&&p(a,{cy:Math.max(10,120-Math.min(110,60+10*Math.log(yp.zoom)/o))})}})(),Mp=(e,t)=>{const{width:i,height:a}=Vu,o=window.innerWidth,s=window.innerHeight,{zoom:n}=yp;yp.x=Math.min(Math.max((o-i)/2-(e-i/2)*n,o-i*(n+1)/2),i*(n-1)/2),yp.y=Math.min(Math.max((s-a)/2-(t-a/2)*n,s-a*(n+1)/2),a*(n-1)/2),p(Fu,{style:{left:yp.x+"px",top:yp.y+"px"}})},Tp=(e,t=!1)=>{zu=[],Xu.splice(0,Xu.length),Vu=e,Fc.clear(),tn.clear(),qc.set(Vu.baseOpaque,Vu.masks),Qc.clear();const i=new Pi,{width:a,height:o,lightColour:s,startX:n,startY:r}=Vu,l=Ue(),c=It(),d=Ue({id:Ju},Ue([as.LOADING_MAP,": ",c,l])),h=Qa(),u=new ua(h);for(const e of Vu.children)u.push(Yu(i,e));return ju={id:0,name:"",hidden:!1,locked:!1,[qi]:h,l:h,children:u,folders:{},items:{},path:"/"},Fu=wo({id:zo,width:a,height:o},[Qc[qi],h,uo({width:"100%",height:"100%",fill:"#000",style:zn?{"fill-opacity":"var(--maskOpacity, 1)"}:void 0,mask:`url(#${Xo})`})]),i.onComplete((()=>setTimeout((()=>d.remove()),zn?0:1e3))),Qc.setGrid(Vu),p(op("/Grid").l,uo({width:"100%",height:"100%",fill:`url(#${Qo})`})),p(op("/Light").l,bo({href:`#${qo}`,style:"mix-blend-mode: multiply"})),Qc.setLight(s),qu(ju,(e=>{if(!Bu(e)){for(const a of e.tokens)if(Fc.set(a.id,{layer:e,token:a}),mp(a)&&a.tokenData){const e=a.tokenData["store-character-id"];if(t&&e&&"number"==typeof e.data&&!Qs.has(e.data)){const t=e.data;Qs.set(t,{}),i.add(),Ei((()=>Xn.characterGet(t).then((e=>Qs.set(t,e))).finally((()=>i.done()))))}}for(const t of e.walls)tn.set(t.id,{layer:e,wall:t})}return!1})),i.onUpdate((({waits:e,done:t,errors:i})=>{const a=t+i;k(l,`${a} / ${e}`),p(c,{max:e,value:a})})),i.add(),i.done(),wp(),yp.zoom=1,Mp(n,r),Ue({id:Qu,onmousedown:e=>$u.call(Fu,e),onwheel:e=>Hu.call(Fu,e),onmouseover:e=>Uu.call(Fu,e)},[Fu,d])};P({[`#${Qu}`]:{height:"100%"},[`#${zo}`]:{"background-color":"#fff",outline:"none",position:"absolute",">g":{"clip-path":"view-box"}},[`#${jo}.hiddenLayer,#${Vo}.hiddenLayer`]:{display:"none"},[`#${qo}>*`]:{"mix-blend-mode":"screen"},[`#${Ju}`]:{"background-color":"#fff",position:"fixed",top:0,left:0,bottom:0,right:0,">div":{display:"flex","align-items":"center","justify-content":"center","flex-wrap":"wrap",height:"100%"}," progress":{margin:"0 1em"}},[`.${Ko} #${Yo}`]:{display:"none"},[`#${Yo}`]:{"z-index":"10",position:"absolute",top:"3px",left:"3px",width:"20px",height:"120px",fill:"rgba(255, 255, 255, 0.2)"," :is(rect, circle)":{transition:"fill 0.5s"}," rect":{cursor:"pointer"}," circle":{cursor:"ns-resize"}},[`#${Yo}:hover, .${Bo} #${Yo}`]:{" rect":{fill:"#fff"}," circle":{fill:"#f00"}}}),$("@media (prefers-color-scheme: light)",{[`:root.${Io} #${Ju}`]:{"background-color":"#000"}}),$("@media (prefers-color-scheme: dark)",{[`:root.:not(${Io}) #${Ju}`]:{"background-color":"#000"}}),xu.mapMouseWheel=e=>{if(e.ctrlKey)kp(.95*Math.sign(e.deltaY),e.clientX,e.clientY);else{const t=Ad.value||100;p(Fu,{style:{left:(yp.x+=Math.sign(e.shiftKey?e.deltaY:e.deltaX)*-t)+"px",top:(yp.y+=(e.shiftKey?0:Math.sign(e.deltaY))*-t)+"px"}})}return!1},_d.wait((()=>Vu&&wp())),ir.then((()=>{Xn.waitMapStartChange().when((e=>[Vu.startX,Vu.startY]=e)),Xn.waitSignalPosition().when(vp),qn.waitGridDistanceChange().when((e=>{Vu.gridDistance=e,wp()})),qn.waitGridDiagonalChange().when((e=>Vu.gridDiagonal=e))})),Ic("centreMap",as.KEY_CENTRE_MAP,"c",(()=>Mp(Vu.startX,Vu.startY)))[0]();const bp=e=>{Xn.waitCurrentUserMapData().when((t=>{e.replaceWith(e=Tp(t,!0)),Ys(!1)}));let t=-1,i=0,a=0;const o=e=>{p(Fu,{style:{left:`${yp.x+=e.clientX-i}px`,top:`${yp.y+=e.clientY-a}px`}}),i=e.clientX,a=e.clientY},s=()=>p(document.body,{class:{[d]:!1}}),[n]=le(0,o,s),[r]=le(1,o,s),l=(e,t)=>(i=e.clientX,a=e.clientY,p(document.body,{class:[d]}),t(),!1),c=(e,t)=>{const i=e.hasLight();for(const i in t)switch(i){case"id":break;case"src":e instanceof Uc&&t.src&&e.updateSource(t.src);break;case"tokenData":const a=t[i];for(const t in a)e.tokenData[t]=a[t];break;case"removeTokenData":const o=t[i];for(const t of o)delete e.tokenData[t];break;default:e[i]=t[i]}return e.updateNode(),i||e.hasLight()},[d,h,u]=U(3);_d.wait((e=>p(document.documentElement,{class:{[u]:e}}))),P(`#${zo}`,{overflow:"hidden",cursor:"grab"}),P(`.${d} #${zo}`,{cursor:"grabbing"}),P(`.${u} .${h} #${zo}`,{"transition-property":"left, top","transition-duration":"1s","transition-timing-function":"ease"}),xu.mapMouse0=e=>l(e,n),xu.mapMouse1=e=>l(e,r),xu.mapMouse2=e=>{const t=Ep(e.clientX,e.clientY);return vp(t),Xn.signalPosition(t),!1},Xn.waitSignalMovePosition().when((e=>{-1===t?p(document.body,{class:[h]}):clearTimeout(t),t=setTimeout((()=>{p(document.body,{class:{[t]:!1}}),t=-1}),1e3),Mp(e[0],e[1]),vp(e)})),Xn.waitMapChange().when(up),Xn.waitMapLightChange().when(pp),Xn.waitLayerShow().when((e=>np(e,!0))),Xn.waitLayerHide().when((e=>np(e,!1))),Xn.waitLayerAdd().when(dp),Xn.waitLayerFolderAdd().when(rp),Xn.waitLayerMove().when((({from:e,to:t,position:i})=>hp(e,t,i))),Xn.waitLayerRename().when((({path:e,name:t})=>lp(e,t))),Xn.waitLayerRemove().when(cp),Xn.waitTokenAdd().when((e=>{const t=op(e.path);if(t&&ap(t)){let i;if(delete e.path,mp(e.token)){i=new md(e.token);const t=e.token.tokenData["store-character-id"];t&&"number"==typeof t.data&&Xn.characterGet(t.data).then((e=>Qs.set(t.data,e)))}else i=fp(e.token)?new gd(e.token):new fd(e.token);void 0===e.pos?t.tokens.push(i):t.tokens.splice(e.pos,0,i),Fc.set(i.id,{layer:t,token:i}),i.hasLight()&&wp()}})),Xn.waitTokenMoveLayerPos().when((({id:e,to:t,newPos:i})=>{const a=Fc.get(e)??{layer:null,token:null},{layer:o,token:s}=a,n=op(t);o&&s&&n&&ap(n)&&(i>n.tokens.length&&(i=n.tokens.length),n.tokens.splice(i,0,o.tokens.splice(o.tokens.findIndex((e=>e===s)),1)[0]),a.layer=n,s.hasLight()&&wp())})),Xn.waitTokenSet().when((e=>{const{token:t}=Fc.get(e.id)??{token:null};t&&c(t,e)&&wp()})),Xn.waitTokenSetMulti().when((e=>{let t=!1;for(const i of e){const{token:e}=Fc.get(i.id)??{token:null};e&&c(e,i)&&(t=!0)}t&&wp()})),Xn.waitTokenRemove().when((e=>{const{layer:t,token:i}=Fc.get(e);t.tokens.splice(t.tokens.findIndex((e=>e===i)),1),i instanceof Uc&&i.cleanup(),i.hasLight()&&wp()})),Xn.waitLayerShift().when((({path:e,dx:t,dy:i})=>{const a=op(e);if(a&&ap(a)){for(const e of a.tokens)e.x+=t,e.y+=i,e.updateNode();for(const e of a.walls)e.x1+=t,e.y1+=i,e.x2+=t,e.y2+=i;wp()}})),Xn.waitWallAdded().when((({path:e,wall:t})=>{const i=op(e);i&&ap(i)&&(i.walls.push(gp(t)),wp())})),Xn.waitWallRemoved().when((e=>{const{layer:t,wall:i}=tn.get(e);t.walls.splice(t.walls.findIndex((e=>e===i)),1),wp()})),Xn.waitWallModified().when((e=>{const t=tn.get(e.id);t&&(Object.assign(t.wall,e),wp())})),Xn.waitWallMoved().when((({id:e,path:t})=>{const i=tn.get(e),a=op(t);i&&a&&ap(a)&&(i.layer.walls.splice(i.layer.walls.findIndex((e=>e===i.wall))),a.walls.push(i.wall),i.layer=a)})),Xn.waitMapDataSet().when((e=>{e.key&&(Vu.data[e.key]=e.data)})),Xn.waitMapDataRemove().when((e=>delete Vu.data[e])),Xn.waitMaskAdd().when(qc.add),Xn.waitMaskRemove().when(qc.remove),Xn.waitMaskSet().when((({baseOpaque:e,masks:t})=>qc.set(e,t))),Xn.waitGridDistanceChange().when(wp)},Op=new ua(di()),_p=new ua(di()),Np={add:(e,t)=>{Ei((async()=>{_p.splice(0,_p.length),0!==xd.value?(-1!==xd.value&&Op.length>=xd.value&&Op.splice(0,Op.length-xd.value),Op.push({fn:e,[qi]:mt(t)})):Op.splice(0,Op.length)}))},clear:()=>{Ei((async()=>{Op.splice(0,Op.length),_p.splice(0,_p.length)}))},undo:()=>{Ei((async()=>{const e=Op.pop();e&&(e.fn=e.fn(),_p.unshift(e))}))},redo:()=>{Ei((async()=>{const e=_p.shift();e&&(e.fn=e.fn(),Op.push(e))}))}};ir.then((()=>{if(!zn)return;const e=new Oi("undo-window-show").wait((e=>{e&&p(In,t)})),t=Ln({"window-title":as.UNDO_WINDOW_TITLE,style:"--window-left: 0px; --window-top: 0px; --window-width: 200px; --window-height: 600px","window-data":"undo-window-settings",resizable:!0,onremove:()=>e.set(!1)},[Oe({onclick:Np.undo},as.UNDO_UNDO),Oe({onclick:Np.redo},as.UNDO_REDO),Be(as.UNDO_WINDOW_UNDOS),Op[qi],Be(as.UNDO_WINDOW_REDOS),_p[qi]]);Object.defineProperty(window,"showUndoWindow",{value:()=>e.set(!0)})}));const Ap=Np,xp=new Ri((()=>{})),Lp=()=>xp,Sp=()=>Promise.reject("invalid"),Ip=e=>(Pp(e),cp(e),Xn.removeLayer(e)),Cp=(e,t)=>{const i={id:e.id,tokenData:{},removeTokenData:[]};for(const a in e)switch(a){case"id":break;case"tokenData":const o=e[a];for(const e in o)t.tokenData[e]?i.tokenData[e]=t.tokenData[e]:i.removeTokenData.push(e);break;case"removeTokenData":const s=e[a];for(const e of s)i.tokenData[e]=t.tokenData[e];break;default:i[a]=t[a]}return i},Dp=(e,t)=>{for(const i in e)switch(i){case"id":break;case"src":t instanceof Uc&&e.src&&t.updateSource(e.src);break;case"tokenData":const a=e[i];for(const e in a)t.tokenData[e]=a[e];break;case"removeTokenData":const o=e[i];for(const e of o)delete t.tokenData[e];break;default:t[i]=e[i]}t.updateNode(),zc.token===t&&(p(Kc,{style:{"--outline-width":t.width+"px","--outline-height":t.height+"px"},class:Yc(t.rotation),transform:t.transformString(!1)}),Hp.x=t.x,Hp.y=t.y,Hp.width=t.width,Hp.height=t.height,Hp.rotation=t.rotation)},Rp=()=>{const{token:e}=zc;if(e instanceof Uc&&!e.isPattern){const{src:t,width:i,height:a,patternWidth:o,patternHeight:s,rotation:n,flip:r,flop:l,snap:c,lightColours:d,lightStages:h,lightTimings:u}=e,p=Xs(e.tokenData);for(const e of cd())delete p[e];return{src:t,width:i,height:a,patternWidth:o,patternHeight:s,rotation:n,flip:r,flop:l,snap:c,lightColours:Xs(d),lightStages:Xs(h),lightTimings:Xs(u),tokenData:p}}},Pp=e=>{const{layer:t}=zc;t&&(t.path===e||t.path.startsWith(e+"/"))&&(zc.layer=null,zc.token&&Bc())},$p=e=>Bp[1](e.path),Hp={mouseX:0,mouseY:0,x:0,y:0,width:0,height:0,rotation:0},Up=Ri.bind(1),Gp=Ri.bind(1),Zp=Ri.bind(1),Wp=Ri.bind(1),jp=Ri.bind(1),Vp=Ri.bind(1),Fp=Ri.bind(1),zp=Ri.bind(1),Kp=Ri.bind(1),Yp=Ri.bind(1),Bp=Ri.bind(1),qp=(e,t=!0)=>{let i={width:Vu.width,height:Vu.height,gridType:Vu.gridType,gridSize:Vu.gridSize,gridStroke:Vu.gridStroke,gridColour:Vu.gridColour};const a=(t=!0)=>(up(e),t&&Ei(Xn.setMapDetails.bind(Xn,e)),[e,i]=[i,e],a);Ap.add(a(t),as.UNDO_MAP_CHANGE)},Xp=(e,t=!0)=>{let i=Vu.lightColour;const a=(t=!0)=>(pp(e),t&&Ei(Xn.setLightColour.bind(Xn,e)),[e,i]=[i,e],a);Ap.add(a(t),as.UNDO_LIGHT_COLOUR)},Qp=(e,t,i=!0)=>{const a=(i=!0)=>(np(e,t),i&&Ei(t?()=>(jp[1](e),Xn.showLayer(e)):()=>(Vp[1](e),Xn.hideLayer(e))),t=!t,a);return Ap.add(a(i),as[t?"UNDO_LAYER_SHOW":"UNDO_LAYER_HIDE"]),e},Jp=(e,t,i=!0)=>{const a=op(e),o=(i=!0)=>(i&&Ei(t?()=>(Fp[1](e),Xn.showLayer(e)):()=>(zp[1](e),Xn.hideLayer(e))),a&&(a.locked=t),t=!t,o);return Ap.add(o(i),as[t?"UNDO_LAYER_LOCK":"UNDO_LAYER_UNLOCK"]),e},em=(e,t=!0)=>{const i="/"+e,a=(t=!0)=>(dp(e),t&&Ei((()=>(Up[1]([{id:1,name:e}]),Xn.addLayer(e)))),o),o=()=>(Pp(i),cp(i),Ei((()=>(Gp[1](i),Xn.removeLayer(i)))),a);return Ap.add(a(t),as.UNDO_LAYER_ADD),e},tm=(e,t=!0)=>{const i=(t=!0)=>(rp(e),t&&Ei((()=>(Zp[1](e),Xn.addLayerFolder(e)))),a),a=()=>(Pp(e),cp(e),Ei((()=>(Wp[1](e),Xn.removeLayer(e)))),i);return Ap.add(i(t),as.UNDO_LAYER_FOLDER_ADD),e},im=(e,t,i,a=!0)=>{const[o,s]=sp(e);if(!o||!s)return void tr("Invalid layer move");let[n,r]=ep(e),l=o.children.indexOf(s);const c=(a=!0)=>{if(Bc(),hp(e,t,i),a){const a={from:e,to:t,position:i};Ei((()=>(Kp[1](a),Xn.moveLayer(a.from,a.to,a.position))))}return[t,n]=[n,t],e=n+"/"+r,[l,i]=[i,l],c};Ap.add(c(a),as.UNDO_LAYER_MOVE)},am=(e,t,i=!0)=>{let[a,o]=ep(e),s=a+"/"+o;const n=(i=!0)=>{if(lp(e,t),i){const i={path:e,name:t};Ei((()=>(Yp[1](i),Xn.renameLayer(i.path,i.name))))}return[e,s]=[s,e],[o,t]=[t,o],n};Ap.add(n(i),as.UNDO_LAYER_RENAME)},om=(e,t,i=!0,a)=>{const o=op(e);if(!o||!ap(o))return tr("Invalid layer for token add"),()=>{};const s=mp(t)?new md(t):fp(t)?new gd(t):new fd(t),n=s.hasLight(),r=e=>{s.id=e,void 0===a?o.tokens.push(s):o.tokens.splice(a,0,s),Fc.set(e,{layer:o,token:s}),n&&wp()},l=(t=!0)=>(t&&Ei((()=>Xn.addToken(e,s,a).then(r))),c),c=()=>(s===zc.token&&Bc(),Fc.delete(s.id),o.tokens.pop(),Ei((()=>Xn.removeToken(s.id))),n&&wp(),l);return Ap.add(l(i),as.UNDO_TOKEN_ADD),r},sm=(e,t,i,a=!0)=>{let o=Fc.get(e).layer,s=op(t);const n=Fc.get(e).token;if(!(o&&n&&s&&ap(s)))return void tr("Invalid Token Move Layer/Pos");i>s.tokens.length&&(i=s.tokens.length);let r=o.tokens.findIndex((e=>e===n));const l=n.hasLight(),c=(t=!0)=>(s.tokens.splice(i,0,o.tokens.splice(r,1)[0]),Fc.get(e).layer=s,l&&wp(),zc.token===n&&Bc(),t&&Ei(Xn.setTokenLayerPos.bind(Xn,e,s.path,i)),[r,i]=[i,r],[o,s]=[s,o],c);Ap.add(c(a),as.UNDO_TOKEN_MOVE)},nm=(e,t=!0)=>{const{token:i}=Fc.get(e.id);if(!i)return void tr("Invalid token for token set");let a=Cp(e,i);const o=e.lightColours||e.lightStages||e.lightTimings||void 0!==e.x||void 0!==e.y||e.width||e.height,s=(t=!0)=>(Dp(e,i),t&&Ei(Xn.setToken.bind(Xn,e)),o&&wp(),[a,e]=[e,a],s);Ap.add(s(t),as.UNDO_TOKEN_SET)},rm=(e,t=!0)=>{const i=[];let a=[];for(const t of e){const{token:e}=Fc.get(t.id);if(!e)return void tr("Invalid token for token set (multi)");i.push(e),a.push(Cp(t,e))}const o=e.some((e=>e.lightStages?.length||e?.lightTimings?.length||void 0!==e.x||void 0!==e.y||e.width||e.height)),s=(t=!0)=>{for(let t=0;t<a.length;t++)Dp(e[t],i[t]);return t&&Ei(Xn.setTokenMulti.bind(Xn,e)),o&&wp(),[a,e]=[e,a],s};Ap.add(s(t),as.UNDO_TOKEN_SET_MULTI)},lm=(e,t=!0)=>{const{layer:i,token:a}=Fc.get(e);if(!a)return void tr("invalid token for removal");const o=i.tokens.findIndex((e=>e===a)),s=a.hasLight(),n=(t=!0)=>(a===zc.token&&Bc(),i.tokens.splice(o,1),Fc.delete(e),a.cleanup(),s&&wp(),t&&Ei((()=>Xn.removeToken(a.id))),r),r=()=>(i.tokens.splice(o,0,a),Ei((()=>Xn.addToken(i.path,a,o).then((e=>{a.id=e,Fc.set(e,{layer:i,token:a})})))),a.uncleanup(),s&&wp(),n);Ap.add(n(t),as.UNDO_TOKEN_REMOVE)},cm=(e,t,i,a=!0)=>{const o=op(e);if(!o||!ap(o))return void tr("invalid layer for shifting");const s=(a=!0)=>{for(const e of o.tokens)e.x+=t,e.y+=i,e.updateNode();for(const e of o.walls)e.x1+=t,e.y1+=i,e.x2+=t,e.y2+=i;return wp(),a&&Ei(Xn.shiftLayer.bind(Xn,e,t,i)),t=-t,i=-i,s};Ap.add(s(a),as.UNDO_LAYER_SHIFT)},dm=(e,t=!0)=>{const i=op(e.path);if(!i||!ap(i))return void tr("invalid layer for wall add");const{path:a,wall:{id:o,x1:s,y1:n,x2:r,y2:l,colour:c,scattering:d}}=e,h=gp({id:o,x1:s,y1:n,x2:r,y2:l,colour:c,scattering:d}),u=(e=!0)=>(i.walls.push(h),e?Ei((()=>Xn.addWall(a,{id:o,x1:s,y1:n,x2:r,y2:l,colour:c,scattering:d}).then((e=>{h.id=e,tn.set(e,{layer:i,wall:h}),wp()})))):o>0&&(tn.set(o,{layer:i,wall:h}),wp()),p),p=()=>{i.walls.splice(i.walls.findIndex((e=>e===h)),1),wp();const e=h.id;return Ei((()=>Xn.removeWall(e))),tn.delete(e),h.id=0,u};s===r&&n===l||Ap.add(u(t),as.UNDO_WALL_ADD)},hm=(e,t=!0)=>{const{layer:i,wall:a}=tn.get(e);if(!i||!a)return void tr("invalid wall to remove");const o=(e=!0)=>{if(i.walls.splice(i.walls.findIndex((e=>e===a)),1),wp(),e){const e=a.id;Ei((()=>Xn.removeWall(e)))}return tn.delete(a.id),a.id=0,s},s=()=>(i.walls.push(a),Ei((()=>Xn.addWall(i.path,a).then((e=>{tn.set(a.id=e,{layer:i,wall:a}),wp()})))),o);Ap.add(o(t),as.UNDO_WALL_REMOVE)},um=(e,t=!0)=>{const i=tn.get(e.id);if(!i)return void tr("invalid wall to modify");let a=Xs(i.wall);const o=(t=!0)=>(Object.assign(i.wall,e),t&&Ei(Xn.modifyWall.bind(Xn,e)),wp(),[a,e]=[e,a],o);Ap.add(o(t),as.UNDO_WALL_MODIFY)},pm=(e,t,i=!0)=>{const a=tn.get(e);if(!a)return void tr("invalid wall to modify");let o=a.layer,s=o.path,n=op(t);if(!n||!ap(n))return void tr("invalid layer for wall move");const r=(i=!0)=>(a.layer=n,n.walls.push(o.walls.splice(o.walls.findIndex((({id:t})=>t===e)),1)[0]),i&&Ei(Xn.moveWall.bind(Xn,e,t)),[o,s,n,t]=[n,t,o,s],r);Ap.add(r(i),as.UNDO_WALL_MOVE)},mm=(e,t,i=!0)=>{const a=Vu.data[e],o=(i=!0)=>(Vu.data[e]=t,i&&Ei((()=>Xn.setMapKeyData(e,t))),s),s=()=>(a?Ei((()=>Xn.setMapKeyData(e,Vu.data[e]=a))):(delete Vu.data[e],Ei((()=>Xn.removeMapKeyData(e)))),o);Ap.add(o(i),as.UNDO_MAP_DATA_SET)},fm=(e,t=!0)=>{const i=Vu.data[e];if(!i)return;const a=(t=!0)=>(delete Vu.data[e],t&&Ei((()=>Xn.removeMapKeyData(e))),o),o=()=>(Vu.data[e]=i,Ei((()=>Xn.setMapKeyData(e,i))),a);Ap.add(a(t),as.UNDO_MAP_DATA_REMOVE)},gm=(e,t=!0)=>{let i=-1;const a=(t=!0)=>(i=qc.add(e),t&&Ei((()=>Xn.addToMask(e))),o),o=()=>(qc.remove(i),Ei((()=>Xn.removeFromMask(i))),a);Ap.add(a(t),as.UNDO_MASK_ADD)},wm=(e,t=!0)=>{const i=qc.baseOpaque,a=Xs(qc.masks),o=(t=!0)=>(qc.remove(e),t&&Ei((()=>Xn.removeFromMask(e))),s),s=()=>(qc.set(i,a),Ei((()=>Xn.setMask(i,a))),o);Ap.add(o(t),as.UNDO_MASK_REMOVE)},vm=(e,t=!0)=>{let i={baseOpaque:qc.baseOpaque,masks:qc.masks};const a=(t=!0)=>(qc.set(e.baseOpaque,e.masks),t&&Ei(Xn.setMask.bind(Xn,e.baseOpaque,e.masks)),[i,e]=[e,i],a);Ap.add(a(t),as.UNDO_MASK_SET)},ym=(e,t,i,a)=>{const o=Vu.gridSize;switch(Vu.gridType){case 1:{const s=1.5*o/Xc,n=Math.round(t/s),r=n%2==0?0:o>>1;return[Math.round((e-r)/o)*o+r+(Math.round(i/o)*o-i>>1),Math.round(n*s+(2*o/Xc+s*(Math.round(a/s)-1)-a>>1))]}case 2:{const s=1.5*o/Xc,n=Math.round(e/s),r=n%2==0?0:o>>1;return[Math.round(n*s+(2*o/Xc+s*(Math.round(i/s)-1)-i>>1)),Math.round((t-r)/o)*o+r+(Math.round(a/o)*o-a>>1)]}}return[Math.round(e/o)*o+(Math.round(i/o)*o-i>>1),Math.round(t/o)*o+(Math.round(a/o)*o-a>>1)]},Em=Object.freeze({waitAdded:()=>Up[0],waitMoved:Lp,waitRemoved:()=>Gp[0],waitCopied:Lp,waitFolderAdded:()=>Zp[0],waitFolderMoved:Lp,waitFolderRemoved:()=>Wp[0],waitLayerSetVisible:()=>jp[0],waitLayerSetInvisible:()=>Vp[0],waitLayerSetLock:()=>Fp[0],waitLayerSetUnlock:()=>zp[0],waitLayerPositionChange:()=>Kp[0],waitLayerRename:()=>Yp[0],waitLayerSelect:()=>Bp[0],list:Sp,createFolder:e=>Xn.addLayerFolder(e).then((e=>tm(e,!1))),move:Sp,moveFolder:Sp,remove:e=>(Ap.clear(),Ip(e)),removeFolder:e=>(Ap.clear(),Ip(e)),copy:Sp});let km=0,Mm=0;const Tm=new Li("character"),bm=`data:image/svg+xml,%3Csvg xmlns="${ma}" viewBox="0 0 100 100"%3E%3Cg stroke-width="2" stroke="%23000" fill="%23fff"%3E%3Cpath d="M99,89 A1,1 0,0,0 1,89 v10 H99 z" /%3E%3Ccircle cx="50" cy="31" r="30" /%3E%3C/g%3E%3C/svg%3E`,Om=(e,t,i,a)=>{const o=km,s={},n=new Set,r=Ln({"window-icon":bm,"window-title":t,"hide-minimise":!1,class:Im,style:{"--window-width":"auto"},ondragover:()=>r.focus(),onclose:e=>{(n.size>0||Object.keys(s).length>0)&&(e.preventDefault(),r.confirm(as.ARE_YOU_SURE,as.UNSAVED_CHANGES).then((e=>{e&&r.remove()})))}}),l=()=>s.name={user:d.checked,data:c.value},c=ct({type:"text",value:i.name?.data??"",onchange:l}),d=ct({type:"checkbox",class:Lm,checked:!1!==i.name?.user,onchange:l}),h=(e,t)=>Object.assign({[qi]:mt({class:Ro},[Oe({style:`background-image: url(${lu(t.src)})`,onclick:function(){r.confirm(as.TOKEN_REPLACE,as.TOKEN_REPLACE_CONFIRM).then((e=>{if(e){const e=Rp();if(!e)return void r.alert(as.TOKEN_SELECT,as.TOKEN_NONE_SELECTED);s["store-image-data"]={user:!1,data:Xs(Array.from(u.values()))},p(this,{style:`background-image: url(${lu(e.src)})`})}}))}},as.TOKEN_USE_SELECTED),Ts({onclick:()=>r.confirm(as.TOKEN_REMOVE,as.TOKEN_REMOVE_CONFIRM).then((t=>{t&&(u.delete(e),s["store-image-data"]={user:!1,data:Xs(Array.from(u.values()))})}))})])},t),u=new pa(di({class:Sm}),Xi,(i["store-image-data"]?i["store-image-data"].data instanceof Array?i["store-image-data"].data:[i["store-image-data"].data]:[]).map(((e,t)=>[t,h(t,e)]))),m=Ue([qs([as.NAME,": "],c),qs(d,Cs()),be(),a?[ut([as.CHARACTER_IMAGE,": "]),Ue({style:"overflow: hidden; display: inline-block; width: 200px; height: 200px; border: 1px solid #888; text-align: center",ondragover:xm,ondrop:function(e){const{id:t}=ru.get(e);s["store-image-icon"]={user:i["store-image-icon"].user,data:t},k(this,lt({src:lu(t),style:"max-width: 100%; max-height: 100%"}))}},lt({src:lu(i["store-image-icon"].data),style:"max-width: 100%; max-height: 100%"})),be(),ut([as.TOKEN,": "]),u[qi],Oe({onclick:()=>{const e=Rp();e?(u.set(g,h(g,e)),g++,s["store-image-data"]={user:!1,data:Array.from(u.values())}):r.alert(as.TOKEN_SELECT,as.TOKEN_NONE_SELECTED)}},as.TOKEN_ADD),be(),ut([as.TOKEN_ORDER,": "]),qs(ct({type:"radio",name:`tokens_ordered_${Mm}`,class:So,checked:!i.tokens_order?.data,onclick:()=>s.tokens_order={user:!1,data:!1}}),[as.TOKEN_ORDER_NORMAL,": "]),qs(ct({type:"radio",name:"tokens_ordered_"+Mm++,class:So,checked:i.tokens_order?.data,onclick:()=>s.tokens_order={user:!1,data:!0}}),[as.TOKEN_ORDER_SHUFFLE,": "])]:[ut([as.CHARACTER,": "]),Ue({style:"overflow: hidden; display: inline-block; width: 200px; height: 200px; border: 1px solid #888; text-align: center",ondragover:Am,ondrop:function(e){const{id:t}=Tm.get(e),i=Qs.get(t);s["store-character-id"]={user:!0,data:t},k(this,lt({src:lu(i["store-image-icon"].data),style:"max-width: 100%; max-height: 100%; cursor: pointer",onclick:()=>Om(t,as.CHARACTER_EDIT,i,!0)}))}},i["store-character-id"]?lt({src:lu(Qs.get(i["store-character-id"].data)["store-image-icon"].data),style:"max-width: 100%; max-height: 100%; cursor: pointer",onclick:()=>Om(i["store-character-id"].data,as.CHARACTER_EDIT,Qs.get(i["store-character-id"].data),!0)}):[])]]),f=od(m,e,i,a,s,n,r);let g=u.size;p(In,ki(p(r,p(m,Oe({onclick:function(){if(p(this,{disabled:!0}),km!==o&&!a)throw r.remove(),In.alert(as.MAP_CHANGED,as.MAP_CHANGED_LONG),new Error("map changed");const t=Array.from(n.values()).filter((e=>(delete s[e],void 0!==i[e]))),l={},c=Object.keys(s).filter((e=>{const t=i[e];return t&&t.user===s[e].user&&t.data===s[e].data?(delete s[e],!1):(l[e]=s[e],!0)}));xn((a?(_m(e,l,t),Xn.characterModify(e,l,t)):Nm(e,l,t)).then((()=>{f();for(const e of c)delete s[e];n.clear(),p(this,{disabled:!1})})),r)}},as.SAVE)))))},_m=(e,t,i)=>{let a={},o=[];const s=Qs.get(e),n=(r=!0)=>{Object.assign(s,t),(t["store-image-data"]||t.tokens_order)&&en(s);for(const e of i)delete s[e];return r&&Ei((()=>Xn.characterModify(e,t,i))),[t,a]=[a,t],[i,o]=[o,i],n};for(const e in t)s[e]?a[e]=s[e]:o.push(e);for(const e of i)s[e]&&(a[e]=s[e]);Ap.add(n(!1),as.UNDO_CHARACTER)},Nm=(e,t,i)=>{const a={id:e,tokenData:t,removeTokenData:i};return nm(a,!1),Xn.setToken(a)},Am=Ii({link:[Tm]}),xm=Ii({link:[ru]}),[Lm,Sm,Im]=U(3);ir.then((()=>{Xn.waitCharacterDataChange().when((({id:e,setting:t,removing:i})=>_m(e,t,i))),Bs((()=>km=Date.now())),P({[`.${Lm}`]:{display:"none","+label>svg":{display:"inline-block",width:"1em",height:"1em"},":not(:checked)+label>svg":{"--check-on":"none","--check-off":"block"}},[`.${Sm}`]:{margin:0,"list-style":"none"},[`.${Ro}`]:{overflow:"hidden",">button":{"background-color":"transparent","background-size":"cover","background-repeat":"no-repeat",width:"200px",height:"200px",color:"#000","text-shadow":"#fff 0 0 5px"},">img":{"max-width":"200px","max-height":"200px"},">svg":{width:"2em",height:"2em",cursor:"pointer"}},[`.${Im}>div`]:{"max-height":"90vh","overflow-y":"scroll"}})}));const Cm=(e,t)=>{const{width:i,height:a}=Vu;return[yp.zoom*e-(yp.zoom-1)*i/2+yp.x,yp.zoom*t-(yp.zoom-1)*a/2+yp.y]},Dm=Ue({style:"border: 1px solid #000; padding: 5px; background-color: #fff; color: #000; position: absolute; pointer-events: none"}),Rm=Ea({r:8,fill:"#000",stroke:"#fff","stroke-width":2}),Pm=co({stroke:"#fff","stroke-width":8,"stroke-linecap":"square","stroke-linejoin":"round",fill:"none"}),$m=co({stroke:"#000","stroke-width":6,"stroke-linejoin":"round",fill:"none"}),Hm=Qa([Pm,$m,Rm]),Um=ct({type:"number",value:1,min:0,onchange:()=>{const e=parseInt(Um.value);mi(e,0)&&Xn.setGridDistance(e)}}),Gm=ct({type:"checkbox",checked:!0,class:So,onchange:()=>Xn.setGridDiagonal(Gm.checked)}),Zm=[NaN,NaN],Wm=(e,t)=>{Zm.splice(0,Zm.length,e,t);const i={points:`${e},${t} ${e},${t}`},[a,o]=Cm(e,t);p(Pm,i),p($m,i),p(Rm,{cx:Zm[0],cy:Zm[1]}),Hm.parentNode||(Cu.parentNode?Fu.insertBefore(Hm,Cu):p(Fu,Hm)),p(Dm,{style:{left:`${a+5}px`,top:`${o+5}px`}}),Dm.parentNode||p(document.body,Dm)},jm=(e,t)=>{if(isNaN(Zm[0])||isNaN(Zm[1]))return;let i=0;const{gridSize:a}=Vu,o=[0,0],s=fi(parseInt(Um.value),1,1/0,a),n={points:Zm.reduce(((e,t,a)=>{if(a%2==0){const t=Zm[a],n=Zm[a+1];if(e+=` ${t},${n}`,a>=2){const e=t-o[0],a=n-o[1];i+=s*(Gm.checked?Math.hypot(e,a):Math.max(Math.abs(e),Math.abs(a)))}o[0]=t,o[1]=n}return e}),"")+` ${e},${t}`},[r,l]=Cm(e,t),c=e-o[0],d=t-o[1];i+=s*(Gm.checked?Math.hypot(c,d):Math.max(Math.abs(c),Math.abs(d))),k(Dm,{style:{left:`${r+5}px`,top:`${l+5}px`}},Math.round(i/a)+""),p(Pm,n),p($m,n)},Vm=()=>{Hm.remove(),Dm.remove(),Zm.splice(0,Zm.length,NaN,NaN)};ir.then((()=>{if(Bs((()=>{Um.value=Vu.gridDistance+"",Gm.checked=Vu.gridDiagonal})),!zn)return void Xn.waitSignalMeasure().when((e=>{if(!e)return void Vm();const[t,i,...a]=e,o=a.pop(),s=a.pop();Wm(t,i),Zm.push(...a),jm(s,o)}));let e=!1;const t=ct({type:"checkbox",class:So}),i=ct({type:"checkbox",checked:!1,class:So}),a=()=>t.click(),[o,s]=le(0,void 0,(e=>{e.ctrlKey||(Vm(),r())})),[n,r]=le(2,void 0,(()=>{e&&(Xn.signalMeasure(null),e=!1)})),[l,c]=re((i=>{const[a,o]=Ep(i.clientX,i.clientY,t.checked);p(Cu,{transform:`translate(${a-10/yp.zoom}, ${o-10/yp.zoom}) scale(${1/yp.zoom})`}),isNaN(Zm[0])||(jm(a,o),e&&Xn.signalMeasure([...Zm,a,o]))})),[d,h]=ne("Shift",a,a),[u,m]=ne("Escape",(()=>{if(2===Zm.length)Vm(),r();else{const t=Zm.pop(),i=Zm.pop();jm(i,t),e&&Xn.signalMeasure([...Zm,i,t])}}));Lu({name:as.TOOL_MEASURE,id:"tool_measure",icon:wo({viewBox:"0 0 50 50"},[Mo(as.TOOL_MEASURE),no({d:"M0,40 l10,10 l40,-40 l-10,-10 z m5,-5 l5,5 m-3,-7 l3,3 m-1,-5 l3,3 m-1,-5 l3,3 m-1,-5 l3,3 m-1,-5 l5,5 m-3,-7 l3,3 m-1,-5 l3,3 m-1,-5 l3,3 m-1,-5 l3,3 m-1,-5 l5,5 m-3,-7 l3,3 m-1,-5 l3,3 m-1,-5 l3,3 m-1,-5 l3,3 m-1,-5 l5,5",style:"stroke: currentColor","stroke-linejoin":"round",fill:"none"})]),options:Ue([qs(t,[as.TOOL_MEASURE_SNAP,": "]),be(),qs(Gm,[as.TOOL_MEASURE_DIAGONALS,": "]),be(),qs(i,[as.TOOL_MEASURE_MULTI,": "]),be(),qs([as.TOOL_MEASURE_CELL,": "],Um)]),mapMouseOver:()=>(l(),!1),tokenMouseOver:function(){return p(Fu,{style:{"--outline-cursor":"none"}}),p(this,{onmouseout:y((()=>p(Fu,{style:{"--outline-cursor":void 0}})),f)}),!1},tokenMouse0:Su,tokenMouse2:Su,mapMouse0:e=>{const[a,s]=Ep(e.clientX,e.clientY,t.checked);return isNaN(Zm[0])?Wm(a,s):Zm.push(a,s),e.ctrlKey||i.checked||o(),!1},mapMouse2:i=>{const[a,o]=Ep(i.clientX,i.clientY,t.checked);return Xn.signalMeasure([...Zm,a,o]),e=!0,n(),!1},set:()=>{p(Fu,{style:{cursor:"none"}},Cu),p(t,{checked:vd.value}),d(),u()},unset:()=>{p(Fu,{style:{cursor:void 0}}),Cu.remove(),s(),r(),c(),h(),m(),Vm()}}),Xn.waitGridDistanceChange().when((e=>Um.value=e+"")),Xn.waitGridDiagonalChange().when((e=>Gm.checked=e))}));const[Fm,zm]=(new Ci).bind(3),Km=new Li("light"),Ym=e=>{$p(Fc.get(e.id).layer),zc.token=e,p(Kc,{transform:e.transformString(!1),style:`--outline-width: ${e.width}px; --outline-height: ${e.height}px`,class:Yc(e.rotation)});for(const t of["x","y","rotation","width","height"])Hp[t]=e[t];jc()},Bm=e=>{let t=null,i=-1,a=null,o=0,s=0,n=!1,r=!1;const l=(e,t="",i=ju)=>i.children.map((i=>i.id<0?[]:ip(i)?Bi([Yi(i.name),Ki(l(e,t,i))]):Yi(i.name===t?{disabled:!0}:{onselect:()=>e(i)},i.name))),[c,d]=le(0,(e=>{let{x:t,y:a,width:o,height:s,rotation:n}=Hp;const[r,l]=Ep(e.clientX,e.clientY),c=r-Hp.mouseX,d=l-Hp.mouseY,h=Vu.gridSize,u=zc.token,m=(u?.snap??!1)!=e.shiftKey;if(u){switch(i){case 0:t+=c,a+=d,m&&([t,a]=ym(t,a,o,s)),Od.value&&jm(t+(o>>1),a+(s>>1));break;case 1:if(n=gi(Math.round(-128*Math.atan2(yp.zoom*(t+o/2)+yp.x-(yp.zoom-1)*Vu.width/2-e.clientX,yp.zoom*(a+s/2)+yp.y-(yp.zoom-1)*Vu.height/2-e.clientY)/Math.PI),256),m){const e=256/(1===Vu.gridType||2===Vu.gridType?12:8);n=Math.round(n/e)*e%256}p(Kc,{class:Yc(n)});break;default:{const e=-360*n/256,{x:r,y:l}=new DOMPoint(c,d).matrixTransform((new DOMMatrix).rotateSelf(e)),u=(new DOMMatrix).translateSelf(t+o/2,a+s/2).rotateSelf(-e).translateSelf(-(t+o/2),-(a+s/2)),p=[2,5,7].includes(i)?-1:[4,6,9].includes(i)?1:0,f=[2,3,4].includes(i)?-1:[7,8,9].includes(i)?1:0,g=m?h:10;let w=r*p,v=l*f;0!==p&&v<w*s/o||0===f?v=w*s/o:w=v*o/s,0!==p&&o+w<g&&(w=g-o,v=g*s/o-s),0!==f&&s+v<g&&(w=g*o/s-o,v=g-s),w*=p,v*=f,m&&(w=Math.round(w/h)*h,v=Math.round(v/h)*h),-1===p?(t+=w,o-=w):1===p&&(o+=w),-1===f?(a+=v,s-=v):1===f&&(s+=v),m&&([t,a]=ym(t,a,o=Math.max(Math.round(o/h)*h,h),s=Math.max(Math.round(s/h)*h,h)));const{x:y,y:E}=new DOMPoint(t+o/2,a+s/2).matrixTransform(u),{x:k,y:M}=new DOMPoint(t,a).matrixTransform(u).matrixTransform((new DOMMatrix).translateSelf(y,E).rotateSelf(e).translateSelf(-y,-E));t=k,a=M}}u.x=Math.round(t),u.y=Math.round(a),u.width=Math.round(o),u.height=Math.round(s),u.rotation=Math.round(n),u.updateNode(),p(Kc,{style:{"--outline-width":o+"px","--outline-height":s+"px"},transform:u.transformString(!1)})}}),(()=>{if(!zc.token)return;p(Fu,{style:{"--outline-cursor":void 0}}),i=-1;const{token:e}=zc,t={id:e.id,x:Math.round(e.x),y:Math.round(e.y),rotation:Math.round(e.rotation),width:Math.round(e.width),height:Math.round(e.height)};let a=!1;for(const i of["x","y","rotation","width","height"])Hp[i]!==t[i]?(e[i]=Hp[i],a=!0):delete t[i];a&&nm(t),Vm()})),h=Ii({link:[Tm,ru],copy:[ou]}),u=e=>{if(!zc.layer)return;if(ou.is(e)){const[t,i]=Ep(e.clientX,e.clientY),{layer:a}=zc;return void iu(ou.asForm(e,"asset")).then((e=>{for(const o of e)lt({src:lu(o.id),onload:function(){const{width:e,height:s}=this;if(zc.layer===a&&e>0&&s>0){const n={id:0,src:o.id,x:t,y:i,width:e||Vu.gridSize,height:s||Vu.gridSize,patternWidth:0,patternHeight:0,stroke:Hn,strokeWidth:0,rotation:0,flip:!1,flop:!1,tokenData:{},tokenType:0,snap:vd.value,lightColours:[],lightStages:[],lightTimings:[]};n.snap&&([n.x,n.y]=ym(n.x,n.y,n.width,n.height)),om(a.path,n)}}})})).catch(tr)}const t={id:0,src:0,x:0,y:0,width:0,height:0,patternWidth:0,patternHeight:0,stroke:Hn,strokeWidth:0,rotation:0,flip:!1,flop:!1,tokenData:{},tokenType:0,snap:vd.value,lightColours:[],lightStages:[],lightTimings:[]};if(Tm.is(e)){const{id:i,width:a,height:o}=Tm.get(e),s=Qs.get(i);s&&Object.assign(t,Js(s)??{src:parseInt(s["store-image-icon"].data),width:a,height:o})}else{if(!ru.is(e))return;{const{id:i,width:a,height:o}=ru.get(e);t.src=i,t.width=a||Vu.gridSize,t.height=o||Vu.gridSize}}[t.x,t.y]=Ep(e.clientX,e.clientY),t.snap&&([t.x,t.y]=ym(t.x,t.y,t.width,t.height)),om(zc.layer.path,t)},m=function*(e=ju){for(const t of e.children)yield*t.locked?[]:ap(t)?t.tokens:m(t)},f=[0,0],g=e=>{n=!0,p(Fu,{style:{left:(yp.x+=e.clientX-o)+"px",top:(yp.y+=e.clientY-s)+"px"}}),o=e.clientX,s=e.clientY},[w]=le(0,g,(e=>{n||e.ctrlKey||(Bc(),M(e)),p(Fu,{style:{"--outline-cursor":void 0}})})),[v]=le(1,g,(()=>p(Fu,{style:{"--outline-cursor":void 0}}))),y=(e,t)=>(p(Fu,{style:{"--outline-cursor":"grabbing"}}),o=e.clientX,s=e.clientY,n=!1,t(),!1),E=[-1,-1,-1,-1],k=(e,t=1)=>e.rotation=gi(e.snap?Math.round(e.rotation+256*t/(0===Vu.gridType?8:12)):e.rotation+t,256),M=({target:e,clientX:t,clientY:i,ctrlKey:a})=>p(document.body,{style:{"--outline-cursor":!a&&(r=e?.parentNode===Kc)?void 0:!a&&zc.layer?.tokens?.some((e=>e.at(t,i)))?"pointer":"grab"}}),T=(e,t)=>M({target:e,clientX:oe,clientY:se,ctrlKey:t}),[b,O]=re(M),_=e=>T(r?Kc.firstChild:null,e.ctrlKey),[N,A]=ne("Control",_,_),x=[ne("Ctrl+c",(()=>t=Xs(zc.token))),ne("Ctrl+x",(()=>lm((t=Xs(zc.token)).id))),ne("Escape",(e=>{if(-1==i)return Bc(),void T(Fu,e.ctrlKey);p(Fu,{style:{"--outline-cursor":void 0}}),i=-1;const{token:t}=zc,{x:a,y:o,width:s,height:n,rotation:r}=Hp;t&&(t.x=a,t.y=o,t.width=s,t.rotation=r,t.height=n,t.updateNode(),p(Kc,{style:{"--outline-width":s+"px","--outline-height":n+"px"},class:Yc(r),transform:t.transformString(!1)})),Vm(),d()})),ne("Delete",(()=>lm(zc.token.id))),Ic("tokenEdit",as.CONTEXT_EDIT_TOKEN,"",(()=>{const{token:e}=zc;e instanceof Uc&&Fc.has(e.id)&&Om(e.id,as.CONTEXT_EDIT_TOKEN,e.tokenData,!1)})),Ic("tokenLight",as.CONTEXT_SET_LIGHTING,"",(()=>{const{token:e}=zc;e&&Fc.has(e.id)&&S(e)})),...[["Up",(e,t)=>e.y-=t],["Down",(e,t)=>e.y+=t],["Left",(e,t,i,a=!1)=>a?k(e,-1):e.x-=i],["Right",(e,t,i,a=!1)=>a?k(e):e.x+=i]].map((([e,t],i)=>((e,t,i)=>ne([`Arrow${t}`,`Shift+Arrow${t}`],(t=>{const{token:a}=zc;a&&!a.snap&&(E[e]=setInterval((()=>{i(a,1,1,t.shiftKey),a.x=Math.min(Math.max(0,a.x),Vu.width-a.width),a.y=Math.min(Math.max(0,a.y),Vu.height-a.height),a.updateNode(),p(Kc,{transform:a.transformString(!1)})}),5))}),(t=>{if(-1!==E[e]){if(clearInterval(E[e]),E[e]=-1,a&&E.every((e=>-1===e))){const{id:e,x:t,y:i,rotation:o}=a;a.x=Hp.x,a.y=Hp.y,a.rotation=Hp.rotation,nm({id:e,x:t,y:i,rotation:o})}}else{const{gridSize:e,gridType:o,width:s,height:n}=Vu,{token:r}=zc;if(t.isTrusted&&r&&(i(r,1===o?Math.round(1.5*e/Xc):2===o?e>>1:e,2===o?Math.round(1.5*e/Xc):1===o?e>>1:e,t.shiftKey),r.x=Math.min(Math.max(0,r.x),s-r.width),r.y=Math.min(Math.max(0,r.y),n-r.height),a)){const{id:e,x:t,y:i,rotation:o}=a;a.x=Hp.x,a.y=Hp.y,a.rotation=Hp.rotation,nm({id:e,x:t,y:i,rotation:o})}}})))(i,e,t)))],L=Ii({copy:[Km]}),S=e=>{const{lightColours:t,lightStages:i,lightTimings:a}=e,o=()=>({id:e.id,lightColours:w.map((e=>e.colours.map((e=>e.value)))),lightStages:w.map((e=>e.value)),lightTimings:g.map((e=>e.value))}),s=Km.register(o),n=Xs(t),r=i.length?Xs(i):[0],l=a.length?Xs(a):[0],c=Ln({"window-icon":Hs,"window-title":as.CONTEXT_SET_LIGHTING,resizable:!0,style:"--window-width: 50%; --window-height: 50%"}),d=ai({colspan:l.length},as.LIGHTING_TIMING),h=ai({rowspan:r.length+1,style:"min-width:1em; writing-mode: vertical-rl; transform: scale(-1, -1)"},as.LIGHTING_STAGES),u=(e=0)=>{const t={[qi]:ai([ct({type:"number",value:e,onchange:function(){t.value=fi(parseInt(this.value),0)}}),Ts({title:as.LIGHTING_REMOVE_TIMING,class:Zo,onclick:()=>{const e=g.findIndex((e=>Object.is(e,t)));g.splice(e,1),l.pop();for(const t of w)t.colours.splice(e,1);p(d,{colspan:g.length})}})]),value:e};return t},m=(e=-1,t=-1)=>{const i={[qi]:Jt(),value:n[e]?.[t]??Hn};return p(i[qi],Gn(c,as.LIGHTING_SET_COLOUR,(()=>i.value),(e=>i.value=e))),i},f=(e=0,t=-1)=>{const i=ri(Jt([ct({type:"number",value:e,onchange:function(){a.value=fi(parseInt(this.value),0)}}),Ts({title:as.LIGHTING_REMOVE_STAGE,class:Zo,onclick:()=>{w.filterRemove((e=>e===a)),p(h,{rowspan:w.length+1})}})])),a={[qi]:i,value:e,colours:new ua(i,Xi,l.map(((e,i)=>m(t,i))))};return a},g=new ua(p(ri(),Jt({colspan:2})),Xi,l.map(u)),w=new ua(Qt(ri(h)),Xi,r.map(f));p(In,p(c,{onremove:()=>Km.deregister(s),ondragover:L,ondrop:t=>{if(Km.is(t)){const{id:i,lightColours:a,lightStages:o,lightTimings:s}=Km.get(t);i!==e.id&&(n.splice(0,n.length,...a),r.splice(0,r.length,...o),l.splice(0,l.length,...s),g.splice(0,g.length,...s.map(u)),w.splice(0,w.length,...o.map(f)),p(d,{colspan:g.length}),p(h,{rowspan:w.length+1}))}}},[Be([Ue({draggable:"true",style:"display: inline-block; cursor: grab",ondragstart:e=>Km.set(e,s)},Us({title:as.LIGHTING_DRAG,width:"1em",height:"1em"})),as.CONTEXT_SET_LIGHTING]),Oe({onclick:()=>p(h,{rowspan:w.push(f())+1})},as.LIGHTING_ADD_STAGE),Oe({onclick:()=>{p(d,{colspan:g.push(u())}),l.push(0);for(const e of w)e.colours.push(m())}},as.LIGHTING_ADD_TIMING),Xt([oi([ri([Jt({colspan:2}),d]),g[qi]]),w[qi]]),Oe({onclick:()=>{Fc.has(e.id)&&nm(o()),c.close()}},as.SAVE)]))},I=e=>{const{layer:t,token:i}=zc;if(t){const a=t.tokens.findIndex((e=>e===i)),o=t.tokens.at(e.shiftKey?(a+1)%t.tokens.length:a<0?-1:a-1);o&&o!==i&&Ym(o),e.preventDefault()}},[C,D]=Ic("nextToken",as.TOKEN_NEXT,"Tab",I),[R,$]=Ic("prevToken",as.TOKEN_PREV,"Shift+Tab",I),U=H();P({[`#${zo}`]:{cursor:"var(--outline-cursor)",overflow:"visible"},[`#${U}`]:{outline:"none","clip-path":"initial !important"," rect":{"stroke-width":"calc(1px / var(--zoom, 1))",stroke:"#000",width:"calc(10px / var(--zoom, 1))",height:"calc(10px / var(--zoom, 1))",fill:"#f00",":nth-child(1)":{width:"var(--outline-width)",height:"var(--outline-height)",fill:"transparent",cursor:"var(--outline-cursor, move)"},":nth-child(2)":{x:"calc(var(--outline-width) / 2 - 5px / var(--zoom, 1))",y:"calc(-20px / var(--zoom, 1))",cursor:"var(--outline-cursor, cell)"},":nth-child(3)":{x:"calc(-5px / var(--zoom, 1))",y:"calc(-5px / var(--zoom, 1))"},":nth-child(4)":{x:"calc(var(--outline-width) / 2 - 5px / var(--zoom, 1))",y:"calc(-5px / var(--zoom, 1))"},":nth-child(5)":{x:"calc(var(--outline-width) - 5px / var(--zoom, 1))",y:"calc(-5px / var(--zoom, 1))"},":nth-child(6)":{x:"calc(-5px / var(--zoom, 1))",y:"calc(var(--outline-height) / 2 - 5px / var(--zoom, 1))"},":nth-child(7)":{x:"calc(var(--outline-width) - 5px / var(--zoom, 1))",y:"calc(var(--outline-height) / 2 - 5px / var(--zoom, 1))"},":nth-child(8)":{x:"calc(-5px / var(--zoom, 1))",y:"calc(var(--outline-height) - 5px / var(--zoom, 1))"},":nth-child(9)":{x:"calc(var(--outline-width) / 2 - 5px / var(--zoom, 1))",y:"calc(var(--outline-height) - 5px / var(--zoom, 1))"},":nth-child(10)":{x:"calc(var(--outline-width) - 5px / var(--zoom, 1))",y:"calc(var(--outline-height) - 5px / var(--zoom, 1))"}}},[`.${Jo[0]} :is(rect:nth-child(3), rect:nth-child(10)), .${Jo[1]} :is(rect:nth-child(6), rect:nth-child(7)), .${Jo[2]} :is(rect:nth-child(5), rect:nth-child(8)), .${Jo[3]} :is(rect:nth-child(4), rect:nth-child(9))`]:{cursor:"var(--outline-cursor, nwse-resize)"},[`.${Jo[0]} :is(rect:nth-child(4), rect:nth-child(9)), .${Jo[1]} :is(rect:nth-child(3), rect:nth-child(10)), .${Jo[2]} :is(rect:nth-child(6), rect:nth-child(7)), .${Jo[3]} :is(rect:nth-child(5), rect:nth-child(8))`]:{cursor:"var(--outline-cursor, ns-resize)"},[`.${Jo[0]} :is(rect:nth-child(5), rect:nth-child(8)), .${Jo[1]} :is(rect:nth-child(4), rect:nth-child(9)), .${Jo[2]} :is(rect:nth-child(3), rect:nth-child(10)), .${Jo[3]} :is(rect:nth-child(6), rect:nth-child(7))`]:{cursor:"var(--outline-cursor, nesw-resize)"},[`.${Jo[0]} :is(rect:nth-child(6), rect:nth-child(7)), .${Jo[1]} :is(rect:nth-child(5), rect:nth-child(8)), .${Jo[2]} :is(rect:nth-child(4), rect:nth-child(9)), .${Jo[3]} :is(rect:nth-child(3), rect:nth-child(10))`]:{cursor:"var(--outline-cursor, ew-resize)"},[`.${Fo}`]:{opacity:"var(--hiddenLayerOpacity, 0.5)",[`.${Do}`]:{opacity:"var(--hiddenLayerSelectedOpacity, 0.5)"}},[`.${Co} #${jo}`]:{display:"none"}}),p(Kc,{id:U,style:"display: none",onwheel:Ru},Array.from({length:10},((e,t)=>uo({onmouseover:Pu,onmousedown:function(e){Du.call(this,e,t)}})))),Vc((()=>{if(zc.token)for(const[e]of x)e();else for(const[,e]of x)e();a=zc.token})),ne("Ctrl+z",Ap.undo)[0](),ne(["Ctrl+r","Ctrl+y","Ctrl+Shift+Z"],Ap.redo)[0](),ne("Ctrl+v",(()=>{if(t&&zc.layer){const{snap:e,width:i,height:a}=t,[o,s]=e?ym(f[0]-(i>>1),f[1]-(a>>1),i,a):[f[0]-(i>>1),f[1]-(a>>1)],n=Object.assign(Xs(t),{id:0,x:Math.min(Math.max(0,o),Vu.width-i),y:Math.min(Math.max(0,s),Vu.height-a)});om(zc.layer.path,n)}}))[0](),zm((t=>Xn.getMapData(t).then((t=>{Bc(),zc.layer=null,e.replaceWith(e=Tp(t)),p(Fu,{ondragover:h,ondrop:u},p(Kc,{style:"display: none"})),f[0]=0,f[1]=0,Ys(!0)})))),xu.mapMouse0=function(e){[f[0],f[1]]=Ep(e.clientX,e.clientY);const{layer:t}=zc;if(!e.ctrlKey||e.shiftKey){let i=null;for(const a of e.ctrlKey?m():t?.tokens??[])a.at(e.clientX,e.clientY)&&(i=a);if(i)return Ym(i),T(Kc.firstChild,e.ctrlKey),!1}return!(!e.ctrlKey&&("pointer"===document.body.style.getPropertyValue("--outline-cursor")||e.target&&e.target.parentNode===Kc))&&y(e,w)},xu.mapMouse1=e=>y(e,v),xu.mapMouseOver=()=>(b(),N(),!1),xu.tokenMouse0=(e,t)=>{if((!e.ctrlKey||e.shiftKey)&&zc.token)if(e.stopPropagation(),0===t&&e.shiftKey){const{layer:t,token:i}=zc;if(t){let a=null;for(const o of e.ctrlKey?m():t.tokens)if(o===i){if(a)break}else o.at(e.clientX,e.clientY)&&(a=o);a&&Ym(a)}}else if(c(),i=t,p(Fu,{style:{"--outline-cursor":["move","cell","nwse-resize","ns-resize","nesw-resize","ew-resize"][i<2?i:(3.5-Math.abs(5.5-i)+(zc.token.rotation+143>>5))%4+2]}}),[Hp.mouseX,Hp.mouseY]=Ep(e.clientX,e.clientY),0===t&&Od.value){const{token:e}=zc;Wm(e.x+(e.width>>1),e.y+(e.height>>1))}return!1},xu.tokenMouse2=e=>{e.stopPropagation();const{layer:t,token:i}=zc;if(t&&i){const a=t.tokens.findIndex((e=>e===i));p(document.body,Ki({x:e.clientX,y:e.clientY},[ld(),mp(i)?[Yi({onselect:()=>i instanceof Uc&&Fc.has(i.id)&&Om(i.id,as.CONTEXT_EDIT_TOKEN,i.tokenData,!1)},as.CONTEXT_EDIT_TOKEN),Yi({onselect:()=>{i instanceof Uc&&Fc.has(i.id)&&nm({id:i.id,flip:!i.flip})}},as.CONTEXT_FLIP),Yi({onselect:()=>{i instanceof Uc&&Fc.has(i.id)&&nm({id:i.id,flop:!i.flop})}},as.CONTEXT_FLOP),Yi({onselect:()=>{i instanceof Uc&&Fc.has(i.id)&&nm(i.isPattern?{id:i.id,patternWidth:0,patternHeight:0}:{id:i.id,patternWidth:i.width,patternHeight:i.height})}},i.isPattern?as.CONTEXT_SET_IMAGE:as.CONTEXT_SET_PATTERN)]:[],Yi({onselect:()=>{const e=i.snap,{x:t,y:a,width:o,height:s,rotation:n}=i;if(Fc.has(i.id))if(e)nm({id:i.id,snap:!e});else{const[r,l]=ym(t,a,o,s),c=32*Math.round(n/32)%256;nm({id:i.id,x:r,y:l,rotation:c,snap:!e})}}},i.snap?as.CONTEXT_UNSNAP:as.CONTEXT_SNAP),Yi({onselect:()=>{Fc.has(i.id)&&S(i)}},as.CONTEXT_SET_LIGHTING),a<t.tokens.length-1?[Yi({onselect:()=>{const e=Fc.get(i.id)?.layer;e&&Fc.has(i.id)&&sm(i.id,e.path,e.tokens.length-1)}},as.CONTEXT_MOVE_TOP),Yi({onselect:()=>{const e=Fc.get(i.id)?.layer;e&&Fc.has(i.id)&&sm(i.id,e.path,e.tokens.findIndex((e=>e===i))+1)}},as.CONTEXT_MOVE_UP)]:[],a>0?[Yi({onselect:()=>{const e=Fc.get(i.id)?.layer;e&&Fc.has(i.id)&&sm(i.id,e.path,e.tokens.findIndex((e=>e===i))-1)}},as.CONTEXT_MOVE_DOWN),Yi({onselect:()=>{const e=Fc.get(i.id)?.layer;e&&Fc.has(i.id)&&sm(i.id,e.path,0)}},as.CONTEXT_MOVE_BOTTOM)]:[],Bi([Yi(as.CONTEXT_MOVE_LAYER),Ki(l((e=>{Fc.has(i.id)&&sm(i.id,e.path,e.tokens.length)}),t.name))]),Yi({onselect:()=>lm(i.id)},as.CONTEXT_DELETE)]))}return!1},xu.mapMouse2=e=>{const t=Ep(e.clientX,e.clientY);return vp(t),e.ctrlKey?(e.altKey&&(Xn.setMapStart(t),[Vu.startX,Vu.startY]=t),Xn.signalMovePosition(t)):Xn.signalPosition(t),!1},xu.set=()=>{C(),R()},xu.unset=()=>{D(),$(),O(),A(),p(document.body,{style:{"--outline-cursor":void 0}})},Xn.waitMapChange().when((e=>qp(e,!1))),Xn.waitMapLightChange().when((e=>Xp(e,!1))),Xn.waitLayerShow().when((e=>jp[1](Qp(e,!0,!1)))),Xn.waitLayerHide().when((e=>Vp[1](Qp(e,!1,!1)))),Xn.waitLayerShow().when((e=>Fp[1](Jp(e,!0,!1)))),Xn.waitLayerHide().when((e=>zp[1](Jp(e,!1,!1)))),Xn.waitLayerAdd().when((e=>Up[1]([{id:1,name:em(e,!1)}]))),Xn.waitLayerFolderAdd().when((e=>Zp[1](tm(e,!1)))),Xn.waitLayerMove().when((({from:e,to:t,position:i})=>{im(e,t,i,!1),Kp[1]({from:e,to:t,position:i})})),Xn.waitLayerRename().when((e=>{am(e.path,e.name,!1),Yp[1](e)})),Xn.waitLayerRemove().when((e=>{Pp(e);const t=op(e);t?((ip(t)?Wp:Gp)[1](e),cp(e),Ap.clear()):tr("Invalid layer remove")})),Xn.waitTokenAdd().when((({path:e,token:t,pos:i})=>om(e,t,!1,i)(t.id))),Xn.waitTokenMoveLayerPos().when((({id:e,to:t,newPos:i})=>sm(e,t,i,!1))),Xn.waitTokenSet().when((e=>nm(e,!1))),Xn.waitTokenSetMulti().when((e=>rm(e,!1))),Xn.waitTokenRemove().when((e=>lm(e,!1))),Xn.waitLayerShift().when((({path:e,dx:t,dy:i})=>cm(e,t,i,!1))),Xn.waitWallAdded().when((e=>dm(e,!1))),Xn.waitWallRemoved().when((e=>hm(e,!1))),Xn.waitWallModified().when((e=>um(e,!1))),Xn.waitWallMoved().when((({id:e,path:t})=>pm(e,t,!1))),Xn.waitMapDataSet().when((({key:e,data:t})=>{e&&mm(e,t,!1)})),Xn.waitMapDataRemove().when((e=>fm(e,!1))),Xn.waitMaskAdd().when((e=>gm(e,!1))),Xn.waitMaskRemove().when((e=>wm(e,!1))),Xn.waitMaskSet().when((e=>vm(e,!1))),Xn.waitGridDistanceChange().when(wp),Ld.wait((e=>p(document.body,{style:{"--hiddenLayerOpacity":Math.max(Math.min(e,255),0)/255}}))),Sd.wait((e=>p(document.body,{style:{"--hiddenLayerSelectedOpacity":Math.max(Math.min(e,255),0)/255}})))};class qm extends Vd{constructor(e,t,i){if(super(e,t,i,Tm,!0),Qs.has(t)){const e=Qs.get(t)?.["store-image-icon"];e&&this.setIcon(e.data)}else Xn.characterGet(t).then((e=>{Qs.set(t,e),e["store-image-icon"]&&this.setIcon(e["store-image-icon"].data)}));Jm.set(t,this)}setIcon(e){p(this.image,{src:lu(e)})}show(){Om(this.id,this.name,Qs.get(this.id),!0)}}class Xm extends zd{constructor(e,t,i,a){super(e,t,i,a,Tm,tf);for(const e in a.items)this.#xe(a.items[e],e)}#xe(e,t){const i=ef.get(e);i?i[0].send(i[1]=t):ef.set(e,[new Ci,t])}addItem(e,t){return this.#xe(e,t),super.addItem(e,t)}}class Qm extends Kd{removeItem(e){const t=super.removeItem(e);return t>0&&Jm.delete(t),t}copyItem(e,t,i){const a=Qs.get(e);a&&(Qs.set(t,Xs(a)),super.copyItem(e,t,i))}}const Jm=new Map,ef=new Map,tf=new Li("characterfolder"),af=(e,t)=>{const i=ef.get(e)??wi(ef,e,[new Ci,""]);return t(i[1]),i[0].receive(t),()=>i[0].remove(t)};on.push([2,()=>zn?[as.TAB_CHARACTERS,(()=>{const e=Xn.characters,t=Ue(an()),i=Ii({link:[ru]}),a=H();return P(`#${a}`,{" ul":{margin:0,"padding-left":"calc(1em + 4px)","list-style":"none"},">div>ul":{"padding-left":0}}),e.list().then((o=>{const s=new Qm(o,as.CHARACTERS,e,qm,Xm);s.windowIcon=bm,k(t,{id:a},[Oe({onclick:()=>{let e=0;const t=ct({onkeypress:Ks}),a=Ln({"window-icon":bm,"window-title":as.CHARACTER_NEW,ondragover:()=>a.focus()},[Be(as.CHARACTER_NEW),qs([as.CHARACTER_NAME,": "],t),be(),ut([as.CHARACTER_IMAGE,": "]),Ue({style:"overflow: hidden; display: inline-block; width: 200px; height: 200px; border: 1px solid #888; text-align: center",ondragover:i,ondrop:function(t){k(this,lt({src:lu(e=ru.get(t).id),style:"max-width: 100%; max-height: 100%"}))}},as.CHARACTER_DRAG_ICON),be(),Oe({onclick:function(){t.value?e?(xn(Xn.characterCreate(t.value,{name:{user:!1,data:t.value},"store-image-icon":{user:!1,data:e}}).then((({id:e,path:t})=>s.addItem(e,t))),a).then((()=>a.remove())).finally((()=>p(this,{disabled:!1}))),p(this,{disabled:!0})):a.alert(as.ERROR,as.CHARACTER_NEED_ICON):a.alert(as.ERROR,as.CHARACTER_NEED_NAME)}},as.CHARACTER_CREATE)]);p(In,a),ki(t)}},as.CHARACTER_NEW),s[qi]]),Xn.waitCharacterDataChange().when((e=>{const t=e.setting["store-image-icon"];t&&Jm.get(e.id)?.setIcon(parseInt(t.data))}))})),t})(),!0,bm]:null]);const of=`data:image/svg+xml,%3Csvg xmlns="${ma}" viewBox="0 0 100 100"%3E%3Cpath d="M50,50 l50,25 l-50,25 l-50,-25 Z" fill="%2300f" /%3E%3Cpath d="M50,25 l50,25 l-50,25 l-50,-25 Z" fill="%230f0" /%3E%3Cpath d="M50,0 l50,25 l-50,25 l-50,-25 Z" fill="%23f00" /%3E%3C/svg%3E`;on.push([5,()=>zn?[as.TAB_LAYERS,(()=>{let e=null,t=null;es.wait((()=>{e&&(k(e.nameElem,as.LAYER_GRID),e.name=as.LAYER_GRID+""),t&&(k(t.nameElem,as.LAYER_LIGHT),t.name=as.LAYER_LIGHT+"")}));class i extends jd{constructor(i,a,o,n=!1,r=!1){super(i,a,-1===a?as.LAYER_GRID+"":-2===a?as.LAYER_LIGHT+"":o),r&&p(this[qi],{class:[W]}),a<0?(k(this[qi],[this.nameElem,-2===a?V:[]]),-1===a?e=this:-2===a&&(t=this)):(this.copier.remove(),void 0===s&&this.show()),n&&p(this[qi],{class:[Z]}),this[qi].insertBefore(E([a<0?[]:js({title:as.LAYER_TOGGLE_LOCK,class:H,onclick:()=>{b(this)}}),Rs({title:as.LAYER_TOGGLE_VISIBILITY,class:G,onclick:()=>M(this)})]),this.nameElem),p(this[qi],[Ue({class:R,onmouseup:()=>v(this,!1)}),Ue({class:D,onmouseup:()=>v(this,!0)})]),p(this.nameElem,{onmousedown:e=>y(this,e)})}show(){if(-1===this.id){const e=ct({type:"number",min:1,max:1e3,value:Math.round(Vu.width/Vu.gridSize),onkeypress:Ks}),t=ct({type:"number",min:1,max:1e3,value:Math.round(Vu.height/Vu.gridSize),onkeypress:Ks}),i=Zt([as.MAP_SQUARE_TYPE_SQUARE,as.MAP_SQUARE_TYPE_HEX_H,as.MAP_SQUARE_TYPE_HEX_V].map(((e,t)=>Nt({value:t,selected:Vu.gridType===t},e)))),a=ct({type:"number",min:10,max:1e3,value:Vu.gridSize}),o=ct({type:"color",value:Vu.gridColour.toHexString()}),s=ct({type:"number",min:0,max:10,value:Vu.gridStroke}),n=Ln({"window-icon":of,"window-title":as.MAP_EDIT},[Be(as.MAP_EDIT),[["MAP_SQUARE_WIDTH",e],["MAP_SQUARE_HEIGHT",t],["MAP_SQUARE_TYPE",i],["MAP_SQUARE_SIZE",a],["MAP_SQUARE_COLOUR",o],["MAP_SQUARE_LINE",s]].map((([e,t])=>[qs([as[e],": "],t),be()])),Oe({onclick:function(){p(this,{disabled:!0});const r=fi(parseInt(a.value),10,1e3,10);xn(Ei((()=>{const a={width:fi(parseInt(e.value),1,1e3,1)*r,height:fi(parseInt(t.value),1,1e3,1)*r,gridType:fi(parseInt(i.value),0,2,0),gridSize:r,gridColour:$n(o.value),gridStroke:fi(parseInt(s.value),0,10,0)};return qp(a,!1),Xn.setMapDetails(a).then((()=>n.remove())).finally((()=>p(this,{disabled:!1})))})),n)}},as.SAVE)]);p(In,n)}else-2===this.id?Un(In,as.LAYER_LIGHT_COLOUR,Vu.lightColour,of).then((e=>xn(Ei((()=>(Xp(e,!1),Xn.setLightColour(e)))),In))):this.isLocked()||(p(s?.[qi],{class:{[Do]:!1}}),p(this[qi],{class:[Do]}),s=this,Bc(),p(zc.layer?.[qi],{class:{[Do]:!1}}),$p(zc.layer=op(this.getPath())),p(zc.layer[qi],{class:[Do]}))}isLocked(){return op(this.getPath())?.locked||this.parent.isLocked()}rename(){return w(this)}}class a extends Fd{id;open;constructor(e,t,o,s,n=!1,r=!1){super(e,t,o,{folders:{},items:{}});const l=s;if(this.open=this[qi].firstChild,n&&p(this[qi],{class:[Z]}),r&&p(this[qi],{class:[W]}),this.id=l.id??=1,l.children)for(const t of l.children)this.children.set(t.name,g(t)?new i(this,t.id,t.name,t.hidden,t.locked):new a(e,this,t.name,t,t.hidden));l.id>0&&(p(this.open.firstChild,[Ue({class:R,onmouseup:()=>v(this,!1)}),Ue({class:D,onmouseup:()=>v(this,!0)})]).insertBefore(E([js({title:as.LAYER_TOGGLE_LOCK,class:H,onclick:e=>{b(this),e.preventDefault()}}),Rs({title:as.LAYER_TOGGLE_VISIBILITY,class:G,onclick:e=>{M(this),e.preventDefault()}})]),p(this.nameElem,{onmousedown:e=>{this.open.open||y(this,e)}})),p(this[qi],{class:[x]},Ue(this[qi].childNodes)))}isLocked(){return op(this.getPath())?.locked||(this.parent?.isLocked()??!1)}get sorter(){return Xi}rename(){return w(this)}}class o extends Kd{constructor(e){super(e,as.TAB_LAYERS,Em,i,a)}get filter(){return!1}getLayer(e){const[t,i]=this.resolvePath(e);return t?i?t.children.get(i):t:null}}let s,n,r,l,c=0,d=()=>{const n=new o(ju),r=e=>{const t={clientX:oe,clientY:se};Fu.dispatchEvent(new MouseEvent("mouseout",t)),Fu.dispatchEvent(new MouseEvent("mouseleave",t)),e.show(),Fu.parentNode?.dispatchEvent(new MouseEvent("mouseover",t))};Ic("layerPrev",as.KEY_LAYER_PREV,"[",(()=>{let e;O(n.folder,(t=>{if(t.id>0&&!t.isLocked()){if(t===s)return!0;e=t}return!1})),e&&r(e)}))[0](),Ic("layerNext",as.KEY_LAYER_NEXT,"]",(()=>{let e=!1;O(n.folder,(t=>{if(t.id>0&&!t.isLocked()){if(e)return r(t),!0;e=t===s}return!1}))}))[0](),Em.waitLayerSetVisible().when((e=>p(n.getLayer(e)?.[qi],{class:{[Z]:!1}}))),Em.waitLayerSetInvisible().when((e=>p(n.getLayer(e)?.[qi],{class:[Z]}))),Em.waitLayerSetLock().when((e=>{const t=n.getLayer(e);t&&(s===t&&T(),p(t[qi],{class:[W]}))})),Em.waitLayerSetUnlock().when((e=>p(n.getLayer(e)?.[qi],{class:{[W]:!1}}))),Em.waitLayerPositionChange().when((e=>{const t=n.getLayer(e.from),i=n.getLayer(e.to);t&&i instanceof a&&(t.parent.children.delete(t.name+""),t.parent=i,e.position>=i.children.size?i.children.set(t.name+"",t):i.children.insertBefore(t.name+"",t,i.children.keyAt(e.position)))})),Em.waitLayerRename().when((e=>{const t=n.getLayer(e.path);t&&(t.parent.children.reSet(t.name+"",e.name),k(t.nameElem,t.name=e.name))})),Em.waitLayerSelect().when((e=>{const t=n.getLayer(e);t!==s&&t instanceof i&&t.show()})),k(N,{id:A},[Oe({onclick:()=>{const e=ct({onkeypress:Ks}),t=Ln({"window-icon":of,"window-title":as.LAYER_ADD},[Be(as.LAYER_ADD),qs(as.LAYER_NAME,e),be(),Oe({onclick:function(){p(this,{disabled:!0}),xn(Ei((()=>Xn.addLayer(e.value).then((e=>{em(e,!1),n.addItem(1,e),t.remove()})).finally((()=>p(this,{disabled:!1}))))),t)}},as.LAYER_ADD)]);p(In,t),ki(e)}},as.LAYER_ADD),n[qi]]),d=()=>{e=null,t=null,s=void 0,n.setRoot(ju)}};const[h,u]=le(0,(e=>{r||(p(n[qi],{class:[L]}),p(document.body,r=Ft({class:I},n.name)),p(l,{class:[S]})),p(r,{style:{top:e.clientY+1+"px",left:e.clientX+c+"px"}})}),(()=>{f(),p(n[qi],{class:{[L]:!1}}),n=void 0,r?.remove(),r=void 0,p(l,{class:{[S]:!1,[C]:!1}})})),[m,f]=ne("Escape",(()=>u())),g=e=>void 0===e.children,w=e=>{const t=ct({type:"text",value:e.name,onkeypress:Ks}),i=Ln({"window-icon":of,"window-title":as.LAYER_RENAME},[Be(as.LAYER_RENAME),qs([as.LAYER_NAME,": "],t),be(),Oe({onclick:function(){p(this,{disabled:!0}),xn(Ei((()=>Xn.renameLayer(e.getPath(),t.value).then((({path:t,name:a})=>{e.parent.children.reSet(e.name+"",a),k(e.nameElem,e.name=a),am(t,a,!1),i.remove()})).finally((()=>p(this,{disabled:!0}))))),i)}},as.LAYER_RENAME)]);return p(In,i),ki(t),i},v=(e,t)=>{if(n&&(n.id>=0||e.parent===n.parent)){n.parent.children.delete(n.name+"");const i=n.getPath();let a,o=0;n.id>=0&&void 0!==e.open&&t&&e.open.open?(0===e.children.size?e.children.set(n.name+"",n):(e.children.insertBefore(n.name+"",n,e.children.keyAt(0)),o=e.children.position(n.name+"")),a=e.getPath()+"/",n.parent=e):(e.parent.children[t?"insertAfter":"insertBefore"](n.name+"",n,e.name+""),a=e.parent.getPath()+"/",o=e.parent.children.position(n.name+""),n.parent=e.parent),xn(Ei((()=>(im(i,a,o,!1),Xn.moveLayer(i,a,o)))),In)}},y=(e,t)=>{if(!n&&0===t.button){e.id<0&&p(l,{class:[C]}),c=e.nameElem.offsetLeft-t.clientX;for(let t=e.nameElem.offsetParent;t instanceof HTMLElement;t=t.offsetParent)c+=t.offsetLeft;n=e,h(),m()}},M=e=>Ei((()=>{const t=!e[qi].classList.toggle(Z);return(t?Xn.showLayer:Xn.hideLayer)(Qp(e.getPath(),t,!1))})),T=()=>{Bc(),p(s?.[qi],{class:{[Do]:!1}}),p(zc.layer?.[qi],{class:{[Do]:!1}}),s=void 0,zc.layer=null},b=e=>Ei((()=>{const t=e[qi].classList.toggle(W);return t&&s&&e[qi].contains(s[qi])&&T(),(t?Xn.lockLayer:Xn.unlockLayer)(Jp(e.getPath(),t,!1))})),O=(e,t)=>{for(const[,o]of e.children)if(o instanceof a){if(O(o,t))return!0}else if(o instanceof i&&t(o))return!0;return!1},_=new Oi("lightToggle").wait((e=>p(document.body,{class:{[Co]:e}}))),N=l=Ue(Be(as.MAP_NONE_SELECTED)),[A,x,L,S,I,C,D,R,H,G,Z,W,j]=U(13),V=$s({id:j,class:Zo,title:as.LAYER_LIGHT_TOGGLE,onclick:()=>_.set(!_.value)}),F={[` .${Do}`]:{"background-color":"#555"},[` .${S}`]:{[` .${R}:hover`]:{"border-top-color":"#fff"},[` .${D}:hover`]:{"border-bottom-color":"#fff"}}};return P({[`#${A}`]:{" ul":{"list-style":"none","padding-left":"calc(2em + 4px)"},[` li, .${x}>div`]:{position:"relative"}},[`.${L}`]:{visibility:"hidden"},[`.${I}`]:{position:"absolute"},[`.${C} .${Uo} .${Uo} :is(.${D}, .${R})`]:{display:"none"},[`.${S}`]:{[` :is(.${D}, .${R})`]:{display:"block",height:"calc(50% - 1px)",position:"absolute",width:"100%"},[` .${D}`]:{top:"50%","border-bottom":"1px solid transparent",":hover":{"border-bottom-color":"#000"}},[` .${R}`]:{top:0,"border-top":"1px solid transparent",":hover":{"border-top-color":"#000"}}},[`.${H}`]:{left:"calc(-2em - 4px) !important"},[`.${H},.${G}`]:{display:"inline-block",width:"1em",height:"1em",position:"absolute",left:"calc(-1em - 4px)",cursor:"pointer"},[`.${Z} .${G}`]:{"--invisible":"none"},[`.${W} .${H}`]:{"--locked":"block","--unlocked":"none"},[`.${Do}`]:{"background-color":"#eee"},[`#${ju} .${Go}`]:{"grid-template-columns":"auto 1em 1em"},[`.${Co} #${j}`]:{"--off":"#000"}}),$("@media (prefers-color-scheme: light)",{[`:root.${Io}`]:F}),$("@media (prefers-color-scheme: dark)",{[`:root:not(.${Io})`]:F}),Bs((()=>d())),N})(),!0,of]:null]);const sf=`data:image/svg+xml,%3Csvg xmlns="${ma}" viewBox="0 0 100 100"%3E%3Cg stroke-width="2" fill="none"%3E%3Cpath d="M30,1 L70,5 V99 L30,95" fill="%238f0" /%3E%3Cpath d="M30,55 h0.5 L69.5,48 H70 M40,53 L60,96 v2" stroke="%23333" stroke-width="10" /%3E%3Cpath d="M1,5 L30,1 70,5 99,1 M1,99 L30,95 70,99 99,95" stroke="%23eee" /%3E%3Cpath d="M30,1 L1,5 V99 L30,95 M70,5 L99,1 V95 L70,99" stroke="%23aaa" fill="%234a0" /%3E%3Cpath d="M2,40 Q10,40 30,35 V2 L2,6 Z M70,40 Q80,30 98,30 V2 L70,6 Z" fill="%2300a" /%3E%3Cpath d="M30,35 C50,30 50,50 70,40 V6 L30,2 Z" fill="%2300f" /%3E%3Cpath d="M2,75 h5 L26,55 H30 M70,48 h3 L96,37 H98" stroke="%23000" stroke-width="10" /%3E%3C/g%3E%3C/svg%3E`,nf=(e,t,i,a)=>{if(t){p(t[qi],{class:{[i]:!1}});for(let e=t.parent;e;e=e.parent)p(e[qi],{class:{[a]:!1}})}if(e){p(e[qi],{class:[i]});for(let t=e.parent;t;t=t.parent)p(t[qi],{class:[a]})}},rf=new _i("selectedMap"),lf=new Li("mapfolder"),[cf,df,hf,uf,pf,mf]=U(6),ff=new Li("map");let gf=null,wf=null;class vf extends Vd{constructor(e,t,i){super(e,t,i,ff),p(this.image,{src:sf}),p(this[qi],{class:[cf]}),this[qi].insertBefore(Ss({class:mf,title:as.MAP_SET_USER,onclick:()=>{this.setUserMap(),Xn.setUserMap(t)}}),this[qi].firstChild)}show(){if(wf!==this){let e=this,t=wf;const i=()=>{nf(e,t,pf,uf),wf=e;const a=e.id;return Ei((()=>Xn.setCurrentMap(a).then((()=>Fm(a))))),rf.set(a),[e,t]=[t,e],i};wf?Ap.add(i(),as.UNDO_MAP_LOAD):i()}}rename(){return this[qi].classList.contains(pf)||this[qi].classList.contains(df)?In.appendChild(Ln({"window-icon":sf,"window-title":as.INVALID_ACTION},qe(as.INVALID_RENAME))):super.rename()}remove(){return this[qi].classList.contains(pf)||this[qi].classList.contains(df)?In.appendChild(Ln({"window-icon":sf,"window-title":as.INVALID_ACTION},qe(as.INVALID_REMOVE))):super.remove()}setUserMap(){nf(this,gf,df,hf),gf=this}}class yf extends zd{constructor(e,t,i,a){super(e,t,i,a,ff,lf)}rename(e){return this[qi].classList.contains(uf)||this[qi].classList.contains(hf)?In.appendChild(Ln({"window-icon":sf,"window-title":as.INVALID_ACTION},qe(as.INVALID_RENAME_CONTAIN))):super.rename(e)}remove(e){return this[qi].classList.contains(uf)||this[qi].classList.contains(hf)?In.appendChild(Ln({"window-icon":sf,"window-title":"Invalid Action"},qe(as.INVALID_REMOVE_CONTAIN))):super.remove(e)}}class Ef extends Kd{moveItem(e,t){wf&&wf.getPath()===e?(nf(null,wf,pf,uf),super.moveItem(e,t),nf(wf,null,pf,uf)):super.moveItem(e,t)}removeItem(e){return wf&&wf.getPath()===e&&(nf(null,wf,pf,uf),Fm(0)),super.removeItem(e)}moveFolder(e,t){const[i]=this.resolvePath(e);if(i&&i[qi].classList.contains(uf)){nf(null,wf,pf,uf);const i=super.moveFolder(e,t);return nf(wf,null,pf,uf),i}return super.moveFolder(e,t)}removeFolder(e){const[t]=this.resolvePath(e);return t&&t[qi].classList.contains(uf)&&(nf(null,wf,pf,uf),Fm(0)),super.removeFolder(e)}}on.push([4,()=>zn?[as.TAB_MAPS,(()=>{const e=Xn.maps,t=Ue(an()),i=H(),a={[` .${pf}`]:{"background-color":"#555"},[` .${uf}>details>summary`]:{"background-color":"#600"},[` .${hf}>details>summary`]:{"background-color":"#400"}};return P({[`#${i}`]:{" ul":{"list-style":"none",margin:0,"padding-left":"calc(1em + 4px)"}," li>svg:first-child":{display:"inline-block",width:"1em",height:"1em",margin:"0 2px"},[` li.${cf}>svg:first-child`]:{cursor:"pointer"},[` li.${df}>svg:first-child`]:{"--map-selected":"block"},[` .${Go}`]:{"grid-template-columns":"auto 1em 1em 1em"}},[`.${hf}>details>summary`]:{"background-color":"#ccffcc"},[`.${uf}>details>summary`]:{"background-color":"#f8f8f8"},[`.${pf}`]:{"background-color":"#eee"},[`.${mf}`]:{position:"absolute",left:0}}),$("@media (prefers-color-scheme: light)",{[`:root.${Io}`]:a}),$("@media (prefers-color-scheme: dark)",{[`:root:not(.${Io})`]:a}),Promise.all([e.list(),Xn.getUserMap()]).then((([a,o])=>{const s=new Ef(a,as.TAB_MAPS,e,vf,yf),n=(e,t)=>{for(const[,i]of e.children)if(i instanceof Fd){const e=n(i,t);if(e)return e}else if(i.id===t)return i},r=(e,t=!1)=>{const i=n(s.folder,e);i&&(i.setUserMap(),t&&i.show())};s.windowIcon=sf,Xn.waitCurrentUserMap().when(r);let l=!0;if(rf.value>0){const e=n(s.folder,rf.value);e&&(e.show(),l=!1)}o>0&&r(o,l),k(t,{id:i},[Oe({onclick:()=>{const e=ct({type:"text",onkeypress:Ks}),t=ct({type:"number",min:10,max:1e3,value:30,onkeypress:Ks}),i=ct({type:"number",min:10,max:1e3,value:30,onkeypress:Ks}),a=Zt([as.MAP_SQUARE_TYPE_SQUARE,as.MAP_SQUARE_TYPE_HEX_H,as.MAP_SQUARE_TYPE_HEX_V].map(((e,t)=>Nt({value:t},e)))),o=ct({type:"number",min:1,max:1e3,value:100}),n=ct({type:"color"}),r=ct({type:"number",min:0,max:10,value:1}),l=Ln({"window-icon":sf,"window-title":as.MAP_NEW},[Be(as.MAP_NEW),qs([as.MAP_NAME,": "],e),be(),qs([as.MAP_SQUARE_WIDTH,": "],t),be(),qs([as.MAP_SQUARE_HEIGHT,": "],i),be(),qs([as.MAP_SQUARE_TYPE,": "],a),be(),qs([as.MAP_SQUARE_SIZE,": "],o),be(),qs([as.MAP_SQUARE_COLOUR,": "],n),be(),qs([as.MAP_SQUARE_LINE,": "],r),be(),Oe({onclick:function(){p(this,{disabled:!0});const c=fi(parseInt(o.value),1,1e3,1);xn(Xn.newMap({name:e.value,width:fi(parseInt(t.value),1,1e3,1)*c,height:fi(parseInt(i.value),1,1e3,1)*c,gridType:fi(parseInt(a.value),0,2,0),gridSize:c,gridColour:$n(n.value),gridStroke:fi(parseInt(r.value),0,10,0)}),l).then((({id:e,name:t})=>{s.addItem(e,t),l.remove()})).finally((()=>p(this,{disabled:!1})))}},as.MAP_ADD)]);p(In,l),ki(e)}},as.MAP_NEW),s[qi]])})),t})(),!0,sf]:null]);class kf{id;volume;repeat;audioElement=null;#Ie=-1;#ge;constructor(e,t){this.id=t.id,this.volume=t.volume,this.repeat=t.repeat,this.#ge=e}setVolume(e){this.volume=e,this.updateVolume()}setRepeat(e){this.repeat=e,this.waitPlay()}play(){this.audioElement?this.waitPlay():this.audioElement=we({src:cu(this.id),onloadeddata:y((()=>{this.updateVolume(),this.waitPlay()}),f),onended:()=>this.waitPlay()})}updateVolume(){this.audioElement&&(this.audioElement.volume=this.volume*this.#ge.volume/65025)}waitPlay(){if(this.audioElement){-1!==this.#Ie&&(clearTimeout(this.#Ie),this.#Ie=-1);const e=Nf(),t=this.audioElement.duration;if(-1===this.repeat)e<this.#ge.playTime+t?(this.audioElement.currentTime=e-this.#ge.playTime,this.audioElement.play()):(this.stop(),this.#ge.checkPlayState());else{const i=t+this.repeat,a=(e-this.#ge.playTime)%i;a<t?(this.audioElement.currentTime=a,this.audioElement.play()):(this.audioElement.pause(),this.#Ie=setTimeout((()=>{this.audioElement?.play(),this.#Ie=-1}),1e3*(i-a)))}}}stop(){this.audioElement&&(this.audioElement.pause(),this.audioElement=null,-1!==this.#Ie&&(clearTimeout(this.#Ie),this.#Ie=-1))}remove(){const e=this.#ge.tracks.findIndex((e=>e===this));return this.#ge.tracks.splice(e,1),this.stop(),e}}class Mf{tracks;volume;playTime;currentTime=0;constructor(e){this.tracks=[];for(const t of e.tracks)this.tracks.push(new kf(this,t));this.volume=e.volume,this.playTime=e.playTime,this.playTime&&setTimeout((()=>this.play(this.playTime)))}setVolume(e){this.volume=e,this.updateVolume()}play(e){if(e){this.playTime=e;for(const e of this.tracks)e.play()}else this.stop()}pause(){this.stop()}stop(){this.playTime=0;for(const e of this.tracks)e.stop()}checkPlayState(){if(this.playTime){for(const e of this.tracks)if(null!==e.audioElement)return;this.stop()}}updateVolume(){for(const e of this.tracks)e.updateVolume()}remove(){for(const e of this.tracks)e.stop()}}const Tf=()=>new Promise((e=>we({src:"data:audio/wav;base64,UklGRiwAAABXQVZFZm10IBAAAAABAAIARKwAABCxAgAEABAAZGF0YQgAAAAAAAAAAAD//w=="}).play().then(e).catch((()=>p(document.body,Ue({style:"position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.75); cursor: pointer; z-index: 2",onclick:function(){this.remove(),e()}},Ue({style:"display: flex; align-items: center; justify-content: center; height: 100%; font-size: 3em; color: #fff"},as.MUSIC_ENABLE))))))),bf=`data:image/svg+xml,%3Csvg xmlns="${ma}" viewBox="0 0 100 100"%3E%3Cdefs%3E%3Cmask id="recordMask"%3E%3Cpath d="M0,10 L50,50 0,90 M100,10 L50,50 100,90" fill="%23fff" /%3E%3C/mask%3E%3C/defs%3E%3Cg fill="none" stroke="%23fff"%3E%3Ccircle cx="50" cy="50" r="30" stroke="%23000" stroke-width="40" /%3E%3Ccircle cx="50" cy="50" r="20" stroke="%23111" stroke-width="5" /%3E%3Ccircle cx="50" cy="50" r="10" stroke="%23a00" stroke-width="15" /%3E%3Ccircle cx="50" cy="50" r="49.5" stroke-width="1" /%3E%3Cg stroke-width="0.25" mask="url(%23recordMask)"%3E%3Ccircle cx="50" cy="50" r="45" /%3E%3Ccircle cx="50" cy="50" r="42" /%3E%3Ccircle cx="50" cy="50" r="39" /%3E%3Ccircle cx="50" cy="50" r="36" /%3E%3Ccircle cx="50" cy="50" r="33" /%3E%3Ccircle cx="50" cy="50" r="30" /%3E%3Ccircle cx="50" cy="50" r="27" /%3E%3C/g%3E%3C/g%3E%3C/svg%3E`,Of=(e,t="",i=[],a=255)=>({id:e,name:t,tracks:i,volume:a,playTime:0,playing:!1}),_f=e=>{Xn.waitMusicPackVolume().when((t=>e.get(t.id)?.setVolume(t.volume))),Xn.waitMusicPackPlay().when((t=>e.get(t.id)?.play(t.playTime))),Xn.waitMusicPackStop().when((t=>e.get(t)?.stop())),Xn.waitMusicPackTrackRemove().when((t=>e.get(t.id)?.tracks[t.track]?.remove())),Xn.waitMusicPackTrackVolume().when((t=>e.get(t.id)?.tracks[t.track]?.setVolume(t.volume))),Xn.waitMusicPackTrackRepeat().when((t=>e.get(t.id)?.tracks[t.track]?.setRepeat(t.repeat)))},Nf=()=>Yn+Date.now()/1e3,Af=new Li("musicpack");let xf=e=>{};ir.then((()=>{zn?($h("musicpack",((e,t,i)=>{const a=t.next(!0).value;if(a&&Bd(a)&&a.attr){const o=parseInt(a.attr);isNaN(o)||p(e,Qd(Ft({class:Po,onclick:e=>{0===e.button&&xf(o)}}),t,i,a.tagName))}})),on.push([3,()=>[as.TAB_MUSIC_PACKS,(()=>{const e=Ue(an()),t=lt({class:"imageIcon",src:bf}),[i,a]=U(2);return P({[`#${i},.${a}`]:{margin:0,"padding-left":0,"list-style":"none"},[`#${i}>li`]:{">span":{cursor:"pointer"},display:"grid","grid-template-columns":"1em auto 1em 1em 1em"},[`.${a} li`]:{">svg":{"margin-right":0,"margin-left":"0.5em"},display:"grid","grid-template-columns":"auto 10em 5em 2em"}}),Tf().then(Xn.musicPackList).then((o=>{class s extends kf{[qi];#Ce;#De;#Re;cleanup;constructor(e,t){super(e,t),this[qi]=mt([this.#Ce=Ft(t.name??[as.MUSIC_TRACK," ",t.id+""]),this.#De=ct({type:"range",max:255,value:this.volume=t.volume,onchange:()=>{Xn.musicPackTrackVolume(e.id,e.tracks.findIndex((e=>e===this)),this.volume=fi(parseInt(this.#De.value),0,255,255)),this.updateVolume()}}),this.#Re=ct({type:"number",min:-1,value:this.repeat=t.repeat,onchange:()=>Xn.musicPackTrackRepeat(e.id,e.tracks.findIndex((e=>e===this)),this.repeat=fi(parseInt(this.#Re.value),-1))}),Ts({class:Zo,title:as.MUSIC_TRACK_REMOVE,onclick:()=>e.window.confirm(as.MUSIC_TRACK_REMOVE,as.MUSIC_TRACK_REMOVE_LONG).then((t=>{t&&Xn.musicPackTrackRemove(e.id,this.remove())}))})]),this.cleanup=t.name?()=>{}:eu(t.id,(e=>k(this.#Ce,e)))}setVolume(e){super.setVolume(e),this.#De.value=e+""}setRepeat(e){super.setRepeat(e),this.#Re.value=e+""}remove(){return this.cleanup(),super.remove()}}class n extends Mf{tracks;id;name;[qi];#Ce;#Pe;#De;#$e=wa(u);#He=wa(m);#Ue;#Ge;#Ze;#We=0;window;#be;#je;constructor(e,i){super(i),this.id=e,this.name=i.name,this.tracks=new ua(di({class:a}),Xi);for(const e of i.tracks)this.tracks.push(new s(this,e));this.#Ge=Mo(0===this.playTime?as.MUSIC_PLAY:as.MUSIC_PAUSE),this.#be=Af.register(this),this.#je=Uh.register((()=>e=>`[musicpack=${this.id}]${e||this.name}[/musicpack]`));const o=e=>{Af.set(e,this.#be,t),Uh.set(e,this.#je)};this.window=Ln({"window-icon":bf,"window-title":as.MUSIC_WINDOW_TITLE,"hide-minimise":!1,ondragover:e=>{0===this.currentTime&&f(e)},ondrop:e=>{if(nu.is(e)){const{id:t,name:i}=nu.get(e);this.tracks.push(new s(this,{id:t,volume:255,repeat:0,name:i})),Xn.musicPackTrackAdd(this.id,[t])}else su.is(e)&&au(su.asForm(e,"asset"),this.window).then((e=>{const t=[];for(const{id:i,name:a}of e)this.tracks.push(new s(this,{id:i,volume:255,repeat:0,name:a})),t.push(i);Xn.musicPackTrackAdd(this.id,t)})).catch(tr)}},[this.#Pe=Be({draggable:"true",ondragstart:o},this.name),wo({style:"width: 2em",viewBox:"0 0 90 90"},[this.#Ge,this.#Ue=no({d:0===this.playTime?d:h,fill:"currentColor",stroke:"none","fill-rule":"evenodd"},[this.#$e,this.#He]),uo({width:"100%",height:"100%","fill-opacity":0,onclick:()=>{this.playTime?this.pause(!0):this.play(Nf()-this.#We,!0)}})]),xs({style:"width: 2em; height: 2em",title:as.MUSIC_STOP,onclick:()=>this.stop(!0)}),be(),this.#De=ct({type:"range",max:255,value:i.volume,onchange:()=>{Xn.musicPackSetVolume(this.id,this.volume=fi(parseInt(this.#De.value),0,255,255)),this.updateVolume()}}),this.tracks[qi],Ue({style:"text-align: center"},as.MUSIC_DROP)]),this[qi]=mt({class:Go,draggable:"true",ondragstart:o},[this.#Ze=ys({style:"width: 1em; height: 1em; visibility: hidden"}),this.#Ce=Ft({onclick:()=>In.addWindow(this.window),onauxclick:e=>{1===e.button&&(this.playTime?this.stop(!0):this.play(Nf()-this.#We,!0))}},this.name),Os({title:as.MUSIC_RENAME,class:Zo,onclick:()=>In.prompt(as.MUSIC_RENAME,as.MUSIC_RENAME_LONG,this.name).then((e=>{e&&e!==this.name&&Xn.musicPackRename(this.id,e).then((e=>{e!==this.name&&(this.setName(e),c.sort())}))}))}),ps({title:as.MUSIC_COPY,class:Zo,onclick:()=>In.prompt(as.MUSIC_COPY,as.MUSIC_COPY_LONG,this.name).then((e=>{e&&Xn.musicPackCopy(this.id,e).then((({id:e,name:t})=>c.set(e,new n(e,Of(e,t,this.tracks.map((e=>({id:e.id,volume:e.volume,repeat:e.repeat}))),this.volume)))))}))}),Ts({title:as.MUSIC_REMOVE,class:Zo,onclick:()=>In.confirm(as.MUSIC_REMOVE,as.MUSIC_REMOVE_LONG).then((e=>{e&&(this.remove(),Xn.musicPackRemove(this.id))}))})])}transfer(){return{id:this.id,name:this.name}}setName(e){k(this.#Pe,e),k(this.#Ce,this.name=e),c.sort()}setVolume(e){super.setVolume(e),this.#De.value=e+""}play(e,t=!1){super.play(e),document.body.contains(this.#He)?this.#He.beginElement():p(this.#Ue,{d:h}),p(this.#Ze,{style:{visibility:void 0}}),k(this.#Ge,as.MUSIC_PAUSE),t&&Xn.musicPackPlay(this.id,Math.round(e)).then((e=>this.playTime=e)),c.sort()}pause(e=!1){const t=Nf()-this.playTime;this.stop(e),this.#We=t}stop(e=!1){super.stop(),this.#We=0,document.body.contains(this.#$e)?this.#$e.beginElement():p(this.#Ue,{d}),p(this.#Ze,{style:{visibility:"hidden"}}),k(this.#Ge,as.MUSIC_PLAY),e&&Xn.musicPackStop(this.id),c.sort()}remove(){super.remove(),this.window.remove();for(const e of this.tracks)e.cleanup();c.delete(this.id),Af.deregister(this.#be),Uh.deregister(this.#je)}}const r=(e,t)=>Qi(e.name,t.name),l=(e,t)=>t.playTime-e.playTime||r(e,t),c=new pa(di({id:i})),d="M75,15 c-15,-15 -45,-15 -60,0 c-15,15 -15,45 0,60 c15,15 45,15 60,0 c15,-15 15,-45 0,-60 z M35,25 v40 l30,-20 l0,0 z",h="M35,15 c0,0 -20,0 -20,0 c0,0 0,60 0,60 c0,0 20,0 20,0 c0,0 0,-60 0,-60 z M55,15 v60 l20,0 l0,-60 z",u={attributeName:"d",to:d,dur:"0.2s",begin:"click",fill:"freeze"},m={attributeName:"d",to:h,dur:"0.2s",begin:"click",fill:"freeze"},f=Ii({link:[nu],copy:[su]});Nd.wait((e=>c.sort(e?l:r)));for(const e of o)c.set(e.id,new n(e.id,e));k(e,[Oe({onclick:()=>In.prompt(as.MUSIC_ADD,as.MUSIC_ADD_NAME).then((e=>{e&&Xn.musicPackAdd(e).then((({id:e,name:t})=>c.set(e,new n(e,Of(e,t)))))}))},as.MUSIC_ADD),c[qi]]),Xn.waitMusicPackAdd().when((({id:e,name:t})=>c.set(e,new n(e,Of(e,t))))),Xn.waitMusicPackRename().when((e=>c.get(e.id)?.setName(e.name))),Xn.waitMusicPackRemove().when((e=>{const t=c.get(e);t&&(t.remove(),c.delete(e))})),Xn.waitMusicPackCopy().when((({id:e,name:t})=>{const i=c.get(e);i&&c.set(e,new n(e,Of(e,t,i.tracks.map((e=>({id:e.id,volume:e.volume,repeat:e.repeat}))),i.volume)))})),Xn.waitMusicPackTrackAdd().when((e=>{const t=c.get(e.id);if(t)for(const i of e.tracks)t.tracks.push(new s(t,{id:i,volume:255,repeat:0}))})),_f(c),xf=e=>{const t=c.get(e);t&&In.addWindow(t.window)}})),e})(),!0,bf]])):(Tf().then(Xn.musicPackList).then((e=>{const t=new Map;for(const i of e)t.set(i.id,new Mf(i));Xn.waitMusicPackAdd().when((({id:e})=>t.set(e,new Mf(Of(e))))),Xn.waitMusicPackRemove().when((e=>{const i=t.get(e);i&&(i.remove(),t.delete(e))})),Xn.waitMusicPackCopy().when((({id:e,newID:i})=>{const a=t.get(e);if(a){const e=[];for(const t in a.tracks)e.push({id:a.tracks[t].id,volume:a.tracks[t].volume,repeat:a.tracks[t].repeat});t.set(i,new Mf({id:i,name:"",tracks:e,volume:a.volume,playTime:0}))}})),Xn.waitMusicPackTrackAdd().when((e=>{const i=t.get(e.id);if(i)for(const t of e.tracks)i.tracks.push(new kf(i,{id:t,volume:255,repeat:0}))})),_f(t)})),$h("musicpack",Ch))})),ir.then((()=>{if(!zn)return;let e=Hn,t=new Rn(0,0,0,255),i=null;const[a,o,s]=Array.from({length:3},((e,t)=>ct({name:"drawShape",type:"radio",checked:!t,class:So}))),n=ct({type:"checkbox",class:So}),r=()=>n.click(),[l,c]=ne("Shift",r,r),d=ct({style:"width: 5em",type:"number",min:0,max:100,value:1}),[h,u]=le(0,(e=>{if(!i)return void u();const[t,a]=Ep(e.clientX,e.clientY,n.checked);p(i,{x:Math.min(b[0],t),y:Math.min(b[1],a),width:Math.abs(b[0]-t),height:Math.abs(b[1]-a)})}),(a=>{if(a.isTrusted){const[i,o]=Ep(a.clientX,a.clientY,n.checked),{layer:s}=zc;s?om(s.path,{id:0,x:Math.min(b[0],i),y:Math.min(b[1],o),width:Math.abs(b[0]-i),height:Math.abs(b[1]-o),rotation:0,snap:n.checked,fill:e,stroke:t,strokeWidth:fi(parseInt(d.value),0,100),tokenType:1,lightColours:[],lightStages:[],lightTimings:[],tokenData:{}}):In.alert(as.ERROR,as.TOOL_DRAW_ERROR)}i?.remove(),i=null,y()})),[m,f]=le(0,(e=>{if(!i)return void f();const[t,a]=Ep(e.clientX,e.clientY,n.checked);p(i,{rx:Math.abs(b[0]-t),ry:Math.abs(b[1]-a)})}),(a=>{if(a.isTrusted){const[i,o]=Ep(a.clientX,a.clientY,n.checked),{layer:s}=zc;if(s){const a=Math.abs(b[0]-i),r=Math.abs(b[1]-o);om(s.path,{id:0,x:b[0]-a,y:b[1]-r,width:2*a,height:2*r,rotation:0,snap:n.checked,fill:e,stroke:t,strokeWidth:fi(parseInt(d.value),0,100),tokenType:1,isEllipse:!0,lightColours:[],lightStages:[],lightTimings:[],tokenData:{}})}else In.alert(as.ERROR,as.TOOL_DRAW_ERROR)}i?.remove(),i=null,y()})),[g,w]=re((e=>{if(!i)return void w();const[t,a]=Ep(e.clientX,e.clientY,n.checked);p(i,{points:b.reduce(((e,t,i)=>i%2==0?`${e} ${b[i]},${b[i+1]}`:e),"")+` ${t},${a}`})})),[v,y]=ne("Escape",(()=>{u(),f()})),[E,k]=ne("Escape",(()=>{i&&(2===b.length?(i.remove(),i=null,w()):(b.pop(),b.pop(),p(i,{points:b.reduce(((e,t,i)=>i%2==0?`${e} ${b[i]},${b[i+1]}`:e),"")})))})),[M,T]=re((e=>{const[t,i]=Ep(e.clientX,e.clientY,n.checked);p(Cu,{transform:`translate(${t-10/yp.zoom}, ${i-10/yp.zoom}) scale(${1/yp.zoom})`})})),b=[0,0],O=wo({viewBox:"0 0 70 70",fill:"none",stroke:"currentColor"},[Mo(as.TOOL_DRAW),co({points:"51,7 58,0 69,11 62,18 51,7 7,52 18,63 62,18","stroke-width":2}),no({d:"M7,52 L1,68 L18,63 M53,12 L14,51 M57,16 L18,55"})]),_=fa(O);Lu({name:as.TOOL_DRAW,id:"tool_draw",icon:O,options:Ue([Ve([pt(as.TOOL_DRAW_SHAPE),qs(a,[as.TOOL_DRAW_RECT,": "]),be(),qs(o,[as.TOOL_DRAW_ELLIPSE,": "]),be(),qs(s,[as.TOOL_DRAW_POLYGON,": "])]),qs(n,[as.TOOL_DRAW_SNAP,": "]),be(),qs([as.TOOL_DRAW_STROKE_WIDTH,": "],d),be(),qs([as.TOOL_DRAW_STROKE_COLOUR,": "],Gn(Gu,as.TOOL_DRAW_STROKE_COLOUR,(()=>t),(e=>t=e),_)),be(),qs([as.TOOL_DRAW_FILL_COLOUR,": "],Gn(Gu,as.TOOL_DRAW_FILL_COLOUR,(()=>e),(t=>e=t),_))]),mapMouseOver:()=>(M(),!1),mapMouse0:r=>{const{layer:l}=zc,[c,u]=Ep(r.clientX,r.clientY,n.checked),f=fi(parseInt(d.value),0,100);return l&&(a.checked?(b[0]=c,b[1]=u,i?.remove(),p(l[qi],i=uo({x:c,y:u,fill:e,stroke:t,"stroke-width":f})),h(),v()):o.checked?(b[0]=c,b[1]=u,i?.remove(),p(l[qi],i=ba({cx:c,cy:u,fill:e,stroke:t,"stroke-width":f})),m(),v()):s.checked&&(i instanceof SVGPolygonElement?(b.push(c,u),p(i,{points:b.reduce(((e,t,i)=>i%2==0?`${e} ${b[i]},${b[i+1]}`:e),"")})):(b.splice(0,b.length,c,u),i?.remove(),p(l[qi],i=lo({stroke:t,fill:e,"stroke-width":f})),g(),E()))),!1},mapMouse2:a=>{const{layer:o}=zc;if(o&&i instanceof SVGPolygonElement&&b.length>=4){const[s,r]=Ep(a.clientX,a.clientY,n.checked);b.push(s,r);let l=1/0,c=1/0,h=-1/0,u=-1/0;const p=b.reduce(((e,t,i)=>{if(i%2==0){const t=b[i],a=b[i+1];e.push([t,a]),t<l&&(l=t),a<c&&(c=a),t>h&&(h=t),a>u&&(u=a)}return e}),[]).map((([e,t])=>({x:e-l,y:t-c})));om(o.path,{id:0,x:l,y:c,width:h-l,height:u-c,rotation:0,snap:n.checked,fill:e,stroke:t,strokeWidth:fi(parseInt(d.value),0,100),tokenType:2,points:p,lightColours:[],lightStages:[],lightTimings:[],tokenData:{}}),w(),k(),i.remove(),i=null}return!1},set:()=>{Bc(),p(n,{checked:vd.value}),l(),p(Fu,{style:{cursor:"none"}},Cu)},unset:()=>{c(),u(),f(),w(),y(),k(),T(),Cu.remove(),p(Fu,{style:{cursor:void 0}})}})})),ir.then((()=>{if(!zn)return;const e=ct({name:"maskColour",type:"radio",class:So,checked:!0}),[t,i,a,o]=Array.from({length:4},((e,t)=>ct({name:"maskShape",type:"radio",class:So,checked:!t}))),s=ct({type:"checkbox",class:So}),n=()=>s.click(),[r,l]=ne("Shift",n,n),[c,d]=le(0,(e=>{if(!_)return void d();const[t,i]=Ep(e.clientX,e.clientY,s.checked);p(_,{x:Math.min(T[0],t),y:Math.min(T[1],i),width:Math.abs(T[0]-t),height:Math.abs(T[1]-i)})}),(e=>{if(e.isTrusted){const[t,i]=Ep(e.clientX,e.clientY,s.checked);gm([O?0:1,Math.min(T[0],t),Math.min(T[1],i),Math.abs(T[0]-t),Math.abs(T[1]-i)])}_?.remove(),_=null,w()})),[h,u]=le(0,(e=>{if(!_)return void u();const[t,i]=Ep(e.clientX,e.clientY,s.checked);p(_,{rx:Math.abs(T[0]-t),ry:Math.abs(T[1]-i)})}),(e=>{if(e.isTrusted){const[t,i]=Ep(e.clientX,e.clientY,s.checked);gm([O?2:3,T[0],T[1],Math.abs(T[0]-t),Math.abs(T[1]-i)])}_?.remove(),_=null,w()})),[m,f]=re((e=>{if(!_)return void f();const[t,i]=Ep(e.clientX,e.clientY,s.checked);p(_,{points:T.reduce(((e,t,i)=>i%2==0?`${e} ${T[i]},${T[i+1]}`:e),"")+` ${t},${i}`})})),[g,w]=ne("Escape",(()=>{d(),u()})),[v,y]=ne("Escape",(()=>{_&&(2===T.length?(_.remove(),_=null,f()):(T.pop(),T.pop(),p(_,{points:T.reduce(((e,t,i)=>i%2==0?`${e} ${T[i]},${T[i+1]}`:e),""),stroke:2===T.length?O?"#fff":"#000":void 0})))})),E=(e,t)=>{const[i]=qc.at(e,t);if(i!==N)if(A?.remove(),i){switch(N=i,i[0]){case 0:case 1:A=uo({x:i[1],y:i[2],width:i[3],height:i[4]});break;case 2:case 3:A=ba({cx:i[1],cy:i[2],rx:i[3],ry:i[4]});break;case 4:case 5:A=lo({points:i.reduce(((e,t,a)=>a%2==1?`${e} ${i[a]},${i[a+1]}`:e),"")})}p(Fu,p(A,{fill:"none",stroke:"#f00"}))}else A=N=null},[k,M]=re((e=>{const[t,i]=Ep(e.clientX,e.clientY,s.checked);p(Cu,{transform:`translate(${t-10/yp.zoom}, ${i-10/yp.zoom}) scale(${1/yp.zoom})`}),o.checked?E(t,i):(A?.remove(),N=null)})),T=[0,0],b=new xi("maskOpacity",1,(e=>"number"==typeof e&&e>=0&&e<=1));let O=!1,_=null,N=null,A=null;b.wait((e=>p(document.body,{style:{"--maskOpacity":e}}))),Lu({name:as.TOOL_MASK,id:"tool_mask",icon:wo({viewBox:"0 0 60 50"},[Mo(as.TOOL_MASK),no({d:"M0,0 Q30,15 60,0 Q30,100 0,0 M32,20 q9,-10 18,0 q-9,-3 -18,0 M10,20 q9,-10 18,0 q-9,-3 -18,0 M20,35 q10,5 20,0 q-10,10 -20,0",stroke:"none",fill:"currentColor","fill-rule":"evenodd"})]),options:Ue([qs([as.TOOL_MASK_OPACITY,": "],ct({type:"range",min:0,max:1,step:.05,value:b.value,oninput:function(){b.set(parseFloat(this.value))}})),Ve([pt(as.TOOL_MASK_DRAW_TYPE),qs(e,[as.TOOL_MASK_OPAQUE,": "]),be(),qs(ct({name:"maskColour",type:"radio",class:So}),[as.TOOL_MASK_TRANSPARENT,": "])]),Ve([pt(as.TOOL_MASK_DRAW_SHAPE),qs(t,[as.TOOL_DRAW_RECT,": "]),be(),qs(i,[as.TOOL_DRAW_ELLIPSE,": "]),be(),qs(a,[as.TOOL_DRAW_POLYGON,": "]),be()]),qs(o,[as.TOOL_MASK_REMOVE,": "]),be(),qs(s,[as.TOOL_DRAW_SNAP,": "]),be(),Oe({onclick:()=>In.confirm(as.ARE_YOU_SURE,as.TOOL_MASK_CLEAR_CONFIRM).then((t=>{t&&vm({baseOpaque:e.checked,masks:[]})}))},as.TOOL_MASK_CLEAR)]),mapMouseOver:()=>(k(),!1),mapMouse0:n=>{const[r,l]=Ep(n.clientX,n.clientY,s.checked);if(o.checked){const[,e]=qc.at(r,l);-1!==e&&(wm(e),E(r,l))}else if(t.checked)T[0]=r,T[1]=l,_?.remove(),p(qc[qi],_=uo({x:r,y:l,fill:(O=e.checked)?"#fff":"#000"})),c(),g();else if(i.checked)T[0]=r,T[1]=l,_?.remove(),p(qc[qi],_=ba({cx:r,cy:l,fill:(O=e.checked)?"#fff":"#000"})),h(),g();else if(a.checked)if(_ instanceof SVGPolygonElement)T.push(r,l),p(_,{points:T.reduce(((e,t,i)=>i%2==0?`${e} ${T[i]},${T[i+1]}`:e),""),stroke:void 0});else{T.splice(0,T.length,r,l),_?.remove();const t=(O=e.checked)?"#fff":"#000";p(qc[qi],_=lo({fill:t,stroke:t})),m(),v()}return!1},mapMouse2:e=>{if(_ instanceof SVGPolygonElement&&T.length>=4){const[t,i]=Ep(e.clientX,e.clientY,s.checked);T.push(t,i),gm([O?4:5,...T]),f(),y(),_.remove(),_=null}return!1},set:()=>{Bc(),p(s,{checked:vd.value}),r(),p(Fu,{style:{cursor:"none"}},Cu)},unset:()=>{l(),d(),u(),f(),w(),y(),M(),Cu.remove(),p(Fu,{style:{cursor:void 0}})}})})),ir.then((()=>{if(!zn)return;let e=0,t=0,i=!1,a=0,o=0,s=!1;const[n,r]=le(0,(n=>{const[r,l]=Ep(n.clientX,n.clientY,i!==n.shiftKey);e=r-a,t=l-o,p(zc.layer[qi],{transform:`translate(${e}, ${t})`}),s&&jm(r,l)}),(()=>{l(),cm(zc.layer.path,e,t)})),l=()=>{r(!1),d(),p(zc.layer?.[qi],{transform:void 0}),s&&Vm()},[c,d]=ne("Escape",l);Lu({name:as.TOOL_MOVE,id:"tool_move",icon:wo({viewBox:"0 0 22 22",style:"fill: currentColor"},[Mo(as.TOOL_MOVE),Qa({"stroke-width":1,style:"stroke: currentColor","stroke-linecap":"round"},[eo({x1:11,y1:6,x2:11,y2:16}),eo({x1:6,y1:11,x2:16,y2:11})]),no({d:"M11,0 L6,5 L16,5 Z M0,11 L5,6 L 5,16 Z M11,22 L6,17 L16,17 Z M22,11 L17,16 L17,6 Z"})]),mapMouse0:function(r){const{layer:l}=zc;return l&&(e=t=0,i=l.tokens.some((e=>e.snap)),[a,o]=Ep(r.clientX,r.clientY,vd.value),c(),(s=Od.value)&&Wm(a,o),Bc(),n()),!1},mapMouse2:Su,mapMouseOver:Su,tokenMouseOver:Su,tokenMouse0:Su,tokenMouse2:Iu,set:()=>p(Fu,{style:{cursor:"move"}}),unset:()=>{p(Fu,{style:{cursor:void 0}}),l()}})})),ir.then((()=>{if(!zn)return;const e=ct({type:"checkbox",class:So,onchange:function(){this.checked?n():(Bc(),s(),xu.unset?.())}}),t=()=>p((c=new md(l=r()))[qi],{opacity:.5}),i=e=>Object.assign({id:0,src:0,x:0,y:0,width:Vu.gridSize,height:Vu.gridSize,patternWidth:0,patternHeight:0,stroke:Hn,strokeWidth:0,rotation:0,flip:!1,flop:!1,tokenData:{},tokenType:0,snap:vd.value,lightColours:[],lightStages:[],lightTimings:[]},e),[a,o]=re((e=>{[c.x,c.y]=Ep(e.clientX-c.width/2,e.clientY-c.height/2,l.snap),c.updateNode()})),s=()=>{const{layer:t}=zc;!e.checked&&c&&l&&t&&(p(t[qi],c[qi]),p(Fu,{style:{cursor:"none"}}),a())},n=()=>{o(),c?.[qi].remove(),c?.cleanup(),p(Fu,{style:{cursor:void 0}})};let r=null,l=null,c=null;Lu({name:as.TOOL_MULTIPLACE,id:"tool_multiplace",icon:wo({viewBox:"0 0 100 100",stroke:"currentColor",fill:"none"},[Mo(as.TOOL_MULTIPLACE),Ea({cx:15,cy:15,r:10,"stroke-dasharray":"50 40","stroke-dashoffset":75}),Ea({cx:28,cy:28,r:10,"stroke-dasharray":"50 40","stroke-dashoffset":75}),Ea({cx:42,cy:42,r:10}),no({d:"M28,77 l26,-26 a3,2 0,0,1 4,0 l40,40 M74,67 l10,-10 a3,2 0,0,1 5,0 l9,9 M14,63 l15,-15 M1,50 l15,-15"}),no({d:"M98,39 s0,-10 -10,-10 h-49 s-10,0 -10,10 v49 s0,10 10,10 h49 s10,0 10,-10 z M84,28 v-3 s0,-10 -10,-10 h-49 s-10,0 -10,10 v49 s0,10 10,10 h3 M71,15 v-3 s0,-10 -10,-10 h-49 s-10,0 -10,10 v49 s0,10 10,10 h3","stroke-width":4})]),options:Ue({style:"overflow: hidden"},[qs(e,[as.TOOL_MULTIPLACE_MODE,": "]),be(),ut([as.TOKEN,": "]),Ue({class:Ro},[Oe({onclick:function(){const a=Rp();a&&(r=()=>i(Xs(a)),p(this,{style:`background-image: url(${lu(a.src)})`}),t(),e.checked||Bc())},ondragover:Ii({link:[Tm,ru]}),ondrop:function(e){if(Tm.is(e)){const a=Tm.get(e),o=Qs.get(a.id);o&&(r=()=>{const e=Js(o);return i(e||{src:o["store-image-icon"].data})},p(this,{style:`background-image: url(${lu(o["store-image-icon"].data)})`}),t())}else if(ru.is(e)){const{id:a,width:o,height:s}=ru.get(e);r=()=>i({src:a,width:o||Vu.gridSize,height:s||Vu.gridSize}),p(this,{style:`background-image: url(${lu(a)})`}),t()}}},as.TOKEN_USE_SELECTED)]),Oe({onclick:()=>c&&t()},as.TOKEN_NEXT)]),mapMouse0:function(i){const{layer:a}=zc;return!(!e.checked&&l&&c&&a&&(i.preventDefault(),c[qi].remove(),l.x=c.x,l.y=c.y,om(a.path,l),t(),p(zc.layer[qi],c[qi]),1))},mapMouse2:Su,mapMouseOver:()=>(s(),!e.checked),tokenMouse2:Iu,set:()=>{!e.checked&&l&&Bc()},unset:()=>{n(),e.checked||xu.unset?.()}}),Em.waitLayerSelect().when((()=>{const{layer:e}=zc;c&&c[qi].parentNode&&e&&p(e[qi],c[qi])}))})),ir.then((()=>{if(!zn)return;let e=$n("#000"),t=!1,i=0,a=null,o=0,s=null;const[n,r,l,c]=U(4),d=()=>{m.checked?(p(Fu,{style:{cursor:"none"},class:{[r]:!1}},Cu),O()):(p(Fu,{class:[r]}),_())},h=new Li("scattering"),u=ct({type:"radio",name:"wallTool",class:So,checked:!0,onchange:d}),m=ct({type:"radio",name:"wallTool",class:So,onchange:()=>{d(),se()}}),f=ct({type:"range",min:0,max:255,value:0,ondragover:Ii({copy:[h]}),ondrop:e=>{h.is(e)&&(f.value=h.get(e)+"")}}),g=ct({type:"checkbox",class:So}),w=h.register((()=>fi(parseInt(f.value),0,255,0))),v=h.register((()=>tn.get(i)?.wall.scattering??0)),y=Zn.register((()=>tn.get(i)?.wall.colour??Hn)),E=ct({type:"checkbox",class:So}),M=()=>E.click(),[T,b]=ne("Shift",M,M),[O,_]=re((e=>{const[t,i]=Ep(e.clientX,e.clientY,E.checked);p(Cu,{transform:`translate(${t-10/yp.zoom}, ${i-10/yp.zoom}) scale(${1/yp.zoom})`})}),(()=>{p(Fu,{style:{cursor:void 0}}),Cu.remove()})),[N,A]=ne("Delete",(()=>{i&&(hm(i),se())})),x=[0,0],L=uo({height:10,fill:"#000",stroke:"#000","stroke-width":2}),S=e=>{const[t,i]=Ep(e.clientX,e.clientY,E.checked);p(L,{width:Math.hypot(t-x[0],i-x[1]),transform:`rotate(${180*Math.atan2(i-x[1],t-x[0])/Math.PI}, ${x[0]}, ${x[1]})`})},I=t=>{if(t.isTrusted&&zc.layer){const[i,a]=Ep(t.clientX,t.clientY,E.checked);dm({path:zc.layer.path,wall:{id:0,x1:x[0],y1:x[1],x2:i,y2:a,colour:e,scattering:fi(parseInt(f.value),0,255,0)}})}L.remove()},[C,D]=le(0,S,I),[R,$]=re(S,(()=>L.remove())),H=uo({width:"100%",height:"100%"}),G=new Pn("underlayColour",new Rn(255,255,255,63)).wait((e=>p(H,{fill:e}))),Z=Qa(H),W=new Map,j=Ii({copy:[Zn,h]}),V=(e,t)=>{const i=tn.get(t);if(i){const t={colour:i.wall.colour};if(Zn.is(e))t.colour=Zn.get(e);else{if(!h.is(e))return;t.scattering=h.get(e)}e.preventDefault(),um(Object.assign(Xs(i.wall),t))}},F=(e,t="",i=ju)=>i.children.map((i=>i.id<0?[]:ip(i)?Bi([Yi(i.name),Ki(F(e,t,i))]):Yi(i.name===t?{disabled:!0}:{onselect:()=>e(i)},i.name))),z=Ue({style:"position: absolute; height: 10px",draggable:"true",ondragstart:e=>{tn.has(i)&&(Zn.set(e,y,ee),h.set(e,v))},ondragover:j,ondrop:e=>V(e,i),oncontextmenu:t=>{if(t.stopPropagation(),t.preventDefault(),a){const o=i;p(document.body,Ki({x:t.clientX,y:t.clientY},[Yi({onselect:()=>{if(i===o){const t=tn.get(o);t&&(t.wall.colour=e,um(Xs(t.wall)))}}},as.TOOL_WALL_COLOUR_SET),Yi({onselect:()=>{if(i===o){const e=tn.get(o);e&&(e.wall.scattering=fi(parseInt(f.value),0,255,0),um(Xs(e.wall)))}}},as.TOOL_WALL_SCATTER_SET),Bi([Yi(as.CONTEXT_MOVE_LAYER),Ki(F((e=>{i===o&&pm(o,e.path)}),a.name))]),Yi({onselect:()=>{i===o&&(hm(o),se())}},as.CONTEXT_DELETE)]))}}}),K=Xa({height:10},z),Y=(e,t,i,a)=>{const o=Math.round(Math.hypot(e-i,t-a));p(z,{style:{width:o+"px"}}),p(Fu,[p(K,{width:o,x:e,y:t-5,transform:`rotate(${180*Math.atan2(a-t,i-e)/Math.PI}, ${e}, ${t})`}),p(te,{transform:`translate(${e-10}, ${t-10})`}),p(ie,{transform:`translate(${i-10}, ${a-10})`})])},B=()=>{k(Z,H),W.clear();let e=!1;for(const{layer:t,wall:o}of tn.values())if(!t.hidden&&!t.locked){const{id:s,x1:r,y1:l,x2:c,y2:d,colour:h,scattering:m}=o;s===i&&(Y(r,l,c,d),e=!0),p(Z,wi(W,s,uo({x:r,y:l-5,width:Math.hypot(r-c,l-d),class:n,transform:`rotate(${180*Math.atan2(d-l,c-r)/Math.PI}, ${r}, ${l})`,fill:h,stroke:h.toHexString(),ondragover:j,ondrop:e=>V(e,s),onmousedown:e=>{u.checked&&o&&0===e.button&&(Y(r,l,c,d),i=s,a=t,N(),ce(),e.stopPropagation())}},Mo([as.TOOL_WALL_LAYER,`: ${t.path}\n`,as.TOOL_WALL_COLOUR,`: ${h}\n`,as.TOOL_WALL_SCATTER,`: ${m}`]))))}e||se()},[q,X]=ne("Escape",(()=>{D(),oe(),$()})),Q=wo({viewBox:"0 0 90 60"},[Mo(as.TOOL_WALL),Ma(ro({id:c,patternUnits:"userSpaceOnUse",width:30,height:30},no({d:"M15,30 V15 H0 V0 H30 V15 H15 M0,30 H30",fill:"none",style:"stroke: currentColor","stroke-width":3}))),no({d:"M60,15 V0.5 H0.5 V59.5 H89.5 V15 Z",fill:`url(#${c})`,style:"stroke: currentColor","stroke-width":2})]),J=fa(Q),ee=lt({src:J}),[te,ie]=Array.from({length:2},((e,t)=>no({d:"M8,0 h4 v8 h8 v4 h-8 v8 h-4 v-8 h-8 v-4 h8 z",class:l,onmousedown:e=>{0===e.button&&(o=t,ae(),e.stopPropagation())}}))),[ae,oe]=le(0,(e=>{const t=tn.get(i);if(t){const{x1:a,y1:s,x2:n,y2:r}=t.wall,l=W.get(i),[c,d]=Ep(e.clientX,e.clientY,E.checked),[h,u]=0===o?[c,d]:[a,s],[m,f]=1===o?[c,d]:[n,r];p(l,{x:h,y:u-5,width:Math.hypot(h-m,u-f),transform:`rotate(${180*Math.atan2(f-u,m-h)/Math.PI}, ${h}, ${u})`}),p(o?ie:te,{transform:`translate(${c-10}, ${d-10})`})}else se()}),(e=>{const t=tn.get(i);if(t){const{x1:a,y1:s,x2:n,y2:r}=t.wall,l=W.get(i);if(e.isTrusted){const{colour:l,scattering:c}=t.wall,[d,h]=Ep(e.clientX,e.clientY,E.checked),[u,m]=0===o?[d,h]:[a,s],[f,g]=1===o?[d,h]:[n,r];p(o?ie:te,{transform:`translate(${d-10}, ${h-10})`}),um({id:i,x1:u,y1:m,x2:f,y2:g,colour:l,scattering:c})}else p(l,{x:a,y:s-5,width:Math.hypot(a-n,s-r),transform:`rotate(${180*Math.atan2(r-s,n-a)/Math.PI}, ${a}, ${s})`}),p(te,{transform:`translate(${a-10}, ${s-10})`}),p(ie,{transform:`translate(${n-10}, ${r-10})`})}})),se=()=>{i=0,a=null,K.remove(),te.remove(),ie.remove(),oe(),A(),de()},[ce,de]=ne("Escape",se),he=()=>{t&&setTimeout(B)};P({[`.${n}`]:{height:"10px","stroke-width":2},[`.${r} .${n}`]:{cursor:"pointer"},[`.${l}`]:{fill:"#000",stroke:"#fff",cursor:"move"}}),Lu({name:as.TOOL_WALL,id:"tool_wall",icon:Q,options:Ue([Ve([pt(as.TOOL_WALL_MODE),qs(u,[as.TOOL_WALL_SELECT,": "]),be(),qs(m,[as.TOOL_WALL_PLACE,": "])]),qs(E,[as.TOOL_WALL_SNAP,": "]),be(),qs(g,[as.TOOL_WALL_CONTINUOUS,": "]),be(),qs([as.TOOL_WALL_COLOUR,": "],Gn(Gu,as.TOOL_WALL_COLOUR,(()=>e),(t=>p(L,{fill:e=t,stroke:t.toHexString()})),J)),be(),qs([as.TOOL_WALL_SCATTER,": "],f,{draggable:"true",ondragstart:e=>h.set(e,w,ee)}),be(),qs([as.TOOL_WALL_UNDERLAY,": "],Gn(Gu,as.TOOL_WALL_UNDERLAY,(()=>G.value),(e=>G.set(e)),J))]),mapMouse0:e=>{if(e.ctrlKey&&!e.shiftKey)return!0;if(m.checked){g.checked?(L.parentNode&&I(e),R()):C();const[t,i]=Ep(e.clientX,e.clientY,E.checked);p(Fu,p(L,{width:0,x:x[0]=t,y:(x[1]=i)-5,transform:void 0}))}else se();return!1},mapMouse2:()=>($(),!1),mapMouseOver:()=>(d(),!1),set:()=>{t=!0,Bc(),p(E,{checked:vd.value}),B(),p(Fu,{style:{cursor:m.checked?"none":void 0}},[Z,m.checked?Cu:[]]),T(),q()},unset:()=>{t=!1,b(),_(),D(),$(),X(),Z.remove(),s&&(s.remove(),s=null),se()}});for(const e of["waitWallAdded","waitWallRemoved","waitWallModified","waitWallMoved","waitLayerMove","waitLayerRemove","waitLayerShift","waitLayerShow","waitLayerHide","waitLayerLock","waitLayerUnlock"])qn[e]().when(he)})),k(document.getElementsByTagName("title")[0],as.TITLE);const[Lf,Sf,If,Cf,Df,Rf,Pf,$f,Hf,Uf]=U(10),Gf=new Ai("lastTab"),Zf=(()=>{let e=0,t=!1;const i=new Oi("panelShow"),a=new xi("windowData",{},(e=>{if(!(e instanceof Object))return!1;for(const t in e){const i=e[t];if("object"!=typeof i||"boolean"!=typeof i.out||!Dn(i.data))return!1}return!0})),o=e=>{e.clientX>0&&(m.set(document.body.clientWidth-e.clientX),t=!0)},[s]=le(0,o),[n]=le(1,o),r=ct({id:Rf,type:"checkbox",checked:i.value,onchange:()=>i.set(r.checked)}),l=Ue({id:Df}),c=Ue({id:If}),d=ut({title:as.PANEL_GRABBER,for:Rf,class:yd.value?Hf:void 0,id:Pf,onmousedown:e=>{r.checked||(0===e.button?s():1===e.button&&n(),t=!1)},onclick:e=>{t&&e.preventDefault()}}),h=Ue({id:Sf},[l,c]),u=Ue({id:Lf},[d,h]),m=new _i("panelWidth",300,0).wait((e=>p(u,{style:`--panel-width: ${e}px`}))),f=a.value,g=()=>a.save(),w=function(){f[this.getAttribute("window-title")||""]={out:!0,data:Cn(this)},g()},v=[],y=()=>{for(const[,e]of v)if("none"!==e.style.getPropertyValue("display"))return void(e.control??e).click()};return yd.wait((e=>p(d,{class:{[Hf]:e}}))),Ic("helpKey",as.KEY_HELP,"F1",(e=>{xc(),e.preventDefault()}))[0](),Ic("togglePanel",as.KEY_PANEL_TOGGLE,"F9",(e=>{i.set(r.checked=!r.checked),e.preventDefault()}))[0](),Object.freeze({add:([t,i,a,o])=>{p(c,i);const s=e++,n=a?ks({class:$f,title:A`${as.POPOUT} ${t}`,onclick:e=>{e.preventDefault();const a=Ue();i.replaceWith(a),f[t+""]?f[t+""].out=!0:f[t+""]={out:!0,data:[20,20,0,0]},g();const[s,n,l,c]=f[t+""].data,h=Ln({"window-icon":o,"window-title":t,resizable:"true",style:{"min-width":"45px","--window-left":s+"px","--window-top":n+"px","--window-width":0===l?void 0:l+"px","--window-height":0===c?void 0:c+"px"},onremove:()=>{a.replaceWith(i),p(r,{style:{display:void 0}}),f[t+""].out=!1,g(),i.dispatchEvent(new CustomEvent("popin",{cancelable:!1}))},onmoved:w,onresized:w},i);p(In,h),p(r,{style:{display:"none"}}),d.checked&&y(),i.dispatchEvent(new CustomEvent("popout",{cancelable:!1,detail:h}))}}):null,[r,d]=qs([lt({src:o}),Ft(t),n||[]],h.insertBefore(ct({name:"tabSelector",type:"radio"}),l),{title:t,tabindex:-1,onkeyup:e=>{e.stopPropagation();let t=s,i=1;switch(e.key){case"ArrowLeft":i=-1;case"ArrowRight":do{t=gi(t+i,v.length)}while(t!==s&&"none"===v[t][1].style.getPropertyValue("display"));break;case"Enter":r.click();default:return}v[t][1].focus()},onclick:()=>Gf.set(t+"")});return p(l,r),v.push([t+"",r]),n&&f[t+""]&&f[t+""].out&&setTimeout((()=>n.dispatchEvent(new MouseEvent("click")))),i},css(){const t=Array.from({length:e},((e,t)=>t+1));P({[t.map((e=>`#${Sf}>input:nth-child(${e}):checked~#${If}>div:nth-child(${e})`)).join(",")]:{display:"block"},[t.map((e=>`#${Sf}>input:nth-child(${e}):checked~#${Df}>label:nth-child(${e})`)).join(",")]:{"border-bottom-color":"var(--c)","z-index":2,background:"var(--c) !important",cursor:"default !important",":before":{"box-shadow":"2px 2px 0 var(--c)"},":after":{"box-shadow":"-2px 2px 0 var(--c)"}}})},setTab(e){for(const[t,i]of v)if(t===e&&"none"!==i.style.getPropertyValue("display"))return void(i.control??i).click();y()},html:()=>[r,u]})})(),Wf={"background-color":"#000",color:"#fff",[` body, windows-window, #${Lf}`]:{"background-color":"#000",color:"#fff","border-color":"#fff"},[` a, .${Po}`]:{color:"#f00"}," windows-window::part(title)":{color:"#000"},[` #${Df}`]:{":after":{"border-color":"#fff"},">label":{"--c":"#000",background:"linear-gradient(to bottom, #777 30%, #111 100%)","box-shadow":"0 3px 3px rgba(255, 255, 255, 0.4), inset 0 1px 0 #000","text-shadow":"0 1px #000","border-color":"#fff",":hover,:focus":{background:"linear-gradient(to bottom, #f22 5%, #a77 40%, #111 100%)"},":before,:after":{"border-color":"#fff"},":before":{"box-shadow":"2px 2px 0 #2e2e2e"},":after":{"box-shadow":"-2px 2px 0 #2e2e2e"}}}," menu-menu":{"background-color":"#222",color:"#fff"}," menu-submenu[open]>menu-item, menu-item:focus":{"background-color":"#000"}," menu-item[disabled],menu-submenu[disabled]":{color:"#888"}};P({"html, body":{color:"#000","background-color":"#fff",margin:0,padding:0,"user-select":"none",height:"100%",width:"100%"},[`.${Po}`]:{cursor:"pointer"},[`a, .${Po}`]:{color:"#00f","text-decoration":"none",":hover":{"text-decoration":"underline"}},[`#${Lf}`]:{position:"fixed",top:0,right:0,bottom:0,width:"var(--panel-width, 300px)","border-left":"1px solid #000",transition:"right 1s, border-color 1s","background-color":"#fff"},[`.${Cf} #${Lf}`]:{"z-index":1},[`#${Sf}>input,#${If}>div`]:{display:"none"},[`#${Df}`]:{"padding-left":0,"margin-top":"-24px","line-height":"24px",position:"relative",width:"100%",overflow:"hidden",padding:"0 0 0 20px","white-space":"nowrap","--c":"#fff",":after":{position:"absolute",content:'""',width:"100%",bottom:0,left:0,"border-bottom":"1px solid #000","z-index":1,overflow:"hidden","text-align":"center",transform:"translateX(-20px)"},">label":{border:"1px solid #000",display:"inline-block",position:"relative","z-index":1,margin:"0 -5px",padding:"0 20px","border-top-right-radius":"6px","border-top-left-radius":"6px",background:"linear-gradient(to bottom, #ececec 50%, #d1d1d1 100%)","box-shadow":"0 3px 3px rgba(0, 0, 0, 0.4), inset 0 1px 0 #fff","text-shadow":"0 1px #fff",":hover,:focus":{background:"linear-gradient(to bottom, #faa 1%, #ffecec 50%, #d1d1d1 100%)",cursor:"pointer",outline:"none"},":before,:after":{position:"absolute",bottom:"-1px",width:"6px",height:"6px",content:'" "',border:"1px solid #000"},":before":{left:"-7px","border-bottom-right-radius":"6px","border-width":"0 1px 1px 0","box-shadow":"2px 2px 0 #d1d1d1"},":after":{right:"-7px","border-bottom-left-radius":"6px","border-width":"0 0 1px 1px","box-shadow":"-2px 2px 0 #d1d1d1"}}},[`#${Rf}`]:{display:"none",[`:checked~#${Lf}`]:{right:"calc(-1 * var(--panel-width) - 1px)",[`>#${Pf}`]:{"background-color":"#000",[`.${Hf}:not(:hover)`]:{opacity:0,transition:"background 1s, opacity 2s 10s"}}}},[`#${Pf}`]:{background:"#fff",border:"2px solid #f00","border-radius":"20px",position:"relative",left:"-12px",display:"block",width:"20px",height:"20px",transition:"background 1s","z-index":9,cursor:"pointer"},"windows-shell-taskmanager":{position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"clip"},"windows-window":{"--window-left":"20px","--window-top":"20px","max-width":"100%","max-height":"100%",outline:"none",">*":{padding:"0 1px"}},[`.${$f}`]:{display:"inline-block","margin-left":"5px","margin-right":"-10px",cursor:"pointer",width:"1em",height:"1em"},[`#${If}>div`]:{height:"calc(100vh - 30px)",overflow:"auto"},'input[type="number"]':{width:"5em"},"windows-desktop":{"background-color":"#000"},[`#${Df} img`]:{"padding-top":"5px",width:"1.5em",height:"1.5em",display:"none","pointer-events":"none"},[`.${Uf}`]:{[` #${Df}`]:{" img":{display:"inline"}," span":{display:"none"}},[` #${If}>div`]:{height:"calc(100vh - 40px)"}},"menu-menu":{border:"2px outset #000",padding:"0.25em 0","box-sizing":"border-box","column-gap":"1em","background-color":"#aaa",color:"#000"},"menu-submenu[open]>menu-item,menu-item:focus":{"background-color":"#eee"},"menu-submenu>menu-item:after":{display:"block",float:"right",content:'"\xbb"'},"menu-item":{outline:"none",padding:"0 0.25em"},"menu-item[disabled],menu-submenu[disabled]":{color:"#444","font-style":"italic"}}),$("@media (prefers-color-scheme: light)",{[`:root.${Io}`]:Wf}),$("@media (prefers-color-scheme: dark)",{[`:root:not(.${Io})`]:Wf}),k(document.body,[hs,In]),Ed.wait((e=>p(document.documentElement,{class:{[Io]:e}}))),Md.wait((e=>p(document.documentElement,{class:{[Uf]:e}}))),bd.wait((e=>p(document.documentElement,{class:{[Cf]:e}}))),ir.then((()=>{const e=[...on].sort((([e],[t])=>e-t)),t=zn?e.pop()[1]:null;return on.splice(0,on.length),Object.freeze(on),wd().then((()=>{p(document.body,{oncontextmenu:e=>{e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement||e.preventDefault()}});for(const[,t]of e){const e=t();e&&Zf.add(e)}for(const e of dd())Zf.add(e);(zn?Bm:bp)(Sn.appendChild(Ue())),t&&Zf.add(t()),Zf.css(),p(document.head,G()),p(Sn,Zf.html()),setTimeout((()=>Zf.setTab(Gf.value))),In.realignWindows(),p(window,{onresize:y((()=>In.realignWindows()),w)}),Xn.ready()}))})).catch(tr);</script></head><body><h1>Loading...</h1></body></html>