const[e,t,a,i,o,n,s,l,r,h,d,c,f,m,p,u,g,k,N,E,I,T,w,v]=await Promise.all(["/lib/bind.js","/lib/css.js","/lib/dom.js","/lib/html.js","/lib/menu.js","/lib/misc.js","/lib/nodes.js","/lib/settings.js","/lib/svg.js","/adminMap.js","/colours.js","/ids.js","/keys.js","/language.js","/map.js","/map_fns.js","/map_lighting.js","/map_tokens.js","/plugins.js","/rpc.js","/settings.js","/shared.js","/symbols.js","/windows.js"].map(include));class y extends k.Lighting{wallInteraction(e,t,a,i,o,n,s=!1){if(s&&n<=this.lightStages[0]){const{r:n,g:s,b:l,a:r}=o,h=255-Math.round((255-r)/255*(n+s+l)/765*(255-this.lightColours[0][0].r)),c=new d.Colour(h,h,h);return new y(e,t,a,i,[[c],[c]],this.lightStages,this.lightTimings)}return null}createLightPolygon(e){return r.polygon({points:e,fill:this.lightColours[0][0].toHexString()})}}let M;const b=Symbol("select"),A=Symbol("unselect"),O=Symbol("updateData"),C=m.makeLangPack({ARMOUR_CLASS:"Armour Class",CONDITION_BANE:"Bane",CONDITION_BLESSED:"Blessed",CONDITION_BLINDED:"Blinded",CONDITION_BLINK:"Blink",CONDITION_BLUR:"Blur",CONDITION_BURNING:"Burning",CONDITION_CHARMED:"Charmed",CONDITION_CONCENTRATING:"Concentrating",CONDITION_CONFUSED:"Confused",CONDITION_DEAD:"Dead",CONDITION_DEAFENED:"Deafened",CONDITION_DYING:"Dying",CONDITION_EXHAUSTED:"Exhausted",CONDITION_FLYING:"Flying",CONDITION_FRIGHTENED:"Frightened",CONDITION_GRAPPLED:"Grappled",CONDITION_GUIDANCE:"Guidance",CONDITION_HASTE:"Haste",CONDITION_HEXED:"Hex",CONDITION_HIDEOUS_LAUGHTER:"Hideous Laughter",CONDITION_HUNTERS_MARK:"Hunters' Mark",CONDITION_INCAPACITATED:"Incapacitated",CONDITION_INSPIRED:"Inspired",CONDITION_INVISIBLE:"Invisible",CONDITION_LEVITATE:"Levitating",CONDITION_MIRROR_IMAGE:"Mirror Image",CONDITION_PARALYZED:"Paralyzed",CONDITION_PETRIFIED:"Petrified",CONDITION_POISONED:"Poisoned",CONDITION_PRONE:"Prone",CONDITION_RAGE:"Rage",CONDITION_RECKLESS:"Reckless",CONDITION_RESTRAINED:"Restrained",CONDITION_SANCTUARY:"Sanctuary",CONDITION_SLOW:"Slow",CONDITION_STUNNED:"Stunned",CONDITION_UNCONSCIOUS:"Unconscious",CONDITIONS:"Conditions",DARKVISION:"Darkvision",DESATURATE_CONDITIONS:"Greyscale Conditions",HIDE_CONDITIONS:"Hide Token Conditions",HIGHLIGHT_COLOUR:"Token Highlight Colour",HP_CURRENT:"Current Hit Points",HP_CURRENT_ENTER:"Please enter current Hit Points",HP_MAX:"Maximum Hit Points",INITIATIVE:"Initiative",INITIATIVE_ADD:"Add Initiative",INITIATIVE_ADV:"Advantage",INITIATIVE_ASC:"Sort Initiative Ascending",INITIATIVE_CHANGE:"Change Initiative",INITIATIVE_DESC:"Sort Initiative Descending",INITIATIVE_ENTER:"Enter initiative",INITIATIVE_ENTER_LONG:"Please enter the initiative value for this token",INITIATIVE_MOD:"Initiative Mod",INITIATIVE_NEXT:"Next",INITIATIVE_PREV:"Previous",INITIATIVE_REMOVE:"Remove Initiative",IS_PLAYER:"Is Player",KEY_HEALTH:"Health Modification Key (5E)",KEY_INITIATIVE:"Initiative Key (5E)",NOTES:"Notes",SHAPECHANGE:"Shapechange",SHAPECHANGE_5E:"Shapechange (5E)",SHAPECHANGE_CHANGE:"Change to Selected Token",SHAPECHANGE_INITIAL_RESTORE:"Restore Initial Token",SHAPECHANGE_TITLE:"Shapechange Settings",SHAPECHANGE_TOKEN_ADD:"Add Token",SHAPECHANGE_TOKEN_CATEGORY:"Add Category",SHAPECHANGE_TOKEN_CATEGORY_LONG:"Please enter a name for this cateogory of Shapechanges.",SHAPECHANGE_TOKEN_CATEGORY_REMOVE:"Remove Shapechange Category",SHAPECHANGE_TOKEN_CATEGORY_REMOVE_LONG:"Are you sure you wish to Remove this Shapechange Category?",SHAPECHANGE_TOKEN_CATEGORY_RENAME:"Rename Shapechange Category",SHAPECHANGE_TOKEN_CATEGORY_RENAME_LONG:"Please enter a new name for this Shapechange category.",SHAPECHANGE_TOKEN_NAME:"Enter Name",SHAPECHANGE_TOKEN_NAME_LONG:"Please enter a name for the selected token.",SHAPECHANGE_TOKEN_REMOVE:"Remove Shapechange Token",SHAPECHANGE_TOKEN_REMOVE_LONG:"Are you sure you wish to Remove this Shapechange Token?",SHAPECHANGE_TOKEN_RENAME:"Rename Shapechange Token",SHAPECHANGE_TOKEN_RENAME_LONG:"Please enter a new name for this token.",SHOW_AC:"Show Token Armour Class",SHOW_HP:"Show Token Hit Points",SHOW_NAMES:"Show Token Names",TOGGLE_CONDITION:"Toggle Condition",TOKEN_SELECTED:"Selected",TOKENS_UNSELECTED:"Unselected"},{"en-US":{ARMOUR_CLASS:"Armor Class",DESATURATE_CONDITIONS:"Grayscale Conditions",HIGHLIGHT_COLOUR:"Token Highlight Color",SHOW_AC:"Show Token Armor Class"}}),_=N.pluginName(import.meta),[x,D,S,H,R,q,G,$,P,L,B,z,V,j,K,U,Y,W,Z,F,X,J,Q,ee,te,ae,ie,oe,ne,se,le,re,he,de,ce,fe,me,pe,ue,ge,ke,Ne,Ee,Ie,Te,we,ve,ye]=t.ids(48),Me=t.ids(37),be=r.svg({viewBox:"0 0 2 2"},r.polygon({points:"2,2 0,2 1,0",fill:"currentColor"})),Ae=r.svg({viewBox:"0 0 2 2"},r.polygon({points:"0,0 2,0 1,2",fill:"currentColor"})),Oe=r.svg({viewBox:"0 0 2 2"},r.polygon({points:"0,0 2,1 0,2",fill:"currentColor"})),Ce=r.svg({viewBox:"0 0 2 2"},r.polygon({points:"2,0 0,1 2,2",fill:"currentColor"})),_e=Object.keys(C).filter((e=>e.startsWith("CONDITION_"))),xe=(e,t)=>e.initiative-t.initiative,De=(e,t)=>t.initiative-e.initiative,Se=e=>e instanceof M&&!e.isPattern&&k.tokens.has(e.id),He=new s.NodeArray(i.ul({id:D})),Re=()=>{0===He.length?u.doMapDataRemove("5e-initiative"):u.doMapDataSet("5e-initiative",He.map((e=>({id:e.token.id,initiative:e.initiative}))))},qe=v.windows({"window-icon":`data:image/svg+xml,%3Csvg xmlns="${r.ns}" viewBox="0 0 100 100"%3E%3Cpath d="M92.5,7 l-30,30 h30 z" fill="%23000" stroke="%23fff" stroke-linejoin="round" /%3E%3Ccircle cx="50" cy="50" r="40" fill="none" stroke="%23fff" stroke-width="12" stroke-dasharray="191 1000" stroke-dashoffset="-29" /%3E%3Ccircle cx="50" cy="50" r="40" fill="none" stroke="%23000" stroke-width="10" stroke-dasharray="191 1000" stroke-dashoffset="-30" /%3E%3C/svg%3E`,"window-title":C.INITIATIVE,style:"--window-left: 0px; --window-top: 0px; --window-width: 200px; --window-height: 400px","window-data":"5e-window-data","hide-close":!0,"hide-maximise":!0,resizable:!0},i.div({id:x},[E.isAdmin?i.div([i.button({title:C.INITIATIVE_ASC,onclick:()=>{He.sort(xe),He.sort(s.noSort),Re()}},be),i.button({title:C.INITIATIVE_DESC,onclick:()=>{He.sort(De),He.sort(s.noSort),Re()}},Ae),i.br(),i.button({title:C.INITIATIVE_PREV,onclick:()=>{const e=He.pop();e&&(He.unshift(e),Re())}},Ce),i.button({title:C.INITIATIVE_NEXT,onclick:()=>{const e=He.shift();e&&(He.push(e),Re())}},Oe)]):[],He[s.node]])),Ge=new Set,$e=(e,t,o)=>(Ge.add(e.id),He.push({token:e,hidden:o,initiative:t,[s.node]:i.li({style:o&&!E.isAdmin?"display: none":void 0,onmouseover:()=>{e[s.node].parentNode&&(a.amendNode(Be,{width:e.width,height:e.height,transform:e.transformString()}),e[s.node].parentNode.insertBefore(Be,e[s.node]))},onmouseleave:()=>Be.remove()},[i.img({src:`/images/${e.src}`,onclick:t=>{p.centreOnGrid(e.x+(e.width>>1),e.y+(e.height>>1)),E.isAdmin&&t.ctrlKey&&h.selectToken(e)}}),i.span(e.getData("name")??""),i.span(E.isAdmin?{class:J,onclick:()=>{Pe([e.id,null]),Re(),Be.remove()}}:{},t+"")])})),Pe=e=>{const{"5e-initiative":t}=p.mapData.data,i=new Set;if(He.splice(0,He.length),Ge.clear(),p.walkLayers(((e,t)=>{t&&i.add(e.path)})),t)for(const a of t){const t=k.tokens.get(a.id);if(t){const{layer:o,token:n}=t;if(n instanceof M){let t=a.initiative;const s=i.has(o.path);if(e&&e[0]===a.id){const a=e[1];if(e=void 0,null===a)continue;t=a}s&&!E.isAdmin||$e(n,t,s)}}}if(e&&null!==e[1]){const{token:t,layer:a}=k.tokens.get(e[0]);t instanceof M&&$e(t,e[1],i.has(a.path))}0===He.length?qe.remove():qe.parentNode||a.amendNode(v.shell,qe),Ve()},Le={SHOW_HP:[new l.BoolSetting("5e-show-token-hp").wait((e=>a.amendNode(document.body,{class:{[R]:!e}}))),new l.BoolSetting("5e-show-selected-hp").wait((e=>a.amendNode(document.body,{class:{[j]:!e}})))],SHOW_AC:[new l.BoolSetting("5e-show-token-ac").wait((e=>a.amendNode(document.body,{class:{[$]:!e}}))),new l.BoolSetting("5e-show-selected-ac").wait((e=>a.amendNode(document.body,{class:{[K]:!e}})))],SHOW_NAMES:[new l.BoolSetting("5e-show-token-names").wait((e=>a.amendNode(document.body,{class:{[L]:!e}}))),new l.BoolSetting("5e-show-selected-names").wait((e=>a.amendNode(document.body,{class:{[U]:!e}})))],HIDE_CONDITIONS:[new l.BoolSetting("5e-hide-token-conditions").wait((e=>a.amendNode(document.body,{class:{[z]:e}}))),new l.BoolSetting("5e-hide-selected-conditions").wait((e=>a.amendNode(document.body,{class:{[Y]:e}})))],DESATURATE_CONDITIONS:[new l.BoolSetting("5e-desaturate-token-conditions").wait((e=>a.amendNode(document.body,{class:{[W]:e}}))),new l.BoolSetting("5e-desaturate-selected-conditions").wait((e=>a.amendNode(document.body,{class:{[Z]:e}})))]},Be=r.rect({"stroke-width":20}),ze=new d.ColourSetting("5e-hightlight-colour",new d.Colour(255,255,0,127)).wait((e=>{const t=e.toHexString();a.amendNode(Be,{fill:t,stroke:t,opacity:e.a/255})})),Ve=(()=>{const e=r.g({id:ee,fill:"#000"}),t=[[new d.Colour(0,0,0)]],i=[0],o=r.filter({id:we},r.feColorMatrix({type:"matrix",values:"0 0 0 0 0,0 0 0 0 0,0 0 0 0 0,-0.2125 -0.7154 -0.0721 1 0"})),n=r.filter({id:ve},r.feColorMatrix({type:"matrix",values:"0.5 0 0 0 0.5,0 0.5 0 0 0.5,0 0 0.5 0 0.5,0 0 0 1 0"})),l=r.g(),h=r.clipPath({id:ye}),c=[];k.masks[s.node].firstChild?.after(e),a.amendNode(k.definitions[s.node],[l,h,o,n]);let f=0,m=0,u=[];return()=>{f=0,a.clearNode(e),a.clearNode(l),a.clearNode(h);const o=[];He[0]?.token.getData("5e-player")?o.push(He[0].token):p.walkLayers(((e,t)=>{if(!t)for(const t of e.tokens)t.getData("5e-player")&&o.push(t)}));let n=p.wallList!==u||o.length!==c.length;if(u=p.wallList,o.length){const{gridSize:d,gridDistance:u,width:k,height:N}=p.mapData,E=d/(u||1),I=[Math.max(k,N)/E,0];n||=E!==m,m=E,a.amendNode(e,[r.rect({width:"100%",height:"100%",fill:"#fff"}),o.map(((e,o)=>{const[s,d]=e.getCentre();if(!n){const[e,t,i,n,r]=c[o];if(s===e&&d===t)return a.amendNode(l,n),a.amendNode(h,r),i}const m=g.makeLight(new y(s,d,s,d,t,I,i),p.wallList,E),u=(e.getData("5e-darkvision")??0)*E,k=[s,d,m,[],[]];if(c.splice(o,1,k),u){const t="DVC-5E_"+f++,[i,o]=e.getCentre();a.amendNode(l,k[3]=r.clipPath({id:t},r.circle({r:u,cx:i,cy:o}))),a.amendNode(h,k[4]=m.map((e=>a.amendNode(e.cloneNode(),{"clip-path":`url(#${t})`,fill:void 0}))))}return m})).flat().sort(((e,t)=>s.stringSort(t.getAttribute("fill")??"",e.getAttribute("fill")??"")))])}}})(),je={settings:{fn:i.div([T.labels([C.HIGHLIGHT_COLOUR,": "],d.makeColourPicker(null,C.HIGHLIGHT_COLOUR,(()=>ze.value),(e=>ze.set(e)))),i.table({id:Q},[i.thead(i.tr([i.td(),i.th(C.TOKENS_UNSELECTED),i.th(C.TOKEN_SELECTED)])),i.tbody(Object.entries(Le).map((([e,t])=>i.tr([i.td([C[e],": "]),t.map((e=>i.td(T.labels(i.input({type:"checkbox",class:c.settingsTicker,checked:e.value,onchange:function(){e.set(this.checked)}}),""))))]))))])])},tokenClass:{fn:e=>M=class extends e{#e;#t;#a;#i;#o;#n;#s;#l;#r;#h;#d;constructor(e,t){super(e,t);const a=this.getData("5e-hp-max"),i=this.getData("5e-hp-current"),o=this.getData("5e-ac"),n=Math.min(this.width,this.height)/4;this[s.node]=r.g([this.#e=this[s.node],this.#t=r.g({class:q,transform:`translate(${this.x}, ${this.y})`,style:"color: #000"},[this.#a=r.g({class:G,style:null===i||null===a?"display: none":void 0},[this.#n=r.use({href:`#${oe}`,width:n,height:n}),this.#o=r.use({href:`#${ie}`,width:n,height:n,"stroke-dasharray":19*Math.PI*.75*Math.min(i||0,a||0)/(a||1)+" 60",style:`color: rgba(${Math.round(255*Math.min(i||0,a||0)/(a||1))}, 0, 0, 1)`}),this.#i=r.text({x:this.width/8,y:"1.2em","text-anchor":"middle",fill:`rgba(${Math.round(255*Math.min(i||0,a||0)/(a||1))}, 0, 0, 1)`},i?.toString()??"")]),this.#s=r.text({class:B,style:"user-select: none",stroke:"#fff","stroke-width":1,fill:"#000",x:this.width/2,y:"1em","text-anchor":"middle"},this.getData("name")??""),this.#l=r.g({class:P,style:null===o?"display: none":void 0},[this.#h=r.use({href:`#${ae}`,width:n,height:n,x:3*this.width/4}),this.#r=r.text({x:7*this.width/8,y:"1.2em","text-anchor":"middle"},o?.toString()??"")]),this.#d=r.g({class:V})])]),setTimeout((()=>this.#c()),0),this.#f()}#c(){const e=this.width/2,t=this.#s.getComputedTextLength(),i=Math.min(this.width,this.height)/8,o=Math.min(e/t*16,this.height/8);a.amendNode(this.#s,{style:{"font-size":o+"px"},"stroke-width":o/100}),a.amendNode(this.#r,{style:{"font-size":`${i}px`}}),a.amendNode(this.#i,{style:{"font-size":`${i}px`}})}#m(e){const t=this[s.node];this[s.node]=this.#e;const a=e();return this.#e=this[s.node],this[s.node]=t,a}cleanup(){this.#m((()=>super.cleanup()))}uncleanup(){this.#m((()=>super.uncleanup()))}hasLight(){return super.hasLight()||this.getData("5e-player")}at(e,t){return this.#m((()=>super.at(e,t)))}[b](){k.outline.insertAdjacentElement("beforebegin",this.#t)}[A](){this.isPattern||a.amendNode(this[s.node],this.#t)}updateSource(e){this.#m((()=>super.updateSource(e)))}updateNode(){const e=this.#e instanceof SVGRectElement;this.#m((()=>super.updateNode())),this.isPattern?e||this.#t.remove():e&&(k.selected.token===this&&k.outline.insertAdjacentElement("beforebegin",this.#t),this[s.node].replaceWith(this[s.node]=r.g([this.#e,this.#t]))),a.amendNode(this.#e,{width:this.width,height:this.height,transform:this.transformString()}),a.amendNode(this.#t,{transform:`translate(${this.x}, ${this.y})`}),a.amendNode(this.#h,{x:3*this.width/4,width:this.width/4,height:Math.min(this.height,this.width)/4}),a.amendNode(this.#n,{width:this.width/4,height:Math.min(this.width,this.height)/4}),a.amendNode(this.#o,{width:this.width/4,height:Math.min(this.width,this.height)/4}),a.amendNode(this.#s,{x:this.width/2,style:{"font-size":void 0}}),a.amendNode(this.#i,{x:this.width/8}),a.amendNode(this.#r,{x:7*this.width/8}),this.#c(),this.#f()}[O](){const e=this.getData("5e-hp-max"),t=this.getData("5e-hp-current"),i=this.getData("5e-ac"),o=this.getData("name")||"";null===i?a.amendNode(this.#l,{style:"display: none"}):(a.amendNode(this.#l,{style:void 0}),a.clearNode(this.#r,i+"")),null===t||null===e?a.amendNode(this.#a,{style:"display: none"}):(a.amendNode(this.#a,{style:void 0}),a.clearNode(this.#i,{fill:`rgba(${Math.round(255*Math.min(t||0,e||0)/(e||1))}, 0, 0, 1)`},t+""),a.amendNode(this.#o,{"stroke-dasharray":19*Math.PI*.75*Math.min(t||0,e||0)/(e||1)+" 60"})),this.#s.innerHTML!==o&&(a.clearNode(this.#s,{style:{"font-size":void 0}},o),this.#c()),this.#f()}#f(){a.clearNode(this.#d);const e=this.getData("5e-conditions")??[],t=Math.min(this.width,this.height)/4,i=Math.floor(this.width/t);let o=-1,n=0;for(let s=0;s<e.length;s++)e[s]&&(a.amendNode(this.#d,r.use({href:`#${Me[s]}`,x:n*t,y:o*t,width:t,height:t})),n++,n===i&&(n=0,o--));a.amendNode(this.#d,{transform:`translate(0, ${this.height})`})}}},handleWalls:{fn:Ve}},Ke=r.animate({attributeName:"stroke-dashoffset",values:"251.26;0",dur:"1s"}),Ue=r.animateMotion({dur:"1s",begin:-.6},r.mpath({href:"#5e-dying"})),Ye=r.circle({r:3,fill:"#fff",stroke:"#000"},Ue);if(t.add({[`#${x}`]:{" svg":{width:"1.5em"}," button":{height:"2em"}},[`#${D}`]:{"list-style":"none",padding:0," li":{display:"grid","grid-template-columns":"4.5em auto 3em","align-items":"center"," span":{"text-align":"center"}}," img":{height:"4em",width:"4em",cursor:"pointer"}},[`.${S}`]:{"padding-left":"1em","box-styling":"padding-box",">menu-item":{display:"list-item","list-style":"none"}},[`.${H}`]:{"list-style":"square !important"},[`.${R} g .${q} .${G},.${$} g .${q} .${P},.${L} g .${q} .${B},.${z} g .${q} .${V},.${j} svg>.${q} .${G},.${K} svg>.${q} .${P},.${U} svg>.${q} .${B},.${Y} svg>.${q} .${V}`]:{visibility:"hidden"},[`.${W} g .${q} .${V},.${Z} svg>.${q} .${V}`]:{filter:`url(#${te})`},[`.${F},.${F}>button,.${F}>img`]:{width:"100px",height:"100px"},[`#${X}`]:{"border-collapse":"collapse"," td":{"text-align":"center",label:{"font-size":"2em"}}," th, td:not(:first-child)":{border:"1px solid currentColor"}},[`.${J}:hover`]:{"background-color":"#800",cursor:"pointer"}}),I.enableAnimation.wait((e=>{const t={repeatCount:e?"indefinite":1};a.amendNode(Ke,t),a.amendNode(Ue,t),a.amendNode(Ye,e?{cx:0,cy:0}:{cx:46,cy:38})})),a.amendNode(w.symbols,[r.filter({id:te},r.feColorMatrix({type:"saturate",values:0})),r.symbol({id:ae,viewBox:"0 0 8 9"},r.path({d:"M0,1 q2,0 4,-1 q2,1 4,1 q0,5 -4,8 q-4,-3 -4,-8 z",fill:"#aaa"})),r.symbol({id:oe,viewBox:"0 0 20 20"},r.circle({r:9.5,fill:"#eee",stroke:"#888","stroke-width":1,"stroke-linecap":"round","stroke-dasharray":`${19*Math.PI*.75} ${19*Math.PI*.25}`,transform:"translate(10, 10) rotate(135)"})),r.symbol({id:ie,viewBox:"0 0 20 20"},r.circle({r:9.5,fill:"transparent",stroke:"#f00","stroke-width":1,"stroke-linecap":"round",transform:"translate(10, 10) rotate(135)"})),[r.symbol({viewBox:"0 0 80 85"},r.g({stroke:"#000","stroke-width":3,"stroke-linecap":"round","stroke-linejoin":"round"},[r.path({d:"M5,37 a1,1 0,0,1 70,0 q4,-1 3,5 q-1,18 -6,10 q0,28 -15,30 q-17,3 -34,0 q-15,-2 -15,-30 q-5,8 -6,-10 q-1,-6 3,-5 z M40,2 v25 m-5,0 h10 m0,-6 h-10 m0,-6 h10 m0,-6 h-10",fill:"#444"}),r.path({d:"M57,82 q-17,3 -34,0 l10,-20 l-20,-18 l5,-20 l5,10 l17,5 l17,-5 l5,-10 l5,20 l-20,18 z",fill:"#fff"}),r.path({d:"M20,38 l15,5 a5,5 0,0,1 -15,-5 z M60,38 l-15,5 a5,5 0,0,0 15,-5 z",fill:"#f00"})])),r.symbol({viewBox:"0 0 11 10.5"},[r.ellipse({cx:5.5,cy:2,rx:5,ry:1.5,fill:"transparent",stroke:"#ff0","stroke-width":1}),r.circle({cx:5.5,cy:5.5,r:5,fill:"#fc8",stroke:"#000","stroke-width":.2}),r.ellipse({cx:5.5,cy:2,rx:5,ry:1.5,fill:"transparent",stroke:"#ff0","stroke-width":1,"stroke-dasharray":10}),r.path({d:"M2,5.5 q1,-1 2,0 m3,0 q1,-1 2,0 M3.5,8.5 q2,1 4,0",fill:"transparent",stroke:"#000","stroke-width":.1,"stroke-linecap":"round"})]),r.symbol({viewBox:"0 0 100 70"},[r.defs(r.mask({id:ne},[r.rect({width:100,height:70,fill:"#fff"}),r.line({x1:10,y1:67,x2:90,y2:3,stroke:"#000","stroke-width":9})])),r.g({mask:`url(#${ne})`},w.visibility()),r.line({x1:10,y1:67,x2:90,y2:3,stroke:"#000","stroke-width":5})]),r.symbol({viewBox:"0 0 100 80"},r.g({stroke:"#000","stroke-width":2},[r.ellipse({cx:50,cy:35,rx:49,ry:34,fill:"#fc8"}),r.path({d:"M10,55 l-8,9 M20,62 l-5,9 M30,66 l-3,10 M40,69 l-1,10 M50,70 v10 M60,69 l1,10 M70,66 l3,10 M80,62 l5,9 M90,55 l8,9","stroke-linecap":"round"})])),r.symbol({viewBox:"0 0 150 90"},[r.defs(r.g({id:se},[r.circle({cx:50,cy:50,r:48,fill:"#fc8",stroke:"#000"}),r.path({d:"M30,30 v10 a5,5 0,0,0 10,0 v-10 a5,5, 0,0,0 -10,0 M60,30 v10 a5,5 0,0,0 10,0 v-10 a5,5, 0,0,0 -10,0 M20,60 q30,20 60,0 q-30,40 -60,0 Z",fill:"#321"})])),r.use({href:`#${se}`,style:"opacity: 0.6"}),r.use({href:`#${se}`,style:"opacity: 0.6",transform:"translate(50, 0)"}),r.use({href:`#${se}`,style:"opacity: 0.8",transform:"translate(25, 0)"})]),r.symbol({viewBox:"0 0 100 100"},[r.defs(r.radialGradient({id:ge,cy:.55,fy:1},[r.stop({offset:"0%","stop-color":"#fff"}),r.stop({offset:"20%","stop-color":"#ff0"}),r.stop({offset:"100%","stop-color":"#f00"})])),r.path({d:"M43,99 c-20,0 -60,-30 -30,-70 q0,20 10,30 c0,-20 25,-40 20,-58 q20,30 20,58 q10,-10 5,-30 q10,15 15,35 q5,-10 0,-25 c40,50 -10,62 -40,60 z M25,20 c-15,30 5,30 0,0 z M60,20 c0,20 10,20 0,0 z",stroke:"#000",fill:`url(#${ge})`,"stroke-linejoin":"round"})]),r.symbol({viewBox:"0 0 8.2 8.23"},r.path({d:"M0.1,2.1 a2,2 0,0,1 4,0 a2,2 0,0,1 4,0 q0,3 -4,6 q-4,-3 -4,-6 Z",fill:"#f00",stroke:"#000","stroke-width":.2})),r.symbol({viewBox:"0 0 80 90"},[r.defs([r.path({id:le,d:"M1,7 v2 a1,1 0,0,1 -2,0 v-2 z",fill:"#000"}),r.g({id:re},[r.circle({r:5.5,fill:"none",stroke:"#000","stroke-width":4.5}),Array.from({length:12},((e,t)=>30*t)).map((e=>r.use({href:`#${le}`,transform:`rotate(${e})`})))])]),r.path({d:"M64,88 c-15,-30 20,-30 15,-60 c-5,-35 -70,-40 -70,10 c-10,10 -10,10 -2,12 c-2,4 -2,4 2,5 c-4,4 -2,4 0,5 c-2,8 -1,10 20,12 q5,0 5,15 z",fill:"#fc8",stroke:"#000","stroke-linejoin":"round"}),r.use({href:`#${re}`,transform:"translate(55, 15)"}),r.use({href:`#${re}`,transform:"translate(30, 20) scale(1.2)"}),r.use({href:`#${re}`,transform:"translate(50, 42) scale(1.8)"})]),r.symbol({viewBox:"0 0 58 100"},r.path({d:"M37,90 a8,8 0,1,0 0,0.1 z M25,70 h8 l1,-20 a11,8 -10,0,0 -30,-45 v15 h5 l2,-8 a9,6 -10,0,1 13,32 Z",stroke:"#000","stroke-width":2,fill:"#fff"})),r.symbol({viewBox:"0 0 84 110"},[r.rect({x:18,y:50,width:47,height:30,fill:"#ffe"}),r.path({d:"M12,52 q-9,-1 -10,-10 a35,35 0,1,1 80,0 q-1,9 -10,10 M32,83 c-10,-20 -27,0 -20,-30 c3,-4.5 -5,-13.5 0,-18 M72,35 c5,4.5 -3,13.5 0,18 c7,30 -10,10 -20,30 M17,72.2 c3,10 0,28 5,30 a40,40 0,0,0 40,0 c5,-2 2,-20 5,-30",fill:"#ffe",stroke:"#000","stroke-width":2,"stroke-linecap":"round"}),r.path({d:"M23,74 c3,5 0,15 5,20 a30,30 0,0,0 28,0 c5,-5 2,-15 5,-20 M32,96 v-13 a25,30 0,0,0 20,0 v13 M37,85 v12 M42,86 v12 M47,85 v12 M32,89.5 a27,30 0,0,0 20,0",fill:"none",stroke:"#000","stroke-width":1}),r.path({d:"M19,50 c0,20 18,10 18,5 c2,-15 -20,-10 -18,-5 M 65,50 c0,20 -18,10 -18,5 c-2,-15 20,-10 18,-5 M41,60 c-10,5 -5,25 0,15 Z M43,60 c10,5 5,25 0,15 Z",fill:"#000"})]),r.symbol({viewBox:"0 0 65 70"},[r.path({d:"M15,25 a20,20 0,1,1 40,10 c0,5 -10,5 -10,10 c-3,15 -10,30 -20,20 M20,25 a10,10 0,1,1 30,10",fill:"#fff",stroke:"#000","stroke-width":3,"stroke-linecap":"round"}),r.path({d:"M5,60 l20,-20 M50,15 l10,-10",stroke:"#000","stroke-width":8})]),r.symbol({viewBox:"0 0 100 54"},[r.defs(r.path({id:he,d:"M0,32 h20 l3,-10 l6,30 l10,-50 l8,40 l4,-10 l4,15 l6,-25 l3,10 h36",fill:"none","stroke-linejoin":"round","stroke-dasharray":"150 102"},Ke)),r.use({href:`#${he}`,stroke:"#000","stroke-width":4}),r.use({href:`#${he}`,stroke:"#f00","stroke-width":2}),Ye]),r.symbol({viewBox:"0 0 82 107"},r.g({stroke:"#000",fill:"#fff","stroke-width":1},[r.circle({cx:41,cy:41,r:40,fill:"#fa6"}),r.circle({cx:41,cy:60,r:6,fill:"#000"}),r.path({d:"M11,30 a2,1 0,0,0 20,0 m20,0 a2,1 0,0,0 20,0",fill:"none"}),r.path({d:"M38,70 l-6,18 l1,11 h16 l1,-11 l-6,-18"}),r.path({d:"M36,90 a8,8 0,1,0 -3,10 M46,90 a8,8 0,1,1 3,10 M33,98 a8,8 0,1,0 16,0"})])),r.symbol({viewBox:"0 0 200 100"},[r.defs(r.path({id:de,d:"M100,99 c40,-20 30,-50 60,-40 q10,5 20,-10 h-40 c40,-10 45,-5 50,-20 l-45,5 c45,-20 50,-10 54,-33 c-120,20 -45,60 -99,98 z",fill:"#fff",stroke:"#000","stroke-width":2,"stroke-linejoin":"round"})),r.use({href:`#${de}`,transform:"translate(200, 0) scale(-1, 1)"}),r.use({href:`#${de}`})]),r.symbol({viewBox:"0 0 62 80"},[r.path({d:"M11,43 a25,26 0,1,1 40,0 a15,22 0,1,1 -40,0 z M11,79 q5,-5 5,-10 q0,-3.5 -1,-7 q-6,-9 -5,-18 q-4,-5 -5,-15 a1,1 0,0,0 -4,-1 q0,5 3,17 q-2,10 3,20 q-1,7 -5,14 z M51,79 q-5,-5 -5,-10 q0,-3.5 1,-7 q6,-9 5,-18 q4,-5 5,-15 a1,1 0,0,1 4,-1 q0,5 -3,17 q2,10 -3,20 q1,7 5,14 z",fill:"#fc8",stroke:"#000"}),r.ellipse({cx:31,cy:56,rx:5,ry:10,fill:"#000"}),r.g({fill:"#f80",stroke:"#fff","stroke-width":3},[r.circle({cx:21,cy:29,r:3}),r.circle({cx:41,cy:29,r:3})]),r.path({d:"M29,29 q-5,11 3,10",stroke:"#000","stroke-width":.5,fill:"none"})]),r.symbol({viewBox:"0 0 75 70"},r.g({fill:"#fc8",stroke:"#000","stroke-linejoin":"round","stroke-linecap":"round"},[r.path({d:"M11,44 l2,10 l5,5 l15,-5 l5,-3 q2,-12 9,-16 l21,-12 l-24,-11 l-26,-5 l-5,10 l-8,5 q0,5 -4,10"}),r.path({d:"M11,44 q1,5 -1,10 q3,10 6,15 q10,-6 20,-10 q-4,-12 -18,-3 M6,44 q10,-1 20,0 q1,-5 0,-10 q-12,-2 -25,-2 q2,6 5,12 M11,24 q7,2 15,5 q3,-5 4,-10 q-10,-4 -20,-7 q-2,5 -5,10 q0,5 -4,10 M26,9 q15,10 20,0 q-8,-5 -15,-8 q-6,1.5 -12,2 l-4,10 M56,24 q-5,2 -10,5 q1,6 2,10 q5,2 25,-5 q-2,-7 -5,-15 q-10,0 -24,-7"})])),r.symbol({viewBox:"0 0 100 100"},[r.defs(r.polygon({id:ce,points:"16,16 50,30 84,16 70,50 84,84 50,70 16,84 30,50"})),r.g({stroke:"#000","stroke-width":1},[r.use({href:`#${ce}`,fill:"#888"}),r.use({href:`#${ce}`,fill:"#ccc",transform:"rotate(45, 50, 50)"}),r.circle({cx:50,cy:50,r:20,fill:"#fff"})])]),r.symbol({viewBox:"0 0 100 80"},[r.defs(r.pattern({id:ke,width:100,height:80,patternUnits:"userSpaceOnUse"},[r.rect({width:100,height:80,fill:"#f84"}),r.path({d:"M11,58 a3,2 0,0,0 0,-10 M55,0 q23,10 17,20 M70,40 l21,5 v-6 l-14,-4 c-10,-5 0,-10 -10,-20 h-10 v5 c5,5 -5,20 13,20 M92,32 a1,1 0,0,1 0,-5",fill:"#ffc"})])),r.path({d:"M30,45 q3,5 -2,10 q-4,1 -8,5 c-8,5 0,20 -10,15 q-1,-1.5 0,-3 l1,-8 c2,-5 10,-10 5,-9 a4,2 0,1,1 1,-5 a4,1 330,0,1 55,-30 q0,-8 -10,-15 a2,5 320,0,1 3,0 q20,10 17,15 q8,0 10,10 q-5,5 -15,5 q6,3 12,5 a1,1 0,0,1 -1,3 q-10,-2 -20,-3 q-18,0 -37,11",fill:`url(#${ke})`,stroke:"#000","stroke-linecap":"round","stroke-linejoin":"round"}),r.circle({cx:82,cy:25,r:1.5,fill:"#000"})]),r.symbol({viewBox:"0 0 100 100"},[r.circle({cx:50,cy:50,r:49.5,fill:"#808",stroke:"#000","stroke-width":1}),r.path({d:"M3,35 L79,90 L50,1 L21,90 L97,35 Z",stroke:"#000",fill:"#fff","stroke-linejoin":"bevel","fill-rule":"evenodd"})]),r.symbol({viewBox:"0 0 100 100"},[r.defs(r.radialGradient({id:Ne,cx:"50%",cy:"50%",fx:"15%",fy:"15%"},[r.stop({offset:"0%","stop-color":"#fff"}),r.stop({offset:"50%","stop-color":"#f00"}),r.stop({offset:"100%","stop-color":"#600"})])),r.g({stroke:"#000","stroke-linejoin":"round"},[r.path({d:"M1,10 q0,50 49,50 q49,0 49,-50 c-10,5 -30,-9 -49,-9 c-19,0 -39,14 -49,9 z",fill:"#a00"}),r.path({d:"M20,69 a1,1 0,0,0 60,0 v-30 q0,-20 -20,-20 c0,15 -20,15 -20,0 q-20,0 -20,20 z",fill:"#ffd"}),r.path({d:"M35,30 v20 c0,20 -15,10 -5,20 M65,30 v20 c0,20 15,10 5,20",stroke:"#a00","stroke-width":2,"stroke-linecap":"round",fill:"none"}),r.path({d:"M30,70 a10,9 0,0,0 40,0 z a2,1 0,0,0 40,0 M35,70 v12 M40,70 v15.5 M45,70 v17 M50,70 v18 M55,70 v17 M60,70 v15.5 M65,70 v12",fill:"#fff"}),r.circle({cx:50,cy:62,r:10,fill:`url(#${Ne})`}),r.path({d:"M27,40 l20,10 a1,1 0,0,1 -20,-10 z M73,40 l-20,10 a1,1 0,0,0 20,-10 z",fill:"#ff0"}),r.circle({cx:35,cy:50,r:2,fill:"#000"}),r.circle({cx:65,cy:50,r:2,fill:"#000"})])]),r.symbol({viewBox:"0 0 100 100"},[r.defs(r.mask({id:fe},[r.rect({width:100,height:100,fill:"#fff"}),r.path({d:"M0,50 h100 M50,0 v100","stroke-width":10,stroke:"#000"})])),r.circle({cx:50,cy:50,r:47.5,fill:"#fff"}),r.g({mask:`url(#${fe})`},[r.circle({cx:50,cy:50,r:30,stroke:"#f00","stroke-width":2,fill:"none"}),r.circle({cx:50,cy:50,r:45,stroke:"#000","stroke-width":5,fill:"none"})]),r.path({d:"M0,50 h35 m30,0 h35 M50,0 v35 m0,30 v35",stroke:"#000","stroke-width":3}),r.path({d:"M35,50 h10 m10,0 h15 M50,35 v10 m0,10 v10",stroke:"#000","stroke-width":1}),r.circle({cx:50,cy:50,r:2,fill:"#f00"})]),r.symbol({viewBox:"0 0 100 100"},[r.circle({cx:50,cy:50,r:49.5,stroke:"#000",fill:"#fc8"}),r.path({d:"M20,30 l20,20 m-20,0 l20,-20 m20,0 l20,20 m-20,0 l20,-20 M30,75 h40 v5 a1,1 0,0,1 -15,0 v-5",stroke:"#000","stroke-width":2,fill:"#f00","stroke-linecap":"round"})]),r.symbol({viewBox:"0 0 24 100"},r.path({d:"M20,90 a8,8 0,1,0 0,0.1 z M8,70 h8 l4,-65 h-16 z",stroke:"#000","stroke-width":2,fill:"#fff"})),r.symbol({viewBox:"0 0 82 92"},r.g({stroke:"#000","stroke-width":1,fill:"rgba(255, 255, 255, 0.75)"},[r.path({d:"M81,91 v-50 a30,30 0,0,0 -80,0 v50 l10,-10 l10,10 l10,-10 l10,10 l10,-10 l10,10 l10,-10 z"}),r.circle({cx:20,cy:30,r:10}),r.circle({cx:60,cy:30,r:10})])),r.symbol({viewBox:"0 0 100 100"},[r.defs(r.g({id:me,transform:"rotate(10)",stroke:"#000","stroke-width":1},[r.path({d:"M30,65 q-0.5,-5, 0,-10 h16 q15,6 30,6 h18 q1,3 0,6 h-18 q-15,0 -30,-6 v4 z",fill:"#420"}),r.path({d:"M30,55 h16 q15,6 30,6 h18 q0.5,-10 -10,-10 q-30,-4 -28,-10 q1,-15 -0,-30 q-12,-1 -26,0 q-1,22 0,44",fill:"#840"})])),r.path({d:"M0,100 v-30 l20,-5 h60 l20,5 v30 z",fill:"#0a0"}),r.use({href:`#${me}`,transform:"translate(10,0) scale(0.9)"}),r.use({href:`#${me}`}),r.path({d:"M15,90 q-2,-2.5 5,-5 q-2,-2.5 5,-5 c3,0 40,2 58,5 q5,2.5 -5,5 q5,2.5 -5,5 c-15,2 -55,-5 -58,-5",fill:"#040"})]),r.symbol({viewBox:"0 0 70 90"},[r.rect({x:5,y:5,width:60,height:80,fill:"#4df",stroke:"#640","stroke-width":10,rx:1}),r.path({d:"M10,50 v10 L60,15 v-5 h-5 z",fill:"#8ff"})]),r.symbol({viewBox:"0 0 73 81"},r.path({d:"M10,32 a1,1 0,0,0 40,40 a1,1 0,0,0 -3,-3 a1,1 0,0,1 -34,-34 a1,1 0,0,0 -3,-3 z M60,77 l-20,-30 h-20 l-10,-35 a8,8 90,1,1 8,5 l7,24.5 h18 l18.5,28 l7,-4 l3,4 z",fill:"#00a",stroke:"#000","stroke-width":1})),r.symbol({viewBox:"0 0 100 90"},[r.path({d:"M5,90 a60,60 0,0,1 90,0 z",fill:"red",stroke:"#000"}),r.path({d:"M50,20 c20,0 20,10 20,30 c-2,15 -5,20 -18,30 q-2,1 -4,0 c-13,-10 -16,-15 -18,-30 c0,-20 0,-30 20,-30",fill:"#fc8",stroke:"#000"}),r.path({d:"M35,45 a10,10 0,0,1 10,0 a10,10 0,0,1 -10,0 M55,45 a10,10 0,0,1 10,0 a10,10 0,0,1 -10,0",fill:"red",stroke:"#000","stroke-width":.3}),r.path({d:"M40,65 c5,0 5,-5 10,-3 c5,-2 5,3 10,3 q-10,-0.5 -20,0 M41,65 q10,0.5 18,0 c-4,4 -14,4 -18,0",fill:"#080"}),r.g({"stroke-width":8,"stroke-linecap":"round",fill:"none"},[r.path({d:"M30,40 c-15,-5 -10,20 -25,10 M70,40 c15,-5 10,20 25,10",stroke:"#040"}),r.path({d:"M33,32 c-15,-10 -10,5 -25,-10 M67,32 c15,-10 10,5, 25,-10",stroke:"#060"}),r.path({d:"M38,25 c-5,-10 -10,5 -15,-20 M 62,25 c5,-10 10,5, 15,-20",stroke:"#080"}),r.path({d:"M50,22 v-18",stroke:"#0a0"})])]),r.symbol({viewBox:"0 0 6.2 9.3"},[r.defs(r.linearGradient({id:Ee},[r.stop({offset:"0%","stop-color":"#040"}),r.stop({offset:"100%","stop-color":"#0e0"})])),r.path({d:"M3.1,0.2 q-6,8 0,9 q6,-1 0,-9 Z",stroke:"#000","stroke-width":.2,fill:`url(#${Ee})`})]),r.symbol({viewBox:"0 0 100 60"},[r.defs(r.pattern({id:Ie,width:100,height:60,patternUnits:"userSpaceOnUse"},[r.rect({width:100,height:60,fill:"#cca"}),r.path({d:"M100,60 h-53 l25,-60 h20 z",fill:"#888"}),r.circle({cx:15,cy:20,r:13,fill:"#840"}),r.path({d:"M85,59 h15 v-20 h-15 z M0,59 h50 v-15 h-50 z M0,25 l28,-10 l-5,20 h-10 z",fill:"#fc8"})])),r.g({stroke:"#000","stroke-linejoin":"round",fill:`url(#${Ie})`},[r.path({d:"M40,33.5 l-3,14.5 h-3.5 l-2,8 h9 q4,0 5,-4 l5,-20.5 z M90,59 a1,1 0,0,0 0,-12 h-20 l10,-23 c10,-8 0,-20 -5,-18 l-40,5 q-5,0 -6,5 l-8,33 h-15 a1,1 0,0,0 0,10 h20 q5,0 6,-5 l5,-20 l27,-5 l-10,25 q0,5 5,5 z M64,29 l-4,1 l-8,20 q-1,4 2,4 z"}),r.circle({cx:15,cy:20,r:12})])]),r.symbol({viewBox:"0 0 100 100"},r.g({stroke:"#000","stroke-width":1,fill:"#fff"},[r.circle({cx:50,cy:50,r:49,fill:"#a00"}),r.circle({cx:30,cy:40,r:8}),r.circle({cx:70,cy:40,r:8}),r.path({d:"M22,25 l17,8 M61,33 l17,-8 M20,80 a3,2 0,0,1 60,0 z M30,80 v-15 M40,80 v-20 M50,80 v-20 M60,80 v-20 M70,80 v-15","stroke-width":3})])),r.symbol({viewBox:"0 0 100 90"},r.g({stroke:"#000","stroke-linejoin":"round","stroke-linecap":"round"},[r.path({d:"M94,84 l-5,5 l-5,-5 l2,-2 l-75,-75 l0,-6",fill:"#840"}),r.path({d:"M94,84 l5,-5 l-5,-5 l-2,2 l-75,-75 l-6,0",fill:"#c84"}),r.path({d:"M7,20 h-5 q5,30 30,25 l-6,-15 z",fill:"#aad"}),r.path({d:"M20,10 q-10,10 -15,10 q10,20 25,20 q-2,-8 5,-15 l1,-1",fill:"#88b"}),r.path({d:"M20,10 l5,-5 l15,15 l-5,5",fill:"#aad"}),r.path({d:"M2,88 a1,1 0,1,1 3,-5 l13,-15 l-5,-5 l3,-3 l7,7",fill:"#f80"}),r.path({d:"M2,88 a1,1 0,1,0 5,-3 l15,-13 l5,5 l3,-3 l-7,-7",fill:"#fa0"}),r.path({d:"M1.75,87.80 l0.4,0.4"}),r.path({d:"M26,70 l55,-50 l5,-16",fill:"#88f"}),r.path({d:"M86,4 l-5,16 l-55,50 l-3,-3",fill:"#bbf"}),r.path({d:"M86,4 l-16,5 l-50,55 l3,3",fill:"#669"})])),r.symbol({viewBox:"0 0 37 37"},r.g({stroke:"#000","stroke-width":.5,fill:"#ccc","stroke-linecap":"round","fill-rule":"evenodd"},[r.path({d:"M2,28 a1,1 0,0,0 5,5 l4,-4 a1,1 0,0,0 -5,-5 z m1,1 a1,1 0,0,0 3,3 l4,-4 a1,1 0,0,0 -3,-3 z m10,-12 a1,1 0,0,0 5,5 l4,-4 a1,1 0,0,0 -5,-5 z m1,1 a1,1 0,0,0 3,3 l4,-4 a1,1 0,0,0 -3,-3 z m10,-12 a1,1 0,0,0 5,5 l4,-4 a1,1 0,0,0 -5,-5 z m1,1 a1,1 0,0,0 3,3 l4,-4 a1,1 0,0,0 -3,-3 z"}),r.path({d:"M7.5,26.5 l8,-8 a1,1 0,0,1 1,1 l-8,8 a1,1 0,0,1 -1,-1 z m11,-11 l8,-8 a1,1 0,0,1 1,1 l-8,8 a1,1 0,0,1 -1,-1 z"})])),r.symbol({viewBox:"0 0 47 72"},[r.g({stroke:"#000",fill:"none"},[r.path({d:"M2.5,41.5 l21,-21 l21,21","stroke-width":6.5}),r.path({d:"M23.5,0.25 v21 M14.5,7 h18","stroke-width":3}),r.path({d:"M23.5,21 l20,20 v30 h-40 v-30 z",fill:"#efa"}),r.path({d:"M23.5,1 v20 M15.5,7 h16",stroke:"#fc4","stroke-width":1}),r.path({d:"M3.5,41 l20,-20 l20,20",stroke:"#e42","stroke-width":5}),r.circle({cx:23.5,cy:40,r:8,fill:"#88f","stroke-width":.5})]),r.path({d:"M13.5,70.5 v-10 a10,10 0,0,1 20,0 v10 z",fill:"#642"})]),r.symbol({viewBox:"0 0 100 65"},[r.defs(r.pattern({id:Te,x:15,y:12.5,width:22,height:12,patternUnits:"userSpaceOnUse"},[r.rect({width:22,height:12,fill:"#420"}),r.path({d:"M0,0 l3,6 h8 l3,-6 h8 l1,2 m0,8 l-1,2 h-8 l-3,-6 m-8,0 l-3,6",fill:"transparent",stroke:"#210","stroke-linecap":"square"})])),r.path({d:"M26,43 q-3,-10 -10,-20 q-30,0 0,-20 c30,-10 0,15 20,35 M30,43 q-5,20 0,20 q2.5,0.5 5,0 q5,0 5,-20 M80,43 q5,20 0,20 q-2.5,0.5 -5,0 q-5,0 -5,-20 M80,43 c40,-35 0,-10 -2,-3",fill:"#080",stroke:"#000","stroke-linejoin":"round"}),r.path({d:"M25,43 c20,-30 40,-30 60,0 c-20,5 -40,5 -60,0 Z",fill:`url(#${Te})`,stroke:"#210","stroke-linejoin":"round"}),r.circle({cx:20,cy:10,r:2.5,fill:"#000"})]),r.symbol({viewBox:"0 0 100 100"},r.g({stroke:"#000"},[r.circle({cx:50,cy:50,r:49,fill:"#fc8"}),r.path({id:pe,d:"M30,40 l3,8.5 h9 l-7,5.5 l2.5,8 l-7.5,-5 l-7.5,5 l2.5,-8.5 l-7,-5.5 h9 z",fill:"#ff0"}),r.use({href:`#${pe}`,transform:"translate(40, 0) scale(0.5)","stroke-width":1.5}),r.path({d:"M50,80 l-1,-8 l16,2 l-2,-16 l16,2 l-1,-8",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"})])),r.symbol({viewBox:"0 0 100 100"},[r.defs(r.path({id:ue,d:"M3,2 h20 v3 l-15,20 h15 l1,-3 h1 l-1,5 h-20 v-3 l15,-20 h-15 l-1,3 h-1 z","stroke-width":1,stroke:"#000",fill:"#fff"})),r.use({href:`#${ue}`,transform:"scale(1.2) translate(55, 0)"}),r.use({href:`#${ue}`,transform:"translate(45, 30)"}),r.use({href:`#${ue}`,transform:"scale(0.8) translate(35, 70)"}),r.use({href:`#${ue}`,transform:"scale(0.6) translate(25, 130)"})])].map(((e,t)=>a.amendNode(e,{id:Me[t]})))]),E.isAdmin){const l=e=>{if(!e["shapechange-categories"]||!e["store-image-shapechanges"])return null;if(!(e["shapechange-categories"].data instanceof Array))return console.log("shapechange-categories must be an Array"),null;if(!(e["store-image-shapechanges"].data instanceof Array))return console.log("store-image-shapechanges must be an Array"),null;const t=e["store-image-shapechanges"].data.length;for(const a of e["shapechange-categories"].data){if("object"!=typeof a)return console.log("entry of shapechange-categories is not an object"),null;if("string"!=typeof a.name)return console.log("shapechange-categories.name must be a string"),null;if(!(a.images instanceof Array))return console.log("shapechange-categories.images must be an array"),null;a.images.length>t&&a.images.splice(t);for(const e of a.images)if("boolean"!=typeof e)return console.log("entry of shapechange-categories.images must be boolean"),null;for(;a.images.length<t;)a.images.push(!1)}for(const t of e["store-image-shapechanges"].data){if("object"!=typeof t)return console.log("entry of store-image-shapechanges must be an object"),null;if(!n.isInt(t.src,0))return console.log("store-image-shapechanges.src must be a Uint"),null;if("string"!=typeof t["5e-shapechange-name"])return console.log("store-image-shapechanges.5e-shapechange-name must be a string"),null;if(!n.isInt(t.width,0)||!n.isInt(t.height,0))return console.log("store-image-shapechanges.width/height must be a Uint"),null;if("boolean"!=typeof t.flip||"boolean"!=typeof t.flop)return console.log("store-image-shapechanges.flip/flop must be a boolean"),null}return e},h=l(N.getSettings(_))??{"shapechange-categories":{user:!1,data:[]},"store-image-shapechanges":{user:!1,data:[]}},d=e=>{v.shell.prompt(C.INITIATIVE_ENTER,C.INITIATIVE_ENTER_LONG,"0").then((t=>{if(Se(e)&&null!==t){const a=parseInt(t);n.isInt(a,-20,40)&&(Pe([e.id,a]),Re())}}))},g=e=>{Se(e)&&(Pe([e.id,null]),Re())},I=(e,t,a)=>(null!==t?Promise.resolve(Math.floor(20*(a?Math.max(Math.random(),Math.random()):Math.random()))+1+t):v.shell.prompt(C.INITIATIVE_ENTER,C.INITIATIVE_ENTER_LONG,"0").then((e=>{if(!e)throw new Error("invalid initiative");return parseInt(e)}))).then((t=>{Se(e)&&n.isInt(t,-20,40)&&(Pe([e.id,t]),Re())})).catch((()=>{})),y=h["shapechange-categories"].data.map((e=>({name:e.name,images:e.images.slice()}))),x=h["store-image-shapechanges"].data.map(T.cloneObject),D=e=>{const t={name:null,"5e-ac":null,"5e-hp-max":null,"5e-hp-current":null},{name:a,"5e-ac":i,"5e-hp-max":o,"5e-hp-current":n}=e.tokenData;return a&&(t.name=T.cloneObject(a)),i&&(t["5e-ac"]=T.cloneObject(i)),o&&(t["5e-hp-max"]=T.cloneObject(o)),n&&(t["5e-hp-max"]=T.cloneObject(n)),{src:e.src,width:e.width,height:e.height,flip:e.flip,flop:e.flop,tokenData:t}},R=(e,t)=>{const a={id:e.id,tokenData:{},removeTokenData:[]};if(t)e.tokenData["store-image-5e-initial-token"]||(a.tokenData["store-image-5e-initial-token"]={user:!1,data:D(e)});else{if(!e.tokenData["store-image-5e-initial-token"])return;t=e.tokenData["store-image-5e-initial-token"].data,a.removeTokenData.push("store-image-5e-initial-token")}a.src=t.src,a.width=t.width,a.height=t.height,a.flip=t.flip,a.flop=t.flop;for(const e in a.tokenData){const t=a.tokenData[e];t?a.tokenData[e]=T.cloneObject(t):a.removeTokenData.push(e)}u.doTokenSet(a),e.updateNode(),Ge.has(a.id)&&Pe()},q=(e,t=y.length-1)=>{const o=i.span(e.name),n=i.th([o,w.rename({title:C.SHAPECHANGE_TOKEN_CATEGORY_RENAME,class:c.itemControl,onclick:()=>v.shell.prompt(C.SHAPECHANGE_TOKEN_CATEGORY_RENAME,C.SHAPECHANGE_TOKEN_CATEGORY_RENAME_LONG,e.name).then((t=>{t&&e.name!==t&&a.clearNode(o,e.name=t)}))}),w.remove({title:C.SHAPECHANGE_TOKEN_CATEGORY_REMOVE,class:c.itemControl,onclick:()=>v.shell.confirm(C.SHAPECHANGE_TOKEN_CATEGORY_REMOVE,C.SHAPECHANGE_TOKEN_CATEGORY_REMOVE_LONG,"").then((e=>{if(e){y[t].name="";for(const e of B)e[t].remove();n.remove()}}))})]);return n},G=(e,t,a=!1)=>{const o=i.td([T.labels(i.input({class:c.settingsTicker,type:"checkbox",checked:a,onchange:function(){y[t].images[e]=this.checked}}),"")]);return B[e].push(o),o},$=(e,t)=>{B.push([]);const o=i.span(e["5e-shapechange-name"]),n=i.img({src:`/images/${e.src}`}),s=i.tr([i.th([i.div({class:[c.tokenSelector,F],style:"width: 100px; height: 100px"},[i.button({title:C.SHAPECHANGE_CHANGE,onclick:()=>{const t=u.getToken();if(t){const i=D(t);v.shell.confirm(m.default.TOKEN_REPLACE,m.default.TOKEN_REPLACE_CONFIRM).then((t=>{t&&(Object.assign(e,i),a.amendNode(n,{src:`/images/${e.src}`}))}))}else v.shell.alert(m.default.TOKEN_SELECT,m.default.TOKEN_NONE_SELECTED)}}),n]),i.br(),o,w.rename({title:C.SHAPECHANGE_TOKEN_RENAME,class:c.itemControl,onclick:()=>v.shell.prompt(C.SHAPECHANGE_TOKEN_RENAME,C.SHAPECHANGE_TOKEN_RENAME_LONG,e["5e-shapechange-name"]).then((t=>{t&&e["5e-shapechange-name"]!==t&&a.clearNode(o,e["5e-shapechange-name"]=t)}))}),w.remove({title:C.SHAPECHANGE_TOKEN_REMOVE,class:c.itemControl,onclick:()=>v.shell.confirm(C.SHAPECHANGE_TOKEN_REMOVE,C.SHAPECHANGE_TOKEN_REMOVE_LONG).then((e=>{e&&(L[t].remove(),x[t]["5e-shapechange-name"]="")}))})]),y.map(((e,a)=>G(t,a,e.images[t])))]);return L.push(s),s},P=i.tr([i.td(),y.map(q)]),L=[],B=[],z=i.tbody(x.map($)),V=v.windows({"window-icon":`data:image/svg+xml,%3Csvg xmlns="${r.ns}" viewBox="0 0 2 2"%3E%3Crect width="2" height="2" fill="%23f00"%3E%3Canimate attributeName="rx" values="0;0;1;1;0" dur="16s" repeatCount="indefinite" keyTimes="0;0.375;0.5;0.875;1" /%3E%3Canimate attributeName="fill" values="%23f00;%23f00;%2300f;%2300f;%23f00" dur="16s" repeatCount="indefinite" keyTimes="0;0.375;0.5;0.875;1" /%3E%3C/rect%3E%3C/svg%3E`,"window-title":C.SHAPECHANGE_TITLE,"window-data":"shapechange-5e",resizable:!0},i.div([i.h1(C.SHAPECHANGE_TITLE),i.button({onclick:()=>v.shell.prompt(C.SHAPECHANGE_TOKEN_CATEGORY,C.SHAPECHANGE_TOKEN_CATEGORY_LONG).then((e=>{if(e){const t={name:e,images:Array.from({length:x.length},(()=>!1))},i=y.push(t)-1;a.amendNode(P,q(t));for(let e=0;e<L.length;e++)a.amendNode(L[e],G(e,i))}}))},C.SHAPECHANGE_TOKEN_CATEGORY),i.button({onclick:()=>{const e=u.getToken();if(e){const t=D(e);v.shell.prompt(C.SHAPECHANGE_TOKEN_NAME,C.SHAPECHANGE_TOKEN_NAME_LONG).then((e=>{if(e){const i=Object.assign(t,{"5e-shapechange-name":e});a.amendNode(z,$(i,x.length)),x.push(i);for(const e of y)e.images.push(!1)}}))}else v.shell.alert(m.default.TOKEN_SELECT,m.default.TOKEN_NONE_SELECTED)}},C.SHAPECHANGE_TOKEN_ADD),i.table({id:X},[i.thead(P),z]),i.button({onclick:()=>{const e=[],t=[],a=[];for(const e of x)e["5e-shapechange-name"]?(a.push(!0),t.push(T.cloneObject(e))):a.push(!1);for(const t of y)if(t.name){const i=[];for(let e=0;e<a.length;e++)a[e]&&i.push(t.images[e]);e.push({name:t.name,images:i})}h["shapechange-categories"]={user:!1,data:e},h["store-image-shapechanges"]={user:!1,data:t},E.rpc.pluginSetting(_,h,[])}},m.default.SAVE)])),[j,K]=f.registerKeyEvent("5e-health-key",C.KEY_HEALTH,"h",void 0,(()=>{const{token:e}=k.selected;if(e instanceof M){const t=e.getData("5e-hp-current");null!==t&&v.shell.prompt(C.HP_CURRENT,C.HP_CURRENT_ENTER,t).then((a=>{if(null!==a&&Se(e)){const i=Math.max(0,parseInt(a)+(a.startsWith("+")||a.startsWith("-")?t:0));isNaN(i)||u.doTokenSet({id:e.id,tokenData:{"5e-hp-current":{user:!1,data:Math.max(0,(parseInt(a)||0)+(a.startsWith("+")||a.startsWith("-")?t:0))}}})}}))}})),[U,Y]=f.registerKeyEvent("5e-initiative-key",C.KEY_INITIATIVE,"i",void 0,(()=>{const{token:e}=k.selected;e instanceof M&&(p.mapData.data["5e-initiative"]&&p.mapData.data["5e-initiative"].some((t=>t.id===e.id))?d(e):I(e,e.getData("5e-initiative-mod"),e.getData("5e-initiative-adv")??!1))})),W=(e,t)=>{if(Se(e)){const a=e.getData("5e-conditions")?.slice()??Array.from({length:_e.length},(e=>!1));a[t]=!a[t],u.doTokenSet({id:e.id,tokenData:{"5e-conditions":{user:!0,data:a}}})}},Z=_e.map(((t,a)=>f.registerKeyEvent("5e-"+t,e.default`${C.TOGGLE_CONDITION}: ${C[t]}`,"",void 0,(()=>W(k.selected.token,a)))));t.add(`.${c.adminHideLight} #${ee}`,{display:"none"}),a.amendNode(je.settings.fn,i.button({onclick:()=>a.amendNode(v.shell,V)},C.SHAPECHANGE_5E)),je.characterEdit={fn:(e,t,o,s,l,r)=>{const h=!s&&o["store-character-id"]&&T.characterData.has(o["store-character-id"].data)?(()=>{const e=T.characterData.get(o["store-character-id"].data);return t=>o[t]??e[t]??{}})():e=>o[e]??{};return a.amendNode(e,[T.labels([C.INITIATIVE_MOD,": "],i.input({type:"number",min:-20,max:20,step:1,value:h("5e-initiative-mod").data??"",onchange:function(){""===this.value?r.add("5e-initiative-mod"):(r.delete("5e-initiative-mod"),l["5e-initiative-mod"]={user:!1,data:n.checkInt(parseInt(this.value),-20,20,0)})}})),T.labels([C.INITIATIVE_ADV,": "],i.input({type:"checkbox",checked:h("5e-initiative-adv").data??!1,onchange:function(){l["5e-initiative-adv"]={user:!1,data:this.checked}}})),i.br(),T.labels([C.ARMOUR_CLASS,": "],i.input({type:"number",min:0,max:50,step:1,value:h("5e-ac").data??10,onchange:function(){l["5e-ac"]={user:!1,data:n.checkInt(parseInt(this.value),0,50,0)}}})),i.br(),T.labels([C.HP_CURRENT,": "],i.input({type:"number",min:0,step:1,value:h("5e-hp-current").data??10,onchange:function(){l["5e-hp-current"]={user:!1,data:n.checkInt(parseInt(this.value),0,1/0,0)}}})),i.br(),T.labels([C.HP_MAX,": "],i.input({type:"number",min:0,step:1,value:h("5e-hp-max").data??10,onchange:function(){l["5e-hp-max"]={user:!1,data:n.checkInt(parseInt(this.value),0,1/0,0)}}})),i.br(),T.labels(i.input({type:"checkbox",class:c.settingsTicker,checked:h("5e-player").data,onchange:function(){l["5e-player"]={user:!0,data:this.checked}}}),[C.IS_PLAYER,": "]),i.br(),T.labels([C.DARKVISION,": "],i.input({type:"number",min:0,step:1,value:h("5e-darkvision").data??0,onchange:function(){l["5e-darkvision"]={user:!0,data:n.checkInt(parseInt(this.value),0,1/0,0)}}})),i.br(),T.labels([C.NOTES,": "],i.textarea({rows:10,cols:30,style:"resize: none",onchange:function(){l["5e-notes"]={user:!1,data:this.value}}},h("5e-notes").data??""))]),()=>{let e=!1,a=!1;if(s)for(const[,{token:i}]of k.tokens)i instanceof M&&i.tokenData["store-character-id"]?.data===t&&(i[O](),Ge.has(i.id)&&(e=!0),(l["5e-player"]||l["5e-darkvision"])&&(a=!0));else k.tokens.get(t).token[O](),e=!!l.name&&Ge.has(t),a=!!l["5e-player"];e?Pe():a&&Ve()}}},je.tokenContext={fn:()=>{const{token:e}=k.selected;if(!(e instanceof M))return[];const t=e.getData("5e-initiative-mod"),a=e.getData("5e-conditions")??[],{"shapechange-categories":{data:i},"store-image-shapechanges":{data:n}}=h,l=[];return p.mapData.data["5e-initiative"]&&p.mapData.data["5e-initiative"].some((t=>t.id===e.id))?l.push(o.item({onselect:()=>Se(e)&&d(e)},C.INITIATIVE_CHANGE),o.item({onselect:()=>Se(e)&&g(e)},C.INITIATIVE_REMOVE)):l.push(o.item({onselect:()=>Se(e)&&I(e,t,e.getData("5e-initiative-adv")??!1)},C.INITIATIVE_ADD)),l.push(o.submenu([o.item(C.CONDITIONS),o.menu({class:S},_e.map(((e,t)=>[e,t])).sort((([e],[t])=>s.stringSort(C[e]+"",C[t]+""))).map((([t,i])=>o.item({onselect:()=>W(e,i),class:{[H]:!!a[i]}},C[t]))))])),i&&i.length&&l.push(o.submenu([o.item(C.SHAPECHANGE),o.menu([e.tokenData["store-image-5e-initial-token"]?o.item({onselect:()=>{Se(e)&&R(e)}},C.SHAPECHANGE_INITIAL_RESTORE):[],i.map((t=>o.submenu([o.item(t.name),o.menu(t.images.map(((t,a)=>{if(t){const t=n[a];return o.item({onselect:()=>{Se(e)&&R(e,t)}},t["5e-shapechange-name"])}return[]})))])))])])),l}},E.rpc.waitPluginSetting().when((e=>{e.id===_&&l(e.setting)&&(h["shapechange-categories"]=e.setting["shapechange-categories"].data,h["store-image-shapechanges"]=e.setting["store-image-shapechanges"].data)})),k.tokenSelectedReceive((()=>{let e=null;return()=>{e?.[A]();const{token:t}=k.selected;if(t instanceof M&&!t.isPattern){j(),U();for(const[e]of Z)e();e=t,t[b]()}else{K(),Y();for(const[,e]of Z)e()}}})())}else t.add(`#${Q}`,{" thead, td:last-child":{display:"none"}});N.addPlugin("5e",je),T.mapLoadedReceive((()=>{qe.remove(),n.queue((async()=>{for(const[,e]of k.tokens)e instanceof M&&e[O]();a.clearNode(p.getLayer("/Light").l,[r.use({href:`#${c.lighting}`,style:"mix-blend-mode: saturation",filter:`url(#${we})`,"clip-path":`url(#${ye})`}),r.g({style:"mix-blend-mode: multiply"},[r.use({href:`#${c.lighting}`}),r.use({href:`#${c.lighting}`,filter:`url(#${ve})`,"clip-path":`url(#${ye})`})])]),Pe()}))})),E.combined.waitTokenSet().when((e=>{const{tokenData:t,removeTokenData:a}=e;if(t&&(t["5e-initiative"]||void 0!==t.name)||a&&(a.includes("5e-initiative")||a.includes("name")))setTimeout((()=>{Ge.has(e.id)&&Pe(),k.tokens.get(e.id).token[O]()}),0);else{if(t)for(const a in t)switch(a){case"5e-ac":case"5e-hp-max":case"5e-hp-current":case"5e-conditions":return void setTimeout((()=>k.tokens.get(e.id).token[O]()),0)}if(a)for(const t of a)switch(t){case"5e-ac":case"5e-hp-max":case"5e-hp-current":case"5e-conditions":return void setTimeout((()=>k.tokens.get(e.id).token[O]()),0)}}})),E.combined.waitMapDataSet().when((e=>{"5e-initiative"===e.key&&setTimeout(Pe,0)})),E.combined.waitMapDataRemove().when((e=>{"5e-initiative"===e&&qe.remove()})),E.combined.waitTokenRemove().when((e=>setTimeout(Ge.has(e)?Pe:Ve))),E.combined.waitTokenAdd().when((({token:{id:e}})=>setTimeout(Ge.has(e)?Pe:Ve))),E.combined.waitTokenMoveLayerPos().when((({id:e})=>setTimeout(Ge.has(e)?Pe:Ve))),E.combined.waitTokenSet().when((({id:e})=>setTimeout(Ge.has(e)?Pe:Ve))),E.combined.waitTokenSetMulti().when((e=>{for(const{id:t}of e)if(Ge.has(t))return void setTimeout(Pe);setTimeout(Ve)}));for(const e of["waitLayerShow","waitLayerHide","waitLayerRemove"])E.combined[e]().when((()=>setTimeout(Pe)));for(const e of["waitLayerShift","waitLayerMove","waitWallAdded","waitWallRemoved","waitWallModified","waitWallMoved"])E.combined[e]().when((()=>setTimeout(Ve)));E.rpc.waitCharacterDataChange().when((({id:e})=>setTimeout((()=>{let t=!1;for(const[,{token:a}]of k.tokens)a instanceof M&&a.tokenData["store-character-id"]?.data===e&&(a[O](),!t&&Ge.has(a.id)&&(setTimeout(Pe),t=!0))})))),E.addMapDataChecker((e=>{for(const t in e){let a="";if("5e-initiative"===t){const i=e[t];if(i instanceof Array)for(const e of i){if(!(e instanceof Object)){a="Map Data value of 5e-initiative needs to be an array of Objects";break}if(!n.isInt(e.id,0)){a="Map Data value of IDInitiative.id needs to be a Uint";break}if(!n.isInt(e.initiative)){a="Map Data value of 5e-initiative needs to be an Int";break}}else a="Map Data value of 5e-initiative needs to be an array"}a&&(delete e[t],console.log(new TypeError(a)))}})),E.addCharacterDataChecker((e=>{for(const t in e){const a=e[t].data;let i="";switch(t){case"name":"string"!=typeof a&&(i="Character Data 'name' must be a string");break;case"5e-ac":n.isInt(a,0,50)||(i="Character Data '5e-ac' must be a Uint <= 50");break;case"5e-hp-max":n.isInt(a,0)||(i="Character Data '5e-hp-max' must be a Uint");break;case"5e-hp-current":n.isInt(a,0)||(i="Character Data '5e-hp-current' must be a Uint");break;case"5e-initiative-adv":"boolean"!=typeof a&&(i="Token Data '5e-initiative-adv' must be a boolean");break;case"5e-initiative-mod":n.isInt(a,-20,20)||(i="Character Data '5e-initiative-mod' must be an Int between -20 and 20");break;case"5e-notes":"string"!=typeof a&&(i="Character Data '5e-notes' must be a string");break;case"5e-player":"boolean"!=typeof a&&(i="Token Data '5e-player' must be a boolean");break;case"5e-darkvision":n.isInt(a,0)||(i="Token Data '5e-darkvision' must be a Uint")}i&&(delete e[t],console.log(new TypeError(i)))}})),E.addTokenDataChecker((e=>{for(const t in e){const a=e[t].data;let i="";switch(t){case"name":"string"!=typeof a&&(i="Token Data 'name' must be a string");break;case"5e-ac":n.isInt(a,0,50)||(i="Token Data '5e-ac' must be a Uint <= 50");break;case"5e-hp-max":n.isInt(a,0)||(i="Token Data '5e-hp-max' must be a Uint");break;case"5e-hp-current":n.isInt(a,0)||(i="Token Data '5e-hp-current' must be a Uint");break;case"5e-initiative-adv":"boolean"!=typeof a&&(i="Token Data '5e-initiative-adv' must be a boolean");break;case"5e-initiative-mod":n.isInt(a,-20,20)||(i="Token Data '5e-initiative-mod' must be an Int between -20 and 20");break;case"5e-conditions":a instanceof Array&&a.length===_e.length&&a.every((e=>"boolean"==typeof e))||(i="Token Data '5e-conditions' must be a boolean array of correct length");break;case"5e-player":"boolean"!=typeof a&&(i="Token Data '5e-player' must be a boolean");break;case"5e-darkvision":n.isInt(a,0)||(i="Token Data '5e-darkvision' must be a Uint");break;case"store-image-5e-initial-token":"object"!=typeof a?i="Token Data 'store-image-5e-initial-token' must be an object":n.isInt(a.src,0)?n.isInt(a.width,0)&&n.isInt(a.height,0)?"boolean"==typeof a.flip&&"boolean"==typeof a.flop||(i="Token Data 'store-image-5e-initial-token' flip & flop must be boolean"):i="Token Data 'store-image-5e-initial-token' width & height must be Uints":i="Token Data 'store-image-5e-initial-token' src must be a Uint";break;case"5e-notes":"string"!=typeof a&&(i="Token Data '5e-notes' must be a string")}i&&(delete e[t],console.log(new TypeError(i)))}}));