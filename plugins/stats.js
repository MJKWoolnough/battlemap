const[e,t,i,s,n,o,a,d,r,l,c]=await Promise.all(["/lib/conn.js","/lib/css.js","/lib/dom.js","/lib/html.js","/lib/nodes.js","/lib/svg.js","/adminMap.js","/language.js","/map_tokens.js","/plugins.js","/rpc.js"].map(include));if(c.isAdmin){const c=d.makeLangPack({GENERATE_STATISTICS:"Generate Statistics",ID:"ID",IMAGE:"Image",MAP:"Map ID",MENU_TITLE:"Statistics",NO_MAP:"No map loaded",SIZE:"Size",TOTAL_SIZE:"Total Size"}),h=(e,t)=>e.id-t.id,m=(e,t)=>t.size-e.size,g=s.div(),f=new n.NodeArray(s.tbody()),E=s.thead(s.tr([s.th({onclick:()=>f.sort(h)},c.ID),s.th(c.IMAGE),s.th({onclick:()=>f.sort(m)},c.SIZE)])),p=new Intl.NumberFormat(d.language.value,{style:"unit",unit:"byte",unitDisplay:"narrow"}),I=t.id();t.add(`#${I}`,{" img":{width:"100%",height:"100%"}," th:not(:nth-child(2)):hover":{cursor:"pointer"}});let T=0;a.mapLoadReceive((e=>T=e)),l.addPlugin("stats",{menuItem:{fn:[c.MENU_TITLE,s.div([s.button({onclick:()=>{f.splice(0,f.length);const t=performance?.getEntries()??[],o=new Set,a=new Map,d=window.location.origin+"/images/",l=s.div();for(const e of t)if(e instanceof PerformanceResourceTiming&&e.name.startsWith(d)){const t=parseInt(e.name.slice(d.length));t&&!a.has(t)&&a.set(t,e.decodedBodySize)}let h=0;for(const[,{token:t}]of r.tokens)if(t instanceof r.SVGToken){const d=t.src;if(o.has(d))continue;if(o.add(d),a.has(d)){const e=a.get(d);h+=e,f.push({id:d,size:e,[n.node]:s.tr([s.td(d+""),s.td(s.img({src:`/images/${d}`})),s.td(p.format(e))])})}else{const t=s.td(),o={id:d,size:0,[n.node]:s.tr([s.td(d+""),s.td(s.img({src:`/images/${d}`})),t])};e.HTTPRequest(`/images/${d}`,{method:"head",response:"xh"}).then((e=>{const s=parseInt(e.getResponseHeader("Content-Length")||"0");i.clearNode(t,p.format(o.size=s)),i.clearNode(l,p.format(h+=s)),f.sort()})),f.push(o)}}i.clearNode(g,[s.h2([c.MAP,`: ${T}`]),i.amendNode(l,[c.TOTAL_SIZE,`: ${p.format(h)}`]),s.table({id:I},[E,f[n.node]])])}},c.GENERATE_STATISTICS),g]),!0,`data:image/svg+xml,%3Csvg xmlns="${o.ns}" viewBox="0 0 100 100"%3E%3Crect x="12" y="60" width="20" height="39" rx="3" fill="%23f00" /%3E%3Crect x="42" y="40" width="20" height="59" rx="3" fill="%230f0" /%3E%3Crect x="72" y="20" width="20" height="79" rx="3" fill="%2300f" /%3E%3Cpath d="M4,4 V96 H96" stroke="%23888" fill="none" stroke-width="8" stroke-linecap="round" /%3E%3C/svg%3E`]}})}